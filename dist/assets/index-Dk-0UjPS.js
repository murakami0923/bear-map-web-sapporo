(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))y(w);new MutationObserver(w=>{for(const T of w)if(T.type==="childList")for(const M of T.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function h(w){const T={};return w.integrity&&(T.integrity=w.integrity),w.referrerPolicy&&(T.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?T.credentials="include":w.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function y(w){if(w.ep)return;w.ep=!0;const T=h(w);fetch(w.href,T)}})();var Ew=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Iw(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var yv={exports:{}},Nd={},_v={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ic=Symbol.for("react.element"),Cw=Symbol.for("react.portal"),Pw=Symbol.for("react.fragment"),zw=Symbol.for("react.strict_mode"),Mw=Symbol.for("react.profiler"),Aw=Symbol.for("react.provider"),Dw=Symbol.for("react.context"),Lw=Symbol.for("react.forward_ref"),Rw=Symbol.for("react.suspense"),Fw=Symbol.for("react.memo"),Bw=Symbol.for("react.lazy"),a_=Symbol.iterator;function Ow(i){return i===null||typeof i!="object"?null:(i=a_&&i[a_]||i["@@iterator"],typeof i=="function"?i:null)}var vv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xv=Object.assign,wv={};function Dl(i,s,h){this.props=i,this.context=s,this.refs=wv,this.updater=h||vv}Dl.prototype.isReactComponent={};Dl.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};Dl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function bv(){}bv.prototype=Dl.prototype;function zm(i,s,h){this.props=i,this.context=s,this.refs=wv,this.updater=h||vv}var Mm=zm.prototype=new bv;Mm.constructor=zm;xv(Mm,Dl.prototype);Mm.isPureReactComponent=!0;var o_=Array.isArray,Sv=Object.prototype.hasOwnProperty,Am={current:null},Tv={key:!0,ref:!0,__self:!0,__source:!0};function kv(i,s,h){var y,w={},T=null,M=null;if(s!=null)for(y in s.ref!==void 0&&(M=s.ref),s.key!==void 0&&(T=""+s.key),s)Sv.call(s,y)&&!Tv.hasOwnProperty(y)&&(w[y]=s[y]);var l=arguments.length-2;if(l===1)w.children=h;else if(1<l){for(var G=Array(l),O=0;O<l;O++)G[O]=arguments[O+2];w.children=G}if(i&&i.defaultProps)for(y in l=i.defaultProps,l)w[y]===void 0&&(w[y]=l[y]);return{$$typeof:Ic,type:i,key:T,ref:M,props:w,_owner:Am.current}}function Nw(i,s){return{$$typeof:Ic,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function Dm(i){return typeof i=="object"&&i!==null&&i.$$typeof===Ic}function Vw(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return s[h]})}var l_=/\/+/g;function uf(i,s){return typeof i=="object"&&i!==null&&i.key!=null?Vw(""+i.key):s.toString(36)}function id(i,s,h,y,w){var T=typeof i;(T==="undefined"||T==="boolean")&&(i=null);var M=!1;if(i===null)M=!0;else switch(T){case"string":case"number":M=!0;break;case"object":switch(i.$$typeof){case Ic:case Cw:M=!0}}if(M)return M=i,w=w(M),i=y===""?"."+uf(M,0):y,o_(w)?(h="",i!=null&&(h=i.replace(l_,"$&/")+"/"),id(w,s,h,"",function(O){return O})):w!=null&&(Dm(w)&&(w=Nw(w,h+(!w.key||M&&M.key===w.key?"":(""+w.key).replace(l_,"$&/")+"/")+i)),s.push(w)),1;if(M=0,y=y===""?".":y+":",o_(i))for(var l=0;l<i.length;l++){T=i[l];var G=y+uf(T,l);M+=id(T,s,h,G,w)}else if(G=Ow(i),typeof G=="function")for(i=G.call(i),l=0;!(T=i.next()).done;)T=T.value,G=y+uf(T,l++),M+=id(T,s,h,G,w);else if(T==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return M}function Nh(i,s,h){if(i==null)return i;var y=[],w=0;return id(i,y,"","",function(T){return s.call(h,T,w++)}),y}function jw(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var Bi={current:null},nd={transition:null},Uw={ReactCurrentDispatcher:Bi,ReactCurrentBatchConfig:nd,ReactCurrentOwner:Am};function Ev(){throw Error("act(...) is not supported in production builds of React.")}It.Children={map:Nh,forEach:function(i,s,h){Nh(i,function(){s.apply(this,arguments)},h)},count:function(i){var s=0;return Nh(i,function(){s++}),s},toArray:function(i){return Nh(i,function(s){return s})||[]},only:function(i){if(!Dm(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};It.Component=Dl;It.Fragment=Pw;It.Profiler=Mw;It.PureComponent=zm;It.StrictMode=zw;It.Suspense=Rw;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Uw;It.act=Ev;It.cloneElement=function(i,s,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var y=xv({},i.props),w=i.key,T=i.ref,M=i._owner;if(s!=null){if(s.ref!==void 0&&(T=s.ref,M=Am.current),s.key!==void 0&&(w=""+s.key),i.type&&i.type.defaultProps)var l=i.type.defaultProps;for(G in s)Sv.call(s,G)&&!Tv.hasOwnProperty(G)&&(y[G]=s[G]===void 0&&l!==void 0?l[G]:s[G])}var G=arguments.length-2;if(G===1)y.children=h;else if(1<G){l=Array(G);for(var O=0;O<G;O++)l[O]=arguments[O+2];y.children=l}return{$$typeof:Ic,type:i.type,key:w,ref:T,props:y,_owner:M}};It.createContext=function(i){return i={$$typeof:Dw,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Aw,_context:i},i.Consumer=i};It.createElement=kv;It.createFactory=function(i){var s=kv.bind(null,i);return s.type=i,s};It.createRef=function(){return{current:null}};It.forwardRef=function(i){return{$$typeof:Lw,render:i}};It.isValidElement=Dm;It.lazy=function(i){return{$$typeof:Bw,_payload:{_status:-1,_result:i},_init:jw}};It.memo=function(i,s){return{$$typeof:Fw,type:i,compare:s===void 0?null:s}};It.startTransition=function(i){var s=nd.transition;nd.transition={};try{i()}finally{nd.transition=s}};It.unstable_act=Ev;It.useCallback=function(i,s){return Bi.current.useCallback(i,s)};It.useContext=function(i){return Bi.current.useContext(i)};It.useDebugValue=function(){};It.useDeferredValue=function(i){return Bi.current.useDeferredValue(i)};It.useEffect=function(i,s){return Bi.current.useEffect(i,s)};It.useId=function(){return Bi.current.useId()};It.useImperativeHandle=function(i,s,h){return Bi.current.useImperativeHandle(i,s,h)};It.useInsertionEffect=function(i,s){return Bi.current.useInsertionEffect(i,s)};It.useLayoutEffect=function(i,s){return Bi.current.useLayoutEffect(i,s)};It.useMemo=function(i,s){return Bi.current.useMemo(i,s)};It.useReducer=function(i,s,h){return Bi.current.useReducer(i,s,h)};It.useRef=function(i){return Bi.current.useRef(i)};It.useState=function(i){return Bi.current.useState(i)};It.useSyncExternalStore=function(i,s,h){return Bi.current.useSyncExternalStore(i,s,h)};It.useTransition=function(){return Bi.current.useTransition()};It.version="18.3.1";_v.exports=It;var yt=_v.exports;const $w=Iw(yt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zw=yt,qw=Symbol.for("react.element"),Gw=Symbol.for("react.fragment"),Hw=Object.prototype.hasOwnProperty,Ww=Zw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xw={key:!0,ref:!0,__self:!0,__source:!0};function Iv(i,s,h){var y,w={},T=null,M=null;h!==void 0&&(T=""+h),s.key!==void 0&&(T=""+s.key),s.ref!==void 0&&(M=s.ref);for(y in s)Hw.call(s,y)&&!Xw.hasOwnProperty(y)&&(w[y]=s[y]);if(i&&i.defaultProps)for(y in s=i.defaultProps,s)w[y]===void 0&&(w[y]=s[y]);return{$$typeof:qw,type:i,key:T,ref:M,props:w,_owner:Ww.current}}Nd.Fragment=Gw;Nd.jsx=Iv;Nd.jsxs=Iv;yv.exports=Nd;var me=yv.exports,Ff={},Cv={exports:{}},dn={},Pv={exports:{}},zv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(He,dt){var gt=He.length;He.push(dt);e:for(;0<gt;){var Ut=gt-1>>>1,Bt=He[Ut];if(0<w(Bt,dt))He[Ut]=dt,He[gt]=Bt,gt=Ut;else break e}}function h(He){return He.length===0?null:He[0]}function y(He){if(He.length===0)return null;var dt=He[0],gt=He.pop();if(gt!==dt){He[0]=gt;e:for(var Ut=0,Bt=He.length,Dt=Bt>>>1;Ut<Dt;){var lr=2*(Ut+1)-1,en=He[lr],ci=lr+1,tn=He[ci];if(0>w(en,gt))ci<Bt&&0>w(tn,en)?(He[Ut]=tn,He[ci]=gt,Ut=ci):(He[Ut]=en,He[lr]=gt,Ut=lr);else if(ci<Bt&&0>w(tn,gt))He[Ut]=tn,He[ci]=gt,Ut=ci;else break e}}return dt}function w(He,dt){var gt=He.sortIndex-dt.sortIndex;return gt!==0?gt:He.id-dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;i.unstable_now=function(){return T.now()}}else{var M=Date,l=M.now();i.unstable_now=function(){return M.now()-l}}var G=[],O=[],ve=1,ge=null,oe=3,ze=!1,Fe=!1,Ce=!1,lt=typeof setTimeout=="function"?setTimeout:null,ie=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(He){for(var dt=h(O);dt!==null;){if(dt.callback===null)y(O);else if(dt.startTime<=He)y(O),dt.sortIndex=dt.expirationTime,s(G,dt);else break;dt=h(O)}}function Ee(He){if(Ce=!1,ce(He),!Fe)if(h(G)!==null)Fe=!0,Ti(Ge);else{var dt=h(O);dt!==null&&$r(Ee,dt.startTime-He)}}function Ge(He,dt){Fe=!1,Ce&&(Ce=!1,ie(Ze),Ze=-1),ze=!0;var gt=oe;try{for(ce(dt),ge=h(G);ge!==null&&(!(ge.expirationTime>dt)||He&&!Ar());){var Ut=ge.callback;if(typeof Ut=="function"){ge.callback=null,oe=ge.priorityLevel;var Bt=Ut(ge.expirationTime<=dt);dt=i.unstable_now(),typeof Bt=="function"?ge.callback=Bt:ge===h(G)&&y(G),ce(dt)}else y(G);ge=h(G)}if(ge!==null)var Dt=!0;else{var lr=h(O);lr!==null&&$r(Ee,lr.startTime-dt),Dt=!1}return Dt}finally{ge=null,oe=gt,ze=!1}}var We=!1,Je=null,Ze=-1,Vt=5,Ue=-1;function Ar(){return!(i.unstable_now()-Ue<Vt)}function Rr(){if(Je!==null){var He=i.unstable_now();Ue=He;var dt=!0;try{dt=Je(!0,He)}finally{dt?ui():(We=!1,Je=null)}}else We=!1}var ui;if(typeof te=="function")ui=function(){te(Rr)};else if(typeof MessageChannel<"u"){var Dr=new MessageChannel,Qr=Dr.port2;Dr.port1.onmessage=Rr,ui=function(){Qr.postMessage(null)}}else ui=function(){lt(Rr,0)};function Ti(He){Je=He,We||(We=!0,ui())}function $r(He,dt){Ze=lt(function(){He(i.unstable_now())},dt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(He){He.callback=null},i.unstable_continueExecution=function(){Fe||ze||(Fe=!0,Ti(Ge))},i.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Vt=0<He?Math.floor(1e3/He):5},i.unstable_getCurrentPriorityLevel=function(){return oe},i.unstable_getFirstCallbackNode=function(){return h(G)},i.unstable_next=function(He){switch(oe){case 1:case 2:case 3:var dt=3;break;default:dt=oe}var gt=oe;oe=dt;try{return He()}finally{oe=gt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(He,dt){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var gt=oe;oe=He;try{return dt()}finally{oe=gt}},i.unstable_scheduleCallback=function(He,dt,gt){var Ut=i.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?Ut+gt:Ut):gt=Ut,He){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=gt+Bt,He={id:ve++,callback:dt,priorityLevel:He,startTime:gt,expirationTime:Bt,sortIndex:-1},gt>Ut?(He.sortIndex=gt,s(O,He),h(G)===null&&He===h(O)&&(Ce?(ie(Ze),Ze=-1):Ce=!0,$r(Ee,gt-Ut))):(He.sortIndex=Bt,s(G,He),Fe||ze||(Fe=!0,Ti(Ge))),He},i.unstable_shouldYield=Ar,i.unstable_wrapCallback=function(He){var dt=oe;return function(){var gt=oe;oe=dt;try{return He.apply(this,arguments)}finally{oe=gt}}}})(zv);Pv.exports=zv;var Kw=Pv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yw=yt,hn=Kw;function De(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)s+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Mv=new Set,cc={};function vo(i,s){El(i,s),El(i+"Capture",s)}function El(i,s){for(cc[i]=s,i=0;i<s.length;i++)Mv.add(s[i])}var Us=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bf=Object.prototype.hasOwnProperty,Qw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u_={},c_={};function Jw(i){return Bf.call(c_,i)?!0:Bf.call(u_,i)?!1:Qw.test(i)?c_[i]=!0:(u_[i]=!0,!1)}function eb(i,s,h,y){if(h!==null&&h.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return y?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function tb(i,s,h,y){if(s===null||typeof s>"u"||eb(i,s,h,y))return!0;if(y)return!1;if(h!==null)switch(h.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Oi(i,s,h,y,w,T,M){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=y,this.attributeNamespace=w,this.mustUseProperty=h,this.propertyName=i,this.type=s,this.sanitizeURL=T,this.removeEmptyString=M}var li={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){li[i]=new Oi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];li[s]=new Oi(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){li[i]=new Oi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){li[i]=new Oi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){li[i]=new Oi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){li[i]=new Oi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){li[i]=new Oi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){li[i]=new Oi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){li[i]=new Oi(i,5,!1,i.toLowerCase(),null,!1,!1)});var Lm=/[\-:]([a-z])/g;function Rm(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(Lm,Rm);li[s]=new Oi(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(Lm,Rm);li[s]=new Oi(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(Lm,Rm);li[s]=new Oi(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){li[i]=new Oi(i,1,!1,i.toLowerCase(),null,!1,!1)});li.xlinkHref=new Oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){li[i]=new Oi(i,1,!1,i.toLowerCase(),null,!0,!0)});function Fm(i,s,h,y){var w=li.hasOwnProperty(s)?li[s]:null;(w!==null?w.type!==0:y||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(tb(s,h,w,y)&&(h=null),y||w===null?Jw(s)&&(h===null?i.removeAttribute(s):i.setAttribute(s,""+h)):w.mustUseProperty?i[w.propertyName]=h===null?w.type===3?!1:"":h:(s=w.attributeName,y=w.attributeNamespace,h===null?i.removeAttribute(s):(w=w.type,h=w===3||w===4&&h===!0?"":""+h,y?i.setAttributeNS(y,s,h):i.setAttribute(s,h))))}var Gs=Yw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vh=Symbol.for("react.element"),ll=Symbol.for("react.portal"),ul=Symbol.for("react.fragment"),Bm=Symbol.for("react.strict_mode"),Of=Symbol.for("react.profiler"),Av=Symbol.for("react.provider"),Dv=Symbol.for("react.context"),Om=Symbol.for("react.forward_ref"),Nf=Symbol.for("react.suspense"),Vf=Symbol.for("react.suspense_list"),Nm=Symbol.for("react.memo"),ya=Symbol.for("react.lazy"),Lv=Symbol.for("react.offscreen"),h_=Symbol.iterator;function Uu(i){return i===null||typeof i!="object"?null:(i=h_&&i[h_]||i["@@iterator"],typeof i=="function"?i:null)}var _r=Object.assign,cf;function Ku(i){if(cf===void 0)try{throw Error()}catch(h){var s=h.stack.trim().match(/\n( *(at )?)/);cf=s&&s[1]||""}return`
`+cf+i}var hf=!1;function df(i,s){if(!i||hf)return"";hf=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(O){var y=O}Reflect.construct(i,[],s)}else{try{s.call()}catch(O){y=O}i.call(s.prototype)}else{try{throw Error()}catch(O){y=O}i()}}catch(O){if(O&&y&&typeof O.stack=="string"){for(var w=O.stack.split(`
`),T=y.stack.split(`
`),M=w.length-1,l=T.length-1;1<=M&&0<=l&&w[M]!==T[l];)l--;for(;1<=M&&0<=l;M--,l--)if(w[M]!==T[l]){if(M!==1||l!==1)do if(M--,l--,0>l||w[M]!==T[l]){var G=`
`+w[M].replace(" at new "," at ");return i.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",i.displayName)),G}while(1<=M&&0<=l);break}}}finally{hf=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?Ku(i):""}function rb(i){switch(i.tag){case 5:return Ku(i.type);case 16:return Ku("Lazy");case 13:return Ku("Suspense");case 19:return Ku("SuspenseList");case 0:case 2:case 15:return i=df(i.type,!1),i;case 11:return i=df(i.type.render,!1),i;case 1:return i=df(i.type,!0),i;default:return""}}function jf(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ul:return"Fragment";case ll:return"Portal";case Of:return"Profiler";case Bm:return"StrictMode";case Nf:return"Suspense";case Vf:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Dv:return(i.displayName||"Context")+".Consumer";case Av:return(i._context.displayName||"Context")+".Provider";case Om:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Nm:return s=i.displayName||null,s!==null?s:jf(i.type)||"Memo";case ya:s=i._payload,i=i._init;try{return jf(i(s))}catch{}}return null}function ib(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return jf(s);case 8:return s===Bm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Ma(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Rv(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function nb(i){var s=Rv(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),y=""+i[s];if(!i.hasOwnProperty(s)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var w=h.get,T=h.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return w.call(this)},set:function(M){y=""+M,T.call(this,M)}}),Object.defineProperty(i,s,{enumerable:h.enumerable}),{getValue:function(){return y},setValue:function(M){y=""+M},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function jh(i){i._valueTracker||(i._valueTracker=nb(i))}function Fv(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var h=s.getValue(),y="";return i&&(y=Rv(i)?i.checked?"true":"false":i.value),i=y,i!==h?(s.setValue(i),!0):!1}function md(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Uf(i,s){var h=s.checked;return _r({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function d_(i,s){var h=s.defaultValue==null?"":s.defaultValue,y=s.checked!=null?s.checked:s.defaultChecked;h=Ma(s.value!=null?s.value:h),i._wrapperState={initialChecked:y,initialValue:h,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Bv(i,s){s=s.checked,s!=null&&Fm(i,"checked",s,!1)}function $f(i,s){Bv(i,s);var h=Ma(s.value),y=s.type;if(h!=null)y==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(y==="submit"||y==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?Zf(i,s.type,h):s.hasOwnProperty("defaultValue")&&Zf(i,s.type,Ma(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function p_(i,s,h){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var y=s.type;if(!(y!=="submit"&&y!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,h||s===i.value||(i.value=s),i.defaultValue=s}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function Zf(i,s,h){(s!=="number"||md(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var Yu=Array.isArray;function xl(i,s,h,y){if(i=i.options,s){s={};for(var w=0;w<h.length;w++)s["$"+h[w]]=!0;for(h=0;h<i.length;h++)w=s.hasOwnProperty("$"+i[h].value),i[h].selected!==w&&(i[h].selected=w),w&&y&&(i[h].defaultSelected=!0)}else{for(h=""+Ma(h),s=null,w=0;w<i.length;w++){if(i[w].value===h){i[w].selected=!0,y&&(i[w].defaultSelected=!0);return}s!==null||i[w].disabled||(s=i[w])}s!==null&&(s.selected=!0)}}function qf(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(De(91));return _r({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function f_(i,s){var h=s.value;if(h==null){if(h=s.children,s=s.defaultValue,h!=null){if(s!=null)throw Error(De(92));if(Yu(h)){if(1<h.length)throw Error(De(93));h=h[0]}s=h}s==null&&(s=""),h=s}i._wrapperState={initialValue:Ma(h)}}function Ov(i,s){var h=Ma(s.value),y=Ma(s.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),s.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),y!=null&&(i.defaultValue=""+y)}function m_(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function Nv(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gf(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?Nv(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Uh,Vv=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,h,y,w){MSApp.execUnsafeLocalFunction(function(){return i(s,h,y,w)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(Uh=Uh||document.createElement("div"),Uh.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Uh.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function hc(i,s){if(s){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=s;return}}i.textContent=s}var ec={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sb=["Webkit","ms","Moz","O"];Object.keys(ec).forEach(function(i){sb.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),ec[s]=ec[i]})});function jv(i,s,h){return s==null||typeof s=="boolean"||s===""?"":h||typeof s!="number"||s===0||ec.hasOwnProperty(i)&&ec[i]?(""+s).trim():s+"px"}function Uv(i,s){i=i.style;for(var h in s)if(s.hasOwnProperty(h)){var y=h.indexOf("--")===0,w=jv(h,s[h],y);h==="float"&&(h="cssFloat"),y?i.setProperty(h,w):i[h]=w}}var ab=_r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hf(i,s){if(s){if(ab[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(De(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(De(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(De(61))}if(s.style!=null&&typeof s.style!="object")throw Error(De(62))}}function Wf(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xf=null;function Vm(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Kf=null,wl=null,bl=null;function g_(i){if(i=zc(i)){if(typeof Kf!="function")throw Error(De(280));var s=i.stateNode;s&&(s=Zd(s),Kf(i.stateNode,i.type,s))}}function $v(i){wl?bl?bl.push(i):bl=[i]:wl=i}function Zv(){if(wl){var i=wl,s=bl;if(bl=wl=null,g_(i),s)for(i=0;i<s.length;i++)g_(s[i])}}function qv(i,s){return i(s)}function Gv(){}var pf=!1;function Hv(i,s,h){if(pf)return i(s,h);pf=!0;try{return qv(i,s,h)}finally{pf=!1,(wl!==null||bl!==null)&&(Gv(),Zv())}}function dc(i,s){var h=i.stateNode;if(h===null)return null;var y=Zd(h);if(y===null)return null;h=y[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(i=i.type,y=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!y;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(De(231,s,typeof h));return h}var Yf=!1;if(Us)try{var $u={};Object.defineProperty($u,"passive",{get:function(){Yf=!0}}),window.addEventListener("test",$u,$u),window.removeEventListener("test",$u,$u)}catch{Yf=!1}function ob(i,s,h,y,w,T,M,l,G){var O=Array.prototype.slice.call(arguments,3);try{s.apply(h,O)}catch(ve){this.onError(ve)}}var tc=!1,gd=null,yd=!1,Qf=null,lb={onError:function(i){tc=!0,gd=i}};function ub(i,s,h,y,w,T,M,l,G){tc=!1,gd=null,ob.apply(lb,arguments)}function cb(i,s,h,y,w,T,M,l,G){if(ub.apply(this,arguments),tc){if(tc){var O=gd;tc=!1,gd=null}else throw Error(De(198));yd||(yd=!0,Qf=O)}}function xo(i){var s=i,h=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(h=s.return),i=s.return;while(i)}return s.tag===3?h:null}function Wv(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function y_(i){if(xo(i)!==i)throw Error(De(188))}function hb(i){var s=i.alternate;if(!s){if(s=xo(i),s===null)throw Error(De(188));return s!==i?null:i}for(var h=i,y=s;;){var w=h.return;if(w===null)break;var T=w.alternate;if(T===null){if(y=w.return,y!==null){h=y;continue}break}if(w.child===T.child){for(T=w.child;T;){if(T===h)return y_(w),i;if(T===y)return y_(w),s;T=T.sibling}throw Error(De(188))}if(h.return!==y.return)h=w,y=T;else{for(var M=!1,l=w.child;l;){if(l===h){M=!0,h=w,y=T;break}if(l===y){M=!0,y=w,h=T;break}l=l.sibling}if(!M){for(l=T.child;l;){if(l===h){M=!0,h=T,y=w;break}if(l===y){M=!0,y=T,h=w;break}l=l.sibling}if(!M)throw Error(De(189))}}if(h.alternate!==y)throw Error(De(190))}if(h.tag!==3)throw Error(De(188));return h.stateNode.current===h?i:s}function Xv(i){return i=hb(i),i!==null?Kv(i):null}function Kv(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=Kv(i);if(s!==null)return s;i=i.sibling}return null}var Yv=hn.unstable_scheduleCallback,__=hn.unstable_cancelCallback,db=hn.unstable_shouldYield,pb=hn.unstable_requestPaint,Mr=hn.unstable_now,fb=hn.unstable_getCurrentPriorityLevel,jm=hn.unstable_ImmediatePriority,Qv=hn.unstable_UserBlockingPriority,_d=hn.unstable_NormalPriority,mb=hn.unstable_LowPriority,Jv=hn.unstable_IdlePriority,Vd=null,ms=null;function gb(i){if(ms&&typeof ms.onCommitFiberRoot=="function")try{ms.onCommitFiberRoot(Vd,i,void 0,(i.current.flags&128)===128)}catch{}}var Wn=Math.clz32?Math.clz32:vb,yb=Math.log,_b=Math.LN2;function vb(i){return i>>>=0,i===0?32:31-(yb(i)/_b|0)|0}var $h=64,Zh=4194304;function Qu(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function vd(i,s){var h=i.pendingLanes;if(h===0)return 0;var y=0,w=i.suspendedLanes,T=i.pingedLanes,M=h&268435455;if(M!==0){var l=M&~w;l!==0?y=Qu(l):(T&=M,T!==0&&(y=Qu(T)))}else M=h&~w,M!==0?y=Qu(M):T!==0&&(y=Qu(T));if(y===0)return 0;if(s!==0&&s!==y&&!(s&w)&&(w=y&-y,T=s&-s,w>=T||w===16&&(T&4194240)!==0))return s;if(y&4&&(y|=h&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=y;0<s;)h=31-Wn(s),w=1<<h,y|=i[h],s&=~w;return y}function xb(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wb(i,s){for(var h=i.suspendedLanes,y=i.pingedLanes,w=i.expirationTimes,T=i.pendingLanes;0<T;){var M=31-Wn(T),l=1<<M,G=w[M];G===-1?(!(l&h)||l&y)&&(w[M]=xb(l,s)):G<=s&&(i.expiredLanes|=l),T&=~l}}function Jf(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function ex(){var i=$h;return $h<<=1,!($h&4194240)&&($h=64),i}function ff(i){for(var s=[],h=0;31>h;h++)s.push(i);return s}function Cc(i,s,h){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-Wn(s),i[s]=h}function bb(i,s){var h=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var y=i.eventTimes;for(i=i.expirationTimes;0<h;){var w=31-Wn(h),T=1<<w;s[w]=0,y[w]=-1,i[w]=-1,h&=~T}}function Um(i,s){var h=i.entangledLanes|=s;for(i=i.entanglements;h;){var y=31-Wn(h),w=1<<y;w&s|i[y]&s&&(i[y]|=s),h&=~w}}var qt=0;function tx(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var rx,$m,ix,nx,sx,em=!1,qh=[],Sa=null,Ta=null,ka=null,pc=new Map,fc=new Map,va=[],Sb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function v_(i,s){switch(i){case"focusin":case"focusout":Sa=null;break;case"dragenter":case"dragleave":Ta=null;break;case"mouseover":case"mouseout":ka=null;break;case"pointerover":case"pointerout":pc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":fc.delete(s.pointerId)}}function Zu(i,s,h,y,w,T){return i===null||i.nativeEvent!==T?(i={blockedOn:s,domEventName:h,eventSystemFlags:y,nativeEvent:T,targetContainers:[w]},s!==null&&(s=zc(s),s!==null&&$m(s)),i):(i.eventSystemFlags|=y,s=i.targetContainers,w!==null&&s.indexOf(w)===-1&&s.push(w),i)}function Tb(i,s,h,y,w){switch(s){case"focusin":return Sa=Zu(Sa,i,s,h,y,w),!0;case"dragenter":return Ta=Zu(Ta,i,s,h,y,w),!0;case"mouseover":return ka=Zu(ka,i,s,h,y,w),!0;case"pointerover":var T=w.pointerId;return pc.set(T,Zu(pc.get(T)||null,i,s,h,y,w)),!0;case"gotpointercapture":return T=w.pointerId,fc.set(T,Zu(fc.get(T)||null,i,s,h,y,w)),!0}return!1}function ax(i){var s=lo(i.target);if(s!==null){var h=xo(s);if(h!==null){if(s=h.tag,s===13){if(s=Wv(h),s!==null){i.blockedOn=s,sx(i.priority,function(){ix(h)});return}}else if(s===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function sd(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var h=tm(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var y=new h.constructor(h.type,h);Xf=y,h.target.dispatchEvent(y),Xf=null}else return s=zc(h),s!==null&&$m(s),i.blockedOn=h,!1;s.shift()}return!0}function x_(i,s,h){sd(i)&&h.delete(s)}function kb(){em=!1,Sa!==null&&sd(Sa)&&(Sa=null),Ta!==null&&sd(Ta)&&(Ta=null),ka!==null&&sd(ka)&&(ka=null),pc.forEach(x_),fc.forEach(x_)}function qu(i,s){i.blockedOn===s&&(i.blockedOn=null,em||(em=!0,hn.unstable_scheduleCallback(hn.unstable_NormalPriority,kb)))}function mc(i){function s(w){return qu(w,i)}if(0<qh.length){qu(qh[0],i);for(var h=1;h<qh.length;h++){var y=qh[h];y.blockedOn===i&&(y.blockedOn=null)}}for(Sa!==null&&qu(Sa,i),Ta!==null&&qu(Ta,i),ka!==null&&qu(ka,i),pc.forEach(s),fc.forEach(s),h=0;h<va.length;h++)y=va[h],y.blockedOn===i&&(y.blockedOn=null);for(;0<va.length&&(h=va[0],h.blockedOn===null);)ax(h),h.blockedOn===null&&va.shift()}var Sl=Gs.ReactCurrentBatchConfig,xd=!0;function Eb(i,s,h,y){var w=qt,T=Sl.transition;Sl.transition=null;try{qt=1,Zm(i,s,h,y)}finally{qt=w,Sl.transition=T}}function Ib(i,s,h,y){var w=qt,T=Sl.transition;Sl.transition=null;try{qt=4,Zm(i,s,h,y)}finally{qt=w,Sl.transition=T}}function Zm(i,s,h,y){if(xd){var w=tm(i,s,h,y);if(w===null)Tf(i,s,y,wd,h),v_(i,y);else if(Tb(w,i,s,h,y))y.stopPropagation();else if(v_(i,y),s&4&&-1<Sb.indexOf(i)){for(;w!==null;){var T=zc(w);if(T!==null&&rx(T),T=tm(i,s,h,y),T===null&&Tf(i,s,y,wd,h),T===w)break;w=T}w!==null&&y.stopPropagation()}else Tf(i,s,y,null,h)}}var wd=null;function tm(i,s,h,y){if(wd=null,i=Vm(y),i=lo(i),i!==null)if(s=xo(i),s===null)i=null;else if(h=s.tag,h===13){if(i=Wv(s),i!==null)return i;i=null}else if(h===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return wd=i,null}function ox(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fb()){case jm:return 1;case Qv:return 4;case _d:case mb:return 16;case Jv:return 536870912;default:return 16}default:return 16}}var wa=null,qm=null,ad=null;function lx(){if(ad)return ad;var i,s=qm,h=s.length,y,w="value"in wa?wa.value:wa.textContent,T=w.length;for(i=0;i<h&&s[i]===w[i];i++);var M=h-i;for(y=1;y<=M&&s[h-y]===w[T-y];y++);return ad=w.slice(i,1<y?1-y:void 0)}function od(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Gh(){return!0}function w_(){return!1}function pn(i){function s(h,y,w,T,M){this._reactName=h,this._targetInst=w,this.type=y,this.nativeEvent=T,this.target=M,this.currentTarget=null;for(var l in i)i.hasOwnProperty(l)&&(h=i[l],this[l]=h?h(T):T[l]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Gh:w_,this.isPropagationStopped=w_,this}return _r(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Gh)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Gh)},persist:function(){},isPersistent:Gh}),s}var Ll={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gm=pn(Ll),Pc=_r({},Ll,{view:0,detail:0}),Cb=pn(Pc),mf,gf,Gu,jd=_r({},Pc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hm,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Gu&&(Gu&&i.type==="mousemove"?(mf=i.screenX-Gu.screenX,gf=i.screenY-Gu.screenY):gf=mf=0,Gu=i),mf)},movementY:function(i){return"movementY"in i?i.movementY:gf}}),b_=pn(jd),Pb=_r({},jd,{dataTransfer:0}),zb=pn(Pb),Mb=_r({},Pc,{relatedTarget:0}),yf=pn(Mb),Ab=_r({},Ll,{animationName:0,elapsedTime:0,pseudoElement:0}),Db=pn(Ab),Lb=_r({},Ll,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Rb=pn(Lb),Fb=_r({},Ll,{data:0}),S_=pn(Fb),Bb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ob={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vb(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=Nb[i])?!!s[i]:!1}function Hm(){return Vb}var jb=_r({},Pc,{key:function(i){if(i.key){var s=Bb[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=od(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Ob[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hm,charCode:function(i){return i.type==="keypress"?od(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?od(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ub=pn(jb),$b=_r({},jd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),T_=pn($b),Zb=_r({},Pc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hm}),qb=pn(Zb),Gb=_r({},Ll,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hb=pn(Gb),Wb=_r({},jd,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Xb=pn(Wb),Kb=[9,13,27,32],Wm=Us&&"CompositionEvent"in window,rc=null;Us&&"documentMode"in document&&(rc=document.documentMode);var Yb=Us&&"TextEvent"in window&&!rc,ux=Us&&(!Wm||rc&&8<rc&&11>=rc),k_=" ",E_=!1;function cx(i,s){switch(i){case"keyup":return Kb.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hx(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var cl=!1;function Qb(i,s){switch(i){case"compositionend":return hx(s);case"keypress":return s.which!==32?null:(E_=!0,k_);case"textInput":return i=s.data,i===k_&&E_?null:i;default:return null}}function Jb(i,s){if(cl)return i==="compositionend"||!Wm&&cx(i,s)?(i=lx(),ad=qm=wa=null,cl=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ux&&s.locale!=="ko"?null:s.data;default:return null}}var e2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function I_(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!e2[i.type]:s==="textarea"}function dx(i,s,h,y){$v(y),s=bd(s,"onChange"),0<s.length&&(h=new Gm("onChange","change",null,h,y),i.push({event:h,listeners:s}))}var ic=null,gc=null;function t2(i){Sx(i,0)}function Ud(i){var s=pl(i);if(Fv(s))return i}function r2(i,s){if(i==="change")return s}var px=!1;if(Us){var _f;if(Us){var vf="oninput"in document;if(!vf){var C_=document.createElement("div");C_.setAttribute("oninput","return;"),vf=typeof C_.oninput=="function"}_f=vf}else _f=!1;px=_f&&(!document.documentMode||9<document.documentMode)}function P_(){ic&&(ic.detachEvent("onpropertychange",fx),gc=ic=null)}function fx(i){if(i.propertyName==="value"&&Ud(gc)){var s=[];dx(s,gc,i,Vm(i)),Hv(t2,s)}}function i2(i,s,h){i==="focusin"?(P_(),ic=s,gc=h,ic.attachEvent("onpropertychange",fx)):i==="focusout"&&P_()}function n2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ud(gc)}function s2(i,s){if(i==="click")return Ud(s)}function a2(i,s){if(i==="input"||i==="change")return Ud(s)}function o2(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Kn=typeof Object.is=="function"?Object.is:o2;function yc(i,s){if(Kn(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var h=Object.keys(i),y=Object.keys(s);if(h.length!==y.length)return!1;for(y=0;y<h.length;y++){var w=h[y];if(!Bf.call(s,w)||!Kn(i[w],s[w]))return!1}return!0}function z_(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function M_(i,s){var h=z_(i);i=0;for(var y;h;){if(h.nodeType===3){if(y=i+h.textContent.length,i<=s&&y>=s)return{node:h,offset:s-i};i=y}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=z_(h)}}function mx(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?mx(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function gx(){for(var i=window,s=md();s instanceof i.HTMLIFrameElement;){try{var h=typeof s.contentWindow.location.href=="string"}catch{h=!1}if(h)i=s.contentWindow;else break;s=md(i.document)}return s}function Xm(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function l2(i){var s=gx(),h=i.focusedElem,y=i.selectionRange;if(s!==h&&h&&h.ownerDocument&&mx(h.ownerDocument.documentElement,h)){if(y!==null&&Xm(h)){if(s=y.start,i=y.end,i===void 0&&(i=s),"selectionStart"in h)h.selectionStart=s,h.selectionEnd=Math.min(i,h.value.length);else if(i=(s=h.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var w=h.textContent.length,T=Math.min(y.start,w);y=y.end===void 0?T:Math.min(y.end,w),!i.extend&&T>y&&(w=y,y=T,T=w),w=M_(h,T);var M=M_(h,y);w&&M&&(i.rangeCount!==1||i.anchorNode!==w.node||i.anchorOffset!==w.offset||i.focusNode!==M.node||i.focusOffset!==M.offset)&&(s=s.createRange(),s.setStart(w.node,w.offset),i.removeAllRanges(),T>y?(i.addRange(s),i.extend(M.node,M.offset)):(s.setEnd(M.node,M.offset),i.addRange(s)))}}for(s=[],i=h;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<s.length;h++)i=s[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var u2=Us&&"documentMode"in document&&11>=document.documentMode,hl=null,rm=null,nc=null,im=!1;function A_(i,s,h){var y=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;im||hl==null||hl!==md(y)||(y=hl,"selectionStart"in y&&Xm(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),nc&&yc(nc,y)||(nc=y,y=bd(rm,"onSelect"),0<y.length&&(s=new Gm("onSelect","select",null,s,h),i.push({event:s,listeners:y}),s.target=hl)))}function Hh(i,s){var h={};return h[i.toLowerCase()]=s.toLowerCase(),h["Webkit"+i]="webkit"+s,h["Moz"+i]="moz"+s,h}var dl={animationend:Hh("Animation","AnimationEnd"),animationiteration:Hh("Animation","AnimationIteration"),animationstart:Hh("Animation","AnimationStart"),transitionend:Hh("Transition","TransitionEnd")},xf={},yx={};Us&&(yx=document.createElement("div").style,"AnimationEvent"in window||(delete dl.animationend.animation,delete dl.animationiteration.animation,delete dl.animationstart.animation),"TransitionEvent"in window||delete dl.transitionend.transition);function $d(i){if(xf[i])return xf[i];if(!dl[i])return i;var s=dl[i],h;for(h in s)if(s.hasOwnProperty(h)&&h in yx)return xf[i]=s[h];return i}var _x=$d("animationend"),vx=$d("animationiteration"),xx=$d("animationstart"),wx=$d("transitionend"),bx=new Map,D_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Da(i,s){bx.set(i,s),vo(s,[i])}for(var wf=0;wf<D_.length;wf++){var bf=D_[wf],c2=bf.toLowerCase(),h2=bf[0].toUpperCase()+bf.slice(1);Da(c2,"on"+h2)}Da(_x,"onAnimationEnd");Da(vx,"onAnimationIteration");Da(xx,"onAnimationStart");Da("dblclick","onDoubleClick");Da("focusin","onFocus");Da("focusout","onBlur");Da(wx,"onTransitionEnd");El("onMouseEnter",["mouseout","mouseover"]);El("onMouseLeave",["mouseout","mouseover"]);El("onPointerEnter",["pointerout","pointerover"]);El("onPointerLeave",["pointerout","pointerover"]);vo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vo("onBeforeInput",["compositionend","keypress","textInput","paste"]);vo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ju="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),d2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ju));function L_(i,s,h){var y=i.type||"unknown-event";i.currentTarget=h,cb(y,s,void 0,i),i.currentTarget=null}function Sx(i,s){s=(s&4)!==0;for(var h=0;h<i.length;h++){var y=i[h],w=y.event;y=y.listeners;e:{var T=void 0;if(s)for(var M=y.length-1;0<=M;M--){var l=y[M],G=l.instance,O=l.currentTarget;if(l=l.listener,G!==T&&w.isPropagationStopped())break e;L_(w,l,O),T=G}else for(M=0;M<y.length;M++){if(l=y[M],G=l.instance,O=l.currentTarget,l=l.listener,G!==T&&w.isPropagationStopped())break e;L_(w,l,O),T=G}}}if(yd)throw i=Qf,yd=!1,Qf=null,i}function ar(i,s){var h=s[lm];h===void 0&&(h=s[lm]=new Set);var y=i+"__bubble";h.has(y)||(Tx(s,i,2,!1),h.add(y))}function Sf(i,s,h){var y=0;s&&(y|=4),Tx(h,i,y,s)}var Wh="_reactListening"+Math.random().toString(36).slice(2);function _c(i){if(!i[Wh]){i[Wh]=!0,Mv.forEach(function(h){h!=="selectionchange"&&(d2.has(h)||Sf(h,!1,i),Sf(h,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Wh]||(s[Wh]=!0,Sf("selectionchange",!1,s))}}function Tx(i,s,h,y){switch(ox(s)){case 1:var w=Eb;break;case 4:w=Ib;break;default:w=Zm}h=w.bind(null,s,h,i),w=void 0,!Yf||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(w=!0),y?w!==void 0?i.addEventListener(s,h,{capture:!0,passive:w}):i.addEventListener(s,h,!0):w!==void 0?i.addEventListener(s,h,{passive:w}):i.addEventListener(s,h,!1)}function Tf(i,s,h,y,w){var T=y;if(!(s&1)&&!(s&2)&&y!==null)e:for(;;){if(y===null)return;var M=y.tag;if(M===3||M===4){var l=y.stateNode.containerInfo;if(l===w||l.nodeType===8&&l.parentNode===w)break;if(M===4)for(M=y.return;M!==null;){var G=M.tag;if((G===3||G===4)&&(G=M.stateNode.containerInfo,G===w||G.nodeType===8&&G.parentNode===w))return;M=M.return}for(;l!==null;){if(M=lo(l),M===null)return;if(G=M.tag,G===5||G===6){y=T=M;continue e}l=l.parentNode}}y=y.return}Hv(function(){var O=T,ve=Vm(h),ge=[];e:{var oe=bx.get(i);if(oe!==void 0){var ze=Gm,Fe=i;switch(i){case"keypress":if(od(h)===0)break e;case"keydown":case"keyup":ze=Ub;break;case"focusin":Fe="focus",ze=yf;break;case"focusout":Fe="blur",ze=yf;break;case"beforeblur":case"afterblur":ze=yf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=b_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=zb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=qb;break;case _x:case vx:case xx:ze=Db;break;case wx:ze=Hb;break;case"scroll":ze=Cb;break;case"wheel":ze=Xb;break;case"copy":case"cut":case"paste":ze=Rb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=T_}var Ce=(s&4)!==0,lt=!Ce&&i==="scroll",ie=Ce?oe!==null?oe+"Capture":null:oe;Ce=[];for(var te=O,ce;te!==null;){ce=te;var Ee=ce.stateNode;if(ce.tag===5&&Ee!==null&&(ce=Ee,ie!==null&&(Ee=dc(te,ie),Ee!=null&&Ce.push(vc(te,Ee,ce)))),lt)break;te=te.return}0<Ce.length&&(oe=new ze(oe,Fe,null,h,ve),ge.push({event:oe,listeners:Ce}))}}if(!(s&7)){e:{if(oe=i==="mouseover"||i==="pointerover",ze=i==="mouseout"||i==="pointerout",oe&&h!==Xf&&(Fe=h.relatedTarget||h.fromElement)&&(lo(Fe)||Fe[$s]))break e;if((ze||oe)&&(oe=ve.window===ve?ve:(oe=ve.ownerDocument)?oe.defaultView||oe.parentWindow:window,ze?(Fe=h.relatedTarget||h.toElement,ze=O,Fe=Fe?lo(Fe):null,Fe!==null&&(lt=xo(Fe),Fe!==lt||Fe.tag!==5&&Fe.tag!==6)&&(Fe=null)):(ze=null,Fe=O),ze!==Fe)){if(Ce=b_,Ee="onMouseLeave",ie="onMouseEnter",te="mouse",(i==="pointerout"||i==="pointerover")&&(Ce=T_,Ee="onPointerLeave",ie="onPointerEnter",te="pointer"),lt=ze==null?oe:pl(ze),ce=Fe==null?oe:pl(Fe),oe=new Ce(Ee,te+"leave",ze,h,ve),oe.target=lt,oe.relatedTarget=ce,Ee=null,lo(ve)===O&&(Ce=new Ce(ie,te+"enter",Fe,h,ve),Ce.target=ce,Ce.relatedTarget=lt,Ee=Ce),lt=Ee,ze&&Fe)t:{for(Ce=ze,ie=Fe,te=0,ce=Ce;ce;ce=ol(ce))te++;for(ce=0,Ee=ie;Ee;Ee=ol(Ee))ce++;for(;0<te-ce;)Ce=ol(Ce),te--;for(;0<ce-te;)ie=ol(ie),ce--;for(;te--;){if(Ce===ie||ie!==null&&Ce===ie.alternate)break t;Ce=ol(Ce),ie=ol(ie)}Ce=null}else Ce=null;ze!==null&&R_(ge,oe,ze,Ce,!1),Fe!==null&&lt!==null&&R_(ge,lt,Fe,Ce,!0)}}e:{if(oe=O?pl(O):window,ze=oe.nodeName&&oe.nodeName.toLowerCase(),ze==="select"||ze==="input"&&oe.type==="file")var Ge=r2;else if(I_(oe))if(px)Ge=a2;else{Ge=n2;var We=i2}else(ze=oe.nodeName)&&ze.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(Ge=s2);if(Ge&&(Ge=Ge(i,O))){dx(ge,Ge,h,ve);break e}We&&We(i,oe,O),i==="focusout"&&(We=oe._wrapperState)&&We.controlled&&oe.type==="number"&&Zf(oe,"number",oe.value)}switch(We=O?pl(O):window,i){case"focusin":(I_(We)||We.contentEditable==="true")&&(hl=We,rm=O,nc=null);break;case"focusout":nc=rm=hl=null;break;case"mousedown":im=!0;break;case"contextmenu":case"mouseup":case"dragend":im=!1,A_(ge,h,ve);break;case"selectionchange":if(u2)break;case"keydown":case"keyup":A_(ge,h,ve)}var Je;if(Wm)e:{switch(i){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else cl?cx(i,h)&&(Ze="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(Ze="onCompositionStart");Ze&&(ux&&h.locale!=="ko"&&(cl||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&cl&&(Je=lx()):(wa=ve,qm="value"in wa?wa.value:wa.textContent,cl=!0)),We=bd(O,Ze),0<We.length&&(Ze=new S_(Ze,i,null,h,ve),ge.push({event:Ze,listeners:We}),Je?Ze.data=Je:(Je=hx(h),Je!==null&&(Ze.data=Je)))),(Je=Yb?Qb(i,h):Jb(i,h))&&(O=bd(O,"onBeforeInput"),0<O.length&&(ve=new S_("onBeforeInput","beforeinput",null,h,ve),ge.push({event:ve,listeners:O}),ve.data=Je))}Sx(ge,s)})}function vc(i,s,h){return{instance:i,listener:s,currentTarget:h}}function bd(i,s){for(var h=s+"Capture",y=[];i!==null;){var w=i,T=w.stateNode;w.tag===5&&T!==null&&(w=T,T=dc(i,h),T!=null&&y.unshift(vc(i,T,w)),T=dc(i,s),T!=null&&y.push(vc(i,T,w))),i=i.return}return y}function ol(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function R_(i,s,h,y,w){for(var T=s._reactName,M=[];h!==null&&h!==y;){var l=h,G=l.alternate,O=l.stateNode;if(G!==null&&G===y)break;l.tag===5&&O!==null&&(l=O,w?(G=dc(h,T),G!=null&&M.unshift(vc(h,G,l))):w||(G=dc(h,T),G!=null&&M.push(vc(h,G,l)))),h=h.return}M.length!==0&&i.push({event:s,listeners:M})}var p2=/\r\n?/g,f2=/\u0000|\uFFFD/g;function F_(i){return(typeof i=="string"?i:""+i).replace(p2,`
`).replace(f2,"")}function Xh(i,s,h){if(s=F_(s),F_(i)!==s&&h)throw Error(De(425))}function Sd(){}var nm=null,sm=null;function am(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var om=typeof setTimeout=="function"?setTimeout:void 0,m2=typeof clearTimeout=="function"?clearTimeout:void 0,B_=typeof Promise=="function"?Promise:void 0,g2=typeof queueMicrotask=="function"?queueMicrotask:typeof B_<"u"?function(i){return B_.resolve(null).then(i).catch(y2)}:om;function y2(i){setTimeout(function(){throw i})}function kf(i,s){var h=s,y=0;do{var w=h.nextSibling;if(i.removeChild(h),w&&w.nodeType===8)if(h=w.data,h==="/$"){if(y===0){i.removeChild(w),mc(s);return}y--}else h!=="$"&&h!=="$?"&&h!=="$!"||y++;h=w}while(h);mc(s)}function Ea(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function O_(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(s===0)return i;s--}else h==="/$"&&s++}i=i.previousSibling}return null}var Rl=Math.random().toString(36).slice(2),fs="__reactFiber$"+Rl,xc="__reactProps$"+Rl,$s="__reactContainer$"+Rl,lm="__reactEvents$"+Rl,_2="__reactListeners$"+Rl,v2="__reactHandles$"+Rl;function lo(i){var s=i[fs];if(s)return s;for(var h=i.parentNode;h;){if(s=h[$s]||h[fs]){if(h=s.alternate,s.child!==null||h!==null&&h.child!==null)for(i=O_(i);i!==null;){if(h=i[fs])return h;i=O_(i)}return s}i=h,h=i.parentNode}return null}function zc(i){return i=i[fs]||i[$s],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function pl(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(De(33))}function Zd(i){return i[xc]||null}var um=[],fl=-1;function La(i){return{current:i}}function or(i){0>fl||(i.current=um[fl],um[fl]=null,fl--)}function tr(i,s){fl++,um[fl]=i.current,i.current=s}var Aa={},Si=La(Aa),Yi=La(!1),fo=Aa;function Il(i,s){var h=i.type.contextTypes;if(!h)return Aa;var y=i.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===s)return y.__reactInternalMemoizedMaskedChildContext;var w={},T;for(T in h)w[T]=s[T];return y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=w),w}function Qi(i){return i=i.childContextTypes,i!=null}function Td(){or(Yi),or(Si)}function N_(i,s,h){if(Si.current!==Aa)throw Error(De(168));tr(Si,s),tr(Yi,h)}function kx(i,s,h){var y=i.stateNode;if(s=s.childContextTypes,typeof y.getChildContext!="function")return h;y=y.getChildContext();for(var w in y)if(!(w in s))throw Error(De(108,ib(i)||"Unknown",w));return _r({},h,y)}function kd(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Aa,fo=Si.current,tr(Si,i),tr(Yi,Yi.current),!0}function V_(i,s,h){var y=i.stateNode;if(!y)throw Error(De(169));h?(i=kx(i,s,fo),y.__reactInternalMemoizedMergedChildContext=i,or(Yi),or(Si),tr(Si,i)):or(Yi),tr(Yi,h)}var Os=null,qd=!1,Ef=!1;function Ex(i){Os===null?Os=[i]:Os.push(i)}function x2(i){qd=!0,Ex(i)}function Ra(){if(!Ef&&Os!==null){Ef=!0;var i=0,s=qt;try{var h=Os;for(qt=1;i<h.length;i++){var y=h[i];do y=y(!0);while(y!==null)}Os=null,qd=!1}catch(w){throw Os!==null&&(Os=Os.slice(i+1)),Yv(jm,Ra),w}finally{qt=s,Ef=!1}}return null}var ml=[],gl=0,Ed=null,Id=0,kn=[],En=0,mo=null,Ns=1,Vs="";function ao(i,s){ml[gl++]=Id,ml[gl++]=Ed,Ed=i,Id=s}function Ix(i,s,h){kn[En++]=Ns,kn[En++]=Vs,kn[En++]=mo,mo=i;var y=Ns;i=Vs;var w=32-Wn(y)-1;y&=~(1<<w),h+=1;var T=32-Wn(s)+w;if(30<T){var M=w-w%5;T=(y&(1<<M)-1).toString(32),y>>=M,w-=M,Ns=1<<32-Wn(s)+w|h<<w|y,Vs=T+i}else Ns=1<<T|h<<w|y,Vs=i}function Km(i){i.return!==null&&(ao(i,1),Ix(i,1,0))}function Ym(i){for(;i===Ed;)Ed=ml[--gl],ml[gl]=null,Id=ml[--gl],ml[gl]=null;for(;i===mo;)mo=kn[--En],kn[En]=null,Vs=kn[--En],kn[En]=null,Ns=kn[--En],kn[En]=null}var cn=null,un=null,dr=!1,Hn=null;function Cx(i,s){var h=In(5,null,null,0);h.elementType="DELETED",h.stateNode=s,h.return=i,s=i.deletions,s===null?(i.deletions=[h],i.flags|=16):s.push(h)}function j_(i,s){switch(i.tag){case 5:var h=i.type;return s=s.nodeType!==1||h.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,cn=i,un=Ea(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,cn=i,un=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(h=mo!==null?{id:Ns,overflow:Vs}:null,i.memoizedState={dehydrated:s,treeContext:h,retryLane:1073741824},h=In(18,null,null,0),h.stateNode=s,h.return=i,i.child=h,cn=i,un=null,!0):!1;default:return!1}}function cm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function hm(i){if(dr){var s=un;if(s){var h=s;if(!j_(i,s)){if(cm(i))throw Error(De(418));s=Ea(h.nextSibling);var y=cn;s&&j_(i,s)?Cx(y,h):(i.flags=i.flags&-4097|2,dr=!1,cn=i)}}else{if(cm(i))throw Error(De(418));i.flags=i.flags&-4097|2,dr=!1,cn=i}}}function U_(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;cn=i}function Kh(i){if(i!==cn)return!1;if(!dr)return U_(i),dr=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!am(i.type,i.memoizedProps)),s&&(s=un)){if(cm(i))throw Px(),Error(De(418));for(;s;)Cx(i,s),s=Ea(s.nextSibling)}if(U_(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(De(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(s===0){un=Ea(i.nextSibling);break e}s--}else h!=="$"&&h!=="$!"&&h!=="$?"||s++}i=i.nextSibling}un=null}}else un=cn?Ea(i.stateNode.nextSibling):null;return!0}function Px(){for(var i=un;i;)i=Ea(i.nextSibling)}function Cl(){un=cn=null,dr=!1}function Qm(i){Hn===null?Hn=[i]:Hn.push(i)}var w2=Gs.ReactCurrentBatchConfig;function Hu(i,s,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(De(309));var y=h.stateNode}if(!y)throw Error(De(147,i));var w=y,T=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===T?s.ref:(s=function(M){var l=w.refs;M===null?delete l[T]:l[T]=M},s._stringRef=T,s)}if(typeof i!="string")throw Error(De(284));if(!h._owner)throw Error(De(290,i))}return i}function Yh(i,s){throw i=Object.prototype.toString.call(s),Error(De(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function $_(i){var s=i._init;return s(i._payload)}function zx(i){function s(ie,te){if(i){var ce=ie.deletions;ce===null?(ie.deletions=[te],ie.flags|=16):ce.push(te)}}function h(ie,te){if(!i)return null;for(;te!==null;)s(ie,te),te=te.sibling;return null}function y(ie,te){for(ie=new Map;te!==null;)te.key!==null?ie.set(te.key,te):ie.set(te.index,te),te=te.sibling;return ie}function w(ie,te){return ie=za(ie,te),ie.index=0,ie.sibling=null,ie}function T(ie,te,ce){return ie.index=ce,i?(ce=ie.alternate,ce!==null?(ce=ce.index,ce<te?(ie.flags|=2,te):ce):(ie.flags|=2,te)):(ie.flags|=1048576,te)}function M(ie){return i&&ie.alternate===null&&(ie.flags|=2),ie}function l(ie,te,ce,Ee){return te===null||te.tag!==6?(te=Df(ce,ie.mode,Ee),te.return=ie,te):(te=w(te,ce),te.return=ie,te)}function G(ie,te,ce,Ee){var Ge=ce.type;return Ge===ul?ve(ie,te,ce.props.children,Ee,ce.key):te!==null&&(te.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===ya&&$_(Ge)===te.type)?(Ee=w(te,ce.props),Ee.ref=Hu(ie,te,ce),Ee.return=ie,Ee):(Ee=fd(ce.type,ce.key,ce.props,null,ie.mode,Ee),Ee.ref=Hu(ie,te,ce),Ee.return=ie,Ee)}function O(ie,te,ce,Ee){return te===null||te.tag!==4||te.stateNode.containerInfo!==ce.containerInfo||te.stateNode.implementation!==ce.implementation?(te=Lf(ce,ie.mode,Ee),te.return=ie,te):(te=w(te,ce.children||[]),te.return=ie,te)}function ve(ie,te,ce,Ee,Ge){return te===null||te.tag!==7?(te=po(ce,ie.mode,Ee,Ge),te.return=ie,te):(te=w(te,ce),te.return=ie,te)}function ge(ie,te,ce){if(typeof te=="string"&&te!==""||typeof te=="number")return te=Df(""+te,ie.mode,ce),te.return=ie,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case Vh:return ce=fd(te.type,te.key,te.props,null,ie.mode,ce),ce.ref=Hu(ie,null,te),ce.return=ie,ce;case ll:return te=Lf(te,ie.mode,ce),te.return=ie,te;case ya:var Ee=te._init;return ge(ie,Ee(te._payload),ce)}if(Yu(te)||Uu(te))return te=po(te,ie.mode,ce,null),te.return=ie,te;Yh(ie,te)}return null}function oe(ie,te,ce,Ee){var Ge=te!==null?te.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return Ge!==null?null:l(ie,te,""+ce,Ee);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Vh:return ce.key===Ge?G(ie,te,ce,Ee):null;case ll:return ce.key===Ge?O(ie,te,ce,Ee):null;case ya:return Ge=ce._init,oe(ie,te,Ge(ce._payload),Ee)}if(Yu(ce)||Uu(ce))return Ge!==null?null:ve(ie,te,ce,Ee,null);Yh(ie,ce)}return null}function ze(ie,te,ce,Ee,Ge){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return ie=ie.get(ce)||null,l(te,ie,""+Ee,Ge);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Vh:return ie=ie.get(Ee.key===null?ce:Ee.key)||null,G(te,ie,Ee,Ge);case ll:return ie=ie.get(Ee.key===null?ce:Ee.key)||null,O(te,ie,Ee,Ge);case ya:var We=Ee._init;return ze(ie,te,ce,We(Ee._payload),Ge)}if(Yu(Ee)||Uu(Ee))return ie=ie.get(ce)||null,ve(te,ie,Ee,Ge,null);Yh(te,Ee)}return null}function Fe(ie,te,ce,Ee){for(var Ge=null,We=null,Je=te,Ze=te=0,Vt=null;Je!==null&&Ze<ce.length;Ze++){Je.index>Ze?(Vt=Je,Je=null):Vt=Je.sibling;var Ue=oe(ie,Je,ce[Ze],Ee);if(Ue===null){Je===null&&(Je=Vt);break}i&&Je&&Ue.alternate===null&&s(ie,Je),te=T(Ue,te,Ze),We===null?Ge=Ue:We.sibling=Ue,We=Ue,Je=Vt}if(Ze===ce.length)return h(ie,Je),dr&&ao(ie,Ze),Ge;if(Je===null){for(;Ze<ce.length;Ze++)Je=ge(ie,ce[Ze],Ee),Je!==null&&(te=T(Je,te,Ze),We===null?Ge=Je:We.sibling=Je,We=Je);return dr&&ao(ie,Ze),Ge}for(Je=y(ie,Je);Ze<ce.length;Ze++)Vt=ze(Je,ie,Ze,ce[Ze],Ee),Vt!==null&&(i&&Vt.alternate!==null&&Je.delete(Vt.key===null?Ze:Vt.key),te=T(Vt,te,Ze),We===null?Ge=Vt:We.sibling=Vt,We=Vt);return i&&Je.forEach(function(Ar){return s(ie,Ar)}),dr&&ao(ie,Ze),Ge}function Ce(ie,te,ce,Ee){var Ge=Uu(ce);if(typeof Ge!="function")throw Error(De(150));if(ce=Ge.call(ce),ce==null)throw Error(De(151));for(var We=Ge=null,Je=te,Ze=te=0,Vt=null,Ue=ce.next();Je!==null&&!Ue.done;Ze++,Ue=ce.next()){Je.index>Ze?(Vt=Je,Je=null):Vt=Je.sibling;var Ar=oe(ie,Je,Ue.value,Ee);if(Ar===null){Je===null&&(Je=Vt);break}i&&Je&&Ar.alternate===null&&s(ie,Je),te=T(Ar,te,Ze),We===null?Ge=Ar:We.sibling=Ar,We=Ar,Je=Vt}if(Ue.done)return h(ie,Je),dr&&ao(ie,Ze),Ge;if(Je===null){for(;!Ue.done;Ze++,Ue=ce.next())Ue=ge(ie,Ue.value,Ee),Ue!==null&&(te=T(Ue,te,Ze),We===null?Ge=Ue:We.sibling=Ue,We=Ue);return dr&&ao(ie,Ze),Ge}for(Je=y(ie,Je);!Ue.done;Ze++,Ue=ce.next())Ue=ze(Je,ie,Ze,Ue.value,Ee),Ue!==null&&(i&&Ue.alternate!==null&&Je.delete(Ue.key===null?Ze:Ue.key),te=T(Ue,te,Ze),We===null?Ge=Ue:We.sibling=Ue,We=Ue);return i&&Je.forEach(function(Rr){return s(ie,Rr)}),dr&&ao(ie,Ze),Ge}function lt(ie,te,ce,Ee){if(typeof ce=="object"&&ce!==null&&ce.type===ul&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Vh:e:{for(var Ge=ce.key,We=te;We!==null;){if(We.key===Ge){if(Ge=ce.type,Ge===ul){if(We.tag===7){h(ie,We.sibling),te=w(We,ce.props.children),te.return=ie,ie=te;break e}}else if(We.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===ya&&$_(Ge)===We.type){h(ie,We.sibling),te=w(We,ce.props),te.ref=Hu(ie,We,ce),te.return=ie,ie=te;break e}h(ie,We);break}else s(ie,We);We=We.sibling}ce.type===ul?(te=po(ce.props.children,ie.mode,Ee,ce.key),te.return=ie,ie=te):(Ee=fd(ce.type,ce.key,ce.props,null,ie.mode,Ee),Ee.ref=Hu(ie,te,ce),Ee.return=ie,ie=Ee)}return M(ie);case ll:e:{for(We=ce.key;te!==null;){if(te.key===We)if(te.tag===4&&te.stateNode.containerInfo===ce.containerInfo&&te.stateNode.implementation===ce.implementation){h(ie,te.sibling),te=w(te,ce.children||[]),te.return=ie,ie=te;break e}else{h(ie,te);break}else s(ie,te);te=te.sibling}te=Lf(ce,ie.mode,Ee),te.return=ie,ie=te}return M(ie);case ya:return We=ce._init,lt(ie,te,We(ce._payload),Ee)}if(Yu(ce))return Fe(ie,te,ce,Ee);if(Uu(ce))return Ce(ie,te,ce,Ee);Yh(ie,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,te!==null&&te.tag===6?(h(ie,te.sibling),te=w(te,ce),te.return=ie,ie=te):(h(ie,te),te=Df(ce,ie.mode,Ee),te.return=ie,ie=te),M(ie)):h(ie,te)}return lt}var Pl=zx(!0),Mx=zx(!1),Cd=La(null),Pd=null,yl=null,Jm=null;function eg(){Jm=yl=Pd=null}function tg(i){var s=Cd.current;or(Cd),i._currentValue=s}function dm(i,s,h){for(;i!==null;){var y=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,y!==null&&(y.childLanes|=s)):y!==null&&(y.childLanes&s)!==s&&(y.childLanes|=s),i===h)break;i=i.return}}function Tl(i,s){Pd=i,Jm=yl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(Ki=!0),i.firstContext=null)}function Pn(i){var s=i._currentValue;if(Jm!==i)if(i={context:i,memoizedValue:s,next:null},yl===null){if(Pd===null)throw Error(De(308));yl=i,Pd.dependencies={lanes:0,firstContext:i}}else yl=yl.next=i;return s}var uo=null;function rg(i){uo===null?uo=[i]:uo.push(i)}function Ax(i,s,h,y){var w=s.interleaved;return w===null?(h.next=h,rg(s)):(h.next=w.next,w.next=h),s.interleaved=h,Zs(i,y)}function Zs(i,s){i.lanes|=s;var h=i.alternate;for(h!==null&&(h.lanes|=s),h=i,i=i.return;i!==null;)i.childLanes|=s,h=i.alternate,h!==null&&(h.childLanes|=s),h=i,i=i.return;return h.tag===3?h.stateNode:null}var _a=!1;function ig(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dx(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function js(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function Ia(i,s,h){var y=i.updateQueue;if(y===null)return null;if(y=y.shared,Lt&2){var w=y.pending;return w===null?s.next=s:(s.next=w.next,w.next=s),y.pending=s,Zs(i,h)}return w=y.interleaved,w===null?(s.next=s,rg(y)):(s.next=w.next,w.next=s),y.interleaved=s,Zs(i,h)}function ld(i,s,h){if(s=s.updateQueue,s!==null&&(s=s.shared,(h&4194240)!==0)){var y=s.lanes;y&=i.pendingLanes,h|=y,s.lanes=h,Um(i,h)}}function Z_(i,s){var h=i.updateQueue,y=i.alternate;if(y!==null&&(y=y.updateQueue,h===y)){var w=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var M={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};T===null?w=T=M:T=T.next=M,h=h.next}while(h!==null);T===null?w=T=s:T=T.next=s}else w=T=s;h={baseState:y.baseState,firstBaseUpdate:w,lastBaseUpdate:T,shared:y.shared,effects:y.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=s:i.next=s,h.lastBaseUpdate=s}function zd(i,s,h,y){var w=i.updateQueue;_a=!1;var T=w.firstBaseUpdate,M=w.lastBaseUpdate,l=w.shared.pending;if(l!==null){w.shared.pending=null;var G=l,O=G.next;G.next=null,M===null?T=O:M.next=O,M=G;var ve=i.alternate;ve!==null&&(ve=ve.updateQueue,l=ve.lastBaseUpdate,l!==M&&(l===null?ve.firstBaseUpdate=O:l.next=O,ve.lastBaseUpdate=G))}if(T!==null){var ge=w.baseState;M=0,ve=O=G=null,l=T;do{var oe=l.lane,ze=l.eventTime;if((y&oe)===oe){ve!==null&&(ve=ve.next={eventTime:ze,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Fe=i,Ce=l;switch(oe=s,ze=h,Ce.tag){case 1:if(Fe=Ce.payload,typeof Fe=="function"){ge=Fe.call(ze,ge,oe);break e}ge=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ce.payload,oe=typeof Fe=="function"?Fe.call(ze,ge,oe):Fe,oe==null)break e;ge=_r({},ge,oe);break e;case 2:_a=!0}}l.callback!==null&&l.lane!==0&&(i.flags|=64,oe=w.effects,oe===null?w.effects=[l]:oe.push(l))}else ze={eventTime:ze,lane:oe,tag:l.tag,payload:l.payload,callback:l.callback,next:null},ve===null?(O=ve=ze,G=ge):ve=ve.next=ze,M|=oe;if(l=l.next,l===null){if(l=w.shared.pending,l===null)break;oe=l,l=oe.next,oe.next=null,w.lastBaseUpdate=oe,w.shared.pending=null}}while(!0);if(ve===null&&(G=ge),w.baseState=G,w.firstBaseUpdate=O,w.lastBaseUpdate=ve,s=w.shared.interleaved,s!==null){w=s;do M|=w.lane,w=w.next;while(w!==s)}else T===null&&(w.shared.lanes=0);yo|=M,i.lanes=M,i.memoizedState=ge}}function q_(i,s,h){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var y=i[s],w=y.callback;if(w!==null){if(y.callback=null,y=h,typeof w!="function")throw Error(De(191,w));w.call(y)}}}var Mc={},gs=La(Mc),wc=La(Mc),bc=La(Mc);function co(i){if(i===Mc)throw Error(De(174));return i}function ng(i,s){switch(tr(bc,s),tr(wc,i),tr(gs,Mc),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Gf(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=Gf(s,i)}or(gs),tr(gs,s)}function zl(){or(gs),or(wc),or(bc)}function Lx(i){co(bc.current);var s=co(gs.current),h=Gf(s,i.type);s!==h&&(tr(wc,i),tr(gs,h))}function sg(i){wc.current===i&&(or(gs),or(wc))}var gr=La(0);function Md(i){for(var s=i;s!==null;){if(s.tag===13){var h=s.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var If=[];function ag(){for(var i=0;i<If.length;i++)If[i]._workInProgressVersionPrimary=null;If.length=0}var ud=Gs.ReactCurrentDispatcher,Cf=Gs.ReactCurrentBatchConfig,go=0,yr=null,jr=null,Kr=null,Ad=!1,sc=!1,Sc=0,b2=0;function xi(){throw Error(De(321))}function og(i,s){if(s===null)return!1;for(var h=0;h<s.length&&h<i.length;h++)if(!Kn(i[h],s[h]))return!1;return!0}function lg(i,s,h,y,w,T){if(go=T,yr=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,ud.current=i===null||i.memoizedState===null?E2:I2,i=h(y,w),sc){T=0;do{if(sc=!1,Sc=0,25<=T)throw Error(De(301));T+=1,Kr=jr=null,s.updateQueue=null,ud.current=C2,i=h(y,w)}while(sc)}if(ud.current=Dd,s=jr!==null&&jr.next!==null,go=0,Kr=jr=yr=null,Ad=!1,s)throw Error(De(300));return i}function ug(){var i=Sc!==0;return Sc=0,i}function ps(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kr===null?yr.memoizedState=Kr=i:Kr=Kr.next=i,Kr}function zn(){if(jr===null){var i=yr.alternate;i=i!==null?i.memoizedState:null}else i=jr.next;var s=Kr===null?yr.memoizedState:Kr.next;if(s!==null)Kr=s,jr=i;else{if(i===null)throw Error(De(310));jr=i,i={memoizedState:jr.memoizedState,baseState:jr.baseState,baseQueue:jr.baseQueue,queue:jr.queue,next:null},Kr===null?yr.memoizedState=Kr=i:Kr=Kr.next=i}return Kr}function Tc(i,s){return typeof s=="function"?s(i):s}function Pf(i){var s=zn(),h=s.queue;if(h===null)throw Error(De(311));h.lastRenderedReducer=i;var y=jr,w=y.baseQueue,T=h.pending;if(T!==null){if(w!==null){var M=w.next;w.next=T.next,T.next=M}y.baseQueue=w=T,h.pending=null}if(w!==null){T=w.next,y=y.baseState;var l=M=null,G=null,O=T;do{var ve=O.lane;if((go&ve)===ve)G!==null&&(G=G.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),y=O.hasEagerState?O.eagerState:i(y,O.action);else{var ge={lane:ve,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};G===null?(l=G=ge,M=y):G=G.next=ge,yr.lanes|=ve,yo|=ve}O=O.next}while(O!==null&&O!==T);G===null?M=y:G.next=l,Kn(y,s.memoizedState)||(Ki=!0),s.memoizedState=y,s.baseState=M,s.baseQueue=G,h.lastRenderedState=y}if(i=h.interleaved,i!==null){w=i;do T=w.lane,yr.lanes|=T,yo|=T,w=w.next;while(w!==i)}else w===null&&(h.lanes=0);return[s.memoizedState,h.dispatch]}function zf(i){var s=zn(),h=s.queue;if(h===null)throw Error(De(311));h.lastRenderedReducer=i;var y=h.dispatch,w=h.pending,T=s.memoizedState;if(w!==null){h.pending=null;var M=w=w.next;do T=i(T,M.action),M=M.next;while(M!==w);Kn(T,s.memoizedState)||(Ki=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),h.lastRenderedState=T}return[T,y]}function Rx(){}function Fx(i,s){var h=yr,y=zn(),w=s(),T=!Kn(y.memoizedState,w);if(T&&(y.memoizedState=w,Ki=!0),y=y.queue,cg(Nx.bind(null,h,y,i),[i]),y.getSnapshot!==s||T||Kr!==null&&Kr.memoizedState.tag&1){if(h.flags|=2048,kc(9,Ox.bind(null,h,y,w,s),void 0,null),Yr===null)throw Error(De(349));go&30||Bx(h,s,w)}return w}function Bx(i,s,h){i.flags|=16384,i={getSnapshot:s,value:h},s=yr.updateQueue,s===null?(s={lastEffect:null,stores:null},yr.updateQueue=s,s.stores=[i]):(h=s.stores,h===null?s.stores=[i]:h.push(i))}function Ox(i,s,h,y){s.value=h,s.getSnapshot=y,Vx(s)&&jx(i)}function Nx(i,s,h){return h(function(){Vx(s)&&jx(i)})}function Vx(i){var s=i.getSnapshot;i=i.value;try{var h=s();return!Kn(i,h)}catch{return!0}}function jx(i){var s=Zs(i,1);s!==null&&Xn(s,i,1,-1)}function G_(i){var s=ps();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tc,lastRenderedState:i},s.queue=i,i=i.dispatch=k2.bind(null,yr,i),[s.memoizedState,i]}function kc(i,s,h,y){return i={tag:i,create:s,destroy:h,deps:y,next:null},s=yr.updateQueue,s===null?(s={lastEffect:null,stores:null},yr.updateQueue=s,s.lastEffect=i.next=i):(h=s.lastEffect,h===null?s.lastEffect=i.next=i:(y=h.next,h.next=i,i.next=y,s.lastEffect=i)),i}function Ux(){return zn().memoizedState}function cd(i,s,h,y){var w=ps();yr.flags|=i,w.memoizedState=kc(1|s,h,void 0,y===void 0?null:y)}function Gd(i,s,h,y){var w=zn();y=y===void 0?null:y;var T=void 0;if(jr!==null){var M=jr.memoizedState;if(T=M.destroy,y!==null&&og(y,M.deps)){w.memoizedState=kc(s,h,T,y);return}}yr.flags|=i,w.memoizedState=kc(1|s,h,T,y)}function H_(i,s){return cd(8390656,8,i,s)}function cg(i,s){return Gd(2048,8,i,s)}function $x(i,s){return Gd(4,2,i,s)}function Zx(i,s){return Gd(4,4,i,s)}function qx(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Gx(i,s,h){return h=h!=null?h.concat([i]):null,Gd(4,4,qx.bind(null,s,i),h)}function hg(){}function Hx(i,s){var h=zn();s=s===void 0?null:s;var y=h.memoizedState;return y!==null&&s!==null&&og(s,y[1])?y[0]:(h.memoizedState=[i,s],i)}function Wx(i,s){var h=zn();s=s===void 0?null:s;var y=h.memoizedState;return y!==null&&s!==null&&og(s,y[1])?y[0]:(i=i(),h.memoizedState=[i,s],i)}function Xx(i,s,h){return go&21?(Kn(h,s)||(h=ex(),yr.lanes|=h,yo|=h,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,Ki=!0),i.memoizedState=h)}function S2(i,s){var h=qt;qt=h!==0&&4>h?h:4,i(!0);var y=Cf.transition;Cf.transition={};try{i(!1),s()}finally{qt=h,Cf.transition=y}}function Kx(){return zn().memoizedState}function T2(i,s,h){var y=Pa(i);if(h={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null},Yx(i))Qx(s,h);else if(h=Ax(i,s,h,y),h!==null){var w=Fi();Xn(h,i,y,w),Jx(h,s,y)}}function k2(i,s,h){var y=Pa(i),w={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null};if(Yx(i))Qx(s,w);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var M=s.lastRenderedState,l=T(M,h);if(w.hasEagerState=!0,w.eagerState=l,Kn(l,M)){var G=s.interleaved;G===null?(w.next=w,rg(s)):(w.next=G.next,G.next=w),s.interleaved=w;return}}catch{}finally{}h=Ax(i,s,w,y),h!==null&&(w=Fi(),Xn(h,i,y,w),Jx(h,s,y))}}function Yx(i){var s=i.alternate;return i===yr||s!==null&&s===yr}function Qx(i,s){sc=Ad=!0;var h=i.pending;h===null?s.next=s:(s.next=h.next,h.next=s),i.pending=s}function Jx(i,s,h){if(h&4194240){var y=s.lanes;y&=i.pendingLanes,h|=y,s.lanes=h,Um(i,h)}}var Dd={readContext:Pn,useCallback:xi,useContext:xi,useEffect:xi,useImperativeHandle:xi,useInsertionEffect:xi,useLayoutEffect:xi,useMemo:xi,useReducer:xi,useRef:xi,useState:xi,useDebugValue:xi,useDeferredValue:xi,useTransition:xi,useMutableSource:xi,useSyncExternalStore:xi,useId:xi,unstable_isNewReconciler:!1},E2={readContext:Pn,useCallback:function(i,s){return ps().memoizedState=[i,s===void 0?null:s],i},useContext:Pn,useEffect:H_,useImperativeHandle:function(i,s,h){return h=h!=null?h.concat([i]):null,cd(4194308,4,qx.bind(null,s,i),h)},useLayoutEffect:function(i,s){return cd(4194308,4,i,s)},useInsertionEffect:function(i,s){return cd(4,2,i,s)},useMemo:function(i,s){var h=ps();return s=s===void 0?null:s,i=i(),h.memoizedState=[i,s],i},useReducer:function(i,s,h){var y=ps();return s=h!==void 0?h(s):s,y.memoizedState=y.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},y.queue=i,i=i.dispatch=T2.bind(null,yr,i),[y.memoizedState,i]},useRef:function(i){var s=ps();return i={current:i},s.memoizedState=i},useState:G_,useDebugValue:hg,useDeferredValue:function(i){return ps().memoizedState=i},useTransition:function(){var i=G_(!1),s=i[0];return i=S2.bind(null,i[1]),ps().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,h){var y=yr,w=ps();if(dr){if(h===void 0)throw Error(De(407));h=h()}else{if(h=s(),Yr===null)throw Error(De(349));go&30||Bx(y,s,h)}w.memoizedState=h;var T={value:h,getSnapshot:s};return w.queue=T,H_(Nx.bind(null,y,T,i),[i]),y.flags|=2048,kc(9,Ox.bind(null,y,T,h,s),void 0,null),h},useId:function(){var i=ps(),s=Yr.identifierPrefix;if(dr){var h=Vs,y=Ns;h=(y&~(1<<32-Wn(y)-1)).toString(32)+h,s=":"+s+"R"+h,h=Sc++,0<h&&(s+="H"+h.toString(32)),s+=":"}else h=b2++,s=":"+s+"r"+h.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},I2={readContext:Pn,useCallback:Hx,useContext:Pn,useEffect:cg,useImperativeHandle:Gx,useInsertionEffect:$x,useLayoutEffect:Zx,useMemo:Wx,useReducer:Pf,useRef:Ux,useState:function(){return Pf(Tc)},useDebugValue:hg,useDeferredValue:function(i){var s=zn();return Xx(s,jr.memoizedState,i)},useTransition:function(){var i=Pf(Tc)[0],s=zn().memoizedState;return[i,s]},useMutableSource:Rx,useSyncExternalStore:Fx,useId:Kx,unstable_isNewReconciler:!1},C2={readContext:Pn,useCallback:Hx,useContext:Pn,useEffect:cg,useImperativeHandle:Gx,useInsertionEffect:$x,useLayoutEffect:Zx,useMemo:Wx,useReducer:zf,useRef:Ux,useState:function(){return zf(Tc)},useDebugValue:hg,useDeferredValue:function(i){var s=zn();return jr===null?s.memoizedState=i:Xx(s,jr.memoizedState,i)},useTransition:function(){var i=zf(Tc)[0],s=zn().memoizedState;return[i,s]},useMutableSource:Rx,useSyncExternalStore:Fx,useId:Kx,unstable_isNewReconciler:!1};function qn(i,s){if(i&&i.defaultProps){s=_r({},s),i=i.defaultProps;for(var h in i)s[h]===void 0&&(s[h]=i[h]);return s}return s}function pm(i,s,h,y){s=i.memoizedState,h=h(y,s),h=h==null?s:_r({},s,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var Hd={isMounted:function(i){return(i=i._reactInternals)?xo(i)===i:!1},enqueueSetState:function(i,s,h){i=i._reactInternals;var y=Fi(),w=Pa(i),T=js(y,w);T.payload=s,h!=null&&(T.callback=h),s=Ia(i,T,w),s!==null&&(Xn(s,i,w,y),ld(s,i,w))},enqueueReplaceState:function(i,s,h){i=i._reactInternals;var y=Fi(),w=Pa(i),T=js(y,w);T.tag=1,T.payload=s,h!=null&&(T.callback=h),s=Ia(i,T,w),s!==null&&(Xn(s,i,w,y),ld(s,i,w))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var h=Fi(),y=Pa(i),w=js(h,y);w.tag=2,s!=null&&(w.callback=s),s=Ia(i,w,y),s!==null&&(Xn(s,i,y,h),ld(s,i,y))}};function W_(i,s,h,y,w,T,M){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(y,T,M):s.prototype&&s.prototype.isPureReactComponent?!yc(h,y)||!yc(w,T):!0}function e0(i,s,h){var y=!1,w=Aa,T=s.contextType;return typeof T=="object"&&T!==null?T=Pn(T):(w=Qi(s)?fo:Si.current,y=s.contextTypes,T=(y=y!=null)?Il(i,w):Aa),s=new s(h,T),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Hd,i.stateNode=s,s._reactInternals=i,y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=w,i.__reactInternalMemoizedMaskedChildContext=T),s}function X_(i,s,h,y){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(h,y),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(h,y),s.state!==i&&Hd.enqueueReplaceState(s,s.state,null)}function fm(i,s,h,y){var w=i.stateNode;w.props=h,w.state=i.memoizedState,w.refs={},ig(i);var T=s.contextType;typeof T=="object"&&T!==null?w.context=Pn(T):(T=Qi(s)?fo:Si.current,w.context=Il(i,T)),w.state=i.memoizedState,T=s.getDerivedStateFromProps,typeof T=="function"&&(pm(i,s,T,h),w.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(s=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),s!==w.state&&Hd.enqueueReplaceState(w,w.state,null),zd(i,h,w,y),w.state=i.memoizedState),typeof w.componentDidMount=="function"&&(i.flags|=4194308)}function Ml(i,s){try{var h="",y=s;do h+=rb(y),y=y.return;while(y);var w=h}catch(T){w=`
Error generating stack: `+T.message+`
`+T.stack}return{value:i,source:s,stack:w,digest:null}}function Mf(i,s,h){return{value:i,source:null,stack:h??null,digest:s??null}}function mm(i,s){try{console.error(s.value)}catch(h){setTimeout(function(){throw h})}}var P2=typeof WeakMap=="function"?WeakMap:Map;function t0(i,s,h){h=js(-1,h),h.tag=3,h.payload={element:null};var y=s.value;return h.callback=function(){Rd||(Rd=!0,km=y),mm(i,s)},h}function r0(i,s,h){h=js(-1,h),h.tag=3;var y=i.type.getDerivedStateFromError;if(typeof y=="function"){var w=s.value;h.payload=function(){return y(w)},h.callback=function(){mm(i,s)}}var T=i.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(h.callback=function(){mm(i,s),typeof y!="function"&&(Ca===null?Ca=new Set([this]):Ca.add(this));var M=s.stack;this.componentDidCatch(s.value,{componentStack:M!==null?M:""})}),h}function K_(i,s,h){var y=i.pingCache;if(y===null){y=i.pingCache=new P2;var w=new Set;y.set(s,w)}else w=y.get(s),w===void 0&&(w=new Set,y.set(s,w));w.has(h)||(w.add(h),i=$2.bind(null,i,s,h),s.then(i,i))}function Y_(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function Q_(i,s,h,y,w){return i.mode&1?(i.flags|=65536,i.lanes=w,i):(i===s?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(s=js(-1,1),s.tag=2,Ia(h,s,1))),h.lanes|=1),i)}var z2=Gs.ReactCurrentOwner,Ki=!1;function Ri(i,s,h,y){s.child=i===null?Mx(s,null,h,y):Pl(s,i.child,h,y)}function J_(i,s,h,y,w){h=h.render;var T=s.ref;return Tl(s,w),y=lg(i,s,h,y,T,w),h=ug(),i!==null&&!Ki?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~w,qs(i,s,w)):(dr&&h&&Km(s),s.flags|=1,Ri(i,s,y,w),s.child)}function ev(i,s,h,y,w){if(i===null){var T=h.type;return typeof T=="function"&&!vg(T)&&T.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(s.tag=15,s.type=T,i0(i,s,T,y,w)):(i=fd(h.type,null,y,s,s.mode,w),i.ref=s.ref,i.return=s,s.child=i)}if(T=i.child,!(i.lanes&w)){var M=T.memoizedProps;if(h=h.compare,h=h!==null?h:yc,h(M,y)&&i.ref===s.ref)return qs(i,s,w)}return s.flags|=1,i=za(T,y),i.ref=s.ref,i.return=s,s.child=i}function i0(i,s,h,y,w){if(i!==null){var T=i.memoizedProps;if(yc(T,y)&&i.ref===s.ref)if(Ki=!1,s.pendingProps=y=T,(i.lanes&w)!==0)i.flags&131072&&(Ki=!0);else return s.lanes=i.lanes,qs(i,s,w)}return gm(i,s,h,y,w)}function n0(i,s,h){var y=s.pendingProps,w=y.children,T=i!==null?i.memoizedState:null;if(y.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},tr(vl,ln),ln|=h;else{if(!(h&1073741824))return i=T!==null?T.baseLanes|h:h,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,tr(vl,ln),ln|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=T!==null?T.baseLanes:h,tr(vl,ln),ln|=y}else T!==null?(y=T.baseLanes|h,s.memoizedState=null):y=h,tr(vl,ln),ln|=y;return Ri(i,s,w,h),s.child}function s0(i,s){var h=s.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(s.flags|=512,s.flags|=2097152)}function gm(i,s,h,y,w){var T=Qi(h)?fo:Si.current;return T=Il(s,T),Tl(s,w),h=lg(i,s,h,y,T,w),y=ug(),i!==null&&!Ki?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~w,qs(i,s,w)):(dr&&y&&Km(s),s.flags|=1,Ri(i,s,h,w),s.child)}function tv(i,s,h,y,w){if(Qi(h)){var T=!0;kd(s)}else T=!1;if(Tl(s,w),s.stateNode===null)hd(i,s),e0(s,h,y),fm(s,h,y,w),y=!0;else if(i===null){var M=s.stateNode,l=s.memoizedProps;M.props=l;var G=M.context,O=h.contextType;typeof O=="object"&&O!==null?O=Pn(O):(O=Qi(h)?fo:Si.current,O=Il(s,O));var ve=h.getDerivedStateFromProps,ge=typeof ve=="function"||typeof M.getSnapshotBeforeUpdate=="function";ge||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(l!==y||G!==O)&&X_(s,M,y,O),_a=!1;var oe=s.memoizedState;M.state=oe,zd(s,y,M,w),G=s.memoizedState,l!==y||oe!==G||Yi.current||_a?(typeof ve=="function"&&(pm(s,h,ve,y),G=s.memoizedState),(l=_a||W_(s,h,l,y,oe,G,O))?(ge||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=y,s.memoizedState=G),M.props=y,M.state=G,M.context=O,y=l):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),y=!1)}else{M=s.stateNode,Dx(i,s),l=s.memoizedProps,O=s.type===s.elementType?l:qn(s.type,l),M.props=O,ge=s.pendingProps,oe=M.context,G=h.contextType,typeof G=="object"&&G!==null?G=Pn(G):(G=Qi(h)?fo:Si.current,G=Il(s,G));var ze=h.getDerivedStateFromProps;(ve=typeof ze=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(l!==ge||oe!==G)&&X_(s,M,y,G),_a=!1,oe=s.memoizedState,M.state=oe,zd(s,y,M,w);var Fe=s.memoizedState;l!==ge||oe!==Fe||Yi.current||_a?(typeof ze=="function"&&(pm(s,h,ze,y),Fe=s.memoizedState),(O=_a||W_(s,h,O,y,oe,Fe,G)||!1)?(ve||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(y,Fe,G),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(y,Fe,G)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||l===i.memoizedProps&&oe===i.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&oe===i.memoizedState||(s.flags|=1024),s.memoizedProps=y,s.memoizedState=Fe),M.props=y,M.state=Fe,M.context=G,y=O):(typeof M.componentDidUpdate!="function"||l===i.memoizedProps&&oe===i.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&oe===i.memoizedState||(s.flags|=1024),y=!1)}return ym(i,s,h,y,T,w)}function ym(i,s,h,y,w,T){s0(i,s);var M=(s.flags&128)!==0;if(!y&&!M)return w&&V_(s,h,!1),qs(i,s,T);y=s.stateNode,z2.current=s;var l=M&&typeof h.getDerivedStateFromError!="function"?null:y.render();return s.flags|=1,i!==null&&M?(s.child=Pl(s,i.child,null,T),s.child=Pl(s,null,l,T)):Ri(i,s,l,T),s.memoizedState=y.state,w&&V_(s,h,!0),s.child}function a0(i){var s=i.stateNode;s.pendingContext?N_(i,s.pendingContext,s.pendingContext!==s.context):s.context&&N_(i,s.context,!1),ng(i,s.containerInfo)}function rv(i,s,h,y,w){return Cl(),Qm(w),s.flags|=256,Ri(i,s,h,y),s.child}var _m={dehydrated:null,treeContext:null,retryLane:0};function vm(i){return{baseLanes:i,cachePool:null,transitions:null}}function o0(i,s,h){var y=s.pendingProps,w=gr.current,T=!1,M=(s.flags&128)!==0,l;if((l=M)||(l=i!==null&&i.memoizedState===null?!1:(w&2)!==0),l?(T=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(w|=1),tr(gr,w&1),i===null)return hm(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(M=y.children,i=y.fallback,T?(y=s.mode,T=s.child,M={mode:"hidden",children:M},!(y&1)&&T!==null?(T.childLanes=0,T.pendingProps=M):T=Kd(M,y,0,null),i=po(i,y,h,null),T.return=s,i.return=s,T.sibling=i,s.child=T,s.child.memoizedState=vm(h),s.memoizedState=_m,i):dg(s,M));if(w=i.memoizedState,w!==null&&(l=w.dehydrated,l!==null))return M2(i,s,M,y,l,w,h);if(T){T=y.fallback,M=s.mode,w=i.child,l=w.sibling;var G={mode:"hidden",children:y.children};return!(M&1)&&s.child!==w?(y=s.child,y.childLanes=0,y.pendingProps=G,s.deletions=null):(y=za(w,G),y.subtreeFlags=w.subtreeFlags&14680064),l!==null?T=za(l,T):(T=po(T,M,h,null),T.flags|=2),T.return=s,y.return=s,y.sibling=T,s.child=y,y=T,T=s.child,M=i.child.memoizedState,M=M===null?vm(h):{baseLanes:M.baseLanes|h,cachePool:null,transitions:M.transitions},T.memoizedState=M,T.childLanes=i.childLanes&~h,s.memoizedState=_m,y}return T=i.child,i=T.sibling,y=za(T,{mode:"visible",children:y.children}),!(s.mode&1)&&(y.lanes=h),y.return=s,y.sibling=null,i!==null&&(h=s.deletions,h===null?(s.deletions=[i],s.flags|=16):h.push(i)),s.child=y,s.memoizedState=null,y}function dg(i,s){return s=Kd({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function Qh(i,s,h,y){return y!==null&&Qm(y),Pl(s,i.child,null,h),i=dg(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function M2(i,s,h,y,w,T,M){if(h)return s.flags&256?(s.flags&=-257,y=Mf(Error(De(422))),Qh(i,s,M,y)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(T=y.fallback,w=s.mode,y=Kd({mode:"visible",children:y.children},w,0,null),T=po(T,w,M,null),T.flags|=2,y.return=s,T.return=s,y.sibling=T,s.child=y,s.mode&1&&Pl(s,i.child,null,M),s.child.memoizedState=vm(M),s.memoizedState=_m,T);if(!(s.mode&1))return Qh(i,s,M,null);if(w.data==="$!"){if(y=w.nextSibling&&w.nextSibling.dataset,y)var l=y.dgst;return y=l,T=Error(De(419)),y=Mf(T,y,void 0),Qh(i,s,M,y)}if(l=(M&i.childLanes)!==0,Ki||l){if(y=Yr,y!==null){switch(M&-M){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=w&(y.suspendedLanes|M)?0:w,w!==0&&w!==T.retryLane&&(T.retryLane=w,Zs(i,w),Xn(y,i,w,-1))}return _g(),y=Mf(Error(De(421))),Qh(i,s,M,y)}return w.data==="$?"?(s.flags|=128,s.child=i.child,s=Z2.bind(null,i),w._reactRetry=s,null):(i=T.treeContext,un=Ea(w.nextSibling),cn=s,dr=!0,Hn=null,i!==null&&(kn[En++]=Ns,kn[En++]=Vs,kn[En++]=mo,Ns=i.id,Vs=i.overflow,mo=s),s=dg(s,y.children),s.flags|=4096,s)}function iv(i,s,h){i.lanes|=s;var y=i.alternate;y!==null&&(y.lanes|=s),dm(i.return,s,h)}function Af(i,s,h,y,w){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:y,tail:h,tailMode:w}:(T.isBackwards=s,T.rendering=null,T.renderingStartTime=0,T.last=y,T.tail=h,T.tailMode=w)}function l0(i,s,h){var y=s.pendingProps,w=y.revealOrder,T=y.tail;if(Ri(i,s,y.children,h),y=gr.current,y&2)y=y&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&iv(i,h,s);else if(i.tag===19)iv(i,h,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}y&=1}if(tr(gr,y),!(s.mode&1))s.memoizedState=null;else switch(w){case"forwards":for(h=s.child,w=null;h!==null;)i=h.alternate,i!==null&&Md(i)===null&&(w=h),h=h.sibling;h=w,h===null?(w=s.child,s.child=null):(w=h.sibling,h.sibling=null),Af(s,!1,w,h,T);break;case"backwards":for(h=null,w=s.child,s.child=null;w!==null;){if(i=w.alternate,i!==null&&Md(i)===null){s.child=w;break}i=w.sibling,w.sibling=h,h=w,w=i}Af(s,!0,h,null,T);break;case"together":Af(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function hd(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function qs(i,s,h){if(i!==null&&(s.dependencies=i.dependencies),yo|=s.lanes,!(h&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(De(153));if(s.child!==null){for(i=s.child,h=za(i,i.pendingProps),s.child=h,h.return=s;i.sibling!==null;)i=i.sibling,h=h.sibling=za(i,i.pendingProps),h.return=s;h.sibling=null}return s.child}function A2(i,s,h){switch(s.tag){case 3:a0(s),Cl();break;case 5:Lx(s);break;case 1:Qi(s.type)&&kd(s);break;case 4:ng(s,s.stateNode.containerInfo);break;case 10:var y=s.type._context,w=s.memoizedProps.value;tr(Cd,y._currentValue),y._currentValue=w;break;case 13:if(y=s.memoizedState,y!==null)return y.dehydrated!==null?(tr(gr,gr.current&1),s.flags|=128,null):h&s.child.childLanes?o0(i,s,h):(tr(gr,gr.current&1),i=qs(i,s,h),i!==null?i.sibling:null);tr(gr,gr.current&1);break;case 19:if(y=(h&s.childLanes)!==0,i.flags&128){if(y)return l0(i,s,h);s.flags|=128}if(w=s.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),tr(gr,gr.current),y)break;return null;case 22:case 23:return s.lanes=0,n0(i,s,h)}return qs(i,s,h)}var u0,xm,c0,h0;u0=function(i,s){for(var h=s.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};xm=function(){};c0=function(i,s,h,y){var w=i.memoizedProps;if(w!==y){i=s.stateNode,co(gs.current);var T=null;switch(h){case"input":w=Uf(i,w),y=Uf(i,y),T=[];break;case"select":w=_r({},w,{value:void 0}),y=_r({},y,{value:void 0}),T=[];break;case"textarea":w=qf(i,w),y=qf(i,y),T=[];break;default:typeof w.onClick!="function"&&typeof y.onClick=="function"&&(i.onclick=Sd)}Hf(h,y);var M;h=null;for(O in w)if(!y.hasOwnProperty(O)&&w.hasOwnProperty(O)&&w[O]!=null)if(O==="style"){var l=w[O];for(M in l)l.hasOwnProperty(M)&&(h||(h={}),h[M]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(cc.hasOwnProperty(O)?T||(T=[]):(T=T||[]).push(O,null));for(O in y){var G=y[O];if(l=w!=null?w[O]:void 0,y.hasOwnProperty(O)&&G!==l&&(G!=null||l!=null))if(O==="style")if(l){for(M in l)!l.hasOwnProperty(M)||G&&G.hasOwnProperty(M)||(h||(h={}),h[M]="");for(M in G)G.hasOwnProperty(M)&&l[M]!==G[M]&&(h||(h={}),h[M]=G[M])}else h||(T||(T=[]),T.push(O,h)),h=G;else O==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,l=l?l.__html:void 0,G!=null&&l!==G&&(T=T||[]).push(O,G)):O==="children"?typeof G!="string"&&typeof G!="number"||(T=T||[]).push(O,""+G):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(cc.hasOwnProperty(O)?(G!=null&&O==="onScroll"&&ar("scroll",i),T||l===G||(T=[])):(T=T||[]).push(O,G))}h&&(T=T||[]).push("style",h);var O=T;(s.updateQueue=O)&&(s.flags|=4)}};h0=function(i,s,h,y){h!==y&&(s.flags|=4)};function Wu(i,s){if(!dr)switch(i.tailMode){case"hidden":s=i.tail;for(var h=null;s!==null;)s.alternate!==null&&(h=s),s=s.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:y.sibling=null}}function wi(i){var s=i.alternate!==null&&i.alternate.child===i.child,h=0,y=0;if(s)for(var w=i.child;w!==null;)h|=w.lanes|w.childLanes,y|=w.subtreeFlags&14680064,y|=w.flags&14680064,w.return=i,w=w.sibling;else for(w=i.child;w!==null;)h|=w.lanes|w.childLanes,y|=w.subtreeFlags,y|=w.flags,w.return=i,w=w.sibling;return i.subtreeFlags|=y,i.childLanes=h,s}function D2(i,s,h){var y=s.pendingProps;switch(Ym(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wi(s),null;case 1:return Qi(s.type)&&Td(),wi(s),null;case 3:return y=s.stateNode,zl(),or(Yi),or(Si),ag(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(i===null||i.child===null)&&(Kh(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Hn!==null&&(Cm(Hn),Hn=null))),xm(i,s),wi(s),null;case 5:sg(s);var w=co(bc.current);if(h=s.type,i!==null&&s.stateNode!=null)c0(i,s,h,y,w),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!y){if(s.stateNode===null)throw Error(De(166));return wi(s),null}if(i=co(gs.current),Kh(s)){y=s.stateNode,h=s.type;var T=s.memoizedProps;switch(y[fs]=s,y[xc]=T,i=(s.mode&1)!==0,h){case"dialog":ar("cancel",y),ar("close",y);break;case"iframe":case"object":case"embed":ar("load",y);break;case"video":case"audio":for(w=0;w<Ju.length;w++)ar(Ju[w],y);break;case"source":ar("error",y);break;case"img":case"image":case"link":ar("error",y),ar("load",y);break;case"details":ar("toggle",y);break;case"input":d_(y,T),ar("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!T.multiple},ar("invalid",y);break;case"textarea":f_(y,T),ar("invalid",y)}Hf(h,T),w=null;for(var M in T)if(T.hasOwnProperty(M)){var l=T[M];M==="children"?typeof l=="string"?y.textContent!==l&&(T.suppressHydrationWarning!==!0&&Xh(y.textContent,l,i),w=["children",l]):typeof l=="number"&&y.textContent!==""+l&&(T.suppressHydrationWarning!==!0&&Xh(y.textContent,l,i),w=["children",""+l]):cc.hasOwnProperty(M)&&l!=null&&M==="onScroll"&&ar("scroll",y)}switch(h){case"input":jh(y),p_(y,T,!0);break;case"textarea":jh(y),m_(y);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(y.onclick=Sd)}y=w,s.updateQueue=y,y!==null&&(s.flags|=4)}else{M=w.nodeType===9?w:w.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Nv(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=M.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof y.is=="string"?i=M.createElement(h,{is:y.is}):(i=M.createElement(h),h==="select"&&(M=i,y.multiple?M.multiple=!0:y.size&&(M.size=y.size))):i=M.createElementNS(i,h),i[fs]=s,i[xc]=y,u0(i,s,!1,!1),s.stateNode=i;e:{switch(M=Wf(h,y),h){case"dialog":ar("cancel",i),ar("close",i),w=y;break;case"iframe":case"object":case"embed":ar("load",i),w=y;break;case"video":case"audio":for(w=0;w<Ju.length;w++)ar(Ju[w],i);w=y;break;case"source":ar("error",i),w=y;break;case"img":case"image":case"link":ar("error",i),ar("load",i),w=y;break;case"details":ar("toggle",i),w=y;break;case"input":d_(i,y),w=Uf(i,y),ar("invalid",i);break;case"option":w=y;break;case"select":i._wrapperState={wasMultiple:!!y.multiple},w=_r({},y,{value:void 0}),ar("invalid",i);break;case"textarea":f_(i,y),w=qf(i,y),ar("invalid",i);break;default:w=y}Hf(h,w),l=w;for(T in l)if(l.hasOwnProperty(T)){var G=l[T];T==="style"?Uv(i,G):T==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&Vv(i,G)):T==="children"?typeof G=="string"?(h!=="textarea"||G!=="")&&hc(i,G):typeof G=="number"&&hc(i,""+G):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(cc.hasOwnProperty(T)?G!=null&&T==="onScroll"&&ar("scroll",i):G!=null&&Fm(i,T,G,M))}switch(h){case"input":jh(i),p_(i,y,!1);break;case"textarea":jh(i),m_(i);break;case"option":y.value!=null&&i.setAttribute("value",""+Ma(y.value));break;case"select":i.multiple=!!y.multiple,T=y.value,T!=null?xl(i,!!y.multiple,T,!1):y.defaultValue!=null&&xl(i,!!y.multiple,y.defaultValue,!0);break;default:typeof w.onClick=="function"&&(i.onclick=Sd)}switch(h){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return wi(s),null;case 6:if(i&&s.stateNode!=null)h0(i,s,i.memoizedProps,y);else{if(typeof y!="string"&&s.stateNode===null)throw Error(De(166));if(h=co(bc.current),co(gs.current),Kh(s)){if(y=s.stateNode,h=s.memoizedProps,y[fs]=s,(T=y.nodeValue!==h)&&(i=cn,i!==null))switch(i.tag){case 3:Xh(y.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Xh(y.nodeValue,h,(i.mode&1)!==0)}T&&(s.flags|=4)}else y=(h.nodeType===9?h:h.ownerDocument).createTextNode(y),y[fs]=s,s.stateNode=y}return wi(s),null;case 13:if(or(gr),y=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(dr&&un!==null&&s.mode&1&&!(s.flags&128))Px(),Cl(),s.flags|=98560,T=!1;else if(T=Kh(s),y!==null&&y.dehydrated!==null){if(i===null){if(!T)throw Error(De(318));if(T=s.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(De(317));T[fs]=s}else Cl(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;wi(s),T=!1}else Hn!==null&&(Cm(Hn),Hn=null),T=!0;if(!T)return s.flags&65536?s:null}return s.flags&128?(s.lanes=h,s):(y=y!==null,y!==(i!==null&&i.memoizedState!==null)&&y&&(s.child.flags|=8192,s.mode&1&&(i===null||gr.current&1?Ur===0&&(Ur=3):_g())),s.updateQueue!==null&&(s.flags|=4),wi(s),null);case 4:return zl(),xm(i,s),i===null&&_c(s.stateNode.containerInfo),wi(s),null;case 10:return tg(s.type._context),wi(s),null;case 17:return Qi(s.type)&&Td(),wi(s),null;case 19:if(or(gr),T=s.memoizedState,T===null)return wi(s),null;if(y=(s.flags&128)!==0,M=T.rendering,M===null)if(y)Wu(T,!1);else{if(Ur!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(M=Md(i),M!==null){for(s.flags|=128,Wu(T,!1),y=M.updateQueue,y!==null&&(s.updateQueue=y,s.flags|=4),s.subtreeFlags=0,y=h,h=s.child;h!==null;)T=h,i=y,T.flags&=14680066,M=T.alternate,M===null?(T.childLanes=0,T.lanes=i,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=M.childLanes,T.lanes=M.lanes,T.child=M.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=M.memoizedProps,T.memoizedState=M.memoizedState,T.updateQueue=M.updateQueue,T.type=M.type,i=M.dependencies,T.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return tr(gr,gr.current&1|2),s.child}i=i.sibling}T.tail!==null&&Mr()>Al&&(s.flags|=128,y=!0,Wu(T,!1),s.lanes=4194304)}else{if(!y)if(i=Md(M),i!==null){if(s.flags|=128,y=!0,h=i.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),Wu(T,!0),T.tail===null&&T.tailMode==="hidden"&&!M.alternate&&!dr)return wi(s),null}else 2*Mr()-T.renderingStartTime>Al&&h!==1073741824&&(s.flags|=128,y=!0,Wu(T,!1),s.lanes=4194304);T.isBackwards?(M.sibling=s.child,s.child=M):(h=T.last,h!==null?h.sibling=M:s.child=M,T.last=M)}return T.tail!==null?(s=T.tail,T.rendering=s,T.tail=s.sibling,T.renderingStartTime=Mr(),s.sibling=null,h=gr.current,tr(gr,y?h&1|2:h&1),s):(wi(s),null);case 22:case 23:return yg(),y=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==y&&(s.flags|=8192),y&&s.mode&1?ln&1073741824&&(wi(s),s.subtreeFlags&6&&(s.flags|=8192)):wi(s),null;case 24:return null;case 25:return null}throw Error(De(156,s.tag))}function L2(i,s){switch(Ym(s),s.tag){case 1:return Qi(s.type)&&Td(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return zl(),or(Yi),or(Si),ag(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return sg(s),null;case 13:if(or(gr),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(De(340));Cl()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return or(gr),null;case 4:return zl(),null;case 10:return tg(s.type._context),null;case 22:case 23:return yg(),null;case 24:return null;default:return null}}var Jh=!1,bi=!1,R2=typeof WeakSet=="function"?WeakSet:Set,rt=null;function _l(i,s){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(y){br(i,s,y)}else h.current=null}function wm(i,s,h){try{h()}catch(y){br(i,s,y)}}var nv=!1;function F2(i,s){if(nm=xd,i=gx(),Xm(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var y=h.getSelection&&h.getSelection();if(y&&y.rangeCount!==0){h=y.anchorNode;var w=y.anchorOffset,T=y.focusNode;y=y.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var M=0,l=-1,G=-1,O=0,ve=0,ge=i,oe=null;t:for(;;){for(var ze;ge!==h||w!==0&&ge.nodeType!==3||(l=M+w),ge!==T||y!==0&&ge.nodeType!==3||(G=M+y),ge.nodeType===3&&(M+=ge.nodeValue.length),(ze=ge.firstChild)!==null;)oe=ge,ge=ze;for(;;){if(ge===i)break t;if(oe===h&&++O===w&&(l=M),oe===T&&++ve===y&&(G=M),(ze=ge.nextSibling)!==null)break;ge=oe,oe=ge.parentNode}ge=ze}h=l===-1||G===-1?null:{start:l,end:G}}else h=null}h=h||{start:0,end:0}}else h=null;for(sm={focusedElem:i,selectionRange:h},xd=!1,rt=s;rt!==null;)if(s=rt,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,rt=i;else for(;rt!==null;){s=rt;try{var Fe=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(Fe!==null){var Ce=Fe.memoizedProps,lt=Fe.memoizedState,ie=s.stateNode,te=ie.getSnapshotBeforeUpdate(s.elementType===s.type?Ce:qn(s.type,Ce),lt);ie.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var ce=s.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(Ee){br(s,s.return,Ee)}if(i=s.sibling,i!==null){i.return=s.return,rt=i;break}rt=s.return}return Fe=nv,nv=!1,Fe}function ac(i,s,h){var y=s.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var w=y=y.next;do{if((w.tag&i)===i){var T=w.destroy;w.destroy=void 0,T!==void 0&&wm(s,h,T)}w=w.next}while(w!==y)}}function Wd(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var h=s=s.next;do{if((h.tag&i)===i){var y=h.create;h.destroy=y()}h=h.next}while(h!==s)}}function bm(i){var s=i.ref;if(s!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof s=="function"?s(i):s.current=i}}function d0(i){var s=i.alternate;s!==null&&(i.alternate=null,d0(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[fs],delete s[xc],delete s[lm],delete s[_2],delete s[v2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function p0(i){return i.tag===5||i.tag===3||i.tag===4}function sv(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||p0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Sm(i,s,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,s?h.nodeType===8?h.parentNode.insertBefore(i,s):h.insertBefore(i,s):(h.nodeType===8?(s=h.parentNode,s.insertBefore(i,h)):(s=h,s.appendChild(i)),h=h._reactRootContainer,h!=null||s.onclick!==null||(s.onclick=Sd));else if(y!==4&&(i=i.child,i!==null))for(Sm(i,s,h),i=i.sibling;i!==null;)Sm(i,s,h),i=i.sibling}function Tm(i,s,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,s?h.insertBefore(i,s):h.appendChild(i);else if(y!==4&&(i=i.child,i!==null))for(Tm(i,s,h),i=i.sibling;i!==null;)Tm(i,s,h),i=i.sibling}var ai=null,Gn=!1;function ga(i,s,h){for(h=h.child;h!==null;)f0(i,s,h),h=h.sibling}function f0(i,s,h){if(ms&&typeof ms.onCommitFiberUnmount=="function")try{ms.onCommitFiberUnmount(Vd,h)}catch{}switch(h.tag){case 5:bi||_l(h,s);case 6:var y=ai,w=Gn;ai=null,ga(i,s,h),ai=y,Gn=w,ai!==null&&(Gn?(i=ai,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):ai.removeChild(h.stateNode));break;case 18:ai!==null&&(Gn?(i=ai,h=h.stateNode,i.nodeType===8?kf(i.parentNode,h):i.nodeType===1&&kf(i,h),mc(i)):kf(ai,h.stateNode));break;case 4:y=ai,w=Gn,ai=h.stateNode.containerInfo,Gn=!0,ga(i,s,h),ai=y,Gn=w;break;case 0:case 11:case 14:case 15:if(!bi&&(y=h.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){w=y=y.next;do{var T=w,M=T.destroy;T=T.tag,M!==void 0&&(T&2||T&4)&&wm(h,s,M),w=w.next}while(w!==y)}ga(i,s,h);break;case 1:if(!bi&&(_l(h,s),y=h.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=h.memoizedProps,y.state=h.memoizedState,y.componentWillUnmount()}catch(l){br(h,s,l)}ga(i,s,h);break;case 21:ga(i,s,h);break;case 22:h.mode&1?(bi=(y=bi)||h.memoizedState!==null,ga(i,s,h),bi=y):ga(i,s,h);break;default:ga(i,s,h)}}function av(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new R2),s.forEach(function(y){var w=q2.bind(null,i,y);h.has(y)||(h.add(y),y.then(w,w))})}}function Zn(i,s){var h=s.deletions;if(h!==null)for(var y=0;y<h.length;y++){var w=h[y];try{var T=i,M=s,l=M;e:for(;l!==null;){switch(l.tag){case 5:ai=l.stateNode,Gn=!1;break e;case 3:ai=l.stateNode.containerInfo,Gn=!0;break e;case 4:ai=l.stateNode.containerInfo,Gn=!0;break e}l=l.return}if(ai===null)throw Error(De(160));f0(T,M,w),ai=null,Gn=!1;var G=w.alternate;G!==null&&(G.return=null),w.return=null}catch(O){br(w,s,O)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)m0(s,i),s=s.sibling}function m0(i,s){var h=i.alternate,y=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Zn(s,i),ds(i),y&4){try{ac(3,i,i.return),Wd(3,i)}catch(Ce){br(i,i.return,Ce)}try{ac(5,i,i.return)}catch(Ce){br(i,i.return,Ce)}}break;case 1:Zn(s,i),ds(i),y&512&&h!==null&&_l(h,h.return);break;case 5:if(Zn(s,i),ds(i),y&512&&h!==null&&_l(h,h.return),i.flags&32){var w=i.stateNode;try{hc(w,"")}catch(Ce){br(i,i.return,Ce)}}if(y&4&&(w=i.stateNode,w!=null)){var T=i.memoizedProps,M=h!==null?h.memoizedProps:T,l=i.type,G=i.updateQueue;if(i.updateQueue=null,G!==null)try{l==="input"&&T.type==="radio"&&T.name!=null&&Bv(w,T),Wf(l,M);var O=Wf(l,T);for(M=0;M<G.length;M+=2){var ve=G[M],ge=G[M+1];ve==="style"?Uv(w,ge):ve==="dangerouslySetInnerHTML"?Vv(w,ge):ve==="children"?hc(w,ge):Fm(w,ve,ge,O)}switch(l){case"input":$f(w,T);break;case"textarea":Ov(w,T);break;case"select":var oe=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!T.multiple;var ze=T.value;ze!=null?xl(w,!!T.multiple,ze,!1):oe!==!!T.multiple&&(T.defaultValue!=null?xl(w,!!T.multiple,T.defaultValue,!0):xl(w,!!T.multiple,T.multiple?[]:"",!1))}w[xc]=T}catch(Ce){br(i,i.return,Ce)}}break;case 6:if(Zn(s,i),ds(i),y&4){if(i.stateNode===null)throw Error(De(162));w=i.stateNode,T=i.memoizedProps;try{w.nodeValue=T}catch(Ce){br(i,i.return,Ce)}}break;case 3:if(Zn(s,i),ds(i),y&4&&h!==null&&h.memoizedState.isDehydrated)try{mc(s.containerInfo)}catch(Ce){br(i,i.return,Ce)}break;case 4:Zn(s,i),ds(i);break;case 13:Zn(s,i),ds(i),w=i.child,w.flags&8192&&(T=w.memoizedState!==null,w.stateNode.isHidden=T,!T||w.alternate!==null&&w.alternate.memoizedState!==null||(mg=Mr())),y&4&&av(i);break;case 22:if(ve=h!==null&&h.memoizedState!==null,i.mode&1?(bi=(O=bi)||ve,Zn(s,i),bi=O):Zn(s,i),ds(i),y&8192){if(O=i.memoizedState!==null,(i.stateNode.isHidden=O)&&!ve&&i.mode&1)for(rt=i,ve=i.child;ve!==null;){for(ge=rt=ve;rt!==null;){switch(oe=rt,ze=oe.child,oe.tag){case 0:case 11:case 14:case 15:ac(4,oe,oe.return);break;case 1:_l(oe,oe.return);var Fe=oe.stateNode;if(typeof Fe.componentWillUnmount=="function"){y=oe,h=oe.return;try{s=y,Fe.props=s.memoizedProps,Fe.state=s.memoizedState,Fe.componentWillUnmount()}catch(Ce){br(y,h,Ce)}}break;case 5:_l(oe,oe.return);break;case 22:if(oe.memoizedState!==null){lv(ge);continue}}ze!==null?(ze.return=oe,rt=ze):lv(ge)}ve=ve.sibling}e:for(ve=null,ge=i;;){if(ge.tag===5){if(ve===null){ve=ge;try{w=ge.stateNode,O?(T=w.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(l=ge.stateNode,G=ge.memoizedProps.style,M=G!=null&&G.hasOwnProperty("display")?G.display:null,l.style.display=jv("display",M))}catch(Ce){br(i,i.return,Ce)}}}else if(ge.tag===6){if(ve===null)try{ge.stateNode.nodeValue=O?"":ge.memoizedProps}catch(Ce){br(i,i.return,Ce)}}else if((ge.tag!==22&&ge.tag!==23||ge.memoizedState===null||ge===i)&&ge.child!==null){ge.child.return=ge,ge=ge.child;continue}if(ge===i)break e;for(;ge.sibling===null;){if(ge.return===null||ge.return===i)break e;ve===ge&&(ve=null),ge=ge.return}ve===ge&&(ve=null),ge.sibling.return=ge.return,ge=ge.sibling}}break;case 19:Zn(s,i),ds(i),y&4&&av(i);break;case 21:break;default:Zn(s,i),ds(i)}}function ds(i){var s=i.flags;if(s&2){try{e:{for(var h=i.return;h!==null;){if(p0(h)){var y=h;break e}h=h.return}throw Error(De(160))}switch(y.tag){case 5:var w=y.stateNode;y.flags&32&&(hc(w,""),y.flags&=-33);var T=sv(i);Tm(i,T,w);break;case 3:case 4:var M=y.stateNode.containerInfo,l=sv(i);Sm(i,l,M);break;default:throw Error(De(161))}}catch(G){br(i,i.return,G)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function B2(i,s,h){rt=i,g0(i)}function g0(i,s,h){for(var y=(i.mode&1)!==0;rt!==null;){var w=rt,T=w.child;if(w.tag===22&&y){var M=w.memoizedState!==null||Jh;if(!M){var l=w.alternate,G=l!==null&&l.memoizedState!==null||bi;l=Jh;var O=bi;if(Jh=M,(bi=G)&&!O)for(rt=w;rt!==null;)M=rt,G=M.child,M.tag===22&&M.memoizedState!==null?uv(w):G!==null?(G.return=M,rt=G):uv(w);for(;T!==null;)rt=T,g0(T),T=T.sibling;rt=w,Jh=l,bi=O}ov(i)}else w.subtreeFlags&8772&&T!==null?(T.return=w,rt=T):ov(i)}}function ov(i){for(;rt!==null;){var s=rt;if(s.flags&8772){var h=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:bi||Wd(5,s);break;case 1:var y=s.stateNode;if(s.flags&4&&!bi)if(h===null)y.componentDidMount();else{var w=s.elementType===s.type?h.memoizedProps:qn(s.type,h.memoizedProps);y.componentDidUpdate(w,h.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var T=s.updateQueue;T!==null&&q_(s,T,y);break;case 3:var M=s.updateQueue;if(M!==null){if(h=null,s.child!==null)switch(s.child.tag){case 5:h=s.child.stateNode;break;case 1:h=s.child.stateNode}q_(s,M,h)}break;case 5:var l=s.stateNode;if(h===null&&s.flags&4){h=l;var G=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&h.focus();break;case"img":G.src&&(h.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var O=s.alternate;if(O!==null){var ve=O.memoizedState;if(ve!==null){var ge=ve.dehydrated;ge!==null&&mc(ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}bi||s.flags&512&&bm(s)}catch(oe){br(s,s.return,oe)}}if(s===i){rt=null;break}if(h=s.sibling,h!==null){h.return=s.return,rt=h;break}rt=s.return}}function lv(i){for(;rt!==null;){var s=rt;if(s===i){rt=null;break}var h=s.sibling;if(h!==null){h.return=s.return,rt=h;break}rt=s.return}}function uv(i){for(;rt!==null;){var s=rt;try{switch(s.tag){case 0:case 11:case 15:var h=s.return;try{Wd(4,s)}catch(G){br(s,h,G)}break;case 1:var y=s.stateNode;if(typeof y.componentDidMount=="function"){var w=s.return;try{y.componentDidMount()}catch(G){br(s,w,G)}}var T=s.return;try{bm(s)}catch(G){br(s,T,G)}break;case 5:var M=s.return;try{bm(s)}catch(G){br(s,M,G)}}}catch(G){br(s,s.return,G)}if(s===i){rt=null;break}var l=s.sibling;if(l!==null){l.return=s.return,rt=l;break}rt=s.return}}var O2=Math.ceil,Ld=Gs.ReactCurrentDispatcher,pg=Gs.ReactCurrentOwner,Cn=Gs.ReactCurrentBatchConfig,Lt=0,Yr=null,Lr=null,oi=0,ln=0,vl=La(0),Ur=0,Ec=null,yo=0,Xd=0,fg=0,oc=null,Xi=null,mg=0,Al=1/0,Bs=null,Rd=!1,km=null,Ca=null,ed=!1,ba=null,Fd=0,lc=0,Em=null,dd=-1,pd=0;function Fi(){return Lt&6?Mr():dd!==-1?dd:dd=Mr()}function Pa(i){return i.mode&1?Lt&2&&oi!==0?oi&-oi:w2.transition!==null?(pd===0&&(pd=ex()),pd):(i=qt,i!==0||(i=window.event,i=i===void 0?16:ox(i.type)),i):1}function Xn(i,s,h,y){if(50<lc)throw lc=0,Em=null,Error(De(185));Cc(i,h,y),(!(Lt&2)||i!==Yr)&&(i===Yr&&(!(Lt&2)&&(Xd|=h),Ur===4&&xa(i,oi)),Ji(i,y),h===1&&Lt===0&&!(s.mode&1)&&(Al=Mr()+500,qd&&Ra()))}function Ji(i,s){var h=i.callbackNode;wb(i,s);var y=vd(i,i===Yr?oi:0);if(y===0)h!==null&&__(h),i.callbackNode=null,i.callbackPriority=0;else if(s=y&-y,i.callbackPriority!==s){if(h!=null&&__(h),s===1)i.tag===0?x2(cv.bind(null,i)):Ex(cv.bind(null,i)),g2(function(){!(Lt&6)&&Ra()}),h=null;else{switch(tx(y)){case 1:h=jm;break;case 4:h=Qv;break;case 16:h=_d;break;case 536870912:h=Jv;break;default:h=_d}h=T0(h,y0.bind(null,i))}i.callbackPriority=s,i.callbackNode=h}}function y0(i,s){if(dd=-1,pd=0,Lt&6)throw Error(De(327));var h=i.callbackNode;if(kl()&&i.callbackNode!==h)return null;var y=vd(i,i===Yr?oi:0);if(y===0)return null;if(y&30||y&i.expiredLanes||s)s=Bd(i,y);else{s=y;var w=Lt;Lt|=2;var T=v0();(Yr!==i||oi!==s)&&(Bs=null,Al=Mr()+500,ho(i,s));do try{j2();break}catch(l){_0(i,l)}while(!0);eg(),Ld.current=T,Lt=w,Lr!==null?s=0:(Yr=null,oi=0,s=Ur)}if(s!==0){if(s===2&&(w=Jf(i),w!==0&&(y=w,s=Im(i,w))),s===1)throw h=Ec,ho(i,0),xa(i,y),Ji(i,Mr()),h;if(s===6)xa(i,y);else{if(w=i.current.alternate,!(y&30)&&!N2(w)&&(s=Bd(i,y),s===2&&(T=Jf(i),T!==0&&(y=T,s=Im(i,T))),s===1))throw h=Ec,ho(i,0),xa(i,y),Ji(i,Mr()),h;switch(i.finishedWork=w,i.finishedLanes=y,s){case 0:case 1:throw Error(De(345));case 2:oo(i,Xi,Bs);break;case 3:if(xa(i,y),(y&130023424)===y&&(s=mg+500-Mr(),10<s)){if(vd(i,0)!==0)break;if(w=i.suspendedLanes,(w&y)!==y){Fi(),i.pingedLanes|=i.suspendedLanes&w;break}i.timeoutHandle=om(oo.bind(null,i,Xi,Bs),s);break}oo(i,Xi,Bs);break;case 4:if(xa(i,y),(y&4194240)===y)break;for(s=i.eventTimes,w=-1;0<y;){var M=31-Wn(y);T=1<<M,M=s[M],M>w&&(w=M),y&=~T}if(y=w,y=Mr()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*O2(y/1960))-y,10<y){i.timeoutHandle=om(oo.bind(null,i,Xi,Bs),y);break}oo(i,Xi,Bs);break;case 5:oo(i,Xi,Bs);break;default:throw Error(De(329))}}}return Ji(i,Mr()),i.callbackNode===h?y0.bind(null,i):null}function Im(i,s){var h=oc;return i.current.memoizedState.isDehydrated&&(ho(i,s).flags|=256),i=Bd(i,s),i!==2&&(s=Xi,Xi=h,s!==null&&Cm(s)),i}function Cm(i){Xi===null?Xi=i:Xi.push.apply(Xi,i)}function N2(i){for(var s=i;;){if(s.flags&16384){var h=s.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var y=0;y<h.length;y++){var w=h[y],T=w.getSnapshot;w=w.value;try{if(!Kn(T(),w))return!1}catch{return!1}}}if(h=s.child,s.subtreeFlags&16384&&h!==null)h.return=s,s=h;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function xa(i,s){for(s&=~fg,s&=~Xd,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var h=31-Wn(s),y=1<<h;i[h]=-1,s&=~y}}function cv(i){if(Lt&6)throw Error(De(327));kl();var s=vd(i,0);if(!(s&1))return Ji(i,Mr()),null;var h=Bd(i,s);if(i.tag!==0&&h===2){var y=Jf(i);y!==0&&(s=y,h=Im(i,y))}if(h===1)throw h=Ec,ho(i,0),xa(i,s),Ji(i,Mr()),h;if(h===6)throw Error(De(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,oo(i,Xi,Bs),Ji(i,Mr()),null}function gg(i,s){var h=Lt;Lt|=1;try{return i(s)}finally{Lt=h,Lt===0&&(Al=Mr()+500,qd&&Ra())}}function _o(i){ba!==null&&ba.tag===0&&!(Lt&6)&&kl();var s=Lt;Lt|=1;var h=Cn.transition,y=qt;try{if(Cn.transition=null,qt=1,i)return i()}finally{qt=y,Cn.transition=h,Lt=s,!(Lt&6)&&Ra()}}function yg(){ln=vl.current,or(vl)}function ho(i,s){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,m2(h)),Lr!==null)for(h=Lr.return;h!==null;){var y=h;switch(Ym(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&Td();break;case 3:zl(),or(Yi),or(Si),ag();break;case 5:sg(y);break;case 4:zl();break;case 13:or(gr);break;case 19:or(gr);break;case 10:tg(y.type._context);break;case 22:case 23:yg()}h=h.return}if(Yr=i,Lr=i=za(i.current,null),oi=ln=s,Ur=0,Ec=null,fg=Xd=yo=0,Xi=oc=null,uo!==null){for(s=0;s<uo.length;s++)if(h=uo[s],y=h.interleaved,y!==null){h.interleaved=null;var w=y.next,T=h.pending;if(T!==null){var M=T.next;T.next=w,y.next=M}h.pending=y}uo=null}return i}function _0(i,s){do{var h=Lr;try{if(eg(),ud.current=Dd,Ad){for(var y=yr.memoizedState;y!==null;){var w=y.queue;w!==null&&(w.pending=null),y=y.next}Ad=!1}if(go=0,Kr=jr=yr=null,sc=!1,Sc=0,pg.current=null,h===null||h.return===null){Ur=1,Ec=s,Lr=null;break}e:{var T=i,M=h.return,l=h,G=s;if(s=oi,l.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var O=G,ve=l,ge=ve.tag;if(!(ve.mode&1)&&(ge===0||ge===11||ge===15)){var oe=ve.alternate;oe?(ve.updateQueue=oe.updateQueue,ve.memoizedState=oe.memoizedState,ve.lanes=oe.lanes):(ve.updateQueue=null,ve.memoizedState=null)}var ze=Y_(M);if(ze!==null){ze.flags&=-257,Q_(ze,M,l,T,s),ze.mode&1&&K_(T,O,s),s=ze,G=O;var Fe=s.updateQueue;if(Fe===null){var Ce=new Set;Ce.add(G),s.updateQueue=Ce}else Fe.add(G);break e}else{if(!(s&1)){K_(T,O,s),_g();break e}G=Error(De(426))}}else if(dr&&l.mode&1){var lt=Y_(M);if(lt!==null){!(lt.flags&65536)&&(lt.flags|=256),Q_(lt,M,l,T,s),Qm(Ml(G,l));break e}}T=G=Ml(G,l),Ur!==4&&(Ur=2),oc===null?oc=[T]:oc.push(T),T=M;do{switch(T.tag){case 3:T.flags|=65536,s&=-s,T.lanes|=s;var ie=t0(T,G,s);Z_(T,ie);break e;case 1:l=G;var te=T.type,ce=T.stateNode;if(!(T.flags&128)&&(typeof te.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(Ca===null||!Ca.has(ce)))){T.flags|=65536,s&=-s,T.lanes|=s;var Ee=r0(T,l,s);Z_(T,Ee);break e}}T=T.return}while(T!==null)}w0(h)}catch(Ge){s=Ge,Lr===h&&h!==null&&(Lr=h=h.return);continue}break}while(!0)}function v0(){var i=Ld.current;return Ld.current=Dd,i===null?Dd:i}function _g(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Yr===null||!(yo&268435455)&&!(Xd&268435455)||xa(Yr,oi)}function Bd(i,s){var h=Lt;Lt|=2;var y=v0();(Yr!==i||oi!==s)&&(Bs=null,ho(i,s));do try{V2();break}catch(w){_0(i,w)}while(!0);if(eg(),Lt=h,Ld.current=y,Lr!==null)throw Error(De(261));return Yr=null,oi=0,Ur}function V2(){for(;Lr!==null;)x0(Lr)}function j2(){for(;Lr!==null&&!db();)x0(Lr)}function x0(i){var s=S0(i.alternate,i,ln);i.memoizedProps=i.pendingProps,s===null?w0(i):Lr=s,pg.current=null}function w0(i){var s=i;do{var h=s.alternate;if(i=s.return,s.flags&32768){if(h=L2(h,s),h!==null){h.flags&=32767,Lr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Ur=6,Lr=null;return}}else if(h=D2(h,s,ln),h!==null){Lr=h;return}if(s=s.sibling,s!==null){Lr=s;return}Lr=s=i}while(s!==null);Ur===0&&(Ur=5)}function oo(i,s,h){var y=qt,w=Cn.transition;try{Cn.transition=null,qt=1,U2(i,s,h,y)}finally{Cn.transition=w,qt=y}return null}function U2(i,s,h,y){do kl();while(ba!==null);if(Lt&6)throw Error(De(327));h=i.finishedWork;var w=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(De(177));i.callbackNode=null,i.callbackPriority=0;var T=h.lanes|h.childLanes;if(bb(i,T),i===Yr&&(Lr=Yr=null,oi=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||ed||(ed=!0,T0(_d,function(){return kl(),null})),T=(h.flags&15990)!==0,h.subtreeFlags&15990||T){T=Cn.transition,Cn.transition=null;var M=qt;qt=1;var l=Lt;Lt|=4,pg.current=null,F2(i,h),m0(h,i),l2(sm),xd=!!nm,sm=nm=null,i.current=h,B2(h),pb(),Lt=l,qt=M,Cn.transition=T}else i.current=h;if(ed&&(ed=!1,ba=i,Fd=w),T=i.pendingLanes,T===0&&(Ca=null),gb(h.stateNode),Ji(i,Mr()),s!==null)for(y=i.onRecoverableError,h=0;h<s.length;h++)w=s[h],y(w.value,{componentStack:w.stack,digest:w.digest});if(Rd)throw Rd=!1,i=km,km=null,i;return Fd&1&&i.tag!==0&&kl(),T=i.pendingLanes,T&1?i===Em?lc++:(lc=0,Em=i):lc=0,Ra(),null}function kl(){if(ba!==null){var i=tx(Fd),s=Cn.transition,h=qt;try{if(Cn.transition=null,qt=16>i?16:i,ba===null)var y=!1;else{if(i=ba,ba=null,Fd=0,Lt&6)throw Error(De(331));var w=Lt;for(Lt|=4,rt=i.current;rt!==null;){var T=rt,M=T.child;if(rt.flags&16){var l=T.deletions;if(l!==null){for(var G=0;G<l.length;G++){var O=l[G];for(rt=O;rt!==null;){var ve=rt;switch(ve.tag){case 0:case 11:case 15:ac(8,ve,T)}var ge=ve.child;if(ge!==null)ge.return=ve,rt=ge;else for(;rt!==null;){ve=rt;var oe=ve.sibling,ze=ve.return;if(d0(ve),ve===O){rt=null;break}if(oe!==null){oe.return=ze,rt=oe;break}rt=ze}}}var Fe=T.alternate;if(Fe!==null){var Ce=Fe.child;if(Ce!==null){Fe.child=null;do{var lt=Ce.sibling;Ce.sibling=null,Ce=lt}while(Ce!==null)}}rt=T}}if(T.subtreeFlags&2064&&M!==null)M.return=T,rt=M;else e:for(;rt!==null;){if(T=rt,T.flags&2048)switch(T.tag){case 0:case 11:case 15:ac(9,T,T.return)}var ie=T.sibling;if(ie!==null){ie.return=T.return,rt=ie;break e}rt=T.return}}var te=i.current;for(rt=te;rt!==null;){M=rt;var ce=M.child;if(M.subtreeFlags&2064&&ce!==null)ce.return=M,rt=ce;else e:for(M=te;rt!==null;){if(l=rt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Wd(9,l)}}catch(Ge){br(l,l.return,Ge)}if(l===M){rt=null;break e}var Ee=l.sibling;if(Ee!==null){Ee.return=l.return,rt=Ee;break e}rt=l.return}}if(Lt=w,Ra(),ms&&typeof ms.onPostCommitFiberRoot=="function")try{ms.onPostCommitFiberRoot(Vd,i)}catch{}y=!0}return y}finally{qt=h,Cn.transition=s}}return!1}function hv(i,s,h){s=Ml(h,s),s=t0(i,s,1),i=Ia(i,s,1),s=Fi(),i!==null&&(Cc(i,1,s),Ji(i,s))}function br(i,s,h){if(i.tag===3)hv(i,i,h);else for(;s!==null;){if(s.tag===3){hv(s,i,h);break}else if(s.tag===1){var y=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(Ca===null||!Ca.has(y))){i=Ml(h,i),i=r0(s,i,1),s=Ia(s,i,1),i=Fi(),s!==null&&(Cc(s,1,i),Ji(s,i));break}}s=s.return}}function $2(i,s,h){var y=i.pingCache;y!==null&&y.delete(s),s=Fi(),i.pingedLanes|=i.suspendedLanes&h,Yr===i&&(oi&h)===h&&(Ur===4||Ur===3&&(oi&130023424)===oi&&500>Mr()-mg?ho(i,0):fg|=h),Ji(i,s)}function b0(i,s){s===0&&(i.mode&1?(s=Zh,Zh<<=1,!(Zh&130023424)&&(Zh=4194304)):s=1);var h=Fi();i=Zs(i,s),i!==null&&(Cc(i,s,h),Ji(i,h))}function Z2(i){var s=i.memoizedState,h=0;s!==null&&(h=s.retryLane),b0(i,h)}function q2(i,s){var h=0;switch(i.tag){case 13:var y=i.stateNode,w=i.memoizedState;w!==null&&(h=w.retryLane);break;case 19:y=i.stateNode;break;default:throw Error(De(314))}y!==null&&y.delete(s),b0(i,h)}var S0;S0=function(i,s,h){if(i!==null)if(i.memoizedProps!==s.pendingProps||Yi.current)Ki=!0;else{if(!(i.lanes&h)&&!(s.flags&128))return Ki=!1,A2(i,s,h);Ki=!!(i.flags&131072)}else Ki=!1,dr&&s.flags&1048576&&Ix(s,Id,s.index);switch(s.lanes=0,s.tag){case 2:var y=s.type;hd(i,s),i=s.pendingProps;var w=Il(s,Si.current);Tl(s,h),w=lg(null,s,y,i,w,h);var T=ug();return s.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Qi(y)?(T=!0,kd(s)):T=!1,s.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,ig(s),w.updater=Hd,s.stateNode=w,w._reactInternals=s,fm(s,y,i,h),s=ym(null,s,y,!0,T,h)):(s.tag=0,dr&&T&&Km(s),Ri(null,s,w,h),s=s.child),s;case 16:y=s.elementType;e:{switch(hd(i,s),i=s.pendingProps,w=y._init,y=w(y._payload),s.type=y,w=s.tag=H2(y),i=qn(y,i),w){case 0:s=gm(null,s,y,i,h);break e;case 1:s=tv(null,s,y,i,h);break e;case 11:s=J_(null,s,y,i,h);break e;case 14:s=ev(null,s,y,qn(y.type,i),h);break e}throw Error(De(306,y,""))}return s;case 0:return y=s.type,w=s.pendingProps,w=s.elementType===y?w:qn(y,w),gm(i,s,y,w,h);case 1:return y=s.type,w=s.pendingProps,w=s.elementType===y?w:qn(y,w),tv(i,s,y,w,h);case 3:e:{if(a0(s),i===null)throw Error(De(387));y=s.pendingProps,T=s.memoizedState,w=T.element,Dx(i,s),zd(s,y,null,h);var M=s.memoizedState;if(y=M.element,T.isDehydrated)if(T={element:y,isDehydrated:!1,cache:M.cache,pendingSuspenseBoundaries:M.pendingSuspenseBoundaries,transitions:M.transitions},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){w=Ml(Error(De(423)),s),s=rv(i,s,y,h,w);break e}else if(y!==w){w=Ml(Error(De(424)),s),s=rv(i,s,y,h,w);break e}else for(un=Ea(s.stateNode.containerInfo.firstChild),cn=s,dr=!0,Hn=null,h=Mx(s,null,y,h),s.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Cl(),y===w){s=qs(i,s,h);break e}Ri(i,s,y,h)}s=s.child}return s;case 5:return Lx(s),i===null&&hm(s),y=s.type,w=s.pendingProps,T=i!==null?i.memoizedProps:null,M=w.children,am(y,w)?M=null:T!==null&&am(y,T)&&(s.flags|=32),s0(i,s),Ri(i,s,M,h),s.child;case 6:return i===null&&hm(s),null;case 13:return o0(i,s,h);case 4:return ng(s,s.stateNode.containerInfo),y=s.pendingProps,i===null?s.child=Pl(s,null,y,h):Ri(i,s,y,h),s.child;case 11:return y=s.type,w=s.pendingProps,w=s.elementType===y?w:qn(y,w),J_(i,s,y,w,h);case 7:return Ri(i,s,s.pendingProps,h),s.child;case 8:return Ri(i,s,s.pendingProps.children,h),s.child;case 12:return Ri(i,s,s.pendingProps.children,h),s.child;case 10:e:{if(y=s.type._context,w=s.pendingProps,T=s.memoizedProps,M=w.value,tr(Cd,y._currentValue),y._currentValue=M,T!==null)if(Kn(T.value,M)){if(T.children===w.children&&!Yi.current){s=qs(i,s,h);break e}}else for(T=s.child,T!==null&&(T.return=s);T!==null;){var l=T.dependencies;if(l!==null){M=T.child;for(var G=l.firstContext;G!==null;){if(G.context===y){if(T.tag===1){G=js(-1,h&-h),G.tag=2;var O=T.updateQueue;if(O!==null){O=O.shared;var ve=O.pending;ve===null?G.next=G:(G.next=ve.next,ve.next=G),O.pending=G}}T.lanes|=h,G=T.alternate,G!==null&&(G.lanes|=h),dm(T.return,h,s),l.lanes|=h;break}G=G.next}}else if(T.tag===10)M=T.type===s.type?null:T.child;else if(T.tag===18){if(M=T.return,M===null)throw Error(De(341));M.lanes|=h,l=M.alternate,l!==null&&(l.lanes|=h),dm(M,h,s),M=T.sibling}else M=T.child;if(M!==null)M.return=T;else for(M=T;M!==null;){if(M===s){M=null;break}if(T=M.sibling,T!==null){T.return=M.return,M=T;break}M=M.return}T=M}Ri(i,s,w.children,h),s=s.child}return s;case 9:return w=s.type,y=s.pendingProps.children,Tl(s,h),w=Pn(w),y=y(w),s.flags|=1,Ri(i,s,y,h),s.child;case 14:return y=s.type,w=qn(y,s.pendingProps),w=qn(y.type,w),ev(i,s,y,w,h);case 15:return i0(i,s,s.type,s.pendingProps,h);case 17:return y=s.type,w=s.pendingProps,w=s.elementType===y?w:qn(y,w),hd(i,s),s.tag=1,Qi(y)?(i=!0,kd(s)):i=!1,Tl(s,h),e0(s,y,w),fm(s,y,w,h),ym(null,s,y,!0,i,h);case 19:return l0(i,s,h);case 22:return n0(i,s,h)}throw Error(De(156,s.tag))};function T0(i,s){return Yv(i,s)}function G2(i,s,h,y){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(i,s,h,y){return new G2(i,s,h,y)}function vg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function H2(i){if(typeof i=="function")return vg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Om)return 11;if(i===Nm)return 14}return 2}function za(i,s){var h=i.alternate;return h===null?(h=In(i.tag,s,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=s,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,s=i.dependencies,h.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function fd(i,s,h,y,w,T){var M=2;if(y=i,typeof i=="function")vg(i)&&(M=1);else if(typeof i=="string")M=5;else e:switch(i){case ul:return po(h.children,w,T,s);case Bm:M=8,w|=8;break;case Of:return i=In(12,h,s,w|2),i.elementType=Of,i.lanes=T,i;case Nf:return i=In(13,h,s,w),i.elementType=Nf,i.lanes=T,i;case Vf:return i=In(19,h,s,w),i.elementType=Vf,i.lanes=T,i;case Lv:return Kd(h,w,T,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Av:M=10;break e;case Dv:M=9;break e;case Om:M=11;break e;case Nm:M=14;break e;case ya:M=16,y=null;break e}throw Error(De(130,i==null?i:typeof i,""))}return s=In(M,h,s,w),s.elementType=i,s.type=y,s.lanes=T,s}function po(i,s,h,y){return i=In(7,i,y,s),i.lanes=h,i}function Kd(i,s,h,y){return i=In(22,i,y,s),i.elementType=Lv,i.lanes=h,i.stateNode={isHidden:!1},i}function Df(i,s,h){return i=In(6,i,null,s),i.lanes=h,i}function Lf(i,s,h){return s=In(4,i.children!==null?i.children:[],i.key,s),s.lanes=h,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function W2(i,s,h,y,w){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ff(0),this.expirationTimes=ff(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ff(0),this.identifierPrefix=y,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function xg(i,s,h,y,w,T,M,l,G){return i=new W2(i,s,h,l,G),s===1?(s=1,T===!0&&(s|=8)):s=0,T=In(3,null,null,s),i.current=T,T.stateNode=i,T.memoizedState={element:y,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},ig(T),i}function X2(i,s,h){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ll,key:y==null?null:""+y,children:i,containerInfo:s,implementation:h}}function k0(i){if(!i)return Aa;i=i._reactInternals;e:{if(xo(i)!==i||i.tag!==1)throw Error(De(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Qi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(De(171))}if(i.tag===1){var h=i.type;if(Qi(h))return kx(i,h,s)}return s}function E0(i,s,h,y,w,T,M,l,G){return i=xg(h,y,!0,i,w,T,M,l,G),i.context=k0(null),h=i.current,y=Fi(),w=Pa(h),T=js(y,w),T.callback=s??null,Ia(h,T,w),i.current.lanes=w,Cc(i,w,y),Ji(i,y),i}function Yd(i,s,h,y){var w=s.current,T=Fi(),M=Pa(w);return h=k0(h),s.context===null?s.context=h:s.pendingContext=h,s=js(T,M),s.payload={element:i},y=y===void 0?null:y,y!==null&&(s.callback=y),i=Ia(w,s,M),i!==null&&(Xn(i,w,M,T),ld(i,w,M)),M}function Od(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function dv(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<s?h:s}}function wg(i,s){dv(i,s),(i=i.alternate)&&dv(i,s)}function K2(){return null}var I0=typeof reportError=="function"?reportError:function(i){console.error(i)};function bg(i){this._internalRoot=i}Qd.prototype.render=bg.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(De(409));Yd(i,s,null,null)};Qd.prototype.unmount=bg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;_o(function(){Yd(null,i,null,null)}),s[$s]=null}};function Qd(i){this._internalRoot=i}Qd.prototype.unstable_scheduleHydration=function(i){if(i){var s=nx();i={blockedOn:null,target:i,priority:s};for(var h=0;h<va.length&&s!==0&&s<va[h].priority;h++);va.splice(h,0,i),h===0&&ax(i)}};function Sg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Jd(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function pv(){}function Y2(i,s,h,y,w){if(w){if(typeof y=="function"){var T=y;y=function(){var O=Od(M);T.call(O)}}var M=E0(s,y,i,0,null,!1,!1,"",pv);return i._reactRootContainer=M,i[$s]=M.current,_c(i.nodeType===8?i.parentNode:i),_o(),M}for(;w=i.lastChild;)i.removeChild(w);if(typeof y=="function"){var l=y;y=function(){var O=Od(G);l.call(O)}}var G=xg(i,0,!1,null,null,!1,!1,"",pv);return i._reactRootContainer=G,i[$s]=G.current,_c(i.nodeType===8?i.parentNode:i),_o(function(){Yd(s,G,h,y)}),G}function ep(i,s,h,y,w){var T=h._reactRootContainer;if(T){var M=T;if(typeof w=="function"){var l=w;w=function(){var G=Od(M);l.call(G)}}Yd(s,M,i,w)}else M=Y2(h,s,i,w,y);return Od(M)}rx=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var h=Qu(s.pendingLanes);h!==0&&(Um(s,h|1),Ji(s,Mr()),!(Lt&6)&&(Al=Mr()+500,Ra()))}break;case 13:_o(function(){var y=Zs(i,1);if(y!==null){var w=Fi();Xn(y,i,1,w)}}),wg(i,1)}};$m=function(i){if(i.tag===13){var s=Zs(i,134217728);if(s!==null){var h=Fi();Xn(s,i,134217728,h)}wg(i,134217728)}};ix=function(i){if(i.tag===13){var s=Pa(i),h=Zs(i,s);if(h!==null){var y=Fi();Xn(h,i,s,y)}wg(i,s)}};nx=function(){return qt};sx=function(i,s){var h=qt;try{return qt=i,s()}finally{qt=h}};Kf=function(i,s,h){switch(s){case"input":if($f(i,h),s=h.name,h.type==="radio"&&s!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<h.length;s++){var y=h[s];if(y!==i&&y.form===i.form){var w=Zd(y);if(!w)throw Error(De(90));Fv(y),$f(y,w)}}}break;case"textarea":Ov(i,h);break;case"select":s=h.value,s!=null&&xl(i,!!h.multiple,s,!1)}};qv=gg;Gv=_o;var Q2={usingClientEntryPoint:!1,Events:[zc,pl,Zd,$v,Zv,gg]},Xu={findFiberByHostInstance:lo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},J2={bundleType:Xu.bundleType,version:Xu.version,rendererPackageName:Xu.rendererPackageName,rendererConfig:Xu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gs.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Xv(i),i===null?null:i.stateNode},findFiberByHostInstance:Xu.findFiberByHostInstance||K2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var td=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!td.isDisabled&&td.supportsFiber)try{Vd=td.inject(J2),ms=td}catch{}}dn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q2;dn.createPortal=function(i,s){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Sg(s))throw Error(De(200));return X2(i,s,null,h)};dn.createRoot=function(i,s){if(!Sg(i))throw Error(De(299));var h=!1,y="",w=I0;return s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(y=s.identifierPrefix),s.onRecoverableError!==void 0&&(w=s.onRecoverableError)),s=xg(i,1,!1,null,null,h,!1,y,w),i[$s]=s.current,_c(i.nodeType===8?i.parentNode:i),new bg(s)};dn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(De(188)):(i=Object.keys(i).join(","),Error(De(268,i)));return i=Xv(s),i=i===null?null:i.stateNode,i};dn.flushSync=function(i){return _o(i)};dn.hydrate=function(i,s,h){if(!Jd(s))throw Error(De(200));return ep(null,i,s,!0,h)};dn.hydrateRoot=function(i,s,h){if(!Sg(i))throw Error(De(405));var y=h!=null&&h.hydratedSources||null,w=!1,T="",M=I0;if(h!=null&&(h.unstable_strictMode===!0&&(w=!0),h.identifierPrefix!==void 0&&(T=h.identifierPrefix),h.onRecoverableError!==void 0&&(M=h.onRecoverableError)),s=E0(s,null,i,1,h??null,w,!1,T,M),i[$s]=s.current,_c(i),y)for(i=0;i<y.length;i++)h=y[i],w=h._getVersion,w=w(h._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[h,w]:s.mutableSourceEagerHydrationData.push(h,w);return new Qd(s)};dn.render=function(i,s,h){if(!Jd(s))throw Error(De(200));return ep(null,i,s,!1,h)};dn.unmountComponentAtNode=function(i){if(!Jd(i))throw Error(De(40));return i._reactRootContainer?(_o(function(){ep(null,null,i,!1,function(){i._reactRootContainer=null,i[$s]=null})}),!0):!1};dn.unstable_batchedUpdates=gg;dn.unstable_renderSubtreeIntoContainer=function(i,s,h,y){if(!Jd(h))throw Error(De(200));if(i==null||i._reactInternals===void 0)throw Error(De(38));return ep(i,s,h,!1,y)};dn.version="18.3.1-next-f1338f8080-20240426";function C0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(C0)}catch(i){console.error(i)}}C0(),Cv.exports=dn;var eS=Cv.exports,fv=eS;Ff.createRoot=fv.createRoot,Ff.hydrateRoot=fv.hydrateRoot;var P0={exports:{}};(function(i,s){(function(h,y){i.exports=y()})(Ew,function(){var h,y,w;function T(l,G){if(!h)h=G;else if(!y)y=G;else{var O="var sharedChunk = {}; ("+h+")(sharedChunk); ("+y+")(sharedChunk);",ve={};h(ve),w=G(ve),typeof window<"u"&&(w.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}T(["exports"],function(l){function G(r,e,n,o){return new(n||(n=Promise))(function(c,m){function g(k){try{b(o.next(k))}catch(I){m(I)}}function _(k){try{b(o.throw(k))}catch(I){m(I)}}function b(k){var I;k.done?c(k.value):(I=k.value,I instanceof n?I:new n(function(z){z(I)})).then(g,_)}b((o=o.apply(r,e||[])).next())})}function O(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ve=ge;function ge(r,e){this.x=r,this.y=e}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,e){var n=Math.cos(r),o=Math.sin(r),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(r){return r instanceof ge?r:Array.isArray(r)?new ge(r[0],r[1]):r};var oe=O(ve),ze=Fe;function Fe(r,e,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=o}Fe.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<e));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Ce=O(ze);let lt,ie;function te(){return lt==null&&(lt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),lt}function ce(){if(ie==null&&(ie=!1,te())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ie=!0;break}}}return ie||!1}function Ee(r,e,n,o){const c=new Ce(r,e,n,o);return function(m){return c.solve(m)}}const Ge=Ee(.25,.1,.25,1);function We(r,e,n){return Math.min(n,Math.max(e,r))}function Je(r,e,n){const o=n-e,c=((r-e)%o+o)%o+e;return c===e?n:c}function Ze(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}let Vt=1;function Ue(r,e,n){const o={};for(const c in r)o[c]=e.call(n||this,r[c],c,r);return o}function Ar(r,e,n){const o={};for(const c in r)e.call(n||this,r[c],c,r)&&(o[c]=r[c]);return o}function Rr(r){return Array.isArray(r)?r.map(Rr):typeof r=="object"&&r?Ue(r,Rr):r}const ui={};function Dr(r){ui[r]||(typeof console<"u"&&console.warn(r),ui[r]=!0)}function Qr(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function Ti(r){let e=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],e+=(o.x-n.x)*(n.y+o.y);return e}function $r(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let He=null;function dt(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ut(r,e,n,o,c){return G(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),b=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(b,function(k,I,z,D,F){const B=4*Math.max(-I,0),j=(Math.max(0,z)-z)*D*4+B,W=4*D,Y=Math.max(0,I),ae=Math.max(0,z);return{rect:{x:Y,y:ae,width:Math.min(k.width,I+D)-Y,height:Math.min(k.height,z+F)-ae},layout:[{offset:j,stride:W}]}}(r,e,n,o,c)),_)for(let k=0;k<b.length;k+=4){const I=b[k];b[k]=b[k+2],b[k+2]=I}return b}finally{m.close()}})}let Bt,Dt,lr,en;const ci={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){return this.getImageCanvasContext(r).getImageData(-e,-e,r.width+2*e,r.height+2*e)},getImageCanvasContext(r){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=r.width,e.height=r.height,n.drawImage(r,0,0,r.width,r.height),n},resolveURL:r=>(lr||(lr=document.createElement("a")),lr.href=r,lr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(en==null&&(en=matchMedia("(prefers-reduced-motion: reduce)")),en.matches)}},tn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Yn extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const rn=$r()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ni=r=>tn.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function Fa(r,e){const n=new AbortController,o=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:rn(),signal:n.signal});let c=!1,m=!1;return r.type==="json"&&o.headers.set("Accept","application/json"),m||fetch(o).then(g=>g.ok?(_=>{(r.type==="arrayBuffer"||r.type==="image"?_.arrayBuffer():r.type==="json"?_.json():_.text()).then(b=>{m||(c=!0,e(null,b,_.headers.get("Cache-Control"),_.headers.get("Expires")))}).catch(b=>{m||e(new Error(b.message))})})(g):g.blob().then(_=>e(new Yn(g.status,g.statusText,r.url,_)))).catch(g=>{g.code!==20&&e(new Error(g.message))}),{cancel:()=>{m=!0,c||n.abort()}}}const Qn=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if($r()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!$r())return(Ni(r.url)||Fa)(r,e)}if(!(/^file:/.test(n=r.url)||/^file:/.test(rn())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Fa(r,e);if($r()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return function(o,c){const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(m.responseType="arraybuffer");for(const g in o.headers)m.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(o.type==="json")try{g=JSON.parse(m.response)}catch(_){return c(_)}c(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const g=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});c(new Yn(m.status,m.statusText,o.url,g))}},m.send(o.body),{cancel:()=>m.abort()}}(r,e)},Ba=function(r,e){return Qn(Ze(r,{type:"arrayBuffer"}),e)};function Mn(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Hs(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function ys(r,e,n){if(n&&n[r]){const o=n[r].indexOf(e);o!==-1&&n[r].splice(o,1)}}class Jn{constructor(e,n={}){Ze(this,n),this.type=e}}class es extends Jn{constructor(e,n={}){super("error",Ze({error:e},n))}}class _s{on(e,n){return this._listeners=this._listeners||{},Hs(e,n,this._listeners),this}off(e,n){return ys(e,n,this._listeners),ys(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Hs(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Jn(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of c)_.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of m)ys(o,_,this._oneTimeListeners),_.call(this,e);const g=this._eventedParent;g&&(Ze(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof es&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const hi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vi(r,e){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return hi.forEach(o=>{o in e&&(n[o]=e[o])}),n}function jt(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!jt(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!jt(r[n],e[n]))return!1;return!0}return r===e}const Ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function fn(r,e,n){n.push({command:Ct.addSource,args:[r,e[r]]})}function Ws(r,e,n){e.push({command:Ct.removeSource,args:[r]}),n[r]=!0}function An(r,e,n,o){Ws(r,n,o),fn(r,e,n)}function wo(r,e,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!jt(r[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!jt(r[n][o],e[n][o]))return!1;return!0}function Xs(r,e,n,o,c,m){let g;for(g in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,g)&&(jt(r[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}));for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(jt(r[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}))}function ts(r){return r.id}function vs(r,e){return r[e.id]=e,r}class Ae{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function mn(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}class rr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class xs{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new xs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Dn={kind:"null"},Re={kind:"number"},mt={kind:"string"},ct={kind:"boolean"},Jr={kind:"color"},gn={kind:"object"},pt={kind:"value"},Ln={kind:"collator"},Z={kind:"formatted"},A={kind:"padding"},L={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function H(r,e){return{kind:"array",itemType:r,N:e}}function X(r){if(r.kind==="array"){const e=X(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const le=[Dn,Re,mt,ct,Jr,Z,gn,H(pt),A,L,N];function ee(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ee(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of le)if(!ee(n,e))return null}}return`Expected ${X(r)} but found ${X(e)} instead.`}function Q(r,e){return e.some(n=>n.kind===r.kind)}function se(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function _e(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const xe=.96422,Se=.82521,it=4/29,ut=6/29,Xe=3*ut*ut,st=ut*ut*ut,ht=Math.PI/180,At=180/Math.PI;function Ot(r){return(r%=360)<0&&(r+=360),r}function Et([r,e,n,o]){let c,m;const g=Zr((.2225045*(r=kt(r))+.7168786*(e=kt(e))+.0606169*(n=kt(n)))/1);r===e&&e===n?c=m=g:(c=Zr((.4360747*r+.3850649*e+.1430804*n)/xe),m=Zr((.0139322*r+.0971045*e+.7141733*n)/Se));const _=116*g-16;return[_<0?0:_,500*(c-g),200*(g-m),o]}function kt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Zr(r){return r>st?Math.pow(r,1/3):r/Xe+it}function $t([r,e,n,o]){let c=(r+16)/116,m=isNaN(e)?c:c+e/500,g=isNaN(n)?c:c-n/200;return c=1*Fr(c),m=xe*Fr(m),g=Se*Fr(g),[vr(3.1338561*m-1.6168667*c-.4906146*g),vr(-.9787684*m+1.9161415*c+.033454*g),vr(.0719453*m-.2289914*c+1.4052427*g),o]}function vr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Fr(r){return r>ut?r*r*r:Xe*(r-it)}function ji(r){return parseInt(r.padEnd(2,r),16)/255}function Ac(r,e){return Ks(e?r/100:r,0,1)}function Ks(r,e,n){return Math.min(Math.max(e,r),n)}function Ys(r){return!r.some(Number.isNaN)}const tp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Rt{constructor(e,n,o,c=1,m=!0){this.r=e,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Rt)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=tp[o];if(c){const[g,_,b]=c;return[g/255,_/255,b/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let _=1;return[ji(o.slice(_,_+=g)),ji(o.slice(_,_+=g)),ji(o.slice(_,_+=g)),ji(o.slice(_,_+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,b,k,I,z,D,F,B,j,W,Y,ae]=g,J=[I||" ",F||" ",W].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ue=[k,D,j].join(""),de=ue==="%%%"?100:ue===""?255:0;if(de){const be=[Ks(+b/de,0,1),Ks(+z/de,0,1),Ks(+B/de,0,1),Y?Ac(+Y,ae):1];if(Ys(be))return be}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,b,k,I,z,D,F,B]=m,j=[b||" ",I||" ",D].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const W=[+_,Ks(+k,0,100),Ks(+z,0,100),F?Ac(+F,B):1];if(Ys(W))return function([Y,ae,J,ue]){function de(be){const je=(be+Y/30)%12,Ye=ae*Math.min(J,1-J);return J-Ye*Math.max(-1,Math.min(je-3,9-je,1))}return Y=Ot(Y),ae/=100,J/=100,[de(0),de(8),de(4),ue]}(W)}}}(e);return n?new Rt(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[e/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,m]=Et(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?Ot(Math.atan2(c,o)*At):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Et(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}Rt.black=new Rt(0,0,0,1),Rt.white=new Rt(1,1,1,1),Rt.transparent=new Rt(0,0,0,0),Rt.red=new Rt(1,0,0,1);class Fl{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bo{constructor(e,n,o,c,m){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class qr{constructor(e){this.sections=e}static fromString(e){return new qr([new bo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof qr?e:qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ki)return e;if(typeof e=="number")return new ki([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ki(e)}}toString(){return JSON.stringify(this.values)}}const rp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ui)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!rp.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ui(e)}}toString(){return JSON.stringify(this.values)}}class Br{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Br({name:e,available:!1}):null}}function So(r,e,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,n,o]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qs(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Rt||r instanceof Fl||r instanceof qr||r instanceof ki||r instanceof Ui||r instanceof Br)return!0;if(Array.isArray(r)){for(const e of r)if(!Qs(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Qs(r[e]))return!1;return!0}return!1}function Yt(r){if(r===null)return Dn;if(typeof r=="string")return mt;if(typeof r=="boolean")return ct;if(typeof r=="number")return Re;if(r instanceof Rt)return Jr;if(r instanceof Fl)return Ln;if(r instanceof qr)return Z;if(r instanceof ki)return A;if(r instanceof Ui)return N;if(r instanceof Br)return L;if(Array.isArray(r)){const e=r.length;let n;for(const o of r){const c=Yt(o);if(n){if(n===c)continue;n=pt;break}n=c}return H(n||pt,e)}return gn}function Pt(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Rt||r instanceof qr||r instanceof ki||r instanceof Ui||r instanceof Br?r.toString():JSON.stringify(r)}class ws{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qs(e[1]))return n.error("invalid value");const o=e[1];let c=Yt(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new ws(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ir{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const To={string:mt,number:Re,boolean:ct,object:gn};class $i{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=e[0];if(m==="array"){let _,b;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in To)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=To[k],c++}else _=pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}o=H(_,b)}else{if(!To[m])throw new Error(`Types doesn't contain name = ${m}`);o=To[m]}const g=[];for(;c<e.length;c++){const _=n.parse(e[c],c,pt);if(!_)return null;g.push(_)}return new $i(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!ee(this.type,Yt(o)))return o;if(n===this.args.length-1)throw new ir(`Expected value to be of type ${X(this.type)}, but found ${X(Yt(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Bl={"to-boolean":ct,"to-color":Jr,"to-number":Re,"to-string":mt};class rs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Bl[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=Bl[o],m=[];for(let g=1;g<e.length;g++){const _=n.parse(e[g],g,pt);if(!_)return null;m.push(_)}return new rs(c,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Rt)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:So(n[0],n[1],n[2],n[3]),!o))return new Rt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ir(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=ki.parse(n);if(c)return c}throw new ir(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=Ui.parse(n);if(c)return c}throw new ir(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new ir(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return qr.fromString(Pt(this.args[0].evaluate(e)));case"resolvedImage":return Br.fromString(Pt(this.args[0].evaluate(e)));default:return Pt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Dc=["Unknown","Point","LineString","Polygon"];class Ol{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Rt.parse(e)),n}}class ko{constructor(e,n,o=[],c,m=new xs,g=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,m={}){return n?this.concat(n,o,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function o(c,m,g){return g==="assert"?new $i(m,[c]):g==="coerce"?new rs(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,b=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||b.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(_.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(_,b))return null}else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"assert")}if(!(g instanceof ws)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Ol;try{g=new ws(g.type,g.evaluate(_))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new ko(this.registry,this._isConstant,c,n||null,m,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new rr(o,e))}checkSubtype(e,n){const o=ee(e,n);return o&&this.error(o),o}}class Eo{constructor(e,n,o){this.type=Ln,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ct);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ct);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,mt),!g)?null:new Eo(c,m,g)}evaluate(e){return new Fl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const is=8192;function Nl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Oa(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Lc(r,e){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*is),Math.round(o*c*is)]}function ip(r,e,n){const o=r[0]-e[0],c=r[1]-e[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function Vl(r,e){let n=!1;for(let g=0,_=e.length;g<_;g++){const b=e[g];for(let k=0,I=b.length;k<I-1;k++){if(ip(r,b[k],b[k+1]))return!1;(c=b[k])[1]>(o=r)[1]!=(m=b[k+1])[1]>o[1]&&o[0]<(m[0]-c[0])*(o[1]-c[1])/(m[1]-c[1])+c[0]&&(n=!n)}}var o,c,m;return n}function jl(r,e){for(let n=0;n<e.length;n++)if(Vl(r,e[n]))return!0;return!1}function Rc(r,e,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),_=(e[0]-n[0])*m-c*(e[1]-n[1]);return g>0&&_<0||g<0&&_>0}function np(r,e,n){for(const k of n)for(let I=0;I<k.length-1;++I)if((_=[(g=k[I+1])[0]-(m=k[I])[0],g[1]-m[1]])[0]*(b=[(c=e)[0]-(o=r)[0],c[1]-o[1]])[1]-_[1]*b[0]!=0&&Rc(o,c,m,g)&&Rc(m,g,o,c))return!0;var o,c,m,g,_,b;return!1}function Fc(r,e){for(let n=0;n<r.length;++n)if(!Vl(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(np(r[n],r[n+1],e))return!1;return!0}function Bc(r,e){for(let n=0;n<e.length;n++)if(Fc(r,e[n]))return!0;return!1}function Io(r,e,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const _=Lc(r[c][g],n);Nl(e,_),m.push(_)}o.push(m)}return o}function Oc(r,e,n){const o=[];for(let c=0;c<r.length;c++){const m=Io(r[c],e,n);o.push(m)}return o}function Nc(r,e,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}Nl(e,r)}function Ul(r,e,n,o){const c=Math.pow(2,o.z)*is,m=[o.x*is,o.y*is],g=[];for(const _ of r)for(const b of _){const k=[b.x+m[0],b.y+m[1]];Nc(k,e,n,c),g.push(k)}return g}function $l(r,e,n,o){const c=Math.pow(2,o.z)*is,m=[o.x*is,o.y*is],g=[];for(const b of r){const k=[];for(const I of b){const z=[I.x+m[0],I.y+m[1]];Nl(e,z),k.push(z)}g.push(k)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of g)for(const k of b)Nc(k,e,n,c)}var _;return g}class bs{constructor(e,n){this.type=ct,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qs(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const m=o.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new bs(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new bs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new bs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=Io(o.coordinates,m,g),b=Ul(n.geometry(),c,m,g);if(!Oa(c,m))return!1;for(const k of b)if(!Vl(k,_))return!1}if(o.type==="MultiPolygon"){const _=Oc(o.coordinates,m,g),b=Ul(n.geometry(),c,m,g);if(!Oa(c,m))return!1;for(const k of b)if(!jl(k,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=Io(o.coordinates,m,g),b=$l(n.geometry(),c,m,g);if(!Oa(c,m))return!1;for(const k of b)if(!Fc(k,_))return!1}if(o.type==="MultiPolygon"){const _=Oc(o.coordinates,m,g),b=$l(n.geometry(),c,m,g);if(!Oa(c,m))return!1;for(const k of b)if(!Bc(k,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Co{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new Co(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Zi{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=Zi.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let b=null;for(const[k,I]of _){b=new ko(n.registry,Po,n.path,null,n.scope);const z=[];let D=!1;for(let F=1;F<e.length;F++){const B=e[F],j=Array.isArray(k)?k[F-1]:k.type,W=b.parse(B,1+z.length,j);if(!W){D=!0;break}z.push(W)}if(!D)if(Array.isArray(k)&&k.length!==z.length)b.error(`Expected ${k.length} arguments, but found ${z.length} instead.`);else{for(let F=0;F<z.length;F++){const B=Array.isArray(k)?k[F]:k.type,j=z[F];b.concat(F+1).checkSubtype(B,j.type)}if(b.errors.length===0)return new Zi(o,m,I,z)}}if(_.length===1)n.errors.push(...b.errors);else{const k=(_.length?_:g).map(([z])=>{return D=z,Array.isArray(D)?`(${D.map(X).join(", ")})`:`(${X(D.type)}...)`;var D}).join(" | "),I=[];for(let z=1;z<e.length;z++){const D=n.parse(e[z],1+I.length);if(!D)return null;I.push(X(D.type))}n.error(`Expected arguments of type ${k}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Zi.definitions=n;for(const o in n)e[o]=Zi}}function Po(r){if(r instanceof Co)return Po(r.boundExpression);if(r instanceof Zi&&r.name==="error"||r instanceof Eo||r instanceof bs)return!1;const e=r instanceof rs||r instanceof $i;let n=!0;return r.eachChild(o=>{n=e?n&&Po(o):n&&o instanceof ws}),!!n&&zo(r)&&Mo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zo(r){if(r instanceof Zi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof bs)return!1;let e=!0;return r.eachChild(n=>{e&&!zo(n)&&(e=!1)}),e}function Na(r){if(r instanceof Zi&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!Na(n)&&(e=!1)}),e}function Mo(r,e){if(r instanceof Zi&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!Mo(o,e)&&(n=!1)}),n}function Js(r,e){const n=r.length-1;let o,c,m=0,g=n,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),o=r[_],c=r[_+1],o<=e){if(_===n||e<c)return _;m=_+1}else{if(!(o>e))throw new ir("Input is not a number.");g=_-1}return 0}class ns{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Re);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<e.length;g+=2){const _=g===1?-1/0:e[g],b=e[g+1],k=g,I=g+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const z=n.parse(b,I,m);if(!z)return null;m=m||z.type,c.push([_,z])}return new ns(m,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(e):o[Js(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function St(r,e,n){return r+n*(e-r)}function Ao(r,e,n){return r.map((o,c)=>St(o,e[c],n))}const Ei={number:St,color:function(r,e,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,_]=Ao(r.rgb,e.rgb,n);return new Rt(c,m,g,_,!1)}case"hcl":{const[c,m,g,_]=r.hcl,[b,k,I,z]=e.hcl;let D,F;if(isNaN(c)||isNaN(b))isNaN(c)?isNaN(b)?D=NaN:(D=b,g!==1&&g!==0||(F=k)):(D=c,I!==1&&I!==0||(F=m));else{let ae=b-c;b>c&&ae>180?ae-=360:b<c&&c-b>180&&(ae+=360),D=c+n*ae}const[B,j,W,Y]=function([ae,J,ue,de]){return ae=isNaN(ae)?0:ae*ht,$t([ue,Math.cos(ae)*J,Math.sin(ae)*J,de])}([D,F??St(m,k,n),St(g,I,n),St(_,z,n)]);return new Rt(B,j,W,Y,!1)}case"lab":{const[c,m,g,_]=$t(Ao(r.lab,e.lab,n));return new Rt(c,m,g,_,!1)}}},array:Ao,padding:function(r,e,n){return new ki(Ao(r.values,e.values,n))},variableAnchorOffsetCollection:function(r,e,n){const o=r.values,c=e.values;if(o.length!==c.length)throw new ir(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new ir(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[_,b]=o[g+1],[k,I]=c[g+1];m.push([St(_,k,n),St(b,I,n)])}return new Ui(m)}};class Ii{constructor(e,n,o,c,m){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(e,n,o,c){let m=0;if(e.name==="exponential")m=Zl(n,e.base,o,c);else if(e.name==="linear")m=Zl(n,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new Ce(g[0],g[1],g[2],g[3]).solve(Zl(n,1,o,c))}return m}static parse(e,n){let[o,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Re),!m)return null;const _=[];let b=null;o==="interpolate-hcl"||o==="interpolate-lab"?b=Jr:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let k=0;k<g.length;k+=2){const I=g[k],z=g[k+1],D=k+3,F=k+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=n.parse(z,F,b);if(!B)return null;b=b||B.type,_.push([I,B])}return _e(b,Re)||_e(b,Jr)||_e(b,A)||_e(b,N)||_e(b,H(Re))?new Ii(b,o,c,m,_):n.error(`Type ${X(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(e);const g=Js(n,c),_=Ii.interpolationFactor(this.interpolation,c,n[g],n[g+1]),b=o[g].evaluate(e),k=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return Ei[this.type.kind](b,k,_);case"interpolate-hcl":return Ei.color(b,k,_,"hcl");case"interpolate-lab":return Ei.color(b,k,_,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Zl(r,e,n,o){const c=o-n,m=r-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class Do{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const _ of e.slice(1)){const b=n.parse(_,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,m.push(b)}if(!o)throw new Error("No output type");const g=c&&m.some(_=>ee(c,_.type));return new Do(g?pt:o,m)}evaluate(e){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(e),o&&o instanceof Br&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Lo{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=n.parse(e[m+1],m+1);if(!_)return null;o.push([g,_])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new Lo(o,c):null}outputDefined(){return this.result.outputDefined()}}class ql{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Re),c=n.parse(e[2],2,H(n.expectedType||pt));return o&&c?new ql(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new ir(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new ir(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new ir(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Gl{constructor(e,n){this.type=ct,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,pt),c=n.parse(e[2],2,pt);return o&&c?Q(o.type,[ct,mt,Re,Dn,pt])?new Gl(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!se(n,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${X(Yt(n))} instead.`);if(!se(o,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${X(Yt(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ro{constructor(e,n,o){this.type=Re,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,pt),c=n.parse(e[2],2,pt);if(!o||!c)return null;if(!Q(o.type,[ct,mt,Re,Dn,pt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${X(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,Re);return m?new Ro(o,c,m):null}return new Ro(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!se(n,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${X(Yt(n))} instead.`);if(!se(o,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${X(Yt(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Hl{constructor(e,n,o,c,m,g){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let k=2;k<e.length-1;k+=2){let I=e[k];const z=e[k+1];Array.isArray(I)||(I=[I]);const D=n.concat(k);if(I.length===0)return D.error("Expected at least one branch label.");for(const B of I){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Yt(B)))return null}else o=Yt(B);if(m[String(B)]!==void 0)return D.error("Branch labels must be unique.");m[String(B)]=g.length}const F=n.parse(z,k,c);if(!F)return null;c=c||F.type,g.push(F)}const _=n.parse(e[1],1,pt);if(!_)return null;const b=n.parse(e[e.length-1],e.length-1,c);return b?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new Hl(o,c,_,m,g,b):null}evaluate(e){const n=this.input.evaluate(e);return(Yt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Wl{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const _=n.parse(e[g],g,ct);if(!_)return null;const b=n.parse(e[g+1],g+1,o);if(!b)return null;c.push([_,b]),o=o||b.type}const m=n.parse(e[e.length-1],e.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Wl(o,c,m)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Fo{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,pt),c=n.parse(e[2],2,Re);if(!o||!c)return null;if(!Q(o.type,[H(pt),mt,pt]))return n.error(`Expected first argument to be of type array or string, but found ${X(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,Re);return m?new Fo(o.type,o,c,m):null}return new Fo(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!se(n,["string","array"]))throw new ir(`Expected first argument to be of type array or string, but found ${X(Yt(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jc(r,e,n,o){return o.compare(e,n)===0}function ea(r,e,n){const o=r!=="=="&&r!=="!=";return class z0{constructor(m,g,_){this.type=ct,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let b=g.parse(m[1],1,pt);if(!b)return null;if(!Vc(_,b.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${X(b.type)}'.`);let k=g.parse(m[2],2,pt);if(!k)return null;if(!Vc(_,k.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${X(k.type)}'.`);if(b.type.kind!==k.type.kind&&b.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${X(b.type)}' and '${X(k.type)}'.`);o&&(b.type.kind==="value"&&k.type.kind!=="value"?b=new $i(k.type,[b]):b.type.kind!=="value"&&k.type.kind==="value"&&(k=new $i(b.type,[k])));let I=null;if(m.length===4){if(b.type.kind!=="string"&&k.type.kind!=="string"&&b.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(m[3],3,Ln),!I)return null}return new z0(b,k,I)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const b=Yt(g),k=Yt(_);if(b.kind!==k.kind||b.kind!=="string"&&b.kind!=="number")throw new ir(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=Yt(g),k=Yt(_);if(b.kind!=="string"||k.kind!=="string")return e(m,g,_)}return this.collator?n(m,g,_,this.collator.evaluate(m)):e(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const sp=ea("==",function(r,e,n){return e===n},jc),ap=ea("!=",function(r,e,n){return e!==n},function(r,e,n,o){return!jc(0,e,n,o)}),op=ea("<",function(r,e,n){return e<n},function(r,e,n,o){return o.compare(e,n)<0}),lp=ea(">",function(r,e,n){return e>n},function(r,e,n,o){return o.compare(e,n)>0}),up=ea("<=",function(r,e,n){return e<=n},function(r,e,n,o){return o.compare(e,n)<=0}),cp=ea(">=",function(r,e,n){return e>=n},function(r,e,n,o){return o.compare(e,n)>=0});class Xl{constructor(e,n,o,c,m){this.type=mt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Re);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,mt),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,mt),!g))return null;let _=null;if(c["min-fraction-digits"]&&(_=n.parse(c["min-fraction-digits"],1,Re),!_))return null;let b=null;return c["max-fraction-digits"]&&(b=n.parse(c["max-fraction-digits"],1,Re),!b)?null:new Xl(o,m,g,_,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Bo{constructor(e){this.type=Z,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const _=e[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let b=null;if(_["font-scale"]&&(b=n.parse(_["font-scale"],1,Re),!b))return null;let k=null;if(_["text-font"]&&(k=n.parse(_["text-font"],1,H(mt)),!k))return null;let I=null;if(_["text-color"]&&(I=n.parse(_["text-color"],1,Jr),!I))return null;const z=c[c.length-1];z.scale=b,z.font=k,z.textColor=I}else{const b=n.parse(e[g],1,pt);if(!b)return null;const k=b.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Bo(c)}evaluate(e){return new qr(this.sections.map(n=>{const o=n.content.evaluate(e);return Yt(o)===L?new bo("",o,null,null,null):new bo(Pt(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class Kl{constructor(e){this.type=L,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,mt);return o?new Kl(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Br.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Yl{constructor(e){this.type=Re,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${X(o.type)} instead.`):new Yl(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ir(`Expected value to be of type string or array, but found ${X(Yt(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ta={"==":sp,"!=":ap,">":lp,"<":op,">=":cp,"<=":up,array:$i,at:ql,boolean:$i,case:Wl,coalesce:Do,collator:Eo,format:Bo,image:Kl,in:Gl,"index-of":Ro,interpolate:Ii,"interpolate-hcl":Ii,"interpolate-lab":Ii,length:Yl,let:Lo,literal:ws,match:Hl,number:$i,"number-format":Xl,object:$i,slice:Fo,step:ns,string:$i,"to-boolean":rs,"to-color":rs,"to-number":rs,"to-string":rs,var:Co,within:bs};function Uc(r,[e,n,o,c]){e=e.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=So(e,n,o,m);if(g)throw new ir(g);return new Rt(e/255,n/255,o/255,m,!1)}function $c(r,e){return r in e}function Ql(r,e){const n=e[r];return n===void 0?null:n}function Ss(r){return{type:r}}function Zc(r){return{result:"success",value:r}}function ss(r){return{result:"error",value:r}}function ra(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function qc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Jl(r){return!!r.expression&&r.expression.interpolated}function zt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Qt(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function hp(r){return r}function Tt(r,e){const n=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(Jl(e)?"exponential":"interval");if(n||e.type==="padding"){const I=n?Rt.parse:ki.parse;(r=mn({},r)).stops&&(r.stops=r.stops.map(z=>[z[0],I(z[1])])),r.default=I(r.default?r.default:e.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,b,k;if(m==="exponential")_=Va;else if(m==="interval")_=Xt;else if(m==="categorical"){_=Jt,b=Object.create(null);for(const I of r.stops)b[I[0]]=I[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Gc}if(o){const I={},z=[];for(let B=0;B<r.stops.length;B++){const j=r.stops[B],W=j[0].zoom;I[W]===void 0&&(I[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},z.push(W)),I[W].stops.push([j[0].value,j[1]])}const D=[];for(const B of z)D.push([I[B].zoom,Tt(I[B],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Ii.interpolationFactor.bind(void 0,F),zoomStops:D.map(B=>B[0]),evaluate:({zoom:B},j)=>Va({stops:D,base:r.base},e,B).evaluate(B,j)}}if(c){const I=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Ii.interpolationFactor.bind(void 0,I),zoomStops:r.stops.map(z=>z[0]),evaluate:({zoom:z})=>_(r,e,z,b,k)}}return{kind:"source",evaluate(I,z){const D=z&&z.properties?z.properties[r.property]:void 0;return D===void 0?Ts(r.default,e.default):_(r,e,D,b,k)}}}function Ts(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Jt(r,e,n,o,c){return Ts(typeof n===c?o[n]:void 0,r.default,e.default)}function Xt(r,e,n){if(zt(n)!=="number")return Ts(r.default,e.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Js(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function Va(r,e,n){const o=r.base!==void 0?r.base:1;if(zt(n)!=="number")return Ts(r.default,e.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=Js(r.stops.map(I=>I[0]),n),g=function(I,z,D,F){const B=F-D,j=I-D;return B===0?0:z===1?j/B:(Math.pow(z,j)-1)/(Math.pow(z,B)-1)}(n,o,r.stops[m][0],r.stops[m+1][0]),_=r.stops[m][1],b=r.stops[m+1][1],k=Ei[e.type]||hp;return typeof _.evaluate=="function"?{evaluate(...I){const z=_.evaluate.apply(void 0,I),D=b.evaluate.apply(void 0,I);if(z!==void 0&&D!==void 0)return k(z,D,g,r.colorSpace)}}:k(_,b,g,r.colorSpace)}function Gc(r,e,n){switch(e.type){case"color":n=Rt.parse(n);break;case"formatted":n=qr.fromString(n.toString());break;case"resolvedImage":n=Br.fromString(n.toString());break;case"padding":n=ki.parse(n);break;default:zt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Ts(n,r.default,e.default)}Zi.register(ta,{error:[{kind:"error"},[mt],(r,[e])=>{throw new ir(e.evaluate(r))}],typeof:[mt,[pt],(r,[e])=>X(Yt(e.evaluate(r)))],"to-rgba":[H(Re,4),[Jr],(r,[e])=>{const[n,o,c,m]=e.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[Jr,[Re,Re,Re],Uc],rgba:[Jr,[Re,Re,Re,Re],Uc],has:{type:ct,overloads:[[[mt],(r,[e])=>$c(e.evaluate(r),r.properties())],[[mt,gn],(r,[e,n])=>$c(e.evaluate(r),n.evaluate(r))]]},get:{type:pt,overloads:[[[mt],(r,[e])=>Ql(e.evaluate(r),r.properties())],[[mt,gn],(r,[e,n])=>Ql(e.evaluate(r),n.evaluate(r))]]},"feature-state":[pt,[mt],(r,[e])=>Ql(e.evaluate(r),r.featureState||{})],properties:[gn,[],r=>r.properties()],"geometry-type":[mt,[],r=>r.geometryType()],id:[pt,[],r=>r.id()],zoom:[Re,[],r=>r.globals.zoom],"heatmap-density":[Re,[],r=>r.globals.heatmapDensity||0],"line-progress":[Re,[],r=>r.globals.lineProgress||0],accumulated:[pt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Re,Ss(Re),(r,e)=>{let n=0;for(const o of e)n+=o.evaluate(r);return n}],"*":[Re,Ss(Re),(r,e)=>{let n=1;for(const o of e)n*=o.evaluate(r);return n}],"-":{type:Re,overloads:[[[Re,Re],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[Re],(r,[e])=>-e.evaluate(r)]]},"/":[Re,[Re,Re],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[Re,[Re,Re],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[Re,[],()=>Math.LN2],pi:[Re,[],()=>Math.PI],e:[Re,[],()=>Math.E],"^":[Re,[Re,Re],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[Re,[Re],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Re,[Re],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Re,[Re],(r,[e])=>Math.log(e.evaluate(r))],log2:[Re,[Re],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Re,[Re],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Re,[Re],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Re,[Re],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Re,[Re],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Re,[Re],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Re,[Re],(r,[e])=>Math.atan(e.evaluate(r))],min:[Re,Ss(Re),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[Re,Ss(Re),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[Re,[Re],(r,[e])=>Math.abs(e.evaluate(r))],round:[Re,[Re],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Re,[Re],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Re,[Re],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ct,[mt,pt],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[ct,[pt],(r,[e])=>r.id()===e.value],"filter-type-==":[ct,[mt],(r,[e])=>r.geometryType()===e.value],"filter-<":[ct,[mt,pt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[ct,[pt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[ct,[mt,pt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[ct,[pt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[ct,[mt,pt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[ct,[pt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[ct,[mt,pt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[ct,[pt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[ct,[pt],(r,[e])=>e.value in r.properties()],"filter-has-id":[ct,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ct,[H(mt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ct,[H(pt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ct,[mt,H(pt)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ct,[mt,H(pt)],(r,[e,n])=>function(o,c,m,g){for(;m<=g;){const _=m+g>>1;if(c[_]===o)return!0;c[_]>o?g=_-1:m=_+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[Ss(ct),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[Ss(ct),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[ct,[ct],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ct,[mt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[mt,[mt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[mt,[mt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[mt,Ss(pt),(r,e)=>e.map(n=>Pt(n.evaluate(r))).join("")],"resolved-locale":[mt,[Ln],(r,[e])=>e.evaluate(r).resolvedLocale()]});class eu{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new Ol,this._defaultValue=n?(o=n).type==="color"&&Qt(o.default)?new Rt(0,0,0,0):o.type==="color"?Rt.parse(o.default)||null:o.type==="padding"?ki.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Ui.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,m,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new ir(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Oo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ta}function No(r,e){const n=new ko(ta,Po,[],e?function(c){const m={color:Jr,string:mt,number:Re,enum:mt,boolean:ct,formatted:Z,padding:A,resolvedImage:L,variableAnchorOffsetCollection:N};return c.type==="array"?H(m[c.value]||pt,c.length):m[c.type]}(e):void 0),o=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Zc(new eu(o,e)):ss(n.errors)}class tu{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Na(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}}class Vo{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Na(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}interpolationFactor(e,n,o){return this.interpolationType?Ii.interpolationFactor(this.interpolationType,e,n,o):0}}function ru(r,e){const n=No(r,e);if(n.result==="error")return n;const o=n.value.expression,c=zo(o);if(!c&&!ra(e))return ss([new rr("","data expressions not supported")]);const m=Mo(o,["zoom"]);if(!m&&!qc(e))return ss([new rr("","zoom expressions not supported")]);const g=Ua(o);return g||m?g instanceof rr?ss([g]):g instanceof Ii&&!Jl(e)?ss([new rr("",'"interpolate" expressions cannot be used with this property')]):Zc(g?new Vo(c?"camera":"composite",n.value,g.labels,g instanceof Ii?g.interpolation:void 0):new tu(c?"constant":"source",n.value)):ss([new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ja{constructor(e,n){this._parameters=e,this._specification=n,mn(this,Tt(this._parameters,this._specification))}static deserialize(e){return new ja(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ua(r){let e=null;if(r instanceof Lo)e=Ua(r.result);else if(r instanceof Do){for(const n of r.args)if(e=Ua(n),e)break}else(r instanceof ns||r instanceof Ii)&&r.input instanceof Zi&&r.input.name==="zoom"&&(e=r);return e instanceof rr||r.eachChild(n=>{const o=Ua(n);o instanceof rr?e=o:!e&&o?e=new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function $a(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!$a(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const dp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};$a(r)||(r=jo(r));const e=No(r,dp);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:Hc(r)}}function pp(r,e){return r<e?-1:r>e?1:0}function Hc(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Hc(r[e]))return!0;return!1}function jo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?nu(r[1],r[2],"=="):e==="!="?Za(nu(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?nu(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(jo))):e==="all"?["all"].concat(r.slice(1).map(jo)):e==="none"?["all"].concat(r.slice(1).map(jo).map(Za)):e==="in"?Wc(r[1],r.slice(2)):e==="!in"?Za(Wc(r[1],r.slice(2))):e==="has"?Xc(r[1]):e==="!has"?Za(Xc(r[1])):e!=="within"||r;var n}function nu(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function Wc(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(pp)]]:["filter-in-small",r,["literal",e]]}}function Xc(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Za(r){return["!",r]}function Uo(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${Uo(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${Uo(r[n[c]])},`;return`${o}}`}function $o(r){let e="";for(const n of hi)e+=`/${Uo(r[n])}`;return e}function Kc(r){const e=r.value;return e?[new Ae(r.key,e,"constants have been deprecated as of v8")]:[]}function nr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ks(r){if(Array.isArray(r))return r.map(ks);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=ks(r[n]);return e}return nr(r)}function di(r){const e=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,_=r.validateSpec;let b=[];const k=zt(n);if(k!=="object")return[new Ae(e,n,`object expected, ${k} found`)];for(const I in n){const z=I.split(".")[0],D=o[z]||o["*"];let F;if(c[z])F=c[z];else if(o[z])F=_;else if(c["*"])F=c["*"];else{if(!o["*"]){b.push(new Ae(e,n[I],`unknown property "${I}"`));continue}F=_}b=b.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:D,style:m,styleSpec:g,object:n,objectKey:I,validateSpec:_},n))}for(const I in o)c[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&b.push(new Ae(e,n,`missing required property "${I}"`));return b}function ia(r){const e=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(zt(e)!=="array")return[new Ae(m,e,`array expected, ${zt(e)} found`)];if(n.length&&e.length!==n.length)return[new Ae(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ae(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let _={type:n.value,values:n.values};c.$version<7&&(_.function=n.function),zt(n.value)==="object"&&(_=n.value);let b=[];for(let k=0;k<e.length;k++)b=b.concat(g({array:e,arrayIndex:k,value:e[k],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${k}]`}));return b}function qa(r){const e=r.key,n=r.value,o=r.valueSpec;let c=zt(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ae(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ae(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ae(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Zo(r){const e=r.valueSpec,n=nr(r.value.type);let o,c,m,g={};const _=n!=="categorical"&&r.value.property===void 0,b=!_,k=zt(r.value.stops)==="array"&&zt(r.value.stops[0])==="array"&&zt(r.value.stops[0][0])==="object",I=di({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Ae(F.key,F.value,'identity function may not have a "stops" property')];let B=[];const j=F.value;return B=B.concat(ia({key:F.key,value:j,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:z})),zt(j)==="array"&&j.length===0&&B.push(new Ae(F.key,j,"array must have at least one stop")),B},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&_&&I.push(new Ae(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||I.push(new Ae(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Jl(r.valueSpec)&&I.push(new Ae(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!ra(r.valueSpec)?I.push(new Ae(r.key,r.value,"property functions not supported")):_&&!qc(r.valueSpec)&&I.push(new Ae(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||I.push(new Ae(r.key,r.value,'"property" property is required')),I;function z(F){let B=[];const j=F.value,W=F.key;if(zt(j)!=="array")return[new Ae(W,j,`array expected, ${zt(j)} found`)];if(j.length!==2)return[new Ae(W,j,`array length 2 expected, length ${j.length} found`)];if(k){if(zt(j[0])!=="object")return[new Ae(W,j,`object expected, ${zt(j[0])} found`)];if(j[0].zoom===void 0)return[new Ae(W,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Ae(W,j,"object stop key must have value")];if(m&&m>nr(j[0].zoom))return[new Ae(W,j[0].zoom,"stop zoom values must appear in ascending order")];nr(j[0].zoom)!==m&&(m=nr(j[0].zoom),c=void 0,g={}),B=B.concat(di({key:`${W}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:qa,value:D}}))}else B=B.concat(D({key:`${W}[0]`,value:j[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},j));return Oo(ks(j[1]))?B.concat([new Ae(`${W}[1]`,j[1],"expressions are not allowed in function stops.")]):B.concat(F.validateSpec({key:`${W}[1]`,value:j[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,B){const j=zt(F.value),W=nr(F.value),Y=F.value!==null?F.value:B;if(o){if(j!==o)return[new Ae(F.key,Y,`${j} stop domain type must match previous stop domain type ${o}`)]}else o=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Ae(F.key,Y,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&n!=="categorical"){let ae=`number expected, ${j} found`;return ra(e)&&n===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(F.key,Y,ae)]}return n!=="categorical"||j!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&j==="number"&&c!==void 0&&W<c?[new Ae(F.key,Y,"stop domain values must appear in ascending order")]:(c=W,n==="categorical"&&W in g?[new Ae(F.key,Y,"stop domain values must be unique")]:(g[W]=!0,[])):[new Ae(F.key,Y,`integer expected, found ${W}`)]}}function Es(r){const e=(r.expressionContext==="property"?ru:No)(ks(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new Ae(`${r.key}${o.key}`,r.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ae(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Na(n))return[new Ae(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Na(n))return[new Ae(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Mo(n,["zoom","feature-state"]))return[new Ae(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!zo(n))return[new Ae(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ga(r){const e=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(nr(n))===-1&&c.push(new Ae(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(nr(n))===-1&&c.push(new Ae(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function na(r){return $a(ks(r.value))?Es(mn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Yc(r)}function Yc(r){const e=r.value,n=r.key;if(zt(e)!=="array")return[new Ae(n,e,`array expected, ${zt(e)} found`)];const o=r.styleSpec;let c,m=[];if(e.length<1)return[new Ae(n,e,"filter array must have at least 1 element")];switch(m=m.concat(Ga({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),nr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&nr(e[1])==="$type"&&m.push(new Ae(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Ae(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=zt(e[1]),c!=="string"&&m.push(new Ae(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=zt(e[g]),nr(e[1])==="$type"?m=m.concat(Ga({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ae(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(Yc({key:`${n}[${g}]`,value:e[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=zt(e[1]),e.length!==2?m.push(new Ae(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ae(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=zt(e[1]),e.length!==2?m.push(new Ae(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&m.push(new Ae(`${n}[1]`,e[1],`object expected, ${c} found`))}return m}function Qc(r,e){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,_=r.objectKey,b=m[`${e}_${r.layerType}`];if(!b)return[];const k=_.match(/^(.*)-transition$/);if(e==="paint"&&k&&b[k[1]]&&b[k[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const I=r.valueSpec||b[_];if(!I)return[new Ae(n,g,`unknown property "${_}"`)];let z;if(zt(g)==="string"&&ra(I)&&!I.tokens&&(z=/^{([^}]+)}$/.exec(g)))return[new Ae(n,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const D=[];return r.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&D.push(new Ae(n,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Qt(ks(g))&&nr(g.type)==="identity"&&D.push(new Ae(n,g,'"text-font" does not support identity functions'))),D.concat(o({key:r.key,value:g,valueSpec:I,style:c,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:_}))}function Jc(r){return Qc(r,"paint")}function eh(r){return Qc(r,"layout")}function th(r){let e=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||e.push(new Ae(o,n,'either "type" or "ref" is required'));let g=nr(n.type);const _=nr(n.ref);if(n.id){const b=nr(n.id);for(let k=0;k<r.arrayIndex;k++){const I=c.layers[k];nr(I.id)===b&&e.push(new Ae(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&e.push(new Ae(o,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{nr(k.id)===_&&(b=k)}),b?b.ref?e.push(new Ae(o,n.ref,"ref cannot reference another ref layer")):g=nr(b.type):e.push(new Ae(o,n.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(n.source){const b=c.sources&&c.sources[n.source],k=b&&nr(b.type);b?k==="vector"&&g==="raster"?e.push(new Ae(o,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?e.push(new Ae(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?e.push(new Ae(o,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?e.push(new Ae(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&b.lineMetrics||e.push(new Ae(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ae(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ae(o,n.source,`source "${n.source}" not found`))}else e.push(new Ae(o,n,'missing required property "source"'));return e=e.concat(di({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:na,layout:b=>di({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":k=>eh(mn({layerType:g},k))}}),paint:b=>di({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":k=>Jc(mn({layerType:g},k))}})}})),e}function yn(r){const e=r.value,n=r.key,o=zt(e);return o!=="string"?[new Ae(n,e,`string expected, ${o} found`)]:[]}const Ha={promoteId:function({key:r,value:e}){if(zt(e)==="string")return yn({key:r,value:e});{const n=[];for(const o in e)n.push(...yn({key:`${r}.${o}`,value:e[o]}));return n}}};function Ci(r){const e=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!e.type)return[new Ae(n,e,'"type" is required')];const g=nr(e.type);let _;switch(g){case"vector":case"raster":return _=di({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Ha,validateSpec:m}),_;case"raster-dem":return _=function(b){var k;const I=(k=b.sourceName)!==null&&k!==void 0?k:"",z=b.value,D=b.styleSpec,F=D.source_raster_dem,B=b.style;let j=[];const W=zt(z);if(z===void 0)return j;if(W!=="object")return j.push(new Ae("source_raster_dem",z,`object expected, ${W} found`)),j;const Y=nr(z.encoding)==="custom",ae=["redFactor","greenFactor","blueFactor","baseShift"],J=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const ue in z)!Y&&ae.includes(ue)?j.push(new Ae(ue,z[ue],`In "${I}": "${ue}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):F[ue]?j=j.concat(b.validateSpec({key:ue,value:z[ue],valueSpec:F[ue],validateSpec:b.validateSpec,style:B,styleSpec:D})):j.push(new Ae(ue,z[ue],`unknown property "${ue}"`));return j}({sourceName:n,value:e,style:r.style,styleSpec:o,validateSpec:m}),_;case"geojson":if(_=di({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:Ha}),e.cluster)for(const b in e.clusterProperties){const[k,I]=e.clusterProperties[b],z=typeof k=="string"?[k,["accumulated"],["get",b]]:k;_.push(...Es({key:`${n}.${b}.map`,value:I,expressionContext:"cluster-map"})),_.push(...Es({key:`${n}.${b}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return _;case"video":return di({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return di({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new Ae(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ga({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Wa(r){const e=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=zt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ae("light",e,`object expected, ${g} found`)]),m;for(const _ in e){const b=_.match(/^(.*)-transition$/);m=m.concat(b&&o[b[1]]&&o[b[1]].transition?r.validateSpec({key:_,value:e[_],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ae(_,e[_],`unknown property "${_}"`)])}return m}function rh(r){const e=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=zt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ae("terrain",e,`object expected, ${g} found`)]),m;for(const _ in e)m=m.concat(o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ae(_,e[_],`unknown property "${_}"`)]);return m}function ih(r){let e=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&e.push(new Ae(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&e.push(new Ae(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),e=e.concat(di({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return yn({key:o,value:n})}const nh={"*":()=>[],array:ia,boolean:function(r){const e=r.value,n=r.key,o=zt(e);return o!=="boolean"?[new Ae(n,e,`boolean expected, ${o} found`)]:[]},number:qa,color:function(r){const e=r.key,n=r.value,o=zt(n);return o!=="string"?[new Ae(e,n,`color expected, ${o} found`)]:Rt.parse(String(n))?[]:[new Ae(e,n,`color expected, "${n}" found`)]},constants:Kc,enum:Ga,filter:na,function:Zo,layer:th,object:di,source:Ci,light:Wa,terrain:rh,string:yn,formatted:function(r){return yn(r).length===0?[]:Es(r)},resolvedImage:function(r){return yn(r).length===0?[]:Es(r)},padding:function(r){const e=r.key,n=r.value;if(zt(n)==="array"){if(n.length<1||n.length>4)return[new Ae(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return qa({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,o=zt(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ae(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Ga({key:`${e}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(ia({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:ih};function as(r){const e=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=as,n.expression&&Qt(nr(e))?Zo(r):n.expression&&Oo(ks(e))?Es(r):n.type&&nh[n.type]?nh[n.type](r):di(mn({},r,{valueSpec:n.type?o[n.type]:n}))}function sh(r){const e=r.value,n=r.key,o=yn(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ae(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ae(n,e,'"glyphs" url must include a "{range}" token'))),o}function qi(r,e=ye){let n=[];return n=n.concat(as({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:as,objectElementValidators:{glyphs:sh,"*":()=>[]}})),r.constants&&(n=n.concat(Kc({key:"constants",value:r.constants}))),qo(n)}function Rn(r){return function(e){return r({...e,validateSpec:as})}}function qo(r){return[].concat(r).sort((e,n)=>e.line-n.line)}function Fn(r){return function(...e){return qo(r.apply(this,e))}}qi.source=Fn(Rn(Ci)),qi.sprite=Fn(Rn(ih)),qi.glyphs=Fn(Rn(sh)),qi.light=Fn(Rn(Wa)),qi.terrain=Fn(Rn(rh)),qi.layer=Fn(Rn(th)),qi.filter=Fn(Rn(na)),qi.paintProperty=Fn(Rn(Jc)),qi.layoutProperty=Fn(Rn(eh));const Bn=qi,fp=Bn.light,su=Bn.paintProperty,ah=Bn.layoutProperty;function Go(r,e){let n=!1;if(e&&e.length)for(const o of e)r.fire(new es(new Error(o.message))),n=!0;return n}class sa{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let b=0;b<this.d*this.d;b++){const k=g[3+b],I=g[3+b+1];c.push(k===I?null:g.subarray(k,I))}const _=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const m=o/n*e;this.min=-m,this.max=e+m}insert(e,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,m,g){this.cells[m].push(g)}query(e,n,o,c,m){const g=this.min,_=this.max;if(e<=g&&n<=g&&_<=o&&_<=c&&!m)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,n,o,c,this._queryCell,b,{},m),b}}_queryCell(e,n,o,c,m,g,_,b){const k=this.cells[m];if(k!==null){const I=this.keys,z=this.bboxes;for(let D=0;D<k.length;D++){const F=k[D];if(_[F]===void 0){const B=4*F;(b?b(z[B+0],z[B+1],z[B+2],z[B+3]):e<=z[B+2]&&n<=z[B+3]&&o>=z[B+0]&&c>=z[B+1])?(_[F]=!0,g.push(I[F])):_[F]=!1}}}}_forEachCell(e,n,o,c,m,g,_,b){const k=this._convertToCellCoord(e),I=this._convertToCellCoord(n),z=this._convertToCellCoord(o),D=this._convertToCellCoord(c);for(let F=k;F<=z;F++)for(let B=I;B<=D;B++){const j=this.d*B+F;if((!b||b(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&m.call(this,e,n,o,c,j,g,_,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<e.length;g++){const _=e[g];c[3+g]=m,c.set(_,m),m+=_.length}return c[3+e.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+e.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new sa(e.buffer)}}const On={};function $e(r,e,n={}){if(On[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),On[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",sa),$e("Color",Rt),$e("Error",Error),$e("AJAXError",Yn),$e("ResolvedImage",Br),$e("StylePropertyFunction",ja),$e("StyleExpression",eu,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Vo),$e("ZoomConstantExpression",tu),$e("CompoundExpression",Zi,{omit:["_evaluate"]});for(const r in ta)ta[r]._classRegistryKey||$e(`Expression_${r}`,ta[r]);function Ho(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function os(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Ho(r)||dt(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const n=r;return e&&e.push(n.buffer),n}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const o of r)n.push(os(o,e));return n}if(typeof r=="object"){const n=r.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!On[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||On[o].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=On[o].shallow.indexOf(m)>=0?g:os(g,e)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof r)}function aa(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Ho(r)||dt(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(aa);if(typeof r=="object"){const e=r.$name||"Object";if(!On[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=On[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=On[e].shallow.indexOf(c)>=0?m:aa(m)}return o}throw new Error("can't deserialize object of type "+typeof r)}class oh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Ve={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function au(r){for(const e of r)if(lu(e.charCodeAt(0)))return!0;return!1}function ou(r){for(const e of r)if(!mp(e.charCodeAt(0)))return!1;return!0}function mp(r){return!(Ve.Arabic(r)||Ve["Arabic Supplement"](r)||Ve["Arabic Extended-A"](r)||Ve["Arabic Presentation Forms-A"](r)||Ve["Arabic Presentation Forms-B"](r))}function lu(r){return!(r!==746&&r!==747&&(r<4352||!(Ve["Bopomofo Extended"](r)||Ve.Bopomofo(r)||Ve["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ve["CJK Compatibility Ideographs"](r)||Ve["CJK Compatibility"](r)||Ve["CJK Radicals Supplement"](r)||Ve["CJK Strokes"](r)||!(!Ve["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ve["CJK Unified Ideographs Extension A"](r)||Ve["CJK Unified Ideographs"](r)||Ve["Enclosed CJK Letters and Months"](r)||Ve["Hangul Compatibility Jamo"](r)||Ve["Hangul Jamo Extended-A"](r)||Ve["Hangul Jamo Extended-B"](r)||Ve["Hangul Jamo"](r)||Ve["Hangul Syllables"](r)||Ve.Hiragana(r)||Ve["Ideographic Description Characters"](r)||Ve.Kanbun(r)||Ve["Kangxi Radicals"](r)||Ve["Katakana Phonetic Extensions"](r)||Ve.Katakana(r)&&r!==12540||!(!Ve["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ve["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ve["Unified Canadian Aboriginal Syllabics"](r)||Ve["Unified Canadian Aboriginal Syllabics Extended"](r)||Ve["Vertical Forms"](r)||Ve["Yijing Hexagram Symbols"](r)||Ve["Yi Syllables"](r)||Ve["Yi Radicals"](r))))}function lh(r){return!(lu(r)||function(e){return!!(Ve["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ve["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ve["Letterlike Symbols"](e)||Ve["Number Forms"](e)||Ve["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ve["Control Pictures"](e)&&e!==9251||Ve["Optical Character Recognition"](e)||Ve["Enclosed Alphanumerics"](e)||Ve["Geometric Shapes"](e)||Ve["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ve["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ve["CJK Symbols and Punctuation"](e)||Ve.Katakana(e)||Ve["Private Use Area"](e)||Ve["CJK Compatibility Forms"](e)||Ve["Small Form Variants"](e)||Ve["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function uh(r){return r>=1424&&r<=2303||Ve["Arabic Presentation Forms-A"](r)||Ve["Arabic Presentation Forms-B"](r)}function ch(r,e){return!(!e&&uh(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ve.Khmer(r))}function gp(r){for(const e of r)if(uh(e.charCodeAt(0)))return!0;return!1}const uu="deferred",cu="loading",hu="loaded";let du=null,pi="unavailable",ls=null;const Xa=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(pi="error"),du&&du(r)};function pu(){Ka.fire(new Jn("pluginStateChange",{pluginStatus:pi,pluginURL:ls}))}const Ka=new _s,fu=function(){return pi},hh=function(){if(pi!==uu||!ls)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pi=cu,pu(),ls&&Ba({url:ls},r=>{r?Xa(r):(pi=hu,pu())})},Pi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>pi===hu||Pi.applyArabicShaping!=null,isLoading:()=>pi===cu,setState(r){if(!$r())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");pi=r.pluginStatus,ls=r.pluginURL},isParsed(){if(!$r())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Pi.applyArabicShaping!=null&&Pi.processBidirectionalText!=null&&Pi.processStyledBidirectionalText!=null},getPluginURL(){if(!$r())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ls}};class Gt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oh,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!ch(c.charCodeAt(0),o))return!1;return!0}(e,Pi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Wo{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(Qt(o))return new ja(o,c);if(Oo(o)){const m=ru(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Rt.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Ui.parse(o)):m=ki.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class mu{constructor(e){this.property=e,this.value=new Wo(e,void 0)}transitioned(e,n){return new ph(this.property,this.value,n,Ze({},e.transition,this.transition),e.now)}untransitioned(){return new ph(this.property,this.value,null,{},0)}}class dh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rr(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new mu(this._values[e].property)),this._values[e].value=new Wo(this._values[e].property,n===null?void 0:Rr(n))}getTransition(e){return Rr(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new mu(this._values[e].property)),this._values[e].transition=Rr(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new fh(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new fh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ph{constructor(e,n,o,c,m){this.property=e,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,m=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,n,o);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),m,function(b){if(b<=0)return 0;if(b>=1)return 1;const k=b*b,I=k*b;return 4*(b<.5?I:3*(b-k)+I-.75)}(_))}}return m}}class fh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new Xo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class yp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Rr(this._values[e].value)}setValue(e,n){this._values[e]=new Wo(this._values[e].property,n===null?void 0:Rr(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new Xo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}}class ei{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class Xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=Ei[this.specification.type];return c?c(e,n,o):e}}class at{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new ei(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ei(this,{kind:"constant",value:void 0},e.parameters);const c=Ei[this.specification.type];if(c){const m=c(e.value.value,n.value.value,o);return new ei(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,o,c,m,g){return e.kind==="constant"?e.value:e.evaluate(n,o,c,m,g)}}class Ya extends at{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new ei(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,n);return new ei(this,{kind:"constant",value:_},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new ei(this,{kind:"constant",value:m},n)}return new ei(this,e.expression,n)}evaluate(e,n,o,c,m,g){if(e.kind==="source"){const _=e.evaluate(n,o,c,m,g);return this._calculate(_,_,_,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class gu{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new Gt(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Gt(Math.floor(n.zoom),n)),e.expression.evaluate(new Gt(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class yu{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class pr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Wo(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new mu(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}$e("DataDrivenProperty",at),$e("DataConstantProperty",tt),$e("CrossFadedDataDrivenProperty",Ya),$e("CrossFadedProperty",gu),$e("ColorRampProperty",yu);const _u="-transition";class Gi extends _s{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new yp(n.layout)),n.paint)){this._transitionablePaint=new dh(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(ah,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(_u)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(su,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(_u))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,_,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ar(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,m={}){return(!m||m.validate!==!1)&&Go(this,e.call(Bn,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ei&&ra(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const mh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Is{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function er(r,e=1){let n=0,o=0;return{members:r.map(c=>{const m=mh[c.type].BYTES_PER_ELEMENT,g=n=oa(n,Math.max(e,m)),_=c.components||1;return o=Math.max(o,m),n+=m*_,{name:c.name,type:c.type,components:_,offset:g}}),size:oa(n,Math.max(o,e)),alignment:e}}function oa(r,e){return Math.ceil(r/e)*e}class Qa extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}Qa.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",Qa);class Ja extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,e}}Ja.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",Ja);class Cs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,e}}Cs.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",Cs);class vu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,_){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=_,e}}vu.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",vu);class xu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,_){const b=4*e,k=8*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[k+4]=c,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=_,e}}xu.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",xu);class la extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}la.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",la);class wu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,_,b,k,I){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,o,c,m,g,_,b,k,I)}emplace(e,n,o,c,m,g,_,b,k,I,z){const D=10*e;return this.uint16[D+0]=n,this.uint16[D+1]=o,this.uint16[D+2]=c,this.uint16[D+3]=m,this.uint16[D+4]=g,this.uint16[D+5]=_,this.uint16[D+6]=b,this.uint16[D+7]=k,this.uint16[D+8]=I,this.uint16[D+9]=z,e}}wu.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",wu);class bu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,_,b,k,I,z,D){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,c,m,g,_,b,k,I,z,D)}emplace(e,n,o,c,m,g,_,b,k,I,z,D,F){const B=12*e;return this.int16[B+0]=n,this.int16[B+1]=o,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=_,this.uint16[B+6]=b,this.uint16[B+7]=k,this.int16[B+8]=I,this.int16[B+9]=z,this.int16[B+10]=D,this.int16[B+11]=F,e}}bu.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",bu);class Mt extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}Mt.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",Mt);class p extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}p.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",p);class t extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,_,b,k){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,o,c,m,g,_,b,k)}emplace(e,n,o,c,m,g,_,b,k,I){const z=10*e,D=5*e;return this.int16[z+0]=n,this.int16[z+1]=o,this.int16[z+2]=c,this.int16[z+3]=m,this.int16[z+4]=g,this.int16[z+5]=_,this.uint32[D+3]=b,this.uint16[z+8]=k,this.uint16[z+9]=I,e}}t.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",t);class a extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,_){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=_,e}}a.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",a);class u extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,m)}emplace(e,n,o,c,m,g){const _=4*e,b=8*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[b+6]=m,this.int16[b+7]=g,e}}u.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",u);class d extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=12*e,_=3*e;return this.uint8[g+0]=n,this.uint8[g+1]=o,this.float32[_+1]=c,this.float32[_+2]=m,e}}d.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",d);class f extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,e}}f.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",f);class v extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y)}emplace(e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y,ae){const J=24*e,ue=12*e,de=48*e;return this.int16[J+0]=n,this.int16[J+1]=o,this.uint16[J+2]=c,this.uint16[J+3]=m,this.uint32[ue+2]=g,this.uint32[ue+3]=_,this.uint32[ue+4]=b,this.uint16[J+10]=k,this.uint16[J+11]=I,this.uint16[J+12]=z,this.float32[ue+7]=D,this.float32[ue+8]=F,this.uint8[de+36]=B,this.uint8[de+37]=j,this.uint8[de+38]=W,this.uint32[ue+10]=Y,this.int16[J+22]=ae,e}}v.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",v);class x extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y,ae,J,ue,de,be,je,Ye,Ne,Oe,Me,qe){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y,ae,J,ue,de,be,je,Ye,Ne,Oe,Me,qe)}emplace(e,n,o,c,m,g,_,b,k,I,z,D,F,B,j,W,Y,ae,J,ue,de,be,je,Ye,Ne,Oe,Me,qe,Le){const Ie=32*e,nt=16*e;return this.int16[Ie+0]=n,this.int16[Ie+1]=o,this.int16[Ie+2]=c,this.int16[Ie+3]=m,this.int16[Ie+4]=g,this.int16[Ie+5]=_,this.int16[Ie+6]=b,this.int16[Ie+7]=k,this.uint16[Ie+8]=I,this.uint16[Ie+9]=z,this.uint16[Ie+10]=D,this.uint16[Ie+11]=F,this.uint16[Ie+12]=B,this.uint16[Ie+13]=j,this.uint16[Ie+14]=W,this.uint16[Ie+15]=Y,this.uint16[Ie+16]=ae,this.uint16[Ie+17]=J,this.uint16[Ie+18]=ue,this.uint16[Ie+19]=de,this.uint16[Ie+20]=be,this.uint16[Ie+21]=je,this.uint16[Ie+22]=Ye,this.uint32[nt+12]=Ne,this.float32[nt+13]=Oe,this.float32[nt+14]=Me,this.uint16[Ie+30]=qe,this.uint16[Ie+31]=Le,e}}x.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",x);class S extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}S.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",S);class E extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}E.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",E);class C extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,e}}C.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",C);class P extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}P.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",P);class R extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}R.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",R);class $ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,e}}$.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",$);class U extends Is{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new oe(this.anchorPointX,this.anchorPointY)}}U.prototype.size=20;class q extends t{get(e){return new U(this,e)}}$e("CollisionBoxArray",q);class V extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}V.prototype.size=48;class re extends v{get(e){return new V(this,e)}}$e("PlacedSymbolArray",re);class he extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}he.prototype.size=64;class K extends x{get(e){return new he(this,e)}}$e("SymbolInstanceArray",K);class ne extends S{getoffsetX(e){return this.float32[1*e+0]}}$e("GlyphOffsetArray",ne);class pe extends Ja{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}$e("SymbolLineVertexArray",pe);class fe extends Is{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fe.prototype.size=12;class we extends E{get(e){return new fe(this,e)}}$e("TextAnchorOffsetArray",we);class ke extends Is{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ke.prototype.size=8;class Te extends C{get(e){return new ke(this,e)}}$e("FeatureIndexArray",Te);class Pe extends Qa{}class Ke extends Qa{}class xt extends Qa{}class Be extends vu{}class ot extends xu{}class Qe extends la{}class Ft extends wu{}class vt extends bu{}class ft extends Mt{}class wt extends p{}class ur extends a{}class Zt extends d{}class Or extends f{}class Sr extends P{}const fr=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:zi}=fr;class Ht{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let m=this.segments[this.segments.length-1];return e>Ht.MAX_VERTEX_ARRAY_LENGTH&&Dr(`Max vertices per segment is ${Ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Ht.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new Ht([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function _n(r,e){return 256*(r=We(Math.floor(r),0,255))+We(Math.floor(e),0,255)}Ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",Ht);const vn=er([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var us={exports:{}},Ps={exports:{}};Ps.exports=function(r,e){var n,o,c,m,g,_,b,k;for(o=r.length-(n=3&r.length),c=e,g=3432918353,_=461845907,k=0;k<o;)b=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(m=5*(65535&(c=(c^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(b=0,n){case 3:b^=(255&r.charCodeAt(k+2))<<16;case 2:b^=(255&r.charCodeAt(k+1))<<8;case 1:c^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(k)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var ua=Ps.exports,Gr={exports:{}};Gr.exports=function(r,e){for(var n,o=r.length,c=e^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Nr=ua,ti=Gr.exports;us.exports=Nr,us.exports.murmur3=Nr,us.exports.murmur2=ti;var zs=O(us.exports);class cr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(Tr(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Tr(e);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return fi(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new cr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Tr(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:zs(String(r))}function fi(r,e,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;hr(r,m,g),hr(e,3*m,3*g),hr(e,3*m+1,3*g+1),hr(e,3*m+2,3*g+2)}g-n<o-g?(fi(r,e,n,g),n=g+1):(fi(r,e,g+1,o),o=g)}}function hr(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}$e("FeaturePositionMap",cr);class Ms{constructor(e,n){this.gl=e.gl,this.location=n}}class Ko extends Ms{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class gh extends Ms{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class yh extends Ms{constructor(e,n){super(e,n),this.current=Rt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const _p=new Float32Array(16);function Su(r){return[_n(255*r.r,255*r.g),_n(255*r.b,255*r.a)]}class xn{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new yh(e,n):new Ko(e,n)}}class As{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new gh(e,n):new Ko(e,n)}}class wn{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Gt(0),n,{},c,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,_)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,m)}_setPaintValue(e,n,o){if(this.type==="color"){const c=Su(o);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hi{constructor(e,n,o,c,m,g){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,o,c,m){const g=this.expression.evaluate(new Gt(this.zoom),n,{},c,[],m),_=this.expression.evaluate(new Gt(this.zoom+1),n,{},c,[],m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,g,_)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,m,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const m=Su(o),g=Su(c);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=We(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new Ko(e,n)}}class bn{constructor(e,n,o,c,m,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,m){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:_}=o,b=c[m],k=c[g],I=c[_];if(b&&k&&I)for(let z=e;z<n;z++)this.zoomInPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],k.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],k.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,vn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,vn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Tu{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const m in e.paint._values){if(!o(m))continue;const g=e.paint.get(m);if(!(g instanceof ei&&ra(g.property.specification)))continue;const _=A0(m,e.type),b=g.value,k=g.property.specification.type,I=g.property.useIntegerZoom,z=g.property.specification["property-type"],D=z==="cross-faded"||z==="cross-faded-data-driven";if(b.kind==="constant")this.binders[m]=D?new As(b.value,_):new xn(b.value,_,k),c.push(`/u_${m}`);else if(b.kind==="source"||D){const F=Eg(m,k,"source");this.binders[m]=D?new bn(b,k,I,n,F,e.id):new wn(b,_,k,F),c.push(`/a_${m}`)}else{const F=Eg(m,k,"composite");this.binders[m]=new Hi(b,_,k,I,n,F),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof wn||n instanceof Hi?n.maxValue:0}populatePaintArrays(e,n,o,c,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof wn||_ instanceof Hi||_ instanceof bn)&&_.populatePaintArray(e,n,o,c,m)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof As&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,m){let g=!1;for(const _ in e){const b=n.getPositions(_);for(const k of b){const I=o.feature(k.index);for(const z in this.binders){const D=this.binders[z];if((D instanceof wn||D instanceof Hi||D instanceof bn)&&D.expression.isStateDependent===!0){const F=c.paint.get(z);D.expression=F.value,D.updatePaintArray(k.start,k.end,I,e[_],m),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof xn||o instanceof As)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof wn||o instanceof Hi)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof bn)for(let c=0;c<vn.members.length;c++)e.push(vn.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof xn||o instanceof As||o instanceof Hi)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof xn||m instanceof As||m instanceof Hi){for(const g of m.uniformNames)if(n[g]){const _=m.getBinding(e,n[g],g);o.push({name:g,property:c,binding:_})}}}return o}setUniforms(e,n,o,c){for(const{name:m,property:g,binding:_}of n)this.binders[g].setUniform(_,c,o.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof bn){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof wn||o instanceof Hi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof wn||o instanceof Hi||o instanceof bn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof wn||n instanceof Hi||n instanceof bn)&&n.destroy()}}}class Nn{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Tu(c,n,o);this.needsUpload=!1,this._featureMap=new cr,this._bufferOffset=0}populatePaintArrays(e,n,o,c,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function A0(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Eg(r,e,n){const o={color:{source:la,composite:$},number:{source:S,composite:la}},c=function(m){return{"line-pattern":{source:Ft,composite:Ft},"fill-pattern":{source:Ft,composite:Ft},"fill-extrusion-pattern":{source:Ft,composite:Ft}}[m]}(r);return c&&c[n]||o[e][n]}$e("ConstantBinder",xn),$e("CrossFadedConstantBinder",As),$e("SourceExpressionBinder",wn),$e("CrossFadedCompositeBinder",bn),$e("CompositeExpressionBinder",Hi),$e("ProgramConfiguration",Tu,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Nn);const xr=8192,vp=Math.pow(2,14)-1,Ig=-vp-1;function eo(r){const e=xr/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],_=Math.round(g.x*e),b=Math.round(g.y*e);g.x=We(_,Ig,vp),g.y=We(b,Ig,vp),(_<g.x||_>g.x+1||b<g.y||b>g.y+1)&&Dr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function to(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?eo(r):[]}}function _h(r,e,n,o,c){r.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class xp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.indexArray=new Or,this.segments=new Ht,this.programConfigurations=new Nn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],m=[];let g=null,_=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:b,id:k,index:I,sourceLayerIndex:z}of e){const D=this.layers[0]._featureFilter.needGeometry,F=to(b,D);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),F,o))continue;const B=_?g.evaluate(F,{},o):void 0,j={id:k,properties:b.properties,type:b.type,sourceLayerIndex:z,index:I,geometry:D?F.geometry:eo(b),patterns:{},sortKey:B};m.push(j)}_&&m.sort((b,k)=>b.sortKey-k.sortKey);for(const b of m){const{geometry:k,index:I,sourceLayerIndex:z}=b,D=e[I].feature;this.addFeature(b,k,I,o),n.featureIndex.insert(D,k,I,z,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const m of n)for(const g of m){const _=g.x,b=g.y;if(_<0||_>=xr||b<0||b>=xr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=k.vertexLength;_h(this.layoutVertexArray,_,b,-1,-1),_h(this.layoutVertexArray,_,b,1,-1),_h(this.layoutVertexArray,_,b,1,1),_h(this.layoutVertexArray,_,b,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function Cg(r,e){for(let n=0;n<r.length;n++)if(Yo(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Yo(r,e[n]))return!0;return!!wp(r,e)}function D0(r,e,n){return!!Yo(r,e)||!!bp(e,r,n)}function Pg(r,e){if(r.length===1)return Mg(e,r[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(Yo(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(Mg(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(wp(r,e[n]))return!0;return!1}function L0(r,e,n){if(r.length>1){if(wp(r,e))return!0;for(let o=0;o<e.length;o++)if(bp(e[o],r,n))return!0}for(let o=0;o<r.length;o++)if(bp(r[o],e,n))return!0;return!1}function wp(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<e.length-1;m++)if(R0(o,c,e[m],e[m+1]))return!0}return!1}function R0(r,e,n,o){return Qr(r,n,o)!==Qr(e,n,o)&&Qr(r,e,n)!==Qr(r,e,o)}function bp(r,e,n){const o=n*n;if(e.length===1)return r.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(zg(r,e[c-1],e[c])<o)return!0;return!1}function zg(r,e,n){const o=e.distSqr(n);if(o===0)return r.distSqr(e);const c=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/o;return r.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function Mg(r,e){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let _=0,b=n.length-1;_<n.length;b=_++)o=n[_],c=n[b],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function Yo(r,e){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function F0(r,e,n){const o=n[0],c=n[2];if(r.x<o.x&&e.x<o.x||r.x>c.x&&e.x>c.x||r.y<o.y&&e.y<o.y||r.y>c.y&&e.y>c.y)return!1;const m=Qr(r,e,n[0]);return m!==Qr(r,e,n[1])||m!==Qr(r,e,n[2])||m!==Qr(r,e,n[3])}function ku(r,e,n){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(r)}function vh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function xh(r,e,n,o,c){if(!e[0]&&!e[1])return r;const m=oe.convert(e)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(m));return g}let Ag,Dg;$e("CircleBucket",xp,{omit:["layers"]});var B0={get paint(){return Dg=Dg||new pr({"circle-radius":new at(ye.paint_circle["circle-radius"]),"circle-color":new at(ye.paint_circle["circle-color"]),"circle-blur":new at(ye.paint_circle["circle-blur"]),"circle-opacity":new at(ye.paint_circle["circle-opacity"]),"circle-translate":new tt(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Ag=Ag||new pr({"circle-sort-key":new at(ye.layout_circle["circle-sort-key"])})}},mi=1e-6,Qo=typeof Float32Array<"u"?Float32Array:Array;function Sp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Lg(r,e,n){var o=e[0],c=e[1],m=e[2],g=e[3],_=e[4],b=e[5],k=e[6],I=e[7],z=e[8],D=e[9],F=e[10],B=e[11],j=e[12],W=e[13],Y=e[14],ae=e[15],J=n[0],ue=n[1],de=n[2],be=n[3];return r[0]=J*o+ue*_+de*z+be*j,r[1]=J*c+ue*b+de*D+be*W,r[2]=J*m+ue*k+de*F+be*Y,r[3]=J*g+ue*I+de*B+be*ae,r[4]=(J=n[4])*o+(ue=n[5])*_+(de=n[6])*z+(be=n[7])*j,r[5]=J*c+ue*b+de*D+be*W,r[6]=J*m+ue*k+de*F+be*Y,r[7]=J*g+ue*I+de*B+be*ae,r[8]=(J=n[8])*o+(ue=n[9])*_+(de=n[10])*z+(be=n[11])*j,r[9]=J*c+ue*b+de*D+be*W,r[10]=J*m+ue*k+de*F+be*Y,r[11]=J*g+ue*I+de*B+be*ae,r[12]=(J=n[12])*o+(ue=n[13])*_+(de=n[14])*z+(be=n[15])*j,r[13]=J*c+ue*b+de*D+be*W,r[14]=J*m+ue*k+de*F+be*Y,r[15]=J*g+ue*I+de*B+be*ae,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Eu,O0=Lg;function wh(r,e,n){var o=e[0],c=e[1],m=e[2],g=e[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}Eu=new Qo(4),Qo!=Float32Array&&(Eu[0]=0,Eu[1]=0,Eu[2]=0,Eu[3]=0);class N0 extends Gi{constructor(e){super(e,B0)}createBucket(e){return new xp(e)}queryRadius(e){const n=e;return ku("circle-radius",this,n)+ku("circle-stroke-width",this,n)+vh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,m,g,_,b){const k=xh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),z=this.paint.get("circle-pitch-alignment")==="map",D=z?k:function(B,j){return B.map(W=>Rg(W,j))}(k,b),F=z?I*_:I;for(const B of c)for(const j of B){const W=z?j:Rg(j,b);let Y=F;const ae=wh([],[j.x,j.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=ae[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=g.cameraToCenterDistance/ae[3]),D0(D,W,Y))return!0}return!1}}function Rg(r,e){const n=wh([],[r.x,r.y,0,1],e);return new oe(n[0]/n[3],n[1]/n[3])}class Fg extends xp{}let Bg;$e("HeatmapBucket",Fg,{omit:["layers"]});var V0={get paint(){return Bg=Bg||new pr({"heatmap-radius":new at(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yu(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(ye.paint_heatmap["heatmap-opacity"])})}};function Tp(r,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return r.width=e,r.height=n,r.data=c,r}function Og(r,{width:e,height:n},o){if(e===r.width&&n===r.height)return;const c=Tp({},{width:e,height:n},o);kp(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},o),r.width=e,r.height=n,r.data=c.data}function kp(r,e,n,o,c,m){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=e.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const k=((n.y+b)*r.width+n.x)*m,I=((o.y+b)*e.width+o.x)*m;for(let z=0;z<c.width*m;z++)_[I+z]=g[k+z]}return e}class Iu{constructor(e,n){Tp(this,e,1,n)}resize(e){Og(this,e,1)}clone(){return new Iu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){kp(e,n,o,c,m,1)}}class nn{constructor(e,n){Tp(this,e,4,n)}resize(e){Og(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new nn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){kp(e,n,o,c,m,4)}}function Ng(r){const e={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new nn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,_,b)=>{e[r.evaluationKey]=b;const k=r.expression.evaluate(e);c.data[g+_+0]=Math.floor(255*k.r/k.a),c.data[g+_+1]=Math.floor(255*k.g/k.a),c.data[g+_+2]=Math.floor(255*k.b/k.a),c.data[g+_+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,_=0;g<o;++g,_+=4*n)for(let b=0,k=0;b<n;b++,k+=4){const I=b/(n-1),{start:z,end:D}=r.clips[g];m(_,k,z*(1-I)+D*I)}else for(let g=0,_=0;g<n;g++,_+=4)m(0,_,g/(n-1));return c}$e("AlphaImage",Iu),$e("RGBAImage",nn);class j0 extends Gi{createBucket(e){return new Fg(e)}constructor(e){super(e,V0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ng({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Vg;var U0={get paint(){return Vg=Vg||new pr({"hillshade-illumination-direction":new tt(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(ye.paint_hillshade["hillshade-accent-color"])})}};class $0 extends Gi{constructor(e){super(e,U0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Z0=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:q0}=Z0;var Ep={exports:{}};function bh(r,e,n){n=n||2;var o,c,m,g,_,b,k,I=e&&e.length,z=I?e[0]*n:r.length,D=jg(r,0,z,n,!0),F=[];if(!D||D.next===D.prev)return F;if(I&&(D=function(j,W,Y,ae){var J,ue,de,be=[];for(J=0,ue=W.length;J<ue;J++)(de=jg(j,W[J]*ae,J<ue-1?W[J+1]*ae:j.length,ae,!1))===de.next&&(de.steiner=!0),be.push(J0(de));for(be.sort(K0),J=0;J<be.length;J++)Y=Y0(be[J],Y);return Y}(r,e,D,n)),r.length>80*n){o=m=r[0],c=g=r[1];for(var B=n;B<z;B+=n)(_=r[B])<o&&(o=_),(b=r[B+1])<c&&(c=b),_>m&&(m=_),b>g&&(g=b);k=(k=Math.max(m-o,g-c))!==0?32767/k:0}return Cu(D,F,n,o,c,k,0),F}function jg(r,e,n,o,c){var m,g;if(c===Pp(r,e,n,o)>0)for(m=e;m<n;m+=o)g=Zg(m,r[m],r[m+1],g);else for(m=n-o;m>=e;m-=o)g=Zg(m,r[m],r[m+1],g);return g&&Sh(g,g.next)&&(zu(g),g=g.next),g}function ro(r,e){if(!r)return r;e||(e=r);var n,o=r;do if(n=!1,o.steiner||!Sh(o,o.next)&&mr(o.prev,o,o.next)!==0)o=o.next;else{if(zu(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Cu(r,e,n,o,c,m,g){if(r){!g&&m&&function(I,z,D,F){var B=I;do B.z===0&&(B.z=Ip(B.x,B.y,z,D,F)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==I);B.prevZ.nextZ=null,B.prevZ=null,function(j){var W,Y,ae,J,ue,de,be,je,Ye=1;do{for(Y=j,j=null,ue=null,de=0;Y;){for(de++,ae=Y,be=0,W=0;W<Ye&&(be++,ae=ae.nextZ);W++);for(je=Ye;be>0||je>0&&ae;)be!==0&&(je===0||!ae||Y.z<=ae.z)?(J=Y,Y=Y.nextZ,be--):(J=ae,ae=ae.nextZ,je--),ue?ue.nextZ=J:j=J,J.prevZ=ue,ue=J;Y=ae}ue.nextZ=null,Ye*=2}while(de>1)}(B)}(r,o,c,m);for(var _,b,k=r;r.prev!==r.next;)if(_=r.prev,b=r.next,m?H0(r,o,c,m):G0(r))e.push(_.i/n|0),e.push(r.i/n|0),e.push(b.i/n|0),zu(r),r=b.next,k=b.next;else if((r=b)===k){g?g===1?Cu(r=W0(ro(r),e,n),e,n,o,c,m,2):g===2&&X0(r,e,n,o,c,m):Cu(ro(r),e,n,o,c,m,1);break}}}function G0(r){var e=r.prev,n=r,o=r.next;if(mr(e,n,o)>=0)return!1;for(var c=e.x,m=n.x,g=o.x,_=e.y,b=n.y,k=o.y,I=c<m?c<g?c:g:m<g?m:g,z=_<b?_<k?_:k:b<k?b:k,D=c>m?c>g?c:g:m>g?m:g,F=_>b?_>k?_:k:b>k?b:k,B=o.next;B!==e;){if(B.x>=I&&B.x<=D&&B.y>=z&&B.y<=F&&Jo(c,_,m,b,g,k,B.x,B.y)&&mr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function H0(r,e,n,o){var c=r.prev,m=r,g=r.next;if(mr(c,m,g)>=0)return!1;for(var _=c.x,b=m.x,k=g.x,I=c.y,z=m.y,D=g.y,F=_<b?_<k?_:k:b<k?b:k,B=I<z?I<D?I:D:z<D?z:D,j=_>b?_>k?_:k:b>k?b:k,W=I>z?I>D?I:D:z>D?z:D,Y=Ip(F,B,e,n,o),ae=Ip(j,W,e,n,o),J=r.prevZ,ue=r.nextZ;J&&J.z>=Y&&ue&&ue.z<=ae;){if(J.x>=F&&J.x<=j&&J.y>=B&&J.y<=W&&J!==c&&J!==g&&Jo(_,I,b,z,k,D,J.x,J.y)&&mr(J.prev,J,J.next)>=0||(J=J.prevZ,ue.x>=F&&ue.x<=j&&ue.y>=B&&ue.y<=W&&ue!==c&&ue!==g&&Jo(_,I,b,z,k,D,ue.x,ue.y)&&mr(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;J&&J.z>=Y;){if(J.x>=F&&J.x<=j&&J.y>=B&&J.y<=W&&J!==c&&J!==g&&Jo(_,I,b,z,k,D,J.x,J.y)&&mr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ue&&ue.z<=ae;){if(ue.x>=F&&ue.x<=j&&ue.y>=B&&ue.y<=W&&ue!==c&&ue!==g&&Jo(_,I,b,z,k,D,ue.x,ue.y)&&mr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function W0(r,e,n){var o=r;do{var c=o.prev,m=o.next.next;!Sh(c,m)&&Ug(c,o,o.next,m)&&Pu(c,m)&&Pu(m,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(m.i/n|0),zu(o),zu(o.next),o=r=m),o=o.next}while(o!==r);return ro(o)}function X0(r,e,n,o,c,m){var g=r;do{for(var _=g.next.next;_!==g.prev;){if(g.i!==_.i&&e1(g,_)){var b=$g(g,_);return g=ro(g,g.next),b=ro(b,b.next),Cu(g,e,n,o,c,m,0),void Cu(b,e,n,o,c,m,0)}_=_.next}g=g.next}while(g!==r)}function K0(r,e){return r.x-e.x}function Y0(r,e){var n=function(c,m){var g,_=m,b=c.x,k=c.y,I=-1/0;do{if(k<=_.y&&k>=_.next.y&&_.next.y!==_.y){var z=_.x+(k-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(z<=b&&z>I&&(I=z,g=_.x<_.next.x?_:_.next,z===b))return g}_=_.next}while(_!==m);if(!g)return null;var D,F=g,B=g.x,j=g.y,W=1/0;_=g;do b>=_.x&&_.x>=B&&b!==_.x&&Jo(k<j?b:I,k,B,j,k<j?I:b,k,_.x,_.y)&&(D=Math.abs(k-_.y)/(b-_.x),Pu(_,c)&&(D<W||D===W&&(_.x>g.x||_.x===g.x&&Q0(g,_)))&&(g=_,W=D)),_=_.next;while(_!==F);return g}(r,e);if(!n)return e;var o=$g(n,r);return ro(o,o.next),ro(n,n.next)}function Q0(r,e){return mr(r.prev,r,e.prev)<0&&mr(e.next,r,r.next)<0}function Ip(r,e,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function J0(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Jo(r,e,n,o,c,m,g,_){return(c-g)*(e-_)>=(r-g)*(m-_)&&(r-g)*(o-_)>=(n-g)*(e-_)&&(n-g)*(m-_)>=(c-g)*(o-_)}function e1(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&Ug(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,e)&&(Pu(r,e)&&Pu(e,r)&&function(n,o){var c=n,m=!1,g=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&g<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,e)&&(mr(r.prev,r,e.prev)||mr(r,e.prev,e))||Sh(r,e)&&mr(r.prev,r,r.next)>0&&mr(e.prev,e,e.next)>0)}function mr(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Sh(r,e){return r.x===e.x&&r.y===e.y}function Ug(r,e,n,o){var c=kh(mr(r,e,n)),m=kh(mr(r,e,o)),g=kh(mr(n,o,r)),_=kh(mr(n,o,e));return c!==m&&g!==_||!(c!==0||!Th(r,n,e))||!(m!==0||!Th(r,o,e))||!(g!==0||!Th(n,r,o))||!(_!==0||!Th(n,e,o))}function Th(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function kh(r){return r>0?1:r<0?-1:0}function Pu(r,e){return mr(r.prev,r,r.next)<0?mr(r,e,r.next)>=0&&mr(r,r.prev,e)>=0:mr(r,e,r.prev)<0||mr(r,r.next,e)<0}function $g(r,e){var n=new Cp(r.i,r.x,r.y),o=new Cp(e.i,e.x,e.y),c=r.next,m=e.prev;return r.next=e,e.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function Zg(r,e,n,o){var c=new Cp(r,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function zu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cp(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pp(r,e,n,o){for(var c=0,m=e,g=n-o;m<n;m+=o)c+=(r[g]-r[m])*(r[m+1]+r[g+1]),g=m;return c}Ep.exports=bh,Ep.exports.default=bh,bh.deviation=function(r,e,n,o){var c=e&&e.length,m=Math.abs(Pp(r,0,c?e[0]*n:r.length,n));if(c)for(var g=0,_=e.length;g<_;g++)m-=Math.abs(Pp(r,e[g]*n,g<_-1?e[g+1]*n:r.length,n));var b=0;for(g=0;g<o.length;g+=3){var k=o[g]*n,I=o[g+1]*n,z=o[g+2]*n;b+=Math.abs((r[k]-r[z])*(r[I+1]-r[k+1])-(r[k]-r[I])*(r[z+1]-r[k+1]))}return m===0&&b===0?0:Math.abs((b-m)/m)},bh.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<r.length;c++){for(var m=0;m<r[c].length;m++)for(var g=0;g<e;g++)n.vertices.push(r[c][m][g]);c>0&&n.holes.push(o+=r[c-1].length)}return n};var qg=O(Ep.exports);function t1(r,e,n,o,c){Gg(r,e,n,o||r.length-1,c||r1)}function Gg(r,e,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=e-n+1,_=Math.log(m),b=.5*Math.exp(2*_/3),k=.5*Math.sqrt(_*b*(m-b)/m)*(g-m/2<0?-1:1);Gg(r,e,Math.max(n,Math.floor(e-g*b/m+k)),Math.min(o,Math.floor(e+(m-g)*b/m+k)),c)}var I=r[e],z=n,D=o;for(Mu(r,n,e),c(r[o],I)>0&&Mu(r,n,o);z<D;){for(Mu(r,z,D),z++,D--;c(r[z],I)<0;)z++;for(;c(r[D],I)>0;)D--}c(r[n],I)===0?Mu(r,n,D):Mu(r,++D,o),D<=e&&(n=D+1),e<=D&&(o=D-1)}}function Mu(r,e,n){var o=r[e];r[e]=r[n],r[n]=o}function r1(r,e){return r<e?-1:r>e?1:0}function zp(r,e){const n=r.length;if(n<=1)return[r];const o=[];let c,m;for(let g=0;g<n;g++){const _=Ti(r[g]);_!==0&&(r[g].area=Math.abs(_),m===void 0&&(m=_<0),m===_<0?(c&&o.push(c),c=[r[g]]):c.push(r[g]))}if(c&&o.push(c),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(t1(o[g],e,1,o[g].length-1,i1),o[g]=o[g].slice(0,e));return o}function i1(r,e){return e.area-r.area}function Mp(r,e,n){const o=n.patternDependencies;let c=!1;for(const m of e){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const _=g.constantOr(null);_&&(c=!0,o[_.to]=!0,o[_.from]=!0)}return c}function Ap(r,e,n,o,c){const m=c.patternDependencies;for(const g of e){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let b=_.evaluate({zoom:o-1},n,{},c.availableImages),k=_.evaluate({zoom:o},n,{},c.availableImages),I=_.evaluate({zoom:o+1},n,{},c.availableImages);b=b&&b.name?b.name:b,k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,m[b]=!0,m[k]=!0,m[I]=!0,n.patterns[g.id]={min:b,mid:k,max:I}}}return n}class Dp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xt,this.indexArray=new Or,this.indexArray2=new Sr,this.programConfigurations=new Nn(e.layers,e.zoom),this.segments=new Ht,this.segments2=new Ht,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Mp("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:b,index:k,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,D=to(_,z);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),D,o))continue;const F=m?c.evaluate(D,{},o,n.availableImages):void 0,B={id:b,properties:_.properties,type:_.type,sourceLayerIndex:I,index:k,geometry:z?D.geometry:eo(_),patterns:{},sortKey:F};g.push(B)}m&&g.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of g){const{geometry:b,index:k,sourceLayerIndex:I}=_;if(this.hasPattern){const z=Ap("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(_,b,k,o,{});n.featureIndex.insert(e[k].feature,b,k,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,q0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,m){for(const g of zp(n,500)){let _=0;for(const F of g)_+=F.length;const b=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),k=b.vertexLength,I=[],z=[];for(const F of g){if(F.length===0)continue;F!==g[0]&&z.push(I.length/2);const B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),j=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(j+F.length-1,j),I.push(F[0].x),I.push(F[0].y);for(let W=1;W<F.length;W++)this.layoutVertexArray.emplaceBack(F[W].x,F[W].y),this.indexArray2.emplaceBack(j+W-1,j+W),I.push(F[W].x),I.push(F[W].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}const D=qg(I,z);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(k+D[F],k+D[F+1],k+D[F+2]);b.vertexLength+=_,b.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}let Hg,Wg;$e("FillBucket",Dp,{omit:["layers","patternFeatures"]});var n1={get paint(){return Wg=Wg||new pr({"fill-antialias":new tt(ye.paint_fill["fill-antialias"]),"fill-opacity":new at(ye.paint_fill["fill-opacity"]),"fill-color":new at(ye.paint_fill["fill-color"]),"fill-outline-color":new at(ye.paint_fill["fill-outline-color"]),"fill-translate":new tt(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ya(ye.paint_fill["fill-pattern"])})},get layout(){return Hg=Hg||new pr({"fill-sort-key":new at(ye.layout_fill["fill-sort-key"])})}};class s1 extends Gi{constructor(e){super(e,n1)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Dp(e)}queryRadius(){return vh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,m,g,_){return Pg(xh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),c)}isTileClipped(){return!0}}const a1=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),o1=er([{name:"a_centroid",components:2,type:"Int16"}],4),{members:l1}=a1;var ca={},u1=ve,Xg=el;function el(r,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(c1,this,e)}function c1(r,e,n){r==1?e.id=n.readVarint():r==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[g]=_}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function h1(r){for(var e,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(e=r[c]).x)*(e.y+n.y);return o}el.types=["Unknown","Point","LineString","Polygon"],el.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,_=[];r.pos<n;){if(c<=0){var b=r.readVarint();o=7&b,c=b>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new u1(m,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},el.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,_=-1/0,b=1/0,k=-1/0;r.pos<e;){if(o<=0){var I=r.readVarint();n=7&I,o=I>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>_&&(_=c),(m+=r.readSVarint())<b&&(b=m),m>k&&(k=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,b,_,k]},el.prototype.toGeoJSON=function(r,e,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,_=this.extent*e,b=this.loadGeometry(),k=el.types[this.type];function I(F){for(var B=0;B<F.length;B++){var j=F[B];F[B]=[360*(j.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(o=0;o<b.length;o++)z[o]=b[o][0];I(b=z);break;case 2:for(o=0;o<b.length;o++)I(b[o]);break;case 3:for(b=function(F){var B=F.length;if(B<=1)return[F];for(var j,W,Y=[],ae=0;ae<B;ae++){var J=h1(F[ae]);J!==0&&(W===void 0&&(W=J<0),W===J<0?(j&&Y.push(j),j=[F[ae]]):j.push(F[ae]))}return j&&Y.push(j),Y}(b),o=0;o<b.length;o++)for(c=0;c<b[o].length;c++)I(b[o][c])}b.length===1?b=b[0]:k="Multi"+k;var D={type:"Feature",geometry:{type:k,coordinates:b},properties:this.properties};return"id"in this&&(D.id=this.id),D};var d1=Xg,Kg=Yg;function Yg(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(p1,this,e),this.length=this._features.length}function p1(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}Yg.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new d1(this._pbf,e,this.extent,this._keys,this._values)};var f1=Kg;function m1(r,e,n){if(r===3){var o=new f1(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}ca.VectorTile=function(r,e){this.layers=r.readFields(m1,{},e)},ca.VectorTileFeature=Xg,ca.VectorTileLayer=Kg;const g1=ca.VectorTileFeature.types,Lp=Math.pow(2,13);function Au(r,e,n,o,c,m,g,_){r.emplaceBack(e,n,2*Math.floor(o*Lp)+g,c*Lp*2,m*Lp*2,Math.round(_))}class Rp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.centroidVertexArray=new Pe,this.indexArray=new Or,this.programConfigurations=new Nn(e.layers,e.zoom),this.segments=new Ht,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=Mp("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:_}of e){const b=this.layers[0]._featureFilter.needGeometry,k=to(c,b);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),k,o))continue;const I={id:m,sourceLayerIndex:_,index:g,geometry:b?k.geometry:eo(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Ap("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,g,o,{}),n.featureIndex.insert(c,I.geometry,g,_,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,o1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,m){const g={x:0,y:0,vertexCount:0};for(const _ of zp(n,500)){let b=0;for(const B of _)b+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of _){if(B.length===0||_1(B))continue;let j=0;for(let W=0;W<B.length;W++){const Y=B[W];if(W>=1){const ae=B[W-1];if(!y1(Y,ae)){k.vertexLength+4>Ht.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const J=Y.sub(ae)._perp()._unit(),ue=ae.dist(Y);j+ue>32768&&(j=0),Au(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,0,j),Au(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,1,j),g.x+=2*Y.x,g.y+=2*Y.y,g.vertexCount+=2,j+=ue,Au(this.layoutVertexArray,ae.x,ae.y,J.x,J.y,0,0,j),Au(this.layoutVertexArray,ae.x,ae.y,J.x,J.y,0,1,j),g.x+=2*ae.x,g.y+=2*ae.y,g.vertexCount+=2;const de=k.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+b>Ht.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),g1[e.type]!=="Polygon")continue;const I=[],z=[],D=k.vertexLength;for(const B of _)if(B.length!==0){B!==_[0]&&z.push(I.length/2);for(let j=0;j<B.length;j++){const W=B[j];Au(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),g.x+=W.x,g.y+=W.y,g.vertexCount+=1,I.push(W.x),I.push(W.y)}}const F=qg(I,z);for(let B=0;B<F.length;B+=3)this.indexArray.emplaceBack(D+F[B],D+F[B+2],D+F[B+1]);k.primitiveLength+=F.length/3,k.vertexLength+=b}for(let _=0;_<g.vertexCount;_++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}function y1(r,e){return r.x===e.x&&(r.x<0||r.x>xr)||r.y===e.y&&(r.y<0||r.y>xr)}function _1(r){return r.every(e=>e.x<0)||r.every(e=>e.x>xr)||r.every(e=>e.y<0)||r.every(e=>e.y>xr)}let Qg;$e("FillExtrusionBucket",Rp,{omit:["layers","features"]});var v1={get paint(){return Qg=Qg||new pr({"fill-extrusion-opacity":new tt(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ya(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class x1 extends Gi{constructor(e){super(e,v1)}createBucket(e){return new Rp(e)}queryRadius(){return vh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,m,g,_,b){const k=xh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),I=this.paint.get("fill-extrusion-height").evaluate(n,o),z=this.paint.get("fill-extrusion-base").evaluate(n,o),D=function(B,j,W,Y){const ae=[];for(const J of B){const ue=[J.x,J.y,0,1];wh(ue,ue,j),ae.push(new oe(ue[0]/ue[3],ue[1]/ue[3]))}return ae}(k,b),F=function(B,j,W,Y){const ae=[],J=[],ue=Y[8]*j,de=Y[9]*j,be=Y[10]*j,je=Y[11]*j,Ye=Y[8]*W,Ne=Y[9]*W,Oe=Y[10]*W,Me=Y[11]*W;for(const qe of B){const Le=[],Ie=[];for(const nt of qe){const et=nt.x,_t=nt.y,Wt=Y[0]*et+Y[4]*_t+Y[12],Kt=Y[1]*et+Y[5]*_t+Y[13],Er=Y[2]*et+Y[6]*_t+Y[14],Wi=Y[3]*et+Y[7]*_t+Y[15],gi=Er+be,wr=Wi+je,Vr=Wt+Ye,Wr=Kt+Ne,yi=Er+Oe,_i=Wi+Me,Ir=new oe((Wt+ue)/wr,(Kt+de)/wr);Ir.z=gi/wr,Le.push(Ir);const Cr=new oe(Vr/_i,Wr/_i);Cr.z=yi/_i,Ie.push(Cr)}ae.push(Le),J.push(Ie)}return[ae,J]}(c,z,I,b);return function(B,j,W){let Y=1/0;Pg(W,j)&&(Y=Jg(W,j[0]));for(let ae=0;ae<j.length;ae++){const J=j[ae],ue=B[ae];for(let de=0;de<J.length-1;de++){const be=J[de],je=[be,J[de+1],ue[de+1],ue[de],be];Cg(W,je)&&(Y=Math.min(Y,Jg(W,je)))}}return Y!==1/0&&Y}(F[0],F[1],D)}}function Du(r,e){return r.x*e.x+r.y*e.y}function Jg(r,e){if(r.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const m=e[n],g=r[0],_=c.sub(o),b=m.sub(o),k=g.sub(o),I=Du(_,_),z=Du(_,b),D=Du(b,b),F=Du(k,_),B=Du(k,b),j=I*D-z*z,W=(D*F-z*B)/j,Y=(I*B-z*F)/j,ae=o.z*(1-W-Y)+c.z*W+m.z*Y;if(isFinite(ae))return ae}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const w1=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:b1}=w1,S1=er([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:T1}=S1,k1=ca.VectorTileFeature.types,E1=Math.cos(Math.PI/180*37.5),ey=Math.pow(2,14)/.5;class Fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ot,this.layoutVertexArray2=new Qe,this.indexArray=new Or,this.programConfigurations=new Nn(e.layers,e.zoom),this.segments=new Ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Mp("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:b,index:k,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,D=to(_,z);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),D,o))continue;const F=m?c.evaluate(D,{},o):void 0,B={id:b,properties:_.properties,type:_.type,sourceLayerIndex:I,index:k,geometry:z?D.geometry:eo(_),patterns:{},sortKey:F};g.push(B)}m&&g.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of g){const{geometry:b,index:k,sourceLayerIndex:I}=_;if(this.hasPattern){const z=Ap("line",this.layers,_,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(_,b,k,o,{});n.featureIndex.insert(e[k].feature,b,k,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,T1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(e,{}),b=g.get("line-cap"),k=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of n)this.addLine(z,e,_,b,k,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}addLine(e,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=k1[n.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let k=0;for(;k<b-1&&e[k].equals(e[k+1]);)k++;if(b<(_?3:2))return;o==="bevel"&&(m=1.05);const I=this.overscaling<=16?15*xr/(512*this.overscaling):0,z=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let D,F,B,j,W;this.e1=this.e2=-1,_&&(D=e[b-2],W=e[k].sub(D)._unit()._perp());for(let Y=k;Y<b;Y++){if(B=Y===b-1?_?e[k+1]:void 0:e[Y+1],B&&e[Y].equals(B))continue;W&&(j=W),D&&(F=D),D=e[Y],W=B?B.sub(D)._unit()._perp():j,j=j||W;let ae=j.add(W);ae.x===0&&ae.y===0||ae._unit();const J=j.x*W.x+j.y*W.y,ue=ae.x*W.x+ae.y*W.y,de=ue!==0?1/ue:1/0,be=2*Math.sqrt(2-2*ue),je=ue<E1&&F&&B,Ye=j.x*W.y-j.y*W.x>0;if(je&&Y>k){const Me=D.dist(F);if(Me>2*I){const qe=D.sub(D.sub(F)._mult(I/Me)._round());this.updateDistance(F,qe),this.addCurrentVertex(qe,j,0,0,z),F=qe}}const Ne=F&&B;let Oe=Ne?o:_?"butt":c;if(Ne&&Oe==="round"&&(de<g?Oe="miter":de<=2&&(Oe="fakeround")),Oe==="miter"&&de>m&&(Oe="bevel"),Oe==="bevel"&&(de>2&&(Oe="flipbevel"),de<m&&(Oe="miter")),F&&this.updateDistance(F,D),Oe==="miter")ae._mult(de),this.addCurrentVertex(D,ae,0,0,z);else if(Oe==="flipbevel"){if(de>100)ae=W.mult(-1);else{const Me=de*j.add(W).mag()/j.sub(W).mag();ae._perp()._mult(Me*(Ye?-1:1))}this.addCurrentVertex(D,ae,0,0,z),this.addCurrentVertex(D,ae.mult(-1),0,0,z)}else if(Oe==="bevel"||Oe==="fakeround"){const Me=-Math.sqrt(de*de-1),qe=Ye?Me:0,Le=Ye?0:Me;if(F&&this.addCurrentVertex(D,j,qe,Le,z),Oe==="fakeround"){const Ie=Math.round(180*be/Math.PI/20);for(let nt=1;nt<Ie;nt++){let et=nt/Ie;if(et!==.5){const Wt=et-.5;et+=et*Wt*(et-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Wt*Wt+(.848013+J*(.215638*J-1.06021)))}const _t=W.sub(j)._mult(et)._add(j)._unit()._mult(Ye?-1:1);this.addHalfVertex(D,_t.x,_t.y,!1,Ye,0,z)}}B&&this.addCurrentVertex(D,W,-qe,-Le,z)}else if(Oe==="butt")this.addCurrentVertex(D,ae,0,0,z);else if(Oe==="square"){const Me=F?1:-1;this.addCurrentVertex(D,ae,Me,Me,z)}else Oe==="round"&&(F&&(this.addCurrentVertex(D,j,0,0,z),this.addCurrentVertex(D,j,1,1,z,!0)),B&&(this.addCurrentVertex(D,W,-1,-1,z,!0),this.addCurrentVertex(D,W,0,0,z)));if(je&&Y<b-1){const Me=D.dist(B);if(Me>2*I){const qe=D.add(B.sub(D)._mult(I/Me)._round());this.updateDistance(D,qe),this.addCurrentVertex(qe,W,0,0,z),D=qe}}}}addCurrentVertex(e,n,o,c,m,g=!1){const _=n.y*c-n.x,b=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(e,_,b,g,!0,-c,m),this.distance>ey/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,m,g))}addHalfVertex({x:e,y:n},o,c,m,g,_,b){const k=.5*(this.lineClips?this.scaledDistance*(ey-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let ty,ry;$e("LineBucket",Fp,{omit:["layers","patternFeatures"]});var iy={get paint(){return ry=ry||new pr({"line-opacity":new at(ye.paint_line["line-opacity"]),"line-color":new at(ye.paint_line["line-color"]),"line-translate":new tt(ye.paint_line["line-translate"]),"line-translate-anchor":new tt(ye.paint_line["line-translate-anchor"]),"line-width":new at(ye.paint_line["line-width"]),"line-gap-width":new at(ye.paint_line["line-gap-width"]),"line-offset":new at(ye.paint_line["line-offset"]),"line-blur":new at(ye.paint_line["line-blur"]),"line-dasharray":new gu(ye.paint_line["line-dasharray"]),"line-pattern":new Ya(ye.paint_line["line-pattern"]),"line-gradient":new yu(ye.paint_line["line-gradient"])})},get layout(){return ty=ty||new pr({"line-cap":new tt(ye.layout_line["line-cap"]),"line-join":new at(ye.layout_line["line-join"]),"line-miter-limit":new tt(ye.layout_line["line-miter-limit"]),"line-round-limit":new tt(ye.layout_line["line-round-limit"]),"line-sort-key":new at(ye.layout_line["line-sort-key"])})}};class I1 extends at{possiblyEvaluate(e,n){return n=new Gt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=Ze({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let Eh;class C1 extends Gi{constructor(e){super(e,iy),this.gradientVersion=0,Eh||(Eh=new I1(iy.paint.properties["line-width"].specification),Eh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ns,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Eh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Fp(e)}queryRadius(e){const n=e,o=ny(ku("line-width",this,n),ku("line-gap-width",this,n)),c=ku("line-offset",this,n);return o/2+Math.abs(c)+vh(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,m,g,_){const b=xh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),k=_/2*ny(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),I=this.paint.get("line-offset").evaluate(n,o);return I&&(c=function(z,D){const F=[];for(let B=0;B<z.length;B++){const j=z[B],W=[];for(let Y=0;Y<j.length;Y++){const ae=j[Y-1],J=j[Y],ue=j[Y+1],de=Y===0?new oe(0,0):J.sub(ae)._unit()._perp(),be=Y===j.length-1?new oe(0,0):ue.sub(J)._unit()._perp(),je=de._add(be)._unit(),Ye=je.x*be.x+je.y*be.y;Ye!==0&&je._mult(1/Ye),W.push(je._mult(D)._add(J))}F.push(W)}return F}(c,I*_)),function(z,D,F){for(let B=0;B<D.length;B++){const j=D[B];if(z.length>=3){for(let W=0;W<j.length;W++)if(Yo(z,j[W]))return!0}if(L0(z,j,F))return!0}return!1}(b,c,k)}isTileClipped(){return!0}}function ny(r,e){return e>0?e+2*r:r}const P1=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),z1=er([{name:"a_projected_pos",components:3,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const M1=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);er([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sy=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),A1=er([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function D1(r,e,n){return r.sections.forEach(o=>{o.text=function(c,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Pi.applyArabicShaping&&(c=Pi.applyArabicShaping(c)),c}(o.text,e,n)}),r}er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),er([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Lu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var kr=24,ay=Nt,oy=function(r,e,n,o,c){var m,g,_=8*c-o-1,b=(1<<_)-1,k=b>>1,I=-7,z=c-1,D=-1,F=r[e+z];for(z+=D,m=F&(1<<-I)-1,F>>=-I,I+=_;I>0;m=256*m+r[e+z],z+=D,I-=8);for(g=m&(1<<-I)-1,m>>=-I,I+=o;I>0;g=256*g+r[e+z],z+=D,I-=8);if(m===0)m=1-k;else{if(m===b)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,o),m-=k}return(F?-1:1)*g*Math.pow(2,m-o)},ly=function(r,e,n,o,c,m){var g,_,b,k=8*m-c-1,I=(1<<k)-1,z=I>>1,D=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,B=1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,g=I):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+z>=1?D/b:D*Math.pow(2,1-z))*b>=2&&(g++,b/=2),g+z>=I?(_=0,g=I):g+z>=1?(_=(e*b-1)*Math.pow(2,c),g+=z):(_=e*Math.pow(2,z-1)*Math.pow(2,c),g=0));c>=8;r[n+F]=255&_,F+=B,_/=256,c-=8);for(g=g<<c|_,k+=c;k>0;r[n+F]=255&g,F+=B,g/=256,k-=8);r[n+F-B]|=128*j};function Nt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Nt.Varint=0,Nt.Fixed64=1,Nt.Bytes=2,Nt.Fixed32=5;var Bp=4294967296,uy=1/Bp,cy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ds(r){return r.type===Nt.Bytes?r.readVarint()+r.pos:r.pos+1}function tl(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function hy(r,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function L1(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function R1(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function F1(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function B1(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function O1(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function N1(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function V1(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function j1(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function U1(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function Ih(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function rl(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function dy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Nt.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,e,this),this.pos===m&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Ih(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=dy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ih(this.buf,this.pos)+Ih(this.buf,this.pos+4)*Bp;return this.pos+=8,r},readSFixed64:function(){var r=Ih(this.buf,this.pos)+dy(this.buf,this.pos+4)*Bp;return this.pos+=8,r},readFloat:function(){var r=oy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=oy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,m,g){var _,b,k=g.buf;if(_=(112&(b=k[g.pos++]))>>4,b<128||(_|=(127&(b=k[g.pos++]))<<3,b<128)||(_|=(127&(b=k[g.pos++]))<<10,b<128)||(_|=(127&(b=k[g.pos++]))<<17,b<128)||(_|=(127&(b=k[g.pos++]))<<24,b<128)||(_|=(1&(b=k[g.pos++]))<<31,b<128))return tl(c,_,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&cy?function(n,o,c){return cy.decode(n.subarray(o,c))}(this.buf,e,r):function(n,o,c){for(var m="",g=o;g<c;){var _,b,k,I=n[g],z=null,D=I>239?4:I>223?3:I>191?2:1;if(g+D>c)break;D===1?I<128&&(z=I):D===2?(192&(_=n[g+1]))==128&&(z=(31&I)<<6|63&_)<=127&&(z=null):D===3?(b=n[g+2],(192&(_=n[g+1]))==128&&(192&b)==128&&((z=(15&I)<<12|(63&_)<<6|63&b)<=2047||z>=55296&&z<=57343)&&(z=null)):D===4&&(b=n[g+2],k=n[g+3],(192&(_=n[g+1]))==128&&(192&b)==128&&(192&k)==128&&((z=(15&I)<<18|(63&_)<<12|(63&b)<<6|63&k)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,D=1):z>65535&&(z-=65536,m+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),m+=String.fromCharCode(z),g+=D}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Nt.Bytes)return r.push(this.readVarint(e));var n=Ds(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSVarint());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Nt.Bytes)return r.push(this.readBoolean());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFloat());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Nt.Bytes)return r.push(this.readDouble());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFixed32());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSFixed32());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFixed64());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSFixed64());var e=Ds(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Nt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nt.Fixed32)this.pos+=4;else{if(e!==Nt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),rl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),rl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),rl(this.buf,-1&r,this.pos),rl(this.buf,Math.floor(r*uy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),rl(this.buf,-1&r,this.pos),rl(this.buf,Math.floor(r*uy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,c,m){for(var g,_,b=0;b<c.length;b++){if((g=c.charCodeAt(b))>55295&&g<57344){if(!_){g>56319||b+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):_=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(o[m++]=239,o[m++]=191,o[m++]=189,_=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&hy(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),ly(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),ly(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var o=this.pos-n;o>=128&&hy(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,n){this.writeTag(r,Nt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,L1,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,R1,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,O1,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,F1,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,B1,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,N1,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,V1,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,j1,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,U1,e)},writeBytesField:function(r,e){this.writeTag(r,Nt.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Nt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Nt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Nt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Nt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Nt.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Nt.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Nt.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Nt.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Nt.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Op=O(ay);const Np=3;function $1(r,e,n){r===1&&n.readMessage(Z1,e)}function Z1(r,e,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:_,top:b,advance:k}=n.readMessage(q1,{});e.push({id:o,bitmap:new Iu({width:m+2*Np,height:g+2*Np},c),metrics:{width:m,height:g,left:_,top:b,advance:k}})}}function q1(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const py=Np;function fy(r){let e=0,n=0;for(const g of r)e+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,_)=>_.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let _=o.length-1;_>=0;_--){const b=o[_];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===b.w&&g.h===b.h){const k=o.pop();_<o.length&&(o[_]=k)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(o.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}const Mi=1;class Vp{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o}get tl(){return[this.paddedRect.x+Mi,this.paddedRect.y+Mi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Mi,this.paddedRect.y+this.paddedRect.h-Mi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Mi)/this.pixelRatio,(this.paddedRect.h-2*Mi)/this.pixelRatio]}}class my{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(n,c,m);const{w:g,h:_}=fy(m),b=new nn({width:g||1,height:_||1});for(const k in e){const I=e[k],z=o[k].paddedRect;nn.copy(I.data,b,{x:0,y:0},{x:z.x+Mi,y:z.y+Mi},I.data)}for(const k in n){const I=n[k],z=c[k].paddedRect,D=z.x+Mi,F=z.y+Mi,B=I.data.width,j=I.data.height;nn.copy(I.data,b,{x:0,y:0},{x:D,y:F},I.data),nn.copy(I.data,b,{x:0,y:j-1},{x:D,y:F-1},{width:B,height:1}),nn.copy(I.data,b,{x:0,y:0},{x:D,y:F+j},{width:B,height:1}),nn.copy(I.data,b,{x:B-1,y:0},{x:D-1,y:F},{width:1,height:j}),nn.copy(I.data,b,{x:0,y:0},{x:D+B,y:F},{width:1,height:j})}this.image=b,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const m=e[c],g={x:0,y:0,w:m.data.width+2*Mi,h:m.data.height+2*Mi};o.push(g),n[c]=new Vp(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,m]=e.tl;o.update(n.data,void 0,{x:c,y:m})}}var ha;$e("ImagePosition",Vp),$e("ImageAtlas",my),l.ai=void 0,(ha=l.ai||(l.ai={}))[ha.none=0]="none",ha[ha.horizontal=1]="horizontal",ha[ha.vertical=2]="vertical",ha[ha.horizontalOnly=3]="horizontalOnly";const Ru=-17;class Fu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Fu;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Fu;return n.imageName=e,n}}class il{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new il;for(let c=0;c<e.sections.length;c++){const m=e.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,m=e.charCodeAt(o-1)||null;n+=c&&lh(c)&&!Lu[e[o+1]]||m&&lh(m)&&!Lu[e[o-1]]||!Lu[e[o]]?e[o]:Lu[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Ph[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Ph[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new il;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Fu.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Dr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Fu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ch(r,e,n,o,c,m,g,_,b,k,I,z,D,F,B,j){const W=il.fromFeature(r,c);let Y;z===l.ai.vertical&&W.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:J}=Pi;if(ae&&W.sections.length===1){Y=[];const be=ae(W.toString(),jp(W,k,m,e,o,F,B));for(const je of be){const Ye=new il;Ye.text=je,Ye.sections=W.sections;for(let Ne=0;Ne<je.length;Ne++)Ye.sectionIndex.push(0);Y.push(Ye)}}else if(J){Y=[];const be=J(W.text,W.sectionIndex,jp(W,k,m,e,o,F,B));for(const je of be){const Ye=new il;Ye.text=je[0],Ye.sectionIndex=je[1],Ye.sections=W.sections,Y.push(Ye)}}else Y=function(be,je){const Ye=[],Ne=be.text;let Oe=0;for(const Me of je)Ye.push(be.substring(Oe,Me)),Oe=Me;return Oe<Ne.length&&Ye.push(be.substring(Oe,Ne.length)),Ye}(W,jp(W,k,m,e,o,F,B));const ue=[],de={positionedLines:ue,text:W.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(be,je,Ye,Ne,Oe,Me,qe,Le,Ie,nt,et,_t){let Wt=0,Kt=Ru,Er=0,Wi=0;const gi=Le==="right"?1:Le==="left"?0:.5;let wr=0;for(const Ir of Oe){Ir.trim();const Cr=Ir.getMaxScale(),ri=(Cr-1)*kr,vi={positionedGlyphs:[],lineOffset:0};be.positionedLines[wr]=vi;const ii=vi.positionedGlyphs;let Ai=0;if(!Ir.length()){Kt+=Me,++wr;continue}for(let Pr=0;Pr<Ir.length();Pr++){const bt=Ir.getSection(Pr),ni=Ir.getSectionIndex(Pr),Xr=Ir.getCharCode(Pr);let zr=0,Sn=null,Vn=null,jn=null,Ls=kr;const Tn=!(Ie===l.ai.horizontal||!et&&!lu(Xr)||et&&(Ph[Xr]||(Vr=Xr,Ve.Arabic(Vr)||Ve["Arabic Supplement"](Vr)||Ve["Arabic Extended-A"](Vr)||Ve["Arabic Presentation Forms-A"](Vr)||Ve["Arabic Presentation Forms-B"](Vr))));if(bt.imageName){const an=Ne[bt.imageName];if(!an)continue;jn=bt.imageName,be.iconsInText=be.iconsInText||!0,Vn=an.paddedRect;const Li=an.displaySize;bt.scale=bt.scale*kr/_t,Sn={width:Li[0],height:Li[1],left:Mi,top:-py,advance:Tn?Li[1]:Li[0]},zr=ri+(kr-Li[1]*bt.scale),Ls=Sn.advance;const Rs=Tn?Li[0]*bt.scale-kr*Cr:Li[1]*bt.scale-kr*Cr;Rs>0&&Rs>Ai&&(Ai=Rs)}else{const an=Ye[bt.fontStack],Li=an&&an[Xr];if(Li&&Li.rect)Vn=Li.rect,Sn=Li.metrics;else{const Rs=je[bt.fontStack],ju=Rs&&Rs[Xr];if(!ju)continue;Sn=ju.metrics}zr=(Cr-bt.scale)*kr}Tn?(be.verticalizable=!0,ii.push({glyph:Xr,imageName:jn,x:Wt,y:Kt+zr,vertical:Tn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:ni,metrics:Sn,rect:Vn}),Wt+=Ls*bt.scale+nt):(ii.push({glyph:Xr,imageName:jn,x:Wt,y:Kt+zr,vertical:Tn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:ni,metrics:Sn,rect:Vn}),Wt+=Sn.advance*bt.scale+nt)}ii.length!==0&&(Er=Math.max(Wt-nt,Er),W1(ii,0,ii.length-1,gi,Ai)),Wt=0;const Di=Me*Cr+Ai;vi.lineOffset=Math.max(Ai,ri),Kt+=Di,Wi=Math.max(Di,Wi),++wr}var Vr;const Wr=Kt-Ru,{horizontalAlign:yi,verticalAlign:_i}=Up(qe);(function(Ir,Cr,ri,vi,ii,Ai,Di,Pr,bt){const ni=(Cr-ri)*ii;let Xr=0;Xr=Ai!==Di?-Pr*vi-Ru:(-vi*bt+.5)*Di;for(const zr of Ir)for(const Sn of zr.positionedGlyphs)Sn.x+=ni,Sn.y+=Xr})(be.positionedLines,gi,yi,_i,Er,Wi,Me,Wr,Oe.length),be.top+=-_i*Wr,be.bottom=be.top+Wr,be.left+=-yi*Er,be.right=be.left+Er}(de,e,n,o,Y,g,_,b,z,k,D,j),!function(be){for(const je of be)if(je.positionedGlyphs.length!==0)return!1;return!0}(ue)&&de}const Ph={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gy(r,e,n,o,c,m){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*kr/m+c:0}{const g=n[e.fontStack],_=g&&g[r];return _?_.metrics.advance*e.scale+c:0}}function yy(r,e,n,o){const c=Math.pow(r-e,2);return o?r<e?c/2:2*c:c+Math.abs(n)*n}function H1(r,e,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function _y(r,e,n,o,c,m){let g=null,_=yy(e,n,c,m);for(const b of o){const k=yy(e-b.x,n,c,m)+b.badness;k<=_&&(g=b,_=k)}return{index:r,x:e,priorBreak:g,badness:_}}function vy(r){return r?vy(r.priorBreak).concat(r.index):[]}function jp(r,e,n,o,c,m,g){if(m!=="point")return[];if(!r)return[];const _=[],b=function(D,F,B,j,W,Y){let ae=0;for(let J=0;J<D.length();J++){const ue=D.getSection(J);ae+=gy(D.getCharCode(J),ue,j,W,F,Y)}return ae/Math.max(1,Math.ceil(ae/B))}(r,e,n,o,c,g),k=r.text.indexOf("")>=0;let I=0;for(let D=0;D<r.length();D++){const F=r.getSection(D),B=r.getCharCode(D);if(Ph[B]||(I+=gy(B,F,o,c,e,g)),D<r.length()-1){const j=!((z=B)<11904||!(Ve["Bopomofo Extended"](z)||Ve.Bopomofo(z)||Ve["CJK Compatibility Forms"](z)||Ve["CJK Compatibility Ideographs"](z)||Ve["CJK Compatibility"](z)||Ve["CJK Radicals Supplement"](z)||Ve["CJK Strokes"](z)||Ve["CJK Symbols and Punctuation"](z)||Ve["CJK Unified Ideographs Extension A"](z)||Ve["CJK Unified Ideographs"](z)||Ve["Enclosed CJK Letters and Months"](z)||Ve["Halfwidth and Fullwidth Forms"](z)||Ve.Hiragana(z)||Ve["Ideographic Description Characters"](z)||Ve["Kangxi Radicals"](z)||Ve["Katakana Phonetic Extensions"](z)||Ve.Katakana(z)||Ve["Vertical Forms"](z)||Ve["Yi Radicals"](z)||Ve["Yi Syllables"](z)));(G1[B]||j||F.imageName)&&_.push(_y(D+1,I,b,_,H1(B,r.getCharCode(D+1),j&&k),!1))}}var z;return vy(_y(r.length(),I,b,_,0,!0))}function Up(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function W1(r,e,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let _=e;_<=n;_++)r[_].x-=g,r[_].y+=c}function X1(r,e,n){const{horizontalAlign:o,verticalAlign:c}=Up(n),m=e[0]-r.displaySize[0]*o,g=e[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function xy(r,e,n,o,c,m){const g=r.image;let _;if(g.content){const W=g.content,Y=g.pixelRatio||1;_=[W[0]/Y,W[1]/Y,g.displaySize[0]-W[2]/Y,g.displaySize[1]-W[3]/Y]}const b=e.left*m,k=e.right*m;let I,z,D,F;n==="width"||n==="both"?(F=c[0]+b-o[3],z=c[0]+k+o[1]):(F=c[0]+(b+k-g.displaySize[0])/2,z=F+g.displaySize[0]);const B=e.top*m,j=e.bottom*m;return n==="height"||n==="both"?(I=c[1]+B-o[0],D=c[1]+j+o[2]):(I=c[1]+(B+j-g.displaySize[1])/2,D=I+g.displaySize[1]),{image:g,top:I,right:z,bottom:D,left:F,collisionPadding:_}}const Bu=255,cs=128,da=Bu*cs;function wy(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Gt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const _=o[m],b=o[g];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:b,minSize:n.evaluate(new Gt(_)),maxSize:n.evaluate(new Gt(b)),interpolationType:c}}}function $p(r,e,n){let o="never";const c=r.get(e);return c?o=c:r.get(n)&&(o="always"),o}const K1=ca.VectorTileFeature.types,Y1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zh(r,e,n,o,c,m,g,_,b,k,I,z,D){const F=_?Math.min(da,Math.round(_[0])):0,B=_?Math.min(da,Math.round(_[1])):0;r.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),m,g,(F<<1)+(b?1:0),B,16*k,16*I,256*z,256*D)}function Zp(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function Q1(r){for(const e of r.sections)if(gp(e.text))return!0;return!1}class qp{constructor(e){this.layoutVertexArray=new vt,this.indexArray=new Or,this.programConfigurations=e,this.segments=new Ht,this.dynamicLayoutVertexArray=new ft,this.opacityVertexArray=new wt,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,z1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Y1,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",qp);class Gp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ht,this.collisionVertexArray=new Zt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,M1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",Gp);class nl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sp([]),this.placementViewportMatrix=Sp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wy(this.zoom,n["text-size"]),this.iconSizeData=wy(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=$p(o,"text-overlap","text-allow-overlap")!=="never"||$p(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>l.ai[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new qp(new Nn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new qp(new Nn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ne,this.lineVertexArray=new pe,this.symbolInstances=new K,this.textAnchorOffsets=new we}calculateGlyphDependencies(e,n,o,c,m){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,(o||c)&&m){const _=Lu[e.charAt(g)];_&&(n[_.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),_=m.get("text-field"),b=m.get("icon-image"),k=(_.value.kind!=="constant"||_.value.value instanceof qr&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!k&&!I)return;const D=n.iconDependencies,F=n.glyphDependencies,B=n.availableImages,j=new Gt(this.zoom);for(const{feature:W,id:Y,index:ae,sourceLayerIndex:J}of e){const ue=c._featureFilter.needGeometry,de=to(W,ue);if(!c._featureFilter.filter(j,de,o))continue;let be,je;if(ue||(de.geometry=eo(W)),k){const Ne=c.getValueAndResolveTokens("text-field",de,o,B),Oe=qr.factory(Ne);Q1(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||fu()==="unavailable"||this.hasRTLText&&Pi.isParsed())&&(be=D1(Oe,c,de))}if(I){const Ne=c.getValueAndResolveTokens("icon-image",de,o,B);je=Ne instanceof Br?Ne:Br.fromString(Ne)}if(!be&&!je)continue;const Ye=this.sortFeaturesByKey?z.evaluate(de,{},o):void 0;if(this.features.push({id:Y,text:be,icon:je,index:ae,sourceLayerIndex:J,geometry:de.geometry,properties:W.properties,type:K1[W.type],sortKey:Ye}),je&&(D[je.name]=!0),be){const Ne=g.evaluate(de,{},o).join(","),Oe=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const Me of be.sections)if(Me.image)D[Me.image.name]=!0;else{const qe=au(be.toString()),Le=Me.fontStack||Ne,Ie=F[Le]=F[Le]||{};this.calculateGlyphDependencies(Me.text,Ie,Oe,this.allowVerticalPlacement,qe)}}}m.get("symbol-placement")==="line"&&(this.features=function(W){const Y={},ae={},J=[];let ue=0;function de(Ne){J.push(W[Ne]),ue++}function be(Ne,Oe,Me){const qe=ae[Ne];return delete ae[Ne],ae[Oe]=qe,J[qe].geometry[0].pop(),J[qe].geometry[0]=J[qe].geometry[0].concat(Me[0]),qe}function je(Ne,Oe,Me){const qe=Y[Oe];return delete Y[Oe],Y[Ne]=qe,J[qe].geometry[0].shift(),J[qe].geometry[0]=Me[0].concat(J[qe].geometry[0]),qe}function Ye(Ne,Oe,Me){const qe=Me?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ne}:${qe.x}:${qe.y}`}for(let Ne=0;Ne<W.length;Ne++){const Oe=W[Ne],Me=Oe.geometry,qe=Oe.text?Oe.text.toString():null;if(!qe){de(Ne);continue}const Le=Ye(qe,Me),Ie=Ye(qe,Me,!0);if(Le in ae&&Ie in Y&&ae[Le]!==Y[Ie]){const nt=je(Le,Ie,Me),et=be(Le,Ie,J[nt].geometry);delete Y[Le],delete ae[Ie],ae[Ye(qe,J[et].geometry,!0)]=et,J[nt].geometry=null}else Le in ae?be(Le,Ie,Me):Ie in Y?je(Le,Ie,Me):(de(Ne),Y[Le]=ue-1,ae[Ie]=ue-1)}return J.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Y)=>W.sortKey-Y.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const g={};for(let _=e.segment+1;_<n.length;_++)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:c},_<n.length-1&&(c+=n[_+1].dist(n[_]));for(let _=e.segment||0;_>=0;_--)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=n[_-1].dist(n[_]));for(let _=0;_<n.length;_++){const b=g[_];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,m,g,_,b,k,I,z,D){const F=e.indexArray,B=e.layoutVertexArray,j=e.segments.prepareSegment(4*n.length,B,F,this.canOverlap?g.sortKey:void 0),W=this.glyphOffsetArray.length,Y=j.vertexLength,ae=this.allowVerticalPlacement&&_===l.ai.vertical?Math.PI/2:0,J=g.text&&g.text.sections;for(let ue=0;ue<n.length;ue++){const{tl:de,tr:be,bl:je,br:Ye,tex:Ne,pixelOffsetTL:Oe,pixelOffsetBR:Me,minFontScaleX:qe,minFontScaleY:Le,glyphOffset:Ie,isSDF:nt,sectionIndex:et}=n[ue],_t=j.vertexLength,Wt=Ie[1];zh(B,b.x,b.y,de.x,Wt+de.y,Ne.x,Ne.y,o,nt,Oe.x,Oe.y,qe,Le),zh(B,b.x,b.y,be.x,Wt+be.y,Ne.x+Ne.w,Ne.y,o,nt,Me.x,Oe.y,qe,Le),zh(B,b.x,b.y,je.x,Wt+je.y,Ne.x,Ne.y+Ne.h,o,nt,Oe.x,Me.y,qe,Le),zh(B,b.x,b.y,Ye.x,Wt+Ye.y,Ne.x+Ne.w,Ne.y+Ne.h,o,nt,Me.x,Me.y,qe,Le),Zp(e.dynamicLayoutVertexArray,b,ae),F.emplaceBack(_t,_t+1,_t+2),F.emplaceBack(_t+1,_t+2,_t+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ie[0]),ue!==n.length-1&&et===n[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,g,g.index,{},D,J&&J[et])}e.placedSymbolArray.emplaceBack(b.x,b.y,W,this.glyphOffsetArray.length-W,Y,k,I,b.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,z)}_addCollisionDebugVertex(e,n,o,c,m,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,c,m,g,_){const b=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=b.vertexLength,I=m.layoutVertexArray,z=m.collisionVertexArray,D=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(I,z,g,D,F,new oe(e,n)),this._addCollisionDebugVertex(I,z,g,D,F,new oe(o,n)),this._addCollisionDebugVertex(I,z,g,D,F,new oe(o,c)),this._addCollisionDebugVertex(I,z,g,D,F,new oe(e,c)),b.vertexLength+=4;const B=m.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),b.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let m=e;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gp(ur,sy.members,Sr),this.iconCollisionBox=new Gp(ur,sy.members,Sr);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,m,g,_,b,k){const I={};for(let z=n;z<o;z++){const D=e.get(z);I.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.textFeatureIndex=D.featureIndex;break}for(let z=c;z<m;z++){const D=e.get(z);I.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.verticalTextFeatureIndex=D.featureIndex;break}for(let z=g;z<_;z++){const D=e.get(z);I.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.iconFeatureIndex=D.featureIndex;break}for(let z=b;z<k;z++){const D=e.get(z);I.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},I.verticalIconFeatureIndex=D.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const b=this.symbolInstances.get(_);c.push(0|Math.round(n*b.anchorX+o*b.anchorY)),m.push(b.featureIndex)}return g.sort((_,b)=>c[_]-c[b]||m[b]-m[_]),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let by,Sy;$e("SymbolBucket",nl,{omit:["layers","collisionBoxArray","features","compareText"]}),nl.MAX_GLYPHS=65535,nl.addDynamicAttributes=Zp;var Hp={get paint(){return Sy=Sy||new pr({"icon-opacity":new at(ye.paint_symbol["icon-opacity"]),"icon-color":new at(ye.paint_symbol["icon-color"]),"icon-halo-color":new at(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(ye.paint_symbol["text-opacity"]),"text-color":new at(ye.paint_symbol["text-color"],{runtimeType:Jr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new at(ye.paint_symbol["text-halo-color"]),"text-halo-width":new at(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new at(ye.paint_symbol["text-halo-blur"]),"text-translate":new tt(ye.paint_symbol["text-translate"]),"text-translate-anchor":new tt(ye.paint_symbol["text-translate-anchor"])})},get layout(){return by=by||new pr({"symbol-placement":new tt(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tt(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tt(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(ye.layout_symbol["icon-size"]),"icon-text-fit":new tt(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(ye.layout_symbol["icon-image"]),"icon-rotate":new at(ye.layout_symbol["icon-rotate"]),"icon-padding":new at(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new at(ye.layout_symbol["icon-offset"]),"icon-anchor":new at(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(ye.layout_symbol["text-rotation-alignment"]),"text-field":new at(ye.layout_symbol["text-field"]),"text-font":new at(ye.layout_symbol["text-font"]),"text-size":new at(ye.layout_symbol["text-size"]),"text-max-width":new at(ye.layout_symbol["text-max-width"]),"text-line-height":new tt(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new at(ye.layout_symbol["text-letter-spacing"]),"text-justify":new at(ye.layout_symbol["text-justify"]),"text-radial-offset":new at(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new at(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new at(ye.layout_symbol["text-anchor"]),"text-max-angle":new tt(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(ye.layout_symbol["text-writing-mode"]),"text-rotate":new at(ye.layout_symbol["text-rotate"]),"text-padding":new tt(ye.layout_symbol["text-padding"]),"text-keep-upright":new tt(ye.layout_symbol["text-keep-upright"]),"text-transform":new at(ye.layout_symbol["text-transform"]),"text-offset":new at(ye.layout_symbol["text-offset"]),"text-allow-overlap":new tt(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new tt(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new tt(ye.layout_symbol["text-ignore-placement"]),"text-optional":new tt(ye.layout_symbol["text-optional"])})}};class Ty{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Dn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",Ty,{omit:["defaultValue"]});class Mh extends Gi{constructor(e){super(e,Hp)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const m=this.layout.get(e).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Oo(g.value)||!m?m:function(_,b){return b.replace(/{([^{}]+)}/g,(k,I)=>_&&I in _?String(_[I]):"")}(n.properties,m)}createBucket(e){return new nl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Hp.paint.overridableProperties){if(!Mh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Ty(n),c=new eu(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new tu("source",c):new Vo("composite",c,n.value.zoomStops),this.paint._values[e]=new ei(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Mh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=Hp.paint.properties[n];let m=!1;const g=_=>{for(const b of _)if(c.overrides&&c.overrides.hasOverride(b))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof qr)g(o.value.value.sections);else if(o.value.kind==="source"){const _=k=>{m||(k instanceof ws&&Yt(k.value)===Z?g(k.value.sections):k instanceof Bo?g(k.sections):k.eachChild(_))},b=o.value;b._styleExpression&&_(b._styleExpression.expression)}return m}}let ky;var J1={get paint(){return ky=ky||new pr({"background-color":new tt(ye.paint_background["background-color"]),"background-pattern":new gu(ye.paint_background["background-pattern"]),"background-opacity":new tt(ye.paint_background["background-opacity"])})}};class ew extends Gi{constructor(e){super(e,J1)}}let Ey;var tw={get paint(){return Ey=Ey||new pr({"raster-opacity":new tt(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(ye.paint_raster["raster-saturation"]),"raster-contrast":new tt(ye.paint_raster["raster-contrast"]),"raster-resampling":new tt(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(ye.paint_raster["raster-fade-duration"])})}};class rw extends Gi{constructor(e){super(e,tw)}}class iw extends Gi{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Wp=63710088e-1;class pa{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pa(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Wp*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof pa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Iy=2*Math.PI*Wp;function Cy(r){return Iy*Math.cos(r*Math.PI/180)}function Py(r){return(180+r)/360}function zy(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function My(r,e){return r/Cy(e)}function Ay(r){return 360*r-180}function Xp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ah{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=pa.convert(e);return new Ah(Py(o.lng),zy(o.lat),My(n,o.lat))}toLngLat(){return new pa(Ay(this.x),Xp(this.y))}toAltitude(){return this.z*Cy(Xp(this.y))}meterInMercatorCoordinateUnits(){return 1/Iy*(e=Xp(this.y),1/Math.cos(e*Math.PI/180));var e}}function Dy(r,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Kp{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Ou(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(g=this.y,_=this.z,b=Dy(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),k=Dy(256*(m+1),256*(g+1),_),b[0]+","+b[1]+","+k[0]+","+k[1]);var m,g,_,b,k;const I=function(z,D,F){let B,j="";for(let W=z;W>0;W--)B=1<<W-1,j+=(D&B?1:0)+(F&B?2:0);return j}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new oe((e.x*n-this.x)*xr,(e.y*n-this.y)*xr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ly{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Ou(e,n.z,n.z,n.x,n.y)}}class sn{constructor(e,n,o,c,m){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Kp(o,+c,+m),this.key=Ou(n,e,o,c,m)}clone(){return new sn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new sn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Ou(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Ou(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new sn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new sn(n,this.wrap,n,o,c),new sn(n,this.wrap,n,o+1,c),new sn(n,this.wrap,n,o,c+1),new sn(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new sn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new sn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ly(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ah(e.x-this.wrap,e.y))}}function Ou(r,e,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+e.toString(36)}$e("CanonicalTileID",Kp),$e("OverscaledTileID",sn,{omit:["posMatrix"]});class Ry{constructor(e,n,o,c=1,m=1,g=1,_=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Dr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const b=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<b;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(b,k)]=this.data[this._idx(b-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,b)]=this.data[this._idx(k,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<b;k++)for(let I=0;I<b;I++){const z=this.get(k,I);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new nn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=_-1;break;case 1:_=g+1}const b=-n*this.dim,k=-o*this.dim;for(let I=g;I<_;I++)for(let z=c;z<m;z++)this.data[this._idx(z,I)]=e.data[this._idx(z+b,I+k)]}}$e("DEMData",Ry);class Fy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class By{constructor(e,n,o,c,m){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class Oy{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new sa(xr,16,0),this.grid3D=new sa(xr,16,0),this.featureIndexArray=new Te,this.promoteId=n}insert(e,n,o,c,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const b=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const I=n[k],z=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){const F=I[D];z[0]=Math.min(z[0],F.x),z[1]=Math.min(z[1],F.y),z[2]=Math.max(z[2],F.x),z[3]=Math.max(z[3],F.y)}z[0]<xr&&z[1]<xr&&z[2]>=0&&z[3]>=0&&b.insert(_,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ca.VectorTile(new Op(this.rawTileData)).layers,this.sourceLayerCoder=new Fy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const m=e.params||{},g=xr/e.tileSize/e.scale,_=iu(m.filter),b=e.queryGeometry,k=e.queryPadding*g,I=Vy(b),z=this.grid.query(I.minX-k,I.minY-k,I.maxX+k,I.maxY+k),D=Vy(e.cameraQueryGeometry),F=this.grid3D.query(D.minX-k,D.minY-k,D.maxX+k,D.maxY+k,(W,Y,ae,J)=>function(ue,de,be,je,Ye){for(const Oe of ue)if(de<=Oe.x&&be<=Oe.y&&je>=Oe.x&&Ye>=Oe.y)return!0;const Ne=[new oe(de,be),new oe(de,Ye),new oe(je,Ye),new oe(je,be)];if(ue.length>2){for(const Oe of Ne)if(Yo(ue,Oe))return!0}for(let Oe=0;Oe<ue.length-1;Oe++)if(F0(ue[Oe],ue[Oe+1],Ne))return!0;return!1}(e.cameraQueryGeometry,W-k,Y-k,ae+k,J+k));for(const W of F)z.push(W);z.sort(sw);const B={};let j;for(let W=0;W<z.length;W++){const Y=z[W];if(Y===j)continue;j=Y;const ae=this.featureIndexArray.get(Y);let J=null;this.loadMatchingFeature(B,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,_,m.layers,m.availableImages,n,o,c,(ue,de,be)=>(J||(J=eo(ue)),de.queryIntersectsFeature(b,ue,be,J,this.z,e.transform,g,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,n,o,c,m,g,_,b,k,I,z){const D=this.bucketLayerIDs[n];if(g&&!function(W,Y){for(let ae=0;ae<W.length;ae++)if(Y.indexOf(W[ae])>=0)return!0;return!1}(g,D))return;const F=this.sourceLayerCoder.decode(o),B=this.vtLayers[F].feature(c);if(m.needGeometry){const W=to(B,!0);if(!m.filter(new Gt(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!m.filter(new Gt(this.tileID.overscaledZ),B))return;const j=this.getId(B,F);for(let W=0;W<D.length;W++){const Y=D[W];if(g&&g.indexOf(Y)<0)continue;const ae=b[Y];if(!ae)continue;let J={};j&&I&&(J=I.getState(ae.sourceLayer||"_geojsonTileLayer",j));const ue=Ze({},k[Y]);ue.paint=Ny(ue.paint,ae.paint,B,J,_),ue.layout=Ny(ue.layout,ae.layout,B,J,_);const de=!z||z(B,ae,J);if(!de)continue;const be=new By(B,this.z,this.x,this.y,j);be.layer=ue;let je=e[Y];je===void 0&&(je=e[Y]=[]),je.push({featureIndex:c,feature:be,intersectionZ:de})}}lookupSymbolFeatures(e,n,o,c,m,g,_,b){const k={};this.loadVTLayers();const I=iu(m);for(const z of e)this.loadMatchingFeature(k,o,c,z,I,g,_,b,n);return k}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Ny(r,e,n,o,c){return Ue(r,(m,g)=>{const _=e instanceof Xo?e.get(g):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function Vy(r){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)e=Math.min(e,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:e,minY:n,maxX:o,maxY:c}}function sw(r,e){return e-r}function jy(r,e,n,o,c){const m=[];for(let g=0;g<r.length;g++){const _=r[g];let b;for(let k=0;k<_.length-1;k++){let I=_[k],z=_[k+1];I.x<e&&z.x<e||(I.x<e?I=new oe(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<e&&(z=new oe(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<n&&z.y<n||(I.y<n?I=new oe(I.x+(n-I.y)/(z.y-I.y)*(z.x-I.x),n)._round():z.y<n&&(z=new oe(I.x+(n-I.y)/(z.y-I.y)*(z.x-I.x),n)._round()),I.x>=o&&z.x>=o||(I.x>=o?I=new oe(o,I.y+(o-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=o&&(z=new oe(o,I.y+(o-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=c&&z.y>=c||(I.y>=c?I=new oe(I.x+(c-I.y)/(z.y-I.y)*(z.x-I.x),c)._round():z.y>=c&&(z=new oe(I.x+(c-I.y)/(z.y-I.y)*(z.x-I.x),c)._round()),b&&I.equals(b[b.length-1])||(b=[I],m.push(b)),b.push(z)))))}}return m}$e("FeatureIndex",Oy,{omit:["rawTileData","sourceLayerCoder"]});class fa extends oe{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new fa(this.x,this.y,this.angle,this.segment)}}function Uy(r,e,n,o,c){if(e.segment===void 0||n===0)return!0;let m=e,g=e.segment+1,_=0;for(;_>-n/2;){if(g--,g<0)return!1;_-=r[g].dist(m),m=r[g]}_+=r[g].dist(r[g+1]),g++;const b=[];let k=0;for(;_<n/2;){const I=r[g],z=r[g+1];if(!z)return!1;let D=r[g-1].angleTo(I)-I.angleTo(z);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:D}),k+=D;_-b[0].distance>o;)k-=b.shift().angleDelta;if(k>c)return!1;g++,_+=I.dist(z)}return!0}function $y(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function Zy(r,e,n){return r?.6*e*n:0}function qy(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function aw(r,e,n,o,c,m){const g=Zy(n,c,m),_=qy(n,o)*m;let b=0;const k=$y(r)/2;for(let I=0;I<r.length-1;I++){const z=r[I],D=r[I+1],F=z.dist(D);if(b+F>k){const B=(k-b)/F,j=Ei.number(z.x,D.x,B),W=Ei.number(z.y,D.y,B),Y=new fa(j,W,D.angleTo(z),I);return Y._round(),!g||Uy(r,Y,_,g,e)?Y:void 0}b+=F}}function ow(r,e,n,o,c,m,g,_,b){const k=Zy(o,m,g),I=qy(o,c),z=I*g,D=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-z<e/4&&(e=z+e/4),Gy(r,D?e/2*_%e:(I/2+2*m)*g*_%e,e,k,n,z,D,!1,b)}function Gy(r,e,n,o,c,m,g,_,b){const k=m/2,I=$y(r);let z=0,D=e-n,F=[];for(let B=0;B<r.length-1;B++){const j=r[B],W=r[B+1],Y=j.dist(W),ae=W.angleTo(j);for(;D+n<z+Y;){D+=n;const J=(D-z)/Y,ue=Ei.number(j.x,W.x,J),de=Ei.number(j.y,W.y,J);if(ue>=0&&ue<b&&de>=0&&de<b&&D-k>=0&&D+k<=I){const be=new fa(ue,de,ae,B);be._round(),o&&!Uy(r,be,m,o,c)||F.push(be)}}z+=Y}return _||F.length||g||(F=Gy(r,z/2,n,o,c,m,g,!0,b)),F}$e("Anchor",fa);const sl=Mi;function Hy(r,e,n,o){const c=[],m=r.image,g=m.pixelRatio,_=m.paddedRect.w-2*sl,b=m.paddedRect.h-2*sl,k=r.right-r.left,I=r.bottom-r.top,z=m.stretchX||[[0,_]],D=m.stretchY||[[0,b]],F=(Me,qe)=>Me+qe[1]-qe[0],B=z.reduce(F,0),j=D.reduce(F,0),W=_-B,Y=b-j;let ae=0,J=B,ue=0,de=j,be=0,je=W,Ye=0,Ne=Y;if(m.content&&o){const Me=m.content;ae=Dh(z,0,Me[0]),ue=Dh(D,0,Me[1]),J=Dh(z,Me[0],Me[2]),de=Dh(D,Me[1],Me[3]),be=Me[0]-ae,Ye=Me[1]-ue,je=Me[2]-Me[0]-J,Ne=Me[3]-Me[1]-de}const Oe=(Me,qe,Le,Ie)=>{const nt=Lh(Me.stretch-ae,J,k,r.left),et=Rh(Me.fixed-be,je,Me.stretch,B),_t=Lh(qe.stretch-ue,de,I,r.top),Wt=Rh(qe.fixed-Ye,Ne,qe.stretch,j),Kt=Lh(Le.stretch-ae,J,k,r.left),Er=Rh(Le.fixed-be,je,Le.stretch,B),Wi=Lh(Ie.stretch-ue,de,I,r.top),gi=Rh(Ie.fixed-Ye,Ne,Ie.stretch,j),wr=new oe(nt,_t),Vr=new oe(Kt,_t),Wr=new oe(Kt,Wi),yi=new oe(nt,Wi),_i=new oe(et/g,Wt/g),Ir=new oe(Er/g,gi/g),Cr=e*Math.PI/180;if(Cr){const ii=Math.sin(Cr),Ai=Math.cos(Cr),Di=[Ai,-ii,ii,Ai];wr._matMult(Di),Vr._matMult(Di),yi._matMult(Di),Wr._matMult(Di)}const ri=Me.stretch+Me.fixed,vi=qe.stretch+qe.fixed;return{tl:wr,tr:Vr,bl:yi,br:Wr,tex:{x:m.paddedRect.x+sl+ri,y:m.paddedRect.y+sl+vi,w:Le.stretch+Le.fixed-ri,h:Ie.stretch+Ie.fixed-vi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_i,pixelOffsetBR:Ir,minFontScaleX:je/g/k,minFontScaleY:Ne/g/I,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const Me=Wy(z,W,B),qe=Wy(D,Y,j);for(let Le=0;Le<Me.length-1;Le++){const Ie=Me[Le],nt=Me[Le+1];for(let et=0;et<qe.length-1;et++)c.push(Oe(Ie,qe[et],nt,qe[et+1]))}}else c.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:b+1}));return c}function Dh(r,e,n){let o=0;for(const c of r)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function Wy(r,e,n){const o=[{fixed:-sl,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:e+sl,stretch:n}),o}function Lh(r,e,n,o){return r/e*n+o}function Rh(r,e,n,o){return r-e*n/o}class Fh{constructor(e,n,o,c,m,g,_,b,k,I){if(this.boxStartIndex=e.length,k){let z=g.top,D=g.bottom;const F=g.collisionPadding;F&&(z-=F[1],D+=F[3]);let B=D-z;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let z=g.top*_-b[0],D=g.bottom*_+b[2],F=g.left*_-b[3],B=g.right*_+b[1];const j=g.collisionPadding;if(j&&(F-=j[0]*_,z-=j[1]*_,B+=j[2]*_,D+=j[3]*_),I){const W=new oe(F,z),Y=new oe(B,z),ae=new oe(F,D),J=new oe(B,D),ue=I*Math.PI/180;W._rotate(ue),Y._rotate(ue),ae._rotate(ue),J._rotate(ue),F=Math.min(W.x,Y.x,ae.x,J.x),B=Math.max(W.x,Y.x,ae.x,J.x),z=Math.min(W.y,Y.y,ae.y,J.y),D=Math.max(W.y,Y.y,ae.y,J.y)}e.emplaceBack(n.x,n.y,F,z,B,D,o,c,m)}this.boxEndIndex=e.length}}class lw{constructor(e=[],n=uw){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const m=e-1>>1,g=n[m];if(o(c,g)>=0)break;n[e]=g,e=m}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,m=n[e];for(;e<c;){let g=1+(e<<1),_=n[g];const b=g+1;if(b<this.length&&o(n[b],_)<0&&(g=b,_=n[b]),o(_,m)>=0)break;n[e]=_,e=g}n[e]=m}}function uw(r,e){return r<e?-1:r>e?1:0}function cw(r,e=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const _=r[0];for(let F=0;F<_.length;F++){const B=_[F];(!F||B.x<o)&&(o=B.x),(!F||B.y<c)&&(c=B.y),(!F||B.x>m)&&(m=B.x),(!F||B.y>g)&&(g=B.y)}const b=Math.min(m-o,g-c);let k=b/2;const I=new lw([],hw);if(b===0)return new oe(o,c);for(let F=o;F<m;F+=b)for(let B=c;B<g;B+=b)I.push(new al(F+k,B+k,k,r));let z=function(F){let B=0,j=0,W=0;const Y=F[0];for(let ae=0,J=Y.length,ue=J-1;ae<J;ue=ae++){const de=Y[ae],be=Y[ue],je=de.x*be.y-be.x*de.y;j+=(de.x+be.x)*je,W+=(de.y+be.y)*je,B+=3*je}return new al(j/B,W/B,0,F)}(r),D=I.length;for(;I.length;){const F=I.pop();(F.d>z.d||!z.d)&&(z=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-z.d<=e||(k=F.h/2,I.push(new al(F.p.x-k,F.p.y-k,k,r)),I.push(new al(F.p.x+k,F.p.y-k,k,r)),I.push(new al(F.p.x-k,F.p.y+k,k,r)),I.push(new al(F.p.x+k,F.p.y+k,k,r)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${z.d}`)),z.p}function hw(r,e){return e.max-r.max}function al(r,e,n,o){this.p=new oe(r,e),this.h=n,this.d=function(c,m){let g=!1,_=1/0;for(let b=0;b<m.length;b++){const k=m[b];for(let I=0,z=k.length,D=z-1;I<z;D=I++){const F=k[I],B=k[D];F.y>c.y!=B.y>c.y&&c.x<(B.x-F.x)*(c.y-F.y)/(B.y-F.y)+F.x&&(g=!g),_=Math.min(_,zg(c,F,B))}}return(g?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Hr;l.aq=void 0,(Hr=l.aq||(l.aq={}))[Hr.center=1]="center",Hr[Hr.left=2]="left",Hr[Hr.right=3]="right",Hr[Hr.top=4]="top",Hr[Hr.bottom=5]="bottom",Hr[Hr["top-left"]=6]="top-left",Hr[Hr["top-right"]=7]="top-right",Hr[Hr["bottom-left"]=8]="bottom-left",Hr[Hr["bottom-right"]=9]="bottom-right";const ma=7,Yp=Number.POSITIVE_INFINITY;function Xy(r,e){return e[1]!==Yp?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-ma;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+ma}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(r,e[0],e[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-ma;break;case"bottom-right":case"bottom-left":m=-g+ma;break;case"bottom":m=-o+ma;break;case"top":m=o-ma}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(r,e[0])}function Ky(r,e,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(m){const _=m.values,b=[];for(let k=0;k<_.length;k+=2){const I=b[k]=_[k],z=_[k+1].map(D=>D*kr);I.startsWith("top")?z[1]-=ma:I.startsWith("bottom")&&(z[1]+=ma),b[k+1]=z}return new Ui(b)}const g=c.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*kr,Yp]:c.get("text-offset").evaluate(e,{},n).map(k=>k*kr);const b=[];for(const k of g)b.push(k,Xy(k,_));return new Ui(b)}return null}function Qp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dw(r,e,n,o,c,m,g,_,b,k,I){let z=m.textMaxSize.evaluate(e,{});z===void 0&&(z=g);const D=r.layers[0].layout,F=D.get("icon-offset").evaluate(e,{},I),B=Qy(n.horizontal),j=g/24,W=r.tilePixelRatio*j,Y=r.tilePixelRatio*z/24,ae=r.tilePixelRatio*_,J=r.tilePixelRatio*D.get("symbol-spacing"),ue=D.get("text-padding")*r.tilePixelRatio,de=function(Ie,nt,et,_t=1){const Wt=Ie.get("icon-padding").evaluate(nt,{},et),Kt=Wt&&Wt.values;return[Kt[0]*_t,Kt[1]*_t,Kt[2]*_t,Kt[3]*_t]}(D,e,I,r.tilePixelRatio),be=D.get("text-max-angle")/180*Math.PI,je=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Ye=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Ne=D.get("symbol-placement"),Oe=J/2,Me=D.get("icon-text-fit");let qe;o&&Me!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(qe=xy(o,n.vertical,Me,D.get("icon-text-fit-padding"),F,j)),B&&(o=xy(o,B,Me,D.get("icon-text-fit-padding"),F,j)));const Le=(Ie,nt)=>{nt.x<0||nt.x>=xr||nt.y<0||nt.y>=xr||function(et,_t,Wt,Kt,Er,Wi,gi,wr,Vr,Wr,yi,_i,Ir,Cr,ri,vi,ii,Ai,Di,Pr,bt,ni,Xr,zr,Sn){const Vn=et.addToLineVertexArray(_t,Wt);let jn,Ls,Tn,an,Li=0,Rs=0,ju=0,r_=0,of=-1,lf=-1;const Fs={};let i_=zs("");if(et.allowVerticalPlacement&&Kt.vertical){const si=wr.layout.get("text-rotate").evaluate(bt,{},zr)+90;Tn=new Fh(Vr,_t,Wr,yi,_i,Kt.vertical,Ir,Cr,ri,si),gi&&(an=new Fh(Vr,_t,Wr,yi,_i,gi,ii,Ai,ri,si))}if(Er){const si=wr.layout.get("icon-rotate").evaluate(bt,{}),on=wr.layout.get("icon-text-fit")!=="none",io=Hy(Er,si,Xr,on),$n=gi?Hy(gi,si,Xr,on):void 0;Ls=new Fh(Vr,_t,Wr,yi,_i,Er,ii,Ai,!1,si),Li=4*io.length;const no=et.iconSizeData;let hs=null;no.kind==="source"?(hs=[cs*wr.layout.get("icon-size").evaluate(bt,{})],hs[0]>da&&Dr(`${et.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)):no.kind==="composite"&&(hs=[cs*ni.compositeIconSizes[0].evaluate(bt,{},zr),cs*ni.compositeIconSizes[1].evaluate(bt,{},zr)],(hs[0]>da||hs[1]>da)&&Dr(`${et.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)),et.addSymbols(et.icon,io,hs,Pr,Di,bt,l.ai.none,_t,Vn.lineStartIndex,Vn.lineLength,-1,zr),of=et.icon.placedSymbolArray.length-1,$n&&(Rs=4*$n.length,et.addSymbols(et.icon,$n,hs,Pr,Di,bt,l.ai.vertical,_t,Vn.lineStartIndex,Vn.lineLength,-1,zr),lf=et.icon.placedSymbolArray.length-1)}const n_=Object.keys(Kt.horizontal);for(const si of n_){const on=Kt.horizontal[si];if(!jn){i_=zs(on.text);const $n=wr.layout.get("text-rotate").evaluate(bt,{},zr);jn=new Fh(Vr,_t,Wr,yi,_i,on,Ir,Cr,ri,$n)}const io=on.positionedLines.length===1;if(ju+=Yy(et,_t,on,Wi,wr,ri,bt,vi,Vn,Kt.vertical?l.ai.horizontal:l.ai.horizontalOnly,io?n_:[si],Fs,of,ni,zr),io)break}Kt.vertical&&(r_+=Yy(et,_t,Kt.vertical,Wi,wr,ri,bt,vi,Vn,l.ai.vertical,["vertical"],Fs,lf,ni,zr));const mw=jn?jn.boxStartIndex:et.collisionBoxArray.length,gw=jn?jn.boxEndIndex:et.collisionBoxArray.length,yw=Tn?Tn.boxStartIndex:et.collisionBoxArray.length,_w=Tn?Tn.boxEndIndex:et.collisionBoxArray.length,vw=Ls?Ls.boxStartIndex:et.collisionBoxArray.length,xw=Ls?Ls.boxEndIndex:et.collisionBoxArray.length,ww=an?an.boxStartIndex:et.collisionBoxArray.length,bw=an?an.boxEndIndex:et.collisionBoxArray.length;let Un=-1;const Oh=(si,on)=>si&&si.circleDiameter?Math.max(si.circleDiameter,on):on;Un=Oh(jn,Un),Un=Oh(Tn,Un),Un=Oh(Ls,Un),Un=Oh(an,Un);const s_=Un>-1?1:0;s_&&(Un*=Sn/kr),et.glyphOffsetArray.length>=nl.MAX_GLYPHS&&Dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bt.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,bt.sortKey);const Sw=Ky(wr,bt,zr),[Tw,kw]=function(si,on){const io=si.length,$n=on==null?void 0:on.values;if(($n==null?void 0:$n.length)>0)for(let no=0;no<$n.length;no+=2){const hs=$n[no+1];si.emplaceBack(l.aq[$n[no]],hs[0],hs[1])}return[io,si.length]}(et.textAnchorOffsets,Sw);et.symbolInstances.emplaceBack(_t.x,_t.y,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical||-1,of,lf,i_,mw,gw,yw,_w,vw,xw,ww,bw,Wr,ju,r_,Li,Rs,s_,0,Ir,Un,Tw,kw)}(r,nt,Ie,n,o,c,qe,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,W,[ue,ue,ue,ue],je,b,ae,de,Ye,F,e,m,k,I,g)};if(Ne==="line")for(const Ie of jy(e.geometry,0,0,xr,xr)){const nt=ow(Ie,J,be,n.vertical||B,o,24,Y,r.overscaling,xr);for(const et of nt)B&&pw(r,B.text,Oe,et)||Le(Ie,et)}else if(Ne==="line-center"){for(const Ie of e.geometry)if(Ie.length>1){const nt=aw(Ie,be,n.vertical||B,o,24,Y);nt&&Le(Ie,nt)}}else if(e.type==="Polygon")for(const Ie of zp(e.geometry,0)){const nt=cw(Ie,16);Le(Ie[0],new fa(nt.x,nt.y,0))}else if(e.type==="LineString")for(const Ie of e.geometry)Le(Ie,new fa(Ie[0].x,Ie[0].y,0));else if(e.type==="Point")for(const Ie of e.geometry)for(const nt of Ie)Le([nt],new fa(nt.x,nt.y,0))}function Yy(r,e,n,o,c,m,g,_,b,k,I,z,D,F,B){const j=function(ae,J,ue,de,be,je,Ye,Ne){const Oe=de.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Me=[];for(const qe of J.positionedLines)for(const Le of qe.positionedGlyphs){if(!Le.rect)continue;const Ie=Le.rect||{};let nt=py+1,et=!0,_t=1,Wt=0;const Kt=(be||Ne)&&Le.vertical,Er=Le.metrics.advance*Le.scale/2;if(Ne&&J.verticalizable&&(Wt=qe.lineOffset/2-(Le.imageName?-(kr-Le.metrics.width*Le.scale)/2:(Le.scale-1)*kr)),Le.imageName){const Pr=Ye[Le.imageName];et=Pr.sdf,_t=Pr.pixelRatio,nt=Mi/_t}const Wi=be?[Le.x+Er,Le.y]:[0,0];let gi=be?[0,0]:[Le.x+Er+ue[0],Le.y+ue[1]-Wt],wr=[0,0];Kt&&(wr=gi,gi=[0,0]);const Vr=Le.metrics.isDoubleResolution?2:1,Wr=(Le.metrics.left-nt)*Le.scale-Er+gi[0],yi=(-Le.metrics.top-nt)*Le.scale+gi[1],_i=Wr+Ie.w/Vr*Le.scale/_t,Ir=yi+Ie.h/Vr*Le.scale/_t,Cr=new oe(Wr,yi),ri=new oe(_i,yi),vi=new oe(Wr,Ir),ii=new oe(_i,Ir);if(Kt){const Pr=new oe(-Er,Er-Ru),bt=-Math.PI/2,ni=kr/2-Er,Xr=new oe(5-Ru-ni,-(Le.imageName?ni:0)),zr=new oe(...wr);Cr._rotateAround(bt,Pr)._add(Xr)._add(zr),ri._rotateAround(bt,Pr)._add(Xr)._add(zr),vi._rotateAround(bt,Pr)._add(Xr)._add(zr),ii._rotateAround(bt,Pr)._add(Xr)._add(zr)}if(Oe){const Pr=Math.sin(Oe),bt=Math.cos(Oe),ni=[bt,-Pr,Pr,bt];Cr._matMult(ni),ri._matMult(ni),vi._matMult(ni),ii._matMult(ni)}const Ai=new oe(0,0),Di=new oe(0,0);Me.push({tl:Cr,tr:ri,bl:vi,br:ii,tex:Ie,writingMode:J.writingMode,glyphOffset:Wi,sectionIndex:Le.sectionIndex,isSDF:et,pixelOffsetTL:Ai,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}return Me}(0,n,_,c,m,g,o,r.allowVerticalPlacement),W=r.textSizeData;let Y=null;W.kind==="source"?(Y=[cs*c.layout.get("text-size").evaluate(g,{})],Y[0]>da&&Dr(`${r.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)):W.kind==="composite"&&(Y=[cs*F.compositeTextSizes[0].evaluate(g,{},B),cs*F.compositeTextSizes[1].evaluate(g,{},B)],(Y[0]>da||Y[1]>da)&&Dr(`${r.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)),r.addSymbols(r.text,j,Y,_,m,g,k,e,b.lineStartIndex,b.lineLength,D,B);for(const ae of I)z[ae]=r.text.placedSymbolArray.length-1;return 4*j.length}function Qy(r){for(const e in r)return r[e];return null}function pw(r,e,n,o){const c=r.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[e]=[];return c[e].push(o),!1}const Jy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=Jy[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Jp(_,g,m,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Jy.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ef(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,b=[0,m.length-1,0],k=[];for(;b.length;){const I=b.pop()||0,z=b.pop()||0,D=b.pop()||0;if(z-D<=_){for(let W=D;W<=z;W++){const Y=g[2*W],ae=g[2*W+1];Y>=e&&Y<=o&&ae>=n&&ae<=c&&k.push(m[W])}continue}const F=D+z>>1,B=g[2*F],j=g[2*F+1];B>=e&&B<=o&&j>=n&&j<=c&&k.push(m[F]),(I===0?e<=B:n<=j)&&(b.push(D),b.push(F-1),b.push(1-I)),(I===0?o>=B:c>=j)&&(b.push(F+1),b.push(z),b.push(1-I))}return k}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,_=[0,c.length-1,0],b=[],k=o*o;for(;_.length;){const I=_.pop()||0,z=_.pop()||0,D=_.pop()||0;if(z-D<=g){for(let W=D;W<=z;W++)t_(m[2*W],m[2*W+1],e,n)<=k&&b.push(c[W]);continue}const F=D+z>>1,B=m[2*F],j=m[2*F+1];t_(B,j,e,n)<=k&&b.push(c[F]),(I===0?e-o<=B:n-o<=j)&&(_.push(D),_.push(F-1),_.push(1-I)),(I===0?e+o>=B:n+o>=j)&&(_.push(F+1),_.push(z),_.push(1-I))}return b}}function ef(r,e,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;e_(r,e,g,o,c,m),ef(r,e,n,o,g-1,1-m),ef(r,e,n,g+1,c,1-m)}function e_(r,e,n,o,c,m){for(;c>o;){if(c-o>600){const k=c-o+1,I=n-o+1,z=Math.log(k),D=.5*Math.exp(2*z/3),F=.5*Math.sqrt(z*D*(k-D)/k)*(I-k/2<0?-1:1);e_(r,e,n,Math.max(o,Math.floor(n-I*D/k+F)),Math.min(c,Math.floor(n+(k-I)*D/k+F)),m)}const g=e[2*n+m];let _=o,b=c;for(Nu(r,e,o,n),e[2*c+m]>g&&Nu(r,e,o,c);_<b;){for(Nu(r,e,_,b),_++,b--;e[2*_+m]<g;)_++;for(;e[2*b+m]>g;)b--}e[2*o+m]===g?Nu(r,e,o,b):(b++,Nu(r,e,b,c)),b<=n&&(o=b+1),n<=b&&(c=b-1)}}function Nu(r,e,n,o){tf(r,n,o),tf(e,2*n,2*o),tf(e,2*n+1,2*o+1)}function tf(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}function t_(r,e,n,o){const c=r-n,m=e-o;return c*c+m*m}var rf;l.bh=void 0,(rf=l.bh||(l.bh={})).create="create",rf.load="load",rf.fullLoad="fullLoad";let Bh=null,Vu=[];const nf=1e3/60,sf="loadTime",af="fullLoadTime",fw={mark(r){performance.mark(r)},frame(r){const e=r;Bh!=null&&Vu.push(e-Bh),Bh=e},clearMetrics(){Bh=null,Vu=[],performance.clearMeasures(sf),performance.clearMeasures(af);for(const r in l.bh)performance.clearMarks(l.bh[r])},getPerformanceMetrics(){performance.measure(sf,l.bh.create,l.bh.load),performance.measure(af,l.bh.create,l.bh.fullLoad);const r=performance.getEntriesByName(sf)[0].duration,e=performance.getEntriesByName(af)[0].duration,n=Vu.length,o=1/(Vu.reduce((m,g)=>m+g,0)/n/1e3),c=Vu.filter(m=>m>nf).reduce((m,g)=>m+(g-nf)/nf,0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};l.$=function(r,e,n){var o,c,m,g,_,b,k,I,z,D,F,B,j=n[0],W=n[1],Y=n[2];return e===r?(r[12]=e[0]*j+e[4]*W+e[8]*Y+e[12],r[13]=e[1]*j+e[5]*W+e[9]*Y+e[13],r[14]=e[2]*j+e[6]*W+e[10]*Y+e[14],r[15]=e[3]*j+e[7]*W+e[11]*Y+e[15]):(c=e[1],m=e[2],g=e[3],_=e[4],b=e[5],k=e[6],I=e[7],z=e[8],D=e[9],F=e[10],B=e[11],r[0]=o=e[0],r[1]=c,r[2]=m,r[3]=g,r[4]=_,r[5]=b,r[6]=k,r[7]=I,r[8]=z,r[9]=D,r[10]=F,r[11]=B,r[12]=o*j+_*W+z*Y+e[12],r[13]=c*j+b*W+D*Y+e[13],r[14]=m*j+k*W+F*Y+e[14],r[15]=g*j+I*W+B*Y+e[15]),r},l.A=Qo,l.B=Ei,l.C=class{constructor(r,e,n){this.receive=o=>{const c=o.data,m=c.id;if(m&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[m];const g=this.cancelCallbacks[m];delete this.cancelCallbacks[m],g&&g()}else $r()||c.mustQueue?(this.tasks[m]=c,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,c)},this.process=()=>{if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),c=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(o,c)},this.target=r,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new nw(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=$r()?r:window}send(r,e,n,o,c=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[m]=n);const g=[],_={id:m,type:r,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:os(e,g)};return this.target.postMessage(_,{transfer:g}),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}processTask(r,e){if(e.type==="<response>"){const n=this.callbacks[r];delete this.callbacks[r],n&&(e.error?n(aa(e.error)):n(null,aa(e.data)))}else{let n=!1;const o=[],c=e.hasCallback?(_,b)=>{n=!0,delete this.cancelCallbacks[r];const k={id:r,type:"<response>",sourceMapId:this.mapId,error:_?os(_):null,data:os(b,o)};this.target.postMessage(k,{transfer:o})}:_=>{n=!0};let m=null;const g=aa(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,c);else if("getWorkerSource"in this.parent){const _=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,_[0],g.source)[_[1]](g,c)}else c(new Error(`Could not find function ${e.type}`));!n&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=tt,l.E=_s,l.F=function(r,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in r&&(n[c]=r[c])}return n},l.G=Py,l.H=zy,l.I=Vp,l.J=te,l.K=ce,l.L=pa,l.M=Ut,l.N=xr,l.O=sn,l.P=oe,l.Q=er,l.R=nn,l.S=Ht,l.T=dh,l.U=Ah,l.V=class extends Cs{},l.W=Kp,l.X=function(r,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<r.length;o++){const c=window.document.createElement("source");Mn(r[o])||(n.crossOrigin="Anonymous"),c.src=r[o],n.appendChild(c)}return{cancel:()=>{}}},l.Y=Ae,l.Z=function(){var r=new Qo(16);return Qo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},l._=G,l.a=dt,l.a$=class extends R{},l.a0=function(r,e,n){var o=n[0],c=n[1],m=n[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.a1=Lg,l.a2=function(){return Vt++},l.a3=q,l.a4=nl,l.a5=function(){Pi.isLoading()||Pi.isLoaded()||fu()!=="deferred"||hh()},l.a6=iu,l.a7=to,l.a8=Gt,l.a9=By,l.aA=Xa,l.aB=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Vi(r[n],e[r[n].ref]));return r},l.aC=function(r){if(r.type==="custom")return new iw(r);switch(r.type){case"background":return new ew(r);case"circle":return new N0(r);case"fill":return new s1(r);case"fill-extrusion":return new x1(r);case"heatmap":return new j0(r);case"hillshade":return new $0(r);case"line":return new C1(r);case"raster":return new rw(r);case"symbol":return new Mh(r)}},l.aD=Rr,l.aE=function(r,e){if(!r)return[{command:Ct.setStyle,args:[e]}];let n=[];try{if(!jt(r.version,e.version))return[{command:Ct.setStyle,args:[e]}];jt(r.center,e.center)||n.push({command:Ct.setCenter,args:[e.center]}),jt(r.zoom,e.zoom)||n.push({command:Ct.setZoom,args:[e.zoom]}),jt(r.bearing,e.bearing)||n.push({command:Ct.setBearing,args:[e.bearing]}),jt(r.pitch,e.pitch)||n.push({command:Ct.setPitch,args:[e.pitch]}),jt(r.sprite,e.sprite)||n.push({command:Ct.setSprite,args:[e.sprite]}),jt(r.glyphs,e.glyphs)||n.push({command:Ct.setGlyphs,args:[e.glyphs]}),jt(r.transition,e.transition)||n.push({command:Ct.setTransition,args:[e.transition]}),jt(r.light,e.light)||n.push({command:Ct.setLight,args:[e.light]});const o={},c=[];(function(g,_,b,k){let I;for(I in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(_,I)||Ws(I,b,k));for(I in _)Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(g,I)?jt(g[I],_[I])||(g[I].type==="geojson"&&_[I].type==="geojson"&&wo(g,_,I)?b.push({command:Ct.setGeoJSONSourceData,args:[I,_[I].data]}):An(I,_,b,k)):fn(I,_,b))})(r.sources,e.sources,c,o);const m=[];r.layers&&r.layers.forEach(g=>{o[g.source]?n.push({command:Ct.removeLayer,args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,_,b){_=_||[];const k=(g=g||[]).map(ts),I=_.map(ts),z=g.reduce(vs,{}),D=_.reduce(vs,{}),F=k.slice(),B=Object.create(null);let j,W,Y,ae,J,ue,de;for(j=0,W=0;j<k.length;j++)Y=k[j],Object.prototype.hasOwnProperty.call(D,Y)?W++:(b.push({command:Ct.removeLayer,args:[Y]}),F.splice(F.indexOf(Y,W),1));for(j=0,W=0;j<I.length;j++)Y=I[I.length-1-j],F[F.length-1-j]!==Y&&(Object.prototype.hasOwnProperty.call(z,Y)?(b.push({command:Ct.removeLayer,args:[Y]}),F.splice(F.lastIndexOf(Y,F.length-W),1)):W++,ue=F[F.length-j],b.push({command:Ct.addLayer,args:[D[Y],ue]}),F.splice(F.length-j,0,Y),B[Y]=!0);for(j=0;j<I.length;j++)if(Y=I[j],ae=z[Y],J=D[Y],!B[Y]&&!jt(ae,J))if(jt(ae.source,J.source)&&jt(ae["source-layer"],J["source-layer"])&&jt(ae.type,J.type)){for(de in Xs(ae.layout,J.layout,b,Y,null,Ct.setLayoutProperty),Xs(ae.paint,J.paint,b,Y,null,Ct.setPaintProperty),jt(ae.filter,J.filter)||b.push({command:Ct.setFilter,args:[Y,J.filter]}),jt(ae.minzoom,J.minzoom)&&jt(ae.maxzoom,J.maxzoom)||b.push({command:Ct.setLayerZoomRange,args:[Y,J.minzoom,J.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Xs(ae[de],J[de],b,Y,de.slice(6),Ct.setPaintProperty):jt(ae[de],J[de])||b.push({command:Ct.setLayerProperty,args:[Y,de,J[de]]}));for(de in J)Object.prototype.hasOwnProperty.call(J,de)&&!Object.prototype.hasOwnProperty.call(ae,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Xs(ae[de],J[de],b,Y,de.slice(6),Ct.setPaintProperty):jt(ae[de],J[de])||b.push({command:Ct.setLayerProperty,args:[Y,de,J[de]]}))}else b.push({command:Ct.removeLayer,args:[Y]}),ue=F[F.lastIndexOf(Y)+1],b.push({command:Ct.addLayer,args:[J,ue]})}(m,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:Ct.setStyle,args:[e]}]}return n},l.aF=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},l.aG=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!r(e[o],n[o]))return!1;return!0}return e===n},l.aH=Ue,l.aI=Ar,l.aJ=Ka,l.aK=function(r){return r({pluginStatus:pi,pluginURL:ls}),Ka.on("pluginStateChange",r),r},l.aL=class extends Ms{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.aM=Ko,l.aN=class extends Ms{constructor(r,e){super(r,e),this.current=_p}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.aO=gh,l.aP=class extends Ms{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.aQ=class extends Ms{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.aR=yh,l.aS=function(r,e,n,o,c,m,g){var _=1/(e-n),b=1/(o-c),k=1/(m-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+n)*_,r[13]=(c+o)*b,r[14]=(g+m)*k,r[15]=1,r},l.aT=Rt,l.aU=O0,l.aV=class extends u{},l.aW=A1,l.aX=class extends f{},l.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},l.aZ=Ng,l.a_=Pe,l.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},l.ab=function(r,e){const n=[];for(const o in r)o in e||n.push(o);return n},l.ac=function(r){if(He==null){const e=r.navigator?r.navigator.userAgent:null;He=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return He},l.ad=We,l.ae=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[0],g=e[1],_=e[2],b=e[3],k=e[4],I=e[5],z=e[6],D=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*c+k*o,r[1]=g*c+I*o,r[2]=_*c+z*o,r[3]=b*c+D*o,r[4]=k*c-m*o,r[5]=I*c-g*o,r[6]=z*c-_*o,r[7]=D*c-b*o,r},l.af=function(r){var e=new Qo(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},l.ag=wh,l.ah=function(r,e){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,_=c?We(Ii.interpolationFactor(c,e,m,g),0,1):0;r.kind==="camera"?o=Ei.number(r.minSize,r.maxSize,_):n=_}return{uSizeT:n,uSize:o}},l.aj=function(r,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/cs:r.kind==="composite"?Ei.number(o/cs,c/cs,n):e},l.ak=Zp,l.al=function(r,e,n,o){const c=e.y-r.y,m=e.x-r.x,g=o.y-n.y,_=o.x-n.x,b=g*m-_*c;if(b===0)return null;const k=(_*(r.y-n.y)-g*(r.x-n.x))/b;return new oe(r.x+k*m,r.y+k*c)},l.am=jy,l.an=Cg,l.ao=Sp,l.ap=kr,l.ar=$p,l.as=function(r,e){var n=e[0],o=e[1],c=e[2],m=e[3],g=e[4],_=e[5],b=e[6],k=e[7],I=e[8],z=e[9],D=e[10],F=e[11],B=e[12],j=e[13],W=e[14],Y=e[15],ae=n*_-o*g,J=n*b-c*g,ue=n*k-m*g,de=o*b-c*_,be=o*k-m*_,je=c*k-m*b,Ye=I*j-z*B,Ne=I*W-D*B,Oe=I*Y-F*B,Me=z*W-D*j,qe=z*Y-F*j,Le=D*Y-F*W,Ie=ae*Le-J*qe+ue*Me+de*Oe-be*Ne+je*Ye;return Ie?(r[0]=(_*Le-b*qe+k*Me)*(Ie=1/Ie),r[1]=(c*qe-o*Le-m*Me)*Ie,r[2]=(j*je-W*be+Y*de)*Ie,r[3]=(D*be-z*je-F*de)*Ie,r[4]=(b*Oe-g*Le-k*Ne)*Ie,r[5]=(n*Le-c*Oe+m*Ne)*Ie,r[6]=(W*ue-B*je-Y*J)*Ie,r[7]=(I*je-D*ue+F*J)*Ie,r[8]=(g*qe-_*Oe+k*Ye)*Ie,r[9]=(o*Oe-n*qe-m*Ye)*Ie,r[10]=(B*be-j*ue+Y*ae)*Ie,r[11]=(z*ue-I*be-F*ae)*Ie,r[12]=(_*Ne-g*Me-b*Ye)*Ie,r[13]=(n*Me-o*Ne+c*Ye)*Ie,r[14]=(j*J-B*de-W*ae)*Ie,r[15]=(I*de-z*J+D*ae)*Ie,r):null},l.at=Qp,l.au=Up,l.av=Jp,l.aw=function(){const r={},e=ye.$version;for(const n in ye.$root){const o=ye.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},l.ax=Ct,l.ay=oh,l.az=rn,l.b=function(r,e){const n=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(n).then(o=>{e(null,o)}).catch(o=>{e(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=Or,l.b1=function(r,e){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],_=r[5],b=r[6],k=r[7],I=r[8],z=r[9],D=r[10],F=r[11],B=r[12],j=r[13],W=r[14],Y=r[15],ae=e[0],J=e[1],ue=e[2],de=e[3],be=e[4],je=e[5],Ye=e[6],Ne=e[7],Oe=e[8],Me=e[9],qe=e[10],Le=e[11],Ie=e[12],nt=e[13],et=e[14],_t=e[15];return Math.abs(n-ae)<=mi*Math.max(1,Math.abs(n),Math.abs(ae))&&Math.abs(o-J)<=mi*Math.max(1,Math.abs(o),Math.abs(J))&&Math.abs(c-ue)<=mi*Math.max(1,Math.abs(c),Math.abs(ue))&&Math.abs(m-de)<=mi*Math.max(1,Math.abs(m),Math.abs(de))&&Math.abs(g-be)<=mi*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(_-je)<=mi*Math.max(1,Math.abs(_),Math.abs(je))&&Math.abs(b-Ye)<=mi*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(k-Ne)<=mi*Math.max(1,Math.abs(k),Math.abs(Ne))&&Math.abs(I-Oe)<=mi*Math.max(1,Math.abs(I),Math.abs(Oe))&&Math.abs(z-Me)<=mi*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(D-qe)<=mi*Math.max(1,Math.abs(D),Math.abs(qe))&&Math.abs(F-Le)<=mi*Math.max(1,Math.abs(F),Math.abs(Le))&&Math.abs(B-Ie)<=mi*Math.max(1,Math.abs(B),Math.abs(Ie))&&Math.abs(j-nt)<=mi*Math.max(1,Math.abs(j),Math.abs(nt))&&Math.abs(W-et)<=mi*Math.max(1,Math.abs(W),Math.abs(et))&&Math.abs(Y-_t)<=mi*Math.max(1,Math.abs(Y),Math.abs(_t))},l.b2=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.b3=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},l.b4=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},l.b5=Je,l.b6=Ly,l.b7=My,l.b8=function(r,e,n,o,c){var m,g=1/Math.tan(e/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},l.b9=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[4],g=e[5],_=e[6],b=e[7],k=e[8],I=e[9],z=e[10],D=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*c+k*o,r[5]=g*c+I*o,r[6]=_*c+z*o,r[7]=b*c+D*o,r[8]=k*c-m*o,r[9]=I*c-g*o,r[10]=z*c-_*o,r[11]=D*c-b*o,r},l.bA=ve,l.bB=ay,l.bC=No,l.bD=Pi,l.ba=Ee,l.bb=Ge,l.bc=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.bd=class extends Ja{},l.be=Wp,l.bf=Ay,l.bg=fw,l.bi=Yn,l.bj=function(r,e,n=!1){if(pi===uu||pi===cu||pi===hu)throw new Error("setRTLTextPlugin cannot be called multiple times.");ls=ci.resolveURL(r),pi=uu,du=e,pu(),n||hh()},l.bk=fu,l.bl=function(r,e){const n={};for(let c=0;c<r.length;c++){const m=e&&e[r[c].id]||$o(r[c]);e&&(e[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},l.bm=$e,l.bn=Fy,l.bo=Oy,l.bp=my,l.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=xr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Gt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Gt(k),r.canonical),o["text-size"].possiblyEvaluate(new Gt(I),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Gt(k),r.canonical),o["icon-size"].possiblyEvaluate(new Gt(I),r.canonical)]}const m=n.get("text-line-height")*kr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",_=n.get("text-keep-upright"),b=n.get("text-size");for(const k of r.bucket.features){const I=n.get("text-font").evaluate(k,{},r.canonical).join(","),z=b.evaluate(k,{},r.canonical),D=c.layoutTextSize.evaluate(k,{},r.canonical),F=c.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},j=k.text;let W,Y=[0,0];if(j){const ue=j.toString(),de=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*kr,be=ou(ue)?de:0,je=n.get("text-anchor").evaluate(k,{},r.canonical),Ye=Ky(e,k,r.canonical);if(!Ye){const Le=n.get("text-radial-offset").evaluate(k,{},r.canonical);Y=Le?Xy(je,[Le*kr,Yp]):n.get("text-offset").evaluate(k,{},r.canonical).map(Ie=>Ie*kr)}let Ne=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const Oe=n.get("symbol-placement"),Me=Oe==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*kr:0,qe=()=>{r.bucket.allowVerticalPlacement&&au(ue)&&(B.vertical=Ch(j,r.glyphMap,r.glyphPositions,r.imagePositions,I,Me,m,je,"left",be,Y,l.ai.vertical,!0,Oe,D,z))};if(!g&&Ye){const Le=new Set;if(Ne==="auto")for(let nt=0;nt<Ye.values.length;nt+=2)Le.add(Qp(Ye.values[nt]));else Le.add(Ne);let Ie=!1;for(const nt of Le)if(!B.horizontal[nt])if(Ie)B.horizontal[nt]=B.horizontal[0];else{const et=Ch(j,r.glyphMap,r.glyphPositions,r.imagePositions,I,Me,m,"center",nt,be,Y,l.ai.horizontal,!1,Oe,D,z);et&&(B.horizontal[nt]=et,Ie=et.positionedLines.length===1)}qe()}else{Ne==="auto"&&(Ne=Qp(je));const Le=Ch(j,r.glyphMap,r.glyphPositions,r.imagePositions,I,Me,m,je,Ne,be,Y,l.ai.horizontal,!1,Oe,D,z);Le&&(B.horizontal[Ne]=Le),qe(),au(ue)&&g&&_&&(B.vertical=Ch(j,r.glyphMap,r.glyphPositions,r.imagePositions,I,Me,m,je,Ne,be,Y,l.ai.vertical,!1,Oe,D,z))}}let ae=!1;if(k.icon&&k.icon.name){const ue=r.imageMap[k.icon.name];ue&&(W=X1(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),ae=!!ue.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ae:r.bucket.sdfIcons!==ae&&Dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const J=Qy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!J&&J.iconsInText,(J||W)&&dw(r.bucket,k,B,W,r.imageMap,c,D,F,Y,ae,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},l.br=Fp,l.bs=Dp,l.bt=Rp,l.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},l.bv=Op,l.bw=ca,l.bx=function(r,e,n,o,c){return G(this,void 0,void 0,function*(){if(ce())try{return yield Ut(r,e,n,o,c)}catch{}return function(m,g,_,b,k){const I=m.width,z=m.height;Bt&&Dt||(Bt=new OffscreenCanvas(I,z),Dt=Bt.getContext("2d",{willReadFrequently:!0})),Bt.width=I,Bt.height=z,Dt.drawImage(m,0,0,I,z);const D=Dt.getImageData(g,_,b,k);return Dt.clearRect(0,0,I,z),D.data}(r,e,n,o,c)})},l.by=Ry,l.bz=O,l.c=tn,l.d=function(r,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=gt})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(r)],{type:"image/png"});n.src=r.byteLength?URL.createObjectURL(o):gt},l.e=Ze,l.f=function(r,e){return Qn(Ze(r,{type:"json"}),e)},l.g=Ni,l.h=ci,l.i=$r,l.j=es,l.k=Jn,l.l=Ba,l.m=Qn,l.n=function(r){return new Op(r).readFields($1,[])},l.o=function(r,e,n){if(!r.length)return n(null,[]);let o=r.length;const c=new Array(r.length);let m=null;r.forEach((g,_)=>{e(g,(b,k)=>{b&&(m=b),c[_]=k,--o==0&&n(m,c)})})},l.p=fy,l.q=Iu,l.r=pr,l.s=Mn,l.t=fp,l.u=Ve,l.v=ye,l.w=Dr,l.x=Go,l.y=Bn,l.z=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}}}),T(["./shared"],function(l){class G{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,L){for(const H of A){this._layerConfigs[H.id]=H;const X=this._layers[H.id]=l.aC(H);X._featureFilter=l.a6(X.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of L)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const N=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const H of N){const X=H.map(xe=>this._layers[xe.id]),le=X[0];if(le.visibility==="none")continue;const ee=le.source||"";let Q=this.familiesBySource[ee];Q||(Q=this.familiesBySource[ee]={});const se=le.sourceLayer||"_geojsonTileLayer";let _e=Q[se];_e||(_e=Q[se]=[]),_e.push(X)}}}class O{constructor(A){const L={},N=[];for(const ee in A){const Q=A[ee],se=L[ee]={};for(const _e in Q){const xe=Q[+_e];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const Se={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};N.push(Se),se[_e]={rect:Se,metrics:xe.metrics}}}const{w:H,h:X}=l.p(N),le=new l.q({width:H||1,height:X||1});for(const ee in A){const Q=A[ee];for(const se in Q){const _e=Q[+se];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const xe=L[ee][se].rect;l.q.copy(_e.bitmap,le,{x:0,y:0},{x:xe.x+1,y:xe.y+1},_e.bitmap)}}this.image=le,this.positions=L}}l.bm("GlyphAtlas",O);class ve{constructor(A){this.tileID=new l.O(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(A,L,N,H,X){this.status="parsing",this.data=A,this.collisionBoxArray=new l.a3;const le=new l.bn(Object.keys(A.layers).sort()),ee=new l.bo(this.tileID,this.promoteId);ee.bucketLayerIDs=[];const Q={},se={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},_e=L.familiesBySource[this.source];for(const Et in _e){const kt=A.layers[Et];if(!kt)continue;kt.version===1&&l.w(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zr=le.encode(Et),$t=[];for(let vr=0;vr<kt.length;vr++){const Fr=kt.feature(vr),ji=ee.getId(Fr,Et);$t.push({feature:Fr,id:ji,index:vr,sourceLayerIndex:Zr})}for(const vr of _e[Et]){const Fr=vr[0];Fr.source!==this.source&&l.w(`layer.source = ${Fr.source} does not equal this.source = ${this.source}`),Fr.minzoom&&this.zoom<Math.floor(Fr.minzoom)||Fr.maxzoom&&this.zoom>=Fr.maxzoom||Fr.visibility!=="none"&&(ge(vr,this.zoom,N),(Q[Fr.id]=Fr.createBucket({index:ee.bucketLayerIDs.length,layers:vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zr,sourceID:this.source})).populate($t,se,this.tileID.canonical),ee.bucketLayerIDs.push(vr.map(ji=>ji.id)))}}let xe,Se,it,ut;const Xe=l.aH(se.glyphDependencies,Et=>Object.keys(Et).map(Number));this.inFlightDependencies.forEach(Et=>Et==null?void 0:Et.cancel()),this.inFlightDependencies=[];const st=++this.dependencySentinel;Object.keys(Xe).length?this.inFlightDependencies.push(H.send("getGlyphs",{uid:this.uid,stacks:Xe,source:this.source,tileID:this.tileID,type:"glyphs"},(Et,kt)=>{st===this.dependencySentinel&&(xe||(xe=Et,Se=kt,Ot.call(this)))})):Se={};const ht=Object.keys(se.iconDependencies);ht.length?this.inFlightDependencies.push(H.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},(Et,kt)=>{st===this.dependencySentinel&&(xe||(xe=Et,it=kt,Ot.call(this)))})):it={};const At=Object.keys(se.patternDependencies);function Ot(){if(xe)return X(xe);if(Se&&it&&ut){const Et=new O(Se),kt=new l.bp(it,ut);for(const Zr in Q){const $t=Q[Zr];$t instanceof l.a4?(ge($t.layers,this.zoom,N),l.bq({bucket:$t,glyphMap:Se,glyphPositions:Et.positions,imageMap:it,imagePositions:kt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$t.hasPattern&&($t instanceof l.br||$t instanceof l.bs||$t instanceof l.bt)&&(ge($t.layers,this.zoom,N),$t.addFeatures(se,this.tileID.canonical,kt.patternPositions))}this.status="done",X(null,{buckets:Object.values(Q).filter(Zr=>!Zr.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,imageAtlas:kt,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?it:null,glyphPositions:this.returnDependencies?Et.positions:null})}}At.length?this.inFlightDependencies.push(H.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"patterns"},(Et,kt)=>{st===this.dependencySentinel&&(xe||(xe=Et,ut=kt,Ot.call(this)))})):ut={},Ot.call(this)}}function ge(Z,A,L){const N=new l.a8(A);for(const H of Z)H.recalculate(N,L)}function oe(Z,A){const L=l.l(Z.request,(N,H,X,le)=>{if(N)A(N);else if(H)try{const ee=new l.bw.VectorTile(new l.bv(H));A(null,{vectorTile:ee,rawData:H,cacheControl:X,expires:le})}catch(ee){const Q=new Uint8Array(H);let se=`Unable to parse the tile at ${Z.request.url}, `;se+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.messge}`,A(new Error(se))}});return()=>{L.cancel(),A()}}class ze{constructor(A,L,N,H){this.actor=A,this.layerIndex=L,this.availableImages=N,this.loadVectorData=H||oe,this.fetching={},this.loading={},this.loaded={}}loadTile(A,L){const N=A.uid;this.loading||(this.loading={});const H=!!(A&&A.request&&A.request.collectResourceTiming)&&new l.bu(A.request),X=this.loading[N]=new ve(A);X.abort=this.loadVectorData(A,(le,ee)=>{if(delete this.loading[N],le||!ee)return X.status="done",this.loaded[N]=X,L(le);const Q=ee.rawData,se={};ee.expires&&(se.expires=ee.expires),ee.cacheControl&&(se.cacheControl=ee.cacheControl);const _e={};if(H){const xe=H.finish();xe&&(_e.resourceTiming=JSON.parse(JSON.stringify(xe)))}X.vectorTile=ee.vectorTile,X.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,Se)=>{if(delete this.fetching[N],xe||!Se)return L(xe);L(null,l.e({rawTileData:Q.slice(0)},Se,se,_e))}),this.loaded=this.loaded||{},this.loaded[N]=X,this.fetching[N]={rawTileData:Q,cacheControl:se,resourceTiming:_e}})}reloadTile(A,L){const N=this.loaded,H=A.uid;if(N&&N[H]){const X=N[H];X.showCollisionBoxes=A.showCollisionBoxes,X.status==="parsing"?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,(le,ee)=>{if(le||!ee)return L(le,ee);let Q;if(this.fetching[H]){const{rawTileData:se,cacheControl:_e,resourceTiming:xe}=this.fetching[H];delete this.fetching[H],Q=l.e({rawTileData:se.slice(0)},ee,_e,xe)}else Q=ee;L(null,Q)}):X.status==="done"&&(X.vectorTile?X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,L):L())}}abortTile(A,L){const N=this.loading,H=A.uid;N&&N[H]&&N[H].abort&&(N[H].abort(),delete N[H]),L()}removeTile(A,L){const N=this.loaded,H=A.uid;N&&N[H]&&delete N[H],L()}}class Fe{constructor(){this.loaded={}}loadTile(A,L){return l._(this,void 0,void 0,function*(){const{uid:N,encoding:H,rawImageData:X,redFactor:le,greenFactor:ee,blueFactor:Q,baseShift:se}=A,_e=X.width+2,xe=X.height+2,Se=l.a(X)?new l.R({width:_e,height:xe},yield l.bx(X,-1,-1,_e,xe)):X,it=new l.by(N,Se,H,le,ee,Q,se);this.loaded=this.loaded||{},this.loaded[N]=it,L(null,it)})}removeTile(A){const L=this.loaded,N=A.uid;L&&L[N]&&delete L[N]}}function Ce(Z,A){if(Z.length!==0){lt(Z[0],A);for(var L=1;L<Z.length;L++)lt(Z[L],!A)}}function lt(Z,A){for(var L=0,N=0,H=0,X=Z.length,le=X-1;H<X;le=H++){var ee=(Z[H][0]-Z[le][0])*(Z[le][1]+Z[H][1]),Q=L+ee;N+=Math.abs(L)>=Math.abs(ee)?L-Q+ee:ee-Q+L,L=Q}L+N>=0!=!!A&&Z.reverse()}var ie=l.bz(function Z(A,L){var N,H=A&&A.type;if(H==="FeatureCollection")for(N=0;N<A.features.length;N++)Z(A.features[N],L);else if(H==="GeometryCollection")for(N=0;N<A.geometries.length;N++)Z(A.geometries[N],L);else if(H==="Feature")Z(A.geometry,L);else if(H==="Polygon")Ce(A.coordinates,L);else if(H==="MultiPolygon")for(N=0;N<A.coordinates.length;N++)Ce(A.coordinates[N],L);return A});const te=l.bw.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},Ee=l.bA,Ge=l.bw.VectorTileFeature,We=Je;function Je(Z,A){this.options=A||{},this.features=Z,this.length=Z.length}function Ze(Z,A){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=A||4096}Je.prototype.feature=function(Z){return new Ze(this.features[Z],this.options.extent)},Ze.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var A=0;A<Z.length;A++){for(var L=Z[A],N=[],H=0;H<L.length;H++)N.push(new Ee(L[H][0],L[H][1]));this.geometry.push(N)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,A=1/0,L=-1/0,N=1/0,H=-1/0,X=0;X<Z.length;X++)for(var le=Z[X],ee=0;ee<le.length;ee++){var Q=le[ee];A=Math.min(A,Q.x),L=Math.max(L,Q.x),N=Math.min(N,Q.y),H=Math.max(H,Q.y)}return[A,N,L,H]},Ze.prototype.toGeoJSON=Ge.prototype.toGeoJSON;var Vt=l.bB,Ue=We;function Ar(Z){var A=new Vt;return function(L,N){for(var H in L.layers)N.writeMessage(3,Rr,L.layers[H])}(Z,A),A.finish()}function Rr(Z,A){var L;A.writeVarintField(15,Z.version||1),A.writeStringField(1,Z.name||""),A.writeVarintField(5,Z.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<Z.length;L++)N.feature=Z.feature(L),A.writeMessage(2,ui,N);var H=N.keys;for(L=0;L<H.length;L++)A.writeStringField(3,H[L]);var X=N.values;for(L=0;L<X.length;L++)A.writeMessage(4,He,X[L])}function ui(Z,A){var L=Z.feature;L.id!==void 0&&A.writeVarintField(1,L.id),A.writeMessage(2,Dr,Z),A.writeVarintField(3,L.type),A.writeMessage(4,$r,L)}function Dr(Z,A){var L=Z.feature,N=Z.keys,H=Z.values,X=Z.keycache,le=Z.valuecache;for(var ee in L.properties){var Q=L.properties[ee],se=X[ee];if(Q!==null){se===void 0&&(N.push(ee),X[ee]=se=N.length-1),A.writeVarint(se);var _e=typeof Q;_e!=="string"&&_e!=="boolean"&&_e!=="number"&&(Q=JSON.stringify(Q));var xe=_e+":"+Q,Se=le[xe];Se===void 0&&(H.push(Q),le[xe]=Se=H.length-1),A.writeVarint(Se)}}}function Qr(Z,A){return(A<<3)+(7&Z)}function Ti(Z){return Z<<1^Z>>31}function $r(Z,A){for(var L=Z.loadGeometry(),N=Z.type,H=0,X=0,le=L.length,ee=0;ee<le;ee++){var Q=L[ee],se=1;N===1&&(se=Q.length),A.writeVarint(Qr(1,se));for(var _e=N===3?Q.length-1:Q.length,xe=0;xe<_e;xe++){xe===1&&N!==1&&A.writeVarint(Qr(2,_e-1));var Se=Q[xe].x-H,it=Q[xe].y-X;A.writeVarint(Ti(Se)),A.writeVarint(Ti(it)),H+=Se,X+=it}N===3&&A.writeVarint(Qr(7,1))}}function He(Z,A){var L=typeof Z;L==="string"?A.writeStringField(1,Z):L==="boolean"?A.writeBooleanField(7,Z):L==="number"&&(Z%1!=0?A.writeDoubleField(3,Z):Z<0?A.writeSVarintField(6,Z):A.writeVarintField(5,Z))}ce.exports=Ar,ce.exports.fromVectorTileJs=Ar,ce.exports.fromGeojsonVt=function(Z,A){A=A||{};var L={};for(var N in Z)L[N]=new Ue(Z[N].features,A),L[N].name=N,L[N].version=A.version,L[N].extent=A.extent;return Ar({layers:L})},ce.exports.GeoJSONWrapper=Ue;var dt=l.bz(ce.exports);const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},Ut=Math.fround||(Bt=new Float32Array(1),Z=>(Bt[0]=+Z,Bt[0]));var Bt;const Dt=3,lr=5,en=6;class ci{constructor(A){this.options=Object.assign(Object.create(gt),A),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(A){const{log:L,minZoom:N,maxZoom:H}=this.options;L&&console.time("total time");const X=`prepare ${A.length} points`;L&&console.time(X),this.points=A;const le=[];for(let Q=0;Q<A.length;Q++){const se=A[Q];if(!se.geometry)continue;const[_e,xe]=se.geometry.coordinates,Se=Ut(rn(_e)),it=Ut(Ni(xe));le.push(Se,it,1/0,Q,-1,1),this.options.reduce&&le.push(0)}let ee=this.trees[H+1]=this._createTree(le);L&&console.timeEnd(X);for(let Q=H;Q>=N;Q--){const se=+Date.now();ee=this.trees[Q]=this._createTree(this._cluster(ee,Q)),L&&console.log("z%d: %d clusters in %dms",Q,ee.numItems,+Date.now()-se)}return L&&console.timeEnd("total time"),this}getClusters(A,L){let N=((A[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,A[1]));let X=A[2]===180?180:((A[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)N=-180,X=180;else if(N>X){const xe=this.getClusters([N,H,180,le],L),Se=this.getClusters([-180,H,X,le],L);return xe.concat(Se)}const ee=this.trees[this._limitZoom(L)],Q=ee.range(rn(N),Ni(le),rn(X),Ni(H)),se=ee.data,_e=[];for(const xe of Q){const Se=this.stride*xe;_e.push(se[Se+lr]>1?tn(se,Se,this.clusterProps):this.points[se[Se+Dt]])}return _e}getChildren(A){const L=this._getOriginId(A),N=this._getOriginZoom(A),H="No cluster with the specified id.",X=this.trees[N];if(!X)throw new Error(H);const le=X.data;if(L*this.stride>=le.length)throw new Error(H);const ee=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Q=X.within(le[L*this.stride],le[L*this.stride+1],ee),se=[];for(const _e of Q){const xe=_e*this.stride;le[xe+4]===A&&se.push(le[xe+lr]>1?tn(le,xe,this.clusterProps):this.points[le[xe+Dt]])}if(se.length===0)throw new Error(H);return se}getLeaves(A,L,N){const H=[];return this._appendLeaves(H,A,L=L||10,N=N||0,0),H}getTile(A,L,N){const H=this.trees[this._limitZoom(A)],X=Math.pow(2,A),{extent:le,radius:ee}=this.options,Q=ee/le,se=(N-Q)/X,_e=(N+1+Q)/X,xe={features:[]};return this._addTileFeatures(H.range((L-Q)/X,se,(L+1+Q)/X,_e),H.data,L,N,X,xe),L===0&&this._addTileFeatures(H.range(1-Q/X,se,1,_e),H.data,X,N,X,xe),L===X-1&&this._addTileFeatures(H.range(0,se,Q/X,_e),H.data,-1,N,X,xe),xe.features.length?xe:null}getClusterExpansionZoom(A){let L=this._getOriginZoom(A)-1;for(;L<=this.options.maxZoom;){const N=this.getChildren(A);if(L++,N.length!==1)break;A=N[0].properties.cluster_id}return L}_appendLeaves(A,L,N,H,X){const le=this.getChildren(L);for(const ee of le){const Q=ee.properties;if(Q&&Q.cluster?X+Q.point_count<=H?X+=Q.point_count:X=this._appendLeaves(A,Q.cluster_id,N,H,X):X<H?X++:A.push(ee),A.length===N)break}return X}_createTree(A){const L=new l.av(A.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<A.length;N+=this.stride)L.add(A[N],A[N+1]);return L.finish(),L.data=A,L}_addTileFeatures(A,L,N,H,X,le){for(const ee of A){const Q=ee*this.stride,se=L[Q+lr]>1;let _e,xe,Se;if(se)_e=Yn(L,Q,this.clusterProps),xe=L[Q],Se=L[Q+1];else{const Xe=this.points[L[Q+Dt]];_e=Xe.properties;const[st,ht]=Xe.geometry.coordinates;xe=rn(st),Se=Ni(ht)}const it={type:1,geometry:[[Math.round(this.options.extent*(xe*X-N)),Math.round(this.options.extent*(Se*X-H))]],tags:_e};let ut;ut=se||this.options.generateId?L[Q+Dt]:this.points[L[Q+Dt]].id,ut!==void 0&&(it.id=ut),le.features.push(it)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(Math.floor(+A),this.options.maxZoom+1))}_cluster(A,L){const{radius:N,extent:H,reduce:X,minPoints:le}=this.options,ee=N/(H*Math.pow(2,L)),Q=A.data,se=[],_e=this.stride;for(let xe=0;xe<Q.length;xe+=_e){if(Q[xe+2]<=L)continue;Q[xe+2]=L;const Se=Q[xe],it=Q[xe+1],ut=A.within(Q[xe],Q[xe+1],ee),Xe=Q[xe+lr];let st=Xe;for(const ht of ut){const At=ht*_e;Q[At+2]>L&&(st+=Q[At+lr])}if(st>Xe&&st>=le){let ht,At=Se*Xe,Ot=it*Xe,Et=-1;const kt=((xe/_e|0)<<5)+(L+1)+this.points.length;for(const Zr of ut){const $t=Zr*_e;if(Q[$t+2]<=L)continue;Q[$t+2]=L;const vr=Q[$t+lr];At+=Q[$t]*vr,Ot+=Q[$t+1]*vr,Q[$t+4]=kt,X&&(ht||(ht=this._map(Q,xe,!0),Et=this.clusterProps.length,this.clusterProps.push(ht)),X(ht,this._map(Q,$t)))}Q[xe+4]=kt,se.push(At/st,Ot/st,1/0,kt,-1,st),X&&se.push(Et)}else{for(let ht=0;ht<_e;ht++)se.push(Q[xe+ht]);if(st>1)for(const ht of ut){const At=ht*_e;if(!(Q[At+2]<=L)){Q[At+2]=L;for(let Ot=0;Ot<_e;Ot++)se.push(Q[At+Ot])}}}}return se}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,L,N){if(A[L+lr]>1){const le=this.clusterProps[A[L+en]];return N?Object.assign({},le):le}const H=this.points[A[L+Dt]].properties,X=this.options.map(H);return N&&X===H?Object.assign({},X):X}}function tn(Z,A,L){return{type:"Feature",id:Z[A+Dt],properties:Yn(Z,A,L),geometry:{type:"Point",coordinates:[(N=Z[A],360*(N-.5)),Fa(Z[A+1])]}};var N}function Yn(Z,A,L){const N=Z[A+lr],H=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,X=Z[A+en],le=X===-1?{}:Object.assign({},L[X]);return Object.assign(le,{cluster:!0,cluster_id:Z[A+Dt],point_count:N,point_count_abbreviated:H})}function rn(Z){return Z/360+.5}function Ni(Z){const A=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return L<0?0:L>1?1:L}function Fa(Z){const A=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function Qn(Z,A,L,N){for(var H,X=N,le=L-A>>1,ee=L-A,Q=Z[A],se=Z[A+1],_e=Z[L],xe=Z[L+1],Se=A+3;Se<L;Se+=3){var it=Ba(Z[Se],Z[Se+1],Q,se,_e,xe);if(it>X)H=Se,X=it;else if(it===X){var ut=Math.abs(Se-le);ut<ee&&(H=Se,ee=ut)}}X>N&&(H-A>3&&Qn(Z,A,H,N),Z[H+2]=X,L-H>3&&Qn(Z,H,L,N))}function Ba(Z,A,L,N,H,X){var le=H-L,ee=X-N;if(le!==0||ee!==0){var Q=((Z-L)*le+(A-N)*ee)/(le*le+ee*ee);Q>1?(L=H,N=X):Q>0&&(L+=le*Q,N+=ee*Q)}return(le=Z-L)*le+(ee=A-N)*ee}function Mn(Z,A,L,N){var H={id:Z===void 0?null:Z,type:A,geometry:L,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(X){var le=X.geometry,ee=X.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Hs(X,le);else if(ee==="Polygon"||ee==="MultiLineString")for(var Q=0;Q<le.length;Q++)Hs(X,le[Q]);else if(ee==="MultiPolygon")for(Q=0;Q<le.length;Q++)for(var se=0;se<le[Q].length;se++)Hs(X,le[Q][se])}(H),H}function Hs(Z,A){for(var L=0;L<A.length;L+=3)Z.minX=Math.min(Z.minX,A[L]),Z.minY=Math.min(Z.minY,A[L+1]),Z.maxX=Math.max(Z.maxX,A[L]),Z.maxY=Math.max(Z.maxY,A[L+1])}function ys(Z,A,L,N){if(A.geometry){var H=A.geometry.coordinates,X=A.geometry.type,le=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),ee=[],Q=A.id;if(L.promoteId?Q=A.properties[L.promoteId]:L.generateId&&(Q=N||0),X==="Point")Jn(H,ee);else if(X==="MultiPoint")for(var se=0;se<H.length;se++)Jn(H[se],ee);else if(X==="LineString")es(H,ee,le,!1);else if(X==="MultiLineString"){if(L.lineMetrics){for(se=0;se<H.length;se++)es(H[se],ee=[],le,!1),Z.push(Mn(Q,"LineString",ee,A.properties));return}_s(H,ee,le,!1)}else if(X==="Polygon")_s(H,ee,le,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(se=0;se<A.geometry.geometries.length;se++)ys(Z,{id:Q,geometry:A.geometry.geometries[se],properties:A.properties},L,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<H.length;se++){var _e=[];_s(H[se],_e,le,!0),ee.push(_e)}}Z.push(Mn(Q,X,ee,A.properties))}}function Jn(Z,A){A.push(ye(Z[0])),A.push(hi(Z[1])),A.push(0)}function es(Z,A,L,N){for(var H,X,le=0,ee=0;ee<Z.length;ee++){var Q=ye(Z[ee][0]),se=hi(Z[ee][1]);A.push(Q),A.push(se),A.push(0),ee>0&&(le+=N?(H*se-Q*X)/2:Math.sqrt(Math.pow(Q-H,2)+Math.pow(se-X,2))),H=Q,X=se}var _e=A.length-3;A[2]=1,Qn(A,0,_e,L),A[_e+2]=1,A.size=Math.abs(le),A.start=0,A.end=A.size}function _s(Z,A,L,N){for(var H=0;H<Z.length;H++){var X=[];es(Z[H],X,L,N),A.push(X)}}function ye(Z){return Z/360+.5}function hi(Z){var A=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return L<0?0:L>1?1:L}function Vi(Z,A,L,N,H,X,le,ee){if(N/=A,X>=(L/=A)&&le<N)return Z;if(le<L||X>=N)return null;for(var Q=[],se=0;se<Z.length;se++){var _e=Z[se],xe=_e.geometry,Se=_e.type,it=H===0?_e.minX:_e.minY,ut=H===0?_e.maxX:_e.maxY;if(it>=L&&ut<N)Q.push(_e);else if(!(ut<L||it>=N)){var Xe=[];if(Se==="Point"||Se==="MultiPoint")jt(xe,Xe,L,N,H);else if(Se==="LineString")Ct(xe,Xe,L,N,H,!1,ee.lineMetrics);else if(Se==="MultiLineString")Ws(xe,Xe,L,N,H,!1);else if(Se==="Polygon")Ws(xe,Xe,L,N,H,!0);else if(Se==="MultiPolygon")for(var st=0;st<xe.length;st++){var ht=[];Ws(xe[st],ht,L,N,H,!0),ht.length&&Xe.push(ht)}if(Xe.length){if(ee.lineMetrics&&Se==="LineString"){for(st=0;st<Xe.length;st++)Q.push(Mn(_e.id,Se,Xe[st],_e.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(Xe.length===1?(Se="LineString",Xe=Xe[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=Xe.length===3?"Point":"MultiPoint"),Q.push(Mn(_e.id,Se,Xe,_e.tags))}}}return Q.length?Q:null}function jt(Z,A,L,N,H){for(var X=0;X<Z.length;X+=3){var le=Z[X+H];le>=L&&le<=N&&(A.push(Z[X]),A.push(Z[X+1]),A.push(Z[X+2]))}}function Ct(Z,A,L,N,H,X,le){for(var ee,Q,se=fn(Z),_e=H===0?wo:Xs,xe=Z.start,Se=0;Se<Z.length-3;Se+=3){var it=Z[Se],ut=Z[Se+1],Xe=Z[Se+2],st=Z[Se+3],ht=Z[Se+4],At=H===0?it:ut,Ot=H===0?st:ht,Et=!1;le&&(ee=Math.sqrt(Math.pow(it-st,2)+Math.pow(ut-ht,2))),At<L?Ot>L&&(Q=_e(se,it,ut,st,ht,L),le&&(se.start=xe+ee*Q)):At>N?Ot<N&&(Q=_e(se,it,ut,st,ht,N),le&&(se.start=xe+ee*Q)):An(se,it,ut,Xe),Ot<L&&At>=L&&(Q=_e(se,it,ut,st,ht,L),Et=!0),Ot>N&&At<=N&&(Q=_e(se,it,ut,st,ht,N),Et=!0),!X&&Et&&(le&&(se.end=xe+ee*Q),A.push(se),se=fn(Z)),le&&(xe+=ee)}var kt=Z.length-3;it=Z[kt],ut=Z[kt+1],Xe=Z[kt+2],(At=H===0?it:ut)>=L&&At<=N&&An(se,it,ut,Xe),kt=se.length-3,X&&kt>=3&&(se[kt]!==se[0]||se[kt+1]!==se[1])&&An(se,se[0],se[1],se[2]),se.length&&A.push(se)}function fn(Z){var A=[];return A.size=Z.size,A.start=Z.start,A.end=Z.end,A}function Ws(Z,A,L,N,H,X){for(var le=0;le<Z.length;le++)Ct(Z[le],A,L,N,H,X,!1)}function An(Z,A,L,N){Z.push(A),Z.push(L),Z.push(N)}function wo(Z,A,L,N,H,X){var le=(X-A)/(N-A);return Z.push(X),Z.push(L+(H-L)*le),Z.push(1),le}function Xs(Z,A,L,N,H,X){var le=(X-L)/(H-L);return Z.push(A+(N-A)*le),Z.push(X),Z.push(1),le}function ts(Z,A){for(var L=[],N=0;N<Z.length;N++){var H,X=Z[N],le=X.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")H=vs(X.geometry,A);else if(le==="MultiLineString"||le==="Polygon"){H=[];for(var ee=0;ee<X.geometry.length;ee++)H.push(vs(X.geometry[ee],A))}else if(le==="MultiPolygon")for(H=[],ee=0;ee<X.geometry.length;ee++){for(var Q=[],se=0;se<X.geometry[ee].length;se++)Q.push(vs(X.geometry[ee][se],A));H.push(Q)}L.push(Mn(X.id,le,H,X.tags))}return L}function vs(Z,A){var L=[];L.size=Z.size,Z.start!==void 0&&(L.start=Z.start,L.end=Z.end);for(var N=0;N<Z.length;N+=3)L.push(Z[N]+A,Z[N+1],Z[N+2]);return L}function Ae(Z,A){if(Z.transformed)return Z;var L,N,H,X=1<<Z.z,le=Z.x,ee=Z.y;for(L=0;L<Z.features.length;L++){var Q=Z.features[L],se=Q.geometry,_e=Q.type;if(Q.geometry=[],_e===1)for(N=0;N<se.length;N+=2)Q.geometry.push(mn(se[N],se[N+1],A,X,le,ee));else for(N=0;N<se.length;N++){var xe=[];for(H=0;H<se[N].length;H+=2)xe.push(mn(se[N][H],se[N][H+1],A,X,le,ee));Q.geometry.push(xe)}}return Z.transformed=!0,Z}function mn(Z,A,L,N,H,X){return[Math.round(L*(Z*N-H)),Math.round(L*(A*N-X))]}function rr(Z,A,L,N,H){for(var X=A===H.maxZoom?0:H.tolerance/((1<<A)*H.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:N,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ee=0;ee<Z.length;ee++){le.numFeatures++,xs(le,Z[ee],X,H);var Q=Z[ee].minX,se=Z[ee].minY,_e=Z[ee].maxX,xe=Z[ee].maxY;Q<le.minX&&(le.minX=Q),se<le.minY&&(le.minY=se),_e>le.maxX&&(le.maxX=_e),xe>le.maxY&&(le.maxY=xe)}return le}function xs(Z,A,L,N){var H=A.geometry,X=A.type,le=[];if(X==="Point"||X==="MultiPoint")for(var ee=0;ee<H.length;ee+=3)le.push(H[ee]),le.push(H[ee+1]),Z.numPoints++,Z.numSimplified++;else if(X==="LineString")Dn(le,H,Z,L,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(ee=0;ee<H.length;ee++)Dn(le,H[ee],Z,L,X==="Polygon",ee===0);else if(X==="MultiPolygon")for(var Q=0;Q<H.length;Q++){var se=H[Q];for(ee=0;ee<se.length;ee++)Dn(le,se[ee],Z,L,!0,ee===0)}if(le.length){var _e=A.tags||null;if(X==="LineString"&&N.lineMetrics){for(var xe in _e={},A.tags)_e[xe]=A.tags[xe];_e.mapbox_clip_start=H.start/H.size,_e.mapbox_clip_end=H.end/H.size}var Se={geometry:le,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:_e};A.id!==null&&(Se.id=A.id),Z.features.push(Se)}}function Dn(Z,A,L,N,H,X){var le=N*N;if(N>0&&A.size<(H?le:N))L.numPoints+=A.length/3;else{for(var ee=[],Q=0;Q<A.length;Q+=3)(N===0||A[Q+2]>le)&&(L.numSimplified++,ee.push(A[Q]),ee.push(A[Q+1])),L.numPoints++;H&&function(se,_e){for(var xe=0,Se=0,it=se.length,ut=it-2;Se<it;ut=Se,Se+=2)xe+=(se[Se]-se[ut])*(se[Se+1]+se[ut+1]);if(xe>0===_e)for(Se=0,it=se.length;Se<it/2;Se+=2){var Xe=se[Se],st=se[Se+1];se[Se]=se[it-2-Se],se[Se+1]=se[it-1-Se],se[it-2-Se]=Xe,se[it-1-Se]=st}}(ee,X),Z.push(ee)}}function Re(Z,A){var L=(A=this.options=function(H,X){for(var le in X)H[le]=X[le];return H}(Object.create(this.options),A)).debug;if(L&&console.time("preprocess data"),A.maxZoom<0||A.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(A.promoteId&&A.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(H,X){var le=[];if(H.type==="FeatureCollection")for(var ee=0;ee<H.features.length;ee++)ys(le,H.features[ee],X,ee);else ys(le,H.type==="Feature"?H:{geometry:H},X);return le}(Z,A);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",A.indexMaxZoom,A.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(H,X){var le=X.buffer/X.extent,ee=H,Q=Vi(H,1,-1-le,le,0,-1,2,X),se=Vi(H,1,1-le,2+le,0,-1,2,X);return(Q||se)&&(ee=Vi(H,1,-le,1+le,0,-1,2,X)||[],Q&&(ee=ts(Q,1).concat(ee)),se&&(ee=ee.concat(ts(se,-1)))),ee}(N,A),N.length&&this.splitTile(N,0,0,0),L&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mt(Z,A,L){return 32*((1<<Z)*L+A)+Z}function ct(Z,A){return A?Z.properties[A]:Z.id}function Jr(Z,A){if(Z==null)return!0;if(Z.type==="Feature")return ct(Z,A)!=null;if(Z.type==="FeatureCollection"){const L=new Set;for(const N of Z.features){const H=ct(N,A);if(H==null||L.has(H))return!1;L.add(H)}return!0}return!1}function gn(Z,A){const L=new Map;if(Z!=null)if(Z.type==="Feature")L.set(ct(Z,A),Z);else for(const N of Z.features)L.set(ct(N,A),N);return L}Re.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Re.prototype.splitTile=function(Z,A,L,N,H,X,le){for(var ee=[Z,A,L,N],Q=this.options,se=Q.debug;ee.length;){N=ee.pop(),L=ee.pop(),A=ee.pop(),Z=ee.pop();var _e=1<<A,xe=mt(A,L,N),Se=this.tiles[xe];if(!Se&&(se>1&&console.time("creation"),Se=this.tiles[xe]=rr(Z,A,L,N,Q),this.tileCoords.push({z:A,x:L,y:N}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",A,L,N,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var it="z"+A;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(Se.source=Z,H){if(A===Q.maxZoom||A===H)continue;var ut=1<<H-A;if(L!==Math.floor(X/ut)||N!==Math.floor(le/ut))continue}else if(A===Q.indexMaxZoom||Se.numPoints<=Q.indexMaxPoints)continue;if(Se.source=null,Z.length!==0){se>1&&console.time("clipping");var Xe,st,ht,At,Ot,Et,kt=.5*Q.buffer/Q.extent,Zr=.5-kt,$t=.5+kt,vr=1+kt;Xe=st=ht=At=null,Ot=Vi(Z,_e,L-kt,L+$t,0,Se.minX,Se.maxX,Q),Et=Vi(Z,_e,L+Zr,L+vr,0,Se.minX,Se.maxX,Q),Z=null,Ot&&(Xe=Vi(Ot,_e,N-kt,N+$t,1,Se.minY,Se.maxY,Q),st=Vi(Ot,_e,N+Zr,N+vr,1,Se.minY,Se.maxY,Q),Ot=null),Et&&(ht=Vi(Et,_e,N-kt,N+$t,1,Se.minY,Se.maxY,Q),At=Vi(Et,_e,N+Zr,N+vr,1,Se.minY,Se.maxY,Q),Et=null),se>1&&console.timeEnd("clipping"),ee.push(Xe||[],A+1,2*L,2*N),ee.push(st||[],A+1,2*L,2*N+1),ee.push(ht||[],A+1,2*L+1,2*N),ee.push(At||[],A+1,2*L+1,2*N+1)}}},Re.prototype.getTile=function(Z,A,L){var N=this.options,H=N.extent,X=N.debug;if(Z<0||Z>24)return null;var le=1<<Z,ee=mt(Z,A=(A%le+le)%le,L);if(this.tiles[ee])return Ae(this.tiles[ee],H);X>1&&console.log("drilling down to z%d-%d-%d",Z,A,L);for(var Q,se=Z,_e=A,xe=L;!Q&&se>0;)se--,_e=Math.floor(_e/2),xe=Math.floor(xe/2),Q=this.tiles[mt(se,_e,xe)];return Q&&Q.source?(X>1&&console.log("found parent tile z%d-%d-%d",se,_e,xe),X>1&&console.time("drilling down"),this.splitTile(Q.source,se,_e,xe,Z,A,L),X>1&&console.timeEnd("drilling down"),this.tiles[ee]?Ae(this.tiles[ee],H):null):null};class pt extends ze{constructor(A,L,N,H){super(A,L,N),this._dataUpdateable=new Map,this.loadGeoJSON=(X,le)=>{const{promoteId:ee}=X;if(X.request)return l.f(X.request,(Q,se,_e,xe)=>{this._dataUpdateable=Jr(se,ee)?gn(se,ee):void 0,le(Q,se,_e,xe)});if(typeof X.data=="string")try{const Q=JSON.parse(X.data);this._dataUpdateable=Jr(Q,ee)?gn(Q,ee):void 0,le(null,Q)}catch{le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}else X.dataDiff?this._dataUpdateable?(function(Q,se,_e){var xe,Se,it,ut;if(se.removeAll&&Q.clear(),se.remove)for(const Xe of se.remove)Q.delete(Xe);if(se.add)for(const Xe of se.add){const st=ct(Xe,_e);st!=null&&Q.set(st,Xe)}if(se.update)for(const Xe of se.update){let st=Q.get(Xe.id);if(st==null)continue;const ht=!Xe.removeAllProperties&&(((xe=Xe.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((Se=Xe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||ht)&&(st=Object.assign({},st),Q.set(Xe.id,st),ht&&(st.properties=Object.assign({},st.properties))),Xe.newGeometry&&(st.geometry=Xe.newGeometry),Xe.removeAllProperties)st.properties={};else if(((it=Xe.removeProperties)===null||it===void 0?void 0:it.length)>0)for(const At of Xe.removeProperties)Object.prototype.hasOwnProperty.call(st.properties,At)&&delete st.properties[At];if(((ut=Xe.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0)for(const{key:At,value:Ot}of Xe.addOrUpdateProperties)st.properties[At]=Ot}}(this._dataUpdateable,X.dataDiff,ee),le(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):le(new Error(`Cannot update existing geojson data in ${X.source}`)):le(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,H&&(this.loadGeoJSON=H)}loadGeoJSONTile(A,L){const N=A.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const H=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!H)return L(null,null);const X=new class{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=ee.length,this._features=ee}feature(ee){return new class{constructor(Q){this._feature=Q,this.extent=l.N,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const se of this._feature.geometry)Q.push([new l.P(se[0],se[1])]);return Q}{const Q=[];for(const se of this._feature.geometry){const _e=[];for(const xe of se)_e.push(new l.P(xe[0],xe[1]));Q.push(_e)}return Q}}toGeoJSON(Q,se,_e){return te.call(this,Q,se,_e)}}(this._features[ee])}}(H.features);let le=dt(X);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),L(null,{vectorTile:X,rawData:le.buffer})}loadData(A,L){var N;(N=this._pendingRequest)===null||N===void 0||N.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const H=!!(A&&A.request&&A.request.collectResourceTiming)&&new l.bu(A.request);this._pendingCallback=L,this._pendingRequest=this.loadGeoJSON(A,(X,le)=>{if(delete this._pendingCallback,delete this._pendingRequest,X||!le)return L(X);if(typeof le!="object")return L(new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`));{ie(le,!0);try{if(A.filter){const Q=l.bC(A.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(_e=>`${_e.key}: ${_e.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(_e=>Q.value.evaluate({zoom:0},_e))}}this._geoJSONIndex=A.cluster?new ci(function({superclusterOptions:Q,clusterProperties:se}){if(!se||!Q)return Q;const _e={},xe={},Se={accumulated:null,zoom:0},it={properties:null},ut=Object.keys(se);for(const Xe of ut){const[st,ht]=se[Xe],At=l.bC(ht),Ot=l.bC(typeof st=="string"?[st,["accumulated"],["get",Xe]]:st);_e[Xe]=At.value,xe[Xe]=Ot.value}return Q.map=Xe=>{it.properties=Xe;const st={};for(const ht of ut)st[ht]=_e[ht].evaluate(Se,it);return st},Q.reduce=(Xe,st)=>{it.properties=st;for(const ht of ut)Se.accumulated=Xe[ht],Xe[ht]=xe[ht].evaluate(Se,it)},Q}(A)).load(le.features):function(Q,se){return new Re(Q,se)}(le,A.geojsonVtOptions)}catch(Q){return L(Q)}this.loaded={};const ee={};if(H){const Q=H.finish();Q&&(ee.resourceTiming={},ee.resourceTiming[A.source]=JSON.parse(JSON.stringify(Q)))}L(null,ee)}})}reloadTile(A,L){const N=this.loaded;return N&&N[A.uid]?super.reloadTile(A,L):this.loadTile(A,L)}removeSource(A,L){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),L()}getClusterExpansionZoom(A,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(A.clusterId))}catch(N){L(N)}}getClusterChildren(A,L){try{L(null,this._geoJSONIndex.getChildren(A.clusterId))}catch(N){L(N)}}getClusterLeaves(A,L){try{L(null,this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset))}catch(N){L(N)}}}class Ln{constructor(A){this.self=A,this.actor=new l.C(A,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ze,geojson:pt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,N)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=N},this.self.registerRTLTextPlugin=L=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=L.applyArabicShaping,l.bD.processBidirectionalText=L.processBidirectionalText,l.bD.processStyledBidirectionalText=L.processStyledBidirectionalText}}setReferrer(A,L){this.referrer=L}setImages(A,L,N){this.availableImages[A]=L;for(const H in this.workerSources[A]){const X=this.workerSources[A][H];for(const le in X)X[le].availableImages=L}N()}setLayers(A,L,N){this.getLayerIndex(A).replace(L),N()}updateLayers(A,L,N){this.getLayerIndex(A).update(L.layers,L.removedIds),N()}loadTile(A,L,N){this.getWorkerSource(A,L.type,L.source).loadTile(L,N)}loadDEMTile(A,L,N){this.getDEMWorkerSource(A,L.source).loadTile(L,N)}reloadTile(A,L,N){this.getWorkerSource(A,L.type,L.source).reloadTile(L,N)}abortTile(A,L,N){this.getWorkerSource(A,L.type,L.source).abortTile(L,N)}removeTile(A,L,N){this.getWorkerSource(A,L.type,L.source).removeTile(L,N)}removeDEMTile(A,L){this.getDEMWorkerSource(A,L.source).removeTile(L)}removeSource(A,L,N){if(!this.workerSources[A]||!this.workerSources[A][L.type]||!this.workerSources[A][L.type][L.source])return;const H=this.workerSources[A][L.type][L.source];delete this.workerSources[A][L.type][L.source],H.removeSource!==void 0?H.removeSource(L,N):N()}loadWorkerSource(A,L,N){try{this.self.importScripts(L.url),N()}catch(H){N(H.toString())}}syncRTLPluginState(A,L,N){try{l.bD.setState(L);const H=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&H!=null){this.self.importScripts(H);const X=l.bD.isParsed();N(X?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),X)}}catch(H){N(H.toString())}}getAvailableImages(A){let L=this.availableImages[A];return L||(L=[]),L}getLayerIndex(A){let L=this.layerIndexes[A];return L||(L=this.layerIndexes[A]=new G),L}getWorkerSource(A,L,N){return this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][L]||(this.workerSources[A][L]={}),this.workerSources[A][L][N]||(this.workerSources[A][L][N]=new this.workerSourceTypes[L]({send:(H,X,le)=>{this.actor.send(H,X,le,A)}},this.getLayerIndex(A),this.getAvailableImages(A))),this.workerSources[A][L][N]}getDEMWorkerSource(A,L){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][L]||(this.demWorkerSources[A][L]=new Fe),this.demWorkerSources[A][L]}}return l.i()&&(self.worker=new Ln(self)),Ln}),T(["./shared"],function(l){var G="3.6.2";class O{static testProp(t){if(!O.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in O.docStyle)return t[a];return t[0]}static create(t,a,u){const d=window.document.createElement(t);return a!==void 0&&(d.className=a),u&&u.appendChild(d),d}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){O.docStyle&&O.selectProp&&(O.userSelect=O.docStyle[O.selectProp],O.docStyle[O.selectProp]="none")}static enableDrag(){O.docStyle&&O.selectProp&&(O.docStyle[O.selectProp]=O.userSelect)}static setTransform(t,a){t.style[O.transformProp]=a}static addEventListener(t,a,u,d={}){t.addEventListener(a,u,"passive"in d?d:d.capture)}static removeEventListener(t,a,u,d={}){t.removeEventListener(a,u,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",O.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",O.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",O.suppressClickInternal,!0)},0)}static mousePos(t,a){const u=t.getBoundingClientRect();return new l.P(a.clientX-u.left-t.clientLeft,a.clientY-u.top-t.clientTop)}static touchPos(t,a){const u=t.getBoundingClientRect(),d=[];for(let f=0;f<a.length;f++)d.push(new l.P(a[f].clientX-u.left-t.clientLeft,a[f].clientY-u.top-t.clientTop));return d}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}O.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,O.selectProp=O.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),O.transformProp=O.testProp(["transform","WebkitTransform"]);const ve={supported:!1,testSupport:function(p){!ze&&oe&&(Fe?Ce(p):ge=p)}};let ge,oe,ze=!1,Fe=!1;function Ce(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,oe),p.isContextLost())return;ve.supported=!0}catch{}p.deleteTexture(t),ze=!0}var lt,ie;typeof document<"u"&&(oe=document.createElement("img"),oe.onload=function(){ge&&Ce(ge),ge=null,Fe=!0},oe.onerror=function(){ze=!0,ge=null},oe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,a,u,d;p.resetRequestQueue=()=>{t=[],a=0,u=0,d={}},p.addThrottleControl=E=>{const C=u++;return d[C]=E,C},p.removeThrottleControl=E=>{delete d[E],x()},p.getImage=(E,C,P=!0)=>{ve.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*");const R={requestParameters:E,supportImageRefresh:P,callback:C,cancelled:!1,completed:!1,cancel:()=>{R.completed||R.cancelled||(R.cancelled=!0,R.innerRequest&&(R.innerRequest.cancel(),a--),x())}};return t.push(R),x(),R};const f=E=>{const{requestParameters:C,supportImageRefresh:P,callback:R}=E;return l.e(C,{type:"image"}),(P!==!1||l.i()||l.g(C.url)||C.headers&&!Object.keys(C.headers).reduce(($,U)=>$&&U==="accept",!0)?l.m:S)(C,($,U,q,V)=>{v(E,R,$,U,q,V)})},v=(E,C,P,R,$,U)=>{P?C(P):R instanceof HTMLImageElement||l.a(R)?C(null,R):R&&((q,V)=>{typeof createImageBitmap=="function"?l.b(q,V):l.d(q,V)})(R,(q,V)=>{q!=null?C(q):V!=null&&C(null,V,{cacheControl:$,expires:U})}),E.cancelled||(E.completed=!0,a--,x())},x=()=>{const E=(()=>{const C=Object.keys(d);let P=!1;if(C.length>0){for(const R of C)if(P=d[R](),P)break}return P})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=a;C<E&&t.length>0;C++){const P=t.shift();if(P.cancelled){C--;continue}const R=f(P);a++,P.innerRequest=R}},S=(E,C)=>{const P=new Image,R=E.url;let $=!1;const U=E.credentials;return U&&U==="include"?P.crossOrigin="use-credentials":(U&&U==="same-origin"||!l.s(R))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{C(null,P),P.onerror=P.onload=null},P.onerror=()=>{$||C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=R,{cancel:()=>{$=!0,P.src=""}}}}(lt||(lt={})),lt.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(ie||(ie={}));class te{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,u){const d=function(f){const v=f.match(ce);if(!v)throw new Error(`Unable to parse URL "${f}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return d.path+=`${a}${u}`,function(f){const v=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${v}`}(d)}setTransformRequest(t){this._transformRequestFn=t}}const ce=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ee(p){var t=new l.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var Ge,We=function(p,t,a){return p[0]=t[0]-a[0],p[1]=t[1]-a[1],p[2]=t[2]-a[2],p};Ge=new l.A(3),l.A!=Float32Array&&(Ge[0]=0,Ge[1]=0,Ge[2]=0);var Je=function(p){var t=p[0],a=p[1];return t*t+a*a};function Ze(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const a=[];for(const{id:u,url:d}of p){const f=`${u}${d}`;a.indexOf(f)===-1&&(a.push(f),t.push({id:u,url:d}))}}return t}function Vt(p,t,a,u,d){if(u)return void p(u);if(d!==Object.values(t).length||d!==Object.values(a).length)return;const f={};for(const v in t){f[v]={};const x=l.h.getImageCanvasContext(a[v]),S=t[v];for(const E in S){const{width:C,height:P,x:R,y:$,sdf:U,pixelRatio:q,stretchX:V,stretchY:re,content:he}=S[E];f[v][E]={data:null,pixelRatio:q,sdf:U,stretchX:V,stretchY:re,content:he,spriteData:{width:C,height:P,x:R,y:$,context:x}}}}p(null,f)}(function(){var p=new l.A(2);l.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Ue{constructor(t,a,u,d){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(a,d)}update(t,a,u){const{width:d,height:f}=t,v=!(this.size&&this.size[0]===d&&this.size[1]===f||u),{context:x}=this,{gl:S}=x;if(this.useMipmap=!!(a&&a.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!a||a.premultiply!==!1)),v)this.size=[d,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.a(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,d,f,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:E,y:C}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.a(t)?S.texSubImage2D(S.TEXTURE_2D,0,E,C,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,E,C,d,f,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(t,a,u){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||t),this.filter=t),a!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ar(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Rr extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:u}of this.requestors)this._notify(a,u);this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let u=!0;const d=a.data||a.spriteData;return this._validateStretch(a.stretchX,d&&d.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,d&&d.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const d of t){if(d[0]<u||d[1]<d[0]||a<d[1])return!1;u=d[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const u=a.spriteData,d=u&&u.width||a.data.width,f=u&&u.height||a.data.height;return!(t[0]<0||d<t[0]||t[1]<0||f<t[1]||t[2]<0||d<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,u=!0){const d=this.getImage(t);if(u&&(d.data.width!==a.data.width||d.data.height!==a.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=d.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let u=!0;if(!this.isLoaded())for(const d of t)this.images[d]||(u=!1);this.isLoaded()||u?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const u={};for(const d of t){let f=this.getImage(d);f||(this.fire(new l.k("styleimagemissing",{id:d})),f=this.getImage(d)),f?u[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,u)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],u=this.getImage(t);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new l.I(d,u);this.patterns[t]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ue(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:a,h:u}=l.p(t),d=this.atlasImage;d.resize({width:a||1,height:u||1});for(const f in this.patterns){const{bin:v}=this.patterns[f],x=v.x+1,S=v.y+1,E=this.getImage(f).data,C=E.width,P=E.height;l.R.copy(E,d,{x:0,y:0},{x,y:S},{width:C,height:P}),l.R.copy(E,d,{x:0,y:P-1},{x,y:S-1},{width:C,height:1}),l.R.copy(E,d,{x:0,y:0},{x,y:S+P},{width:C,height:1}),l.R.copy(E,d,{x:C-1,y:0},{x:x-1,y:S},{width:1,height:P}),l.R.copy(E,d,{x:0,y:0},{x:x+C,y:S},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||l.w(`Image with ID: "${a}" was not found`),Ar(u)&&this.updateImage(a,u)}}}const ui=1e20;function Dr(p,t,a,u,d,f,v,x,S){for(let E=t;E<t+u;E++)Qr(p,a*f+E,f,d,v,x,S);for(let E=a;E<a+d;E++)Qr(p,E*f+t,1,u,v,x,S)}function Qr(p,t,a,u,d,f,v){f[0]=0,v[0]=-ui,v[1]=ui,d[0]=p[t];for(let x=1,S=0,E=0;x<u;x++){d[x]=p[t+x*a];const C=x*x;do{const P=f[S];E=(d[x]-d[P]+C-P*P)/(x-P)/2}while(E<=v[S]&&--S>-1);S++,f[S]=x,v[S]=E,v[S+1]=ui}for(let x=0,S=0;x<u;x++){for(;v[S+1]<x;)S++;const E=f[S],C=x-E;p[t+x*a]=d[E]+C*C}}class Ti{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const u=[];for(const d in t)for(const f of t[d])u.push({stack:d,id:f});l.o(u,({stack:d,id:f},v)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{}});let S=x.glyphs[f];if(S!==void 0)return void v(null,{stack:d,id:f,glyph:S});if(S=this._tinySDF(x,d,f),S)return x.glyphs[f]=S,void v(null,{stack:d,id:f,glyph:S});const E=Math.floor(f/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void v(null,{stack:d,id:f,glyph:S});if(!this.url)return void v(new Error("glyphsUrl is not set"));let C=x.requests[E];C||(C=x.requests[E]=[],Ti.loadGlyphRange(d,E,this.url,this.requestManager,(P,R)=>{if(R){for(const $ in R)this._doesCharSupportLocalGlyph(+$)||(x.glyphs[+$]=R[+$]);x.ranges[E]=!0}for(const $ of C)$(P,R);delete x.requests[E]})),C.push((P,R)=>{P?v(P):R&&v(null,{stack:d,id:f,glyph:R[f]||null})})},(d,f)=>{if(d)a(d);else if(f){const v={};for(const{stack:x,id:S,glyph:E}of f)(v[x]||(v[x]={}))[S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};a(null,v)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](t)||l.u["Hangul Syllables"](t)||l.u.Hiragana(t)||l.u.Katakana(t))}_tinySDF(t,a,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let f=t.tinySDF;if(!f){let x="400";/bold/i.test(a)?x="900":/medium/i.test(a)?x="500":/light/i.test(a)&&(x="200"),f=t.tinySDF=new Ti.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:x})}const v=f.draw(String.fromCharCode(u));return{id:u,bitmap:new l.q({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ti.loadGlyphRange=function(p,t,a,u,d){const f=256*t,v=f+255,x=u.transformRequest(a.replace("{fontstack}",p).replace("{range}",`${f}-${v}`),ie.Glyphs);l.l(x,(S,E)=>{if(S)d(S);else if(E){const C={};for(const P of l.n(E))C[P.id]=P;d(null,C)}})},Ti.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:f="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=a;const x=this.size=p+4*t,S=this._createCanvas(x),E=this.ctx=S.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${f} ${p}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:f}=this.ctx.measureText(p),v=Math.ceil(a),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-d))),S=Math.min(this.size-this.buffer,v+Math.ceil(u)),E=x+2*this.buffer,C=S+2*this.buffer,P=Math.max(E*C,0),R=new Uint8ClampedArray(P),$={data:R,width:E,height:C,glyphWidth:x,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(x===0||S===0)return $;const{ctx:U,buffer:q,gridInner:V,gridOuter:re}=this;U.clearRect(q,q,x,S),U.fillText(p,q,q+v);const he=U.getImageData(q,q,x,S);re.fill(ui,0,P),V.fill(0,0,P);for(let K=0;K<S;K++)for(let ne=0;ne<x;ne++){const pe=he.data[4*(K*x+ne)+3]/255;if(pe===0)continue;const fe=(K+q)*E+ne+q;if(pe===1)re[fe]=0,V[fe]=ui;else{const we=.5-pe;re[fe]=we>0?we*we:0,V[fe]=we<0?we*we:0}}Dr(re,0,0,E,C,E,this.f,this.v,this.z),Dr(V,q,q,x,S,E,this.f,this.v,this.z);for(let K=0;K<P;K++){const ne=Math.sqrt(re[K])-Math.sqrt(V[K]);R[K]=Math.round(255-255*(ne/this.radius+this.cutoff))}return $}};class $r{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,a){return l.z(t.expression.evaluate(a))}interpolate(t,a,u){return{x:l.B.number(t.x,a.x,u),y:l.B.number(t.y,a.y,u),z:l.B.number(t.z,a.z,u)}}}let He;class dt extends l.E{constructor(t){super(),He=He||new l.r({anchor:new l.D(l.v.light.anchor),position:new $r,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(He),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.t,t,a))for(const u in t){const d=t[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&l.x(this,t.call(l.y,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class gt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const u=t.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,a)),this.dashEntry[u]}getDashRanges(t,a,u){const d=[];let f=t.length%2==1?-t[t.length-1]*u:0,v=t[0]*u,x=!0;d.push({left:f,right:v,isDash:x,zeroLength:t[0]===0});let S=t[0];for(let E=1;E<t.length;E++){x=!x;const C=t[E];f=S*u,S+=C,v=S*u,d.push({left:f,right:v,isDash:x,zeroLength:C===0})}return d}addRoundDash(t,a,u){const d=a/2;for(let f=-u;f<=u;f++){const v=this.width*(this.nextRow+u+f);let x=0,S=t[x];for(let E=0;E<this.width;E++){E/S.right>1&&(S=t[++x]);const C=Math.abs(E-S.left),P=Math.abs(E-S.right),R=Math.min(C,P);let $;const U=f/u*(d+1);if(S.isDash){const q=d-Math.abs(U);$=Math.sqrt(R*R+q*q)}else $=d-Math.sqrt(R*R+U*U);this.data[v+E]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let x=t.length-1;x>=0;--x){const S=t[x],E=t[x+1];S.zeroLength?t.splice(x,1):E&&E.isDash===S.isDash&&(E.left=S.left,t.splice(x,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let f=0,v=t[f];for(let x=0;x<this.width;x++){x/v.right>1&&(v=t[++f]);const S=Math.abs(x-v.left),E=Math.abs(x-v.right),C=Math.min(S,E);this.data[d+x]=Math.max(0,Math.min(255,(v.isDash?C:-C)+128))}}addDash(t,a){const u=a?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let f=0;for(let x=0;x<t.length;x++)f+=t[x];if(f!==0){const x=this.width/f,S=this.getDashRanges(t,this.width,x);a?this.addRoundDash(S,x,u):this.addRegularDash(S)}const v={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=d,this.dirty=!0,v}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class Ut{constructor(t,a,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const d=this.workerPool.acquire(u);for(let f=0;f<d.length;f++){const v=new l.C(d[f],a,u);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,u){l.o(this.actors,(d,f)=>{d.send(t,a,f)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Bt(p,t,a){const u=function(d,f){if(d)return a(d);if(f){const v=l.F(l.e(f,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(v.vectorLayers=f.vector_layers,v.vectorLayerIds=v.vectorLayers.map(x=>x.id)),a(null,v)}};return p.url?l.f(t.transformRequest(p.url,ie.Source),u):l.h.frame(()=>u(null,p))}class Dt{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.L?new l.L(t.lng,t.lat):l.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.L?new l.L(t.lng,t.lat):l.L.convert(t),this}extend(t){const a=this._sw,u=this._ne;let d,f;if(t instanceof l.L)d=t,f=t;else{if(!(t instanceof Dt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Dt.convert(t)):this.extend(l.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.L.convert(t)):this;if(d=t._sw,f=t._ne,!d||!f)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new l.L(d.lng,d.lat),this._ne=new l.L(f.lng,f.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=l.L.convert(t);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(t){return t instanceof Dt?t:t&&new Dt(t)}static fromLngLat(t,a=0){const u=360*a/40075017,d=u/Math.cos(Math.PI/180*t.lat);return new Dt(new l.L(t.lng-d,t.lat-u),new l.L(t.lng+d,t.lat+u))}}class lr{constructor(t,a,u){this.bounds=Dt.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),u=Math.floor(l.G(this.bounds.getWest())*a),d=Math.floor(l.H(this.bounds.getNorth())*a),f=Math.ceil(l.G(this.bounds.getEast())*a),v=Math.ceil(l.H(this.bounds.getSouth())*a);return t.x>=u&&t.x<f&&t.y>=d&&t.y<v}}class en extends l.E{constructor(t,a,u,d){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._requestManager,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),f?this.fire(new l.j(f)):v&&(l.e(this,v),v.bounds&&(this.tileBounds=new lr(v.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(a,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(u,ie.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(v,x){return delete t.request,t.aborted?a(null):v&&v.status!==404?a(v):(x&&x.resourceTiming&&(t.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&t.setExpiryData(x),t.loadVectorData(x,this.map.painter),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",d,f.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",d,f.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class ci extends l.E{constructor(t,a,u,d){super(),this.id=t,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.F(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.j(t)):a&&(l.e(this,a),a.bounds&&(this.tileBounds=new lr(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=lt.getImage(this.map._requestManager.transformRequest(u,ie.Tile),(d,f,v)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(d)t.state="errored",a(d);else if(f){this.map._refreshExpiredTiles&&v&&t.setExpiryData(v);const x=this.map.painter.context,S=x.gl;t.texture=this.map.painter.getTileTexture(f.width),t.texture?t.texture.update(f,{useMipmap:!0}):(t.texture=new Ue(x,f,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),t.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}class tn extends ci{constructor(t,a,u,d){super(t,a,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(u,ie.Tile);function f(v,x){v&&(t.state="errored",a(v)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=lt.getImage(d,(v,x,S)=>l._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(v)t.state="errored",a(v);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(S);const E=l.a(x)&&l.J()?x:yield function(P){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const R=P.width+2,$=P.height+2;try{return new l.R({width:R,height:$},yield l.M(P,-1,-1,R,$))}catch{}}return l.h.getImageData(P,1)})}(x),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,f))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const a=t.canonical,u=Math.pow(2,a.z),d=(a.x-1+u)%u,f=a.x===0?t.wrap-1:t.wrap,v=(a.x+1+u)%u,x=a.x+1===u?t.wrap+1:t.wrap,S={};return S[new l.O(t.overscaledZ,f,a.z,d,a.y).key]={backfilled:!1},S[new l.O(t.overscaledZ,x,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(S[new l.O(t.overscaledZ,f,a.z,d,a.y-1).key]={backfilled:!1},S[new l.O(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new l.O(t.overscaledZ,x,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<u&&(S[new l.O(t.overscaledZ,f,a.z,d,a.y+1).key]={backfilled:!1},S[new l.O(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new l.O(t.overscaledZ,x,a.z,v,a.y+1).key]={backfilled:!1}),S}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Yn extends l.E{constructor(t,a,u,d){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=a.data,this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const f=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*f,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*f,extent:l.N,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.N,radius:(a.clusterRadius||50)*f,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,u,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:u},d),this}_updateWorkerData(t){const a=l.e({},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),ie.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(u,d)=>{if(this._pendingLoads--,this._removed||d&&d.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let f=null;if(d&&d.resourceTiming&&d.resourceTiming[this.id]&&(f=d.resourceTiming[this.id].slice(0)),u)return void this.fire(new l.j(u));const v={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&l.e(v,{resourceTiming:f}),this.fire(new l.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const u=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const d={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(u,d,(f,v)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):f?a(f):(t.loadVectorData(v,this.map.painter,u==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var rn=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ni extends l.E{constructor(t,a,u,d){super(),this.load=(f,v)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=lt.getImage(this.map._requestManager.transformRequest(this.url,ie.Image),(x,S)=>{this._request=null,this._loaded=!0,x?this.fire(new l.j(x)):S&&(this.image=S,f&&(this.coordinates=f),v&&v(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,v=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,rn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ue(f,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.U.fromLngLat);this.tileID=function(d){let f=1/0,v=1/0,x=-1/0,S=-1/0;for(const R of d)f=Math.min(f,R.x),v=Math.min(v,R.y),x=Math.max(x,R.x),S=Math.max(S,R.y);const E=Math.max(x-f,S-v),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),P=Math.pow(2,C);return new l.W(C,Math.floor((f+x)/2*P),Math.floor((v+S)/2*P))}(a),this.minzoom=this.maxzoom=this.tileID.z;const u=a.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,l.N,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,l.N),this._boundsArray.emplaceBack(u[2].x,u[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}hasTransition(){return!1}}class Fa extends Ni{constructor(t,a,u,d){super(t,a,u,d),this.load=()=>{this._loaded=!1;const f=this.options;this.urls=[];for(const v of f.urls)this.urls.push(this.map._requestManager.transformRequest(v,ie.Source).url);l.X(this.urls,(v,x)=>{this._loaded=!0,v?this.fire(new l.j(v)):x&&(this.video=x,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,v=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,rn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new Ue(f,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,x=!0)}x&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Qn extends Ni{constructor(t,a,u,d){super(t,a,u,d),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const v=this.map.painter.context,x=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,rn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ue(v,this.canvas,x.RGBA,{premultiply:!0});let S=!1;for(const E in this.tiles){const C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,S=!0)}S&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(v=>typeof v!="number"))||this.fire(new l.j(new l.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ba={},Mn=p=>{switch(p){case"geojson":return Yn;case"image":return Ni;case"raster":return ci;case"raster-dem":return tn;case"vector":return en;case"video":return Fa;case"canvas":return Qn}return Ba[p]};function Hs(p,t){const a=l.Z();return l.$(a,a,[1,1,0]),l.a0(a,a,[.5*p.width,.5*p.height,1]),l.a1(a,a,p.calculatePosMatrix(t.toUnwrapped()))}function ys(p,t,a,u,d,f){const v=function(P,R,$){if(P)for(const U of P){const q=R[U];if(q&&q.source===$&&q.type==="fill-extrusion")return!0}else for(const U in R){const q=R[U];if(q.source===$&&q.type==="fill-extrusion")return!0}return!1}(d&&d.layers,t,p.id),x=f.maxPitchScaleFactor(),S=p.tilesIn(u,x,v);S.sort(Jn);const E=[];for(const P of S)E.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,a,p._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,d,f,x,Hs(p.transform,P.tileID))});const C=function(P){const R={},$={};for(const U of P){const q=U.queryResults,V=U.wrappedTileID,re=$[V]=$[V]||{};for(const he in q){const K=q[he],ne=re[he]=re[he]||{},pe=R[he]=R[he]||[];for(const fe of K)ne[fe.featureIndex]||(ne[fe.featureIndex]=!0,pe.push(fe))}}return R}(E);for(const P in C)C[P].forEach(R=>{const $=R.feature,U=p.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=U});return C}function Jn(p,t){const a=p.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}class es{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a2(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(d,f){const v={};if(!f)return v;for(const x of d){const S=x.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(S.length!==0){x.layers=S,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>S.filter(C=>C.id===E)[0]));for(const E of S)v[E.id]=x}}return v}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const f=this.buckets[d];if(f instanceof l.a4){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const f=this.buckets[d];if(f instanceof l.a4&&f.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const d in this.buckets){const f=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ue(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ue(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,d,f,v,x,S,E,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:f,scale:v,tileSize:this.tileSize,pixelPosMatrix:C,transform:S,params:x,queryPadding:this.queryPadding*E},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),f=a&&a.sourceLayer?a.sourceLayer:"",v=d._geojsonTileLayer||d[f];if(!v)return;const x=l.a6(a&&a.filter),{z:S,x:E,y:C}=this.tileID.canonical,P={z:S,x:E,y:C};for(let R=0;R<v.length;R++){const $=v.feature(R);if(x.needGeometry){const V=l.a7($,!0);if(!x.filter(new l.a8(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!x.filter(new l.a8(this.tileID.overscaledZ),$))continue;const U=u.getId($,f),q=new l.a9($,S,E,C,U);q.tile=P,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=l.aa(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const f=this.expirationTime-a;f?this.expirationTime=u+Math.max(f,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!a.style.hasLayer(d))continue;const f=this.buckets[d],v=f.layers[0].sourceLayer||"_geojsonTileLayer",x=u[v],S=t[v];if(!x||!S||Object.keys(S).length===0)continue;f.update(S,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=a&&a.style&&a.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=l.h.now()+t}setDependencies(t,a){const u={};for(const d of a)u[d]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const d=this.dependencies[u];if(d){for(const f of a)if(d[f])return!0}}return!1}}class _s{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const f={value:a,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},u)),this.data[d].push(f),this.order.push(d),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,d=a===void 0?0:this.data[u].indexOf(a),f=this.data[u][d];return this.data[u].splice(d,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const d of this.data[u])t(d.value)||a.push(d);for(const u of a)this.remove(u.value.tileID,u)}}class ye{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const d=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},l.e(this.stateChanges[t][d],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==d&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const f in this.state[t][d])u[f]||(this.deletedStates[t][d][f]=null)}else for(const f in u)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][f]===null&&delete this.deletedStates[t][d][f]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const d=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(u in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][u]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),d=l.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][a];if(f===null)return{};for(const v in f)delete d[v]}return d}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const f={};for(const v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),l.e(this.state[d][v],this.stateChanges[d][v]),f[v]=this.state[d][v];u[d]=f}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const f={};if(this.deletedStates[d]===null)for(const v in this.state[d])f[v]={},this.state[d][v]={};else for(const v in this.deletedStates[d]){if(this.deletedStates[d][v]===null)this.state[d][v]={};else for(const x of Object.keys(this.deletedStates[d][v]))delete this.state[d][v][x];f[v]=this.state[d][v]}u[d]=u[d]||{},l.e(u[d],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in t)t[d].setFeatureState(u,a)}}class hi extends l.E{constructor(t,a,u){super(),this.id=t,this.dispatcher=u,this.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,f,v,x)=>{const S=new(Mn(f.type))(d,f,v,x);if(S.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${S.id}`);return S})(t,a,u,this),this._tiles={},this._cache=new _s(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ye,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Vi).map(t=>t.key)}getRenderableIds(t){const a=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&a.push(this._tiles[u]);return t?a.sort((u,d)=>{const f=u.tileID,v=d.tileID,x=new l.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new l.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-v.overscaledZ||S.y-x.y||S.x-x.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(Vi).map(u=>u.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,t,a)))}_tileLoaded(t,a,u,d){if(d)return t.state="errored",void(d.status!==404?this._source.fire(new l.j(d,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=l.h.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const f=a[d];if(t.neighboringTiles&&t.neighboringTiles[f]){const v=this.getTileByID(f);u(t,v),u(v,t)}}function u(d,f){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let v=f.tileID.canonical.x-d.tileID.canonical.x;const x=f.tileID.canonical.y-d.tileID.canonical.y,S=Math.pow(2,d.tileID.canonical.z),E=f.tileID.key;v===0&&x===0||Math.abs(x)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),f.dem&&d.dem&&(d.dem.backfillBorder(f.dem,v,x),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,d){for(const f in this._tiles){let v=this._tiles[f];if(d[f]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>u)continue;let x=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(x=E)}let S=x;for(;S.overscaledZ>a;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){d[x.key]=x;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const d=t.scaledTo(u),f=this._getLoadedTile(d);if(f)return f}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const d in this._tiles){const f=this._tiles[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+a),u[f.tileID.key]=f}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new l.O(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(u=u.filter(C=>this._source.hasTile(C)))):u=[];const d=t.coveringZoomLevel(this._source),f=Math.max(d-hi.maxOverzooming,this._source.minzoom),v=Math.max(d+hi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const P of u)if(P.canonical.z>this._source.minzoom){const R=P.scaledTo(P.canonical.z-1);C[R.key]=R;const $=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));C[$.key]=$}u=u.concat(Object.values(C))}const x=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(u,d);if(jt(this._source.type)){const C={},P={},R=Object.keys(S),$=l.h.now();for(const U of R){const q=S[U],V=this._tiles[U];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=$)continue;const re=this.findLoadedParent(q,f);re&&(this._addTile(re.tileID),C[re.tileID.key]=re.tileID),P[U]=q}this._retainLoadedChildren(P,d,v,S);for(const U in C)S[U]||(this._coveredTiles[U]=!0,S[U]=C[U]);if(a){const U={},q={};for(const V of u)this._tiles[V.key].hasData()?U[V.key]=V:q[V.key]=V;for(const V in q){const re=q[V].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(U[re[0].key]=S[re[0].key]=re[0],U[re[1].key]=S[re[1].key]=re[1],U[re[2].key]=S[re[2].key]=re[2],U[re[3].key]=S[re[3].key]=re[3],delete q[V])}for(const V in q){const re=this.findLoadedParent(q[V],this._source.minzoom);if(re){U[re.tileID.key]=S[re.tileID.key]=re.tileID;for(const he in U)U[he].isChildOf(re.tileID)&&delete U[he]}}for(const V in this._tiles)U[V]||(this._coveredTiles[V]=!0)}}for(const C in S)this._tiles[C].clearFadeHold();const E=l.ab(this._tiles,S);for(const C of E){const P=this._tiles[C];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const u={},d={},f=Math.max(a-hi.maxOverzooming,this._source.minzoom),v=Math.max(a+hi.maxUnderzooming,this._source.minzoom),x={};for(const S of t){const E=this._addTile(S);u[S.key]=S,E.hasData()||a<this._source.maxzoom&&(x[S.key]=S)}this._retainLoadedChildren(x,a,v,u);for(const S of t){let E=this._tiles[S.key];if(E.hasData())continue;if(a+1>this._source.maxzoom){const P=S.children(this._source.maxzoom)[0],R=this.getTile(P);if(R&&R.hasData()){u[P.key]=P;continue}}else{const P=S.children(this._source.maxzoom);if(u[P[0].key]&&u[P[1].key]&&u[P[2].key]&&u[P[3].key])continue}let C=E.wasRequested();for(let P=S.overscaledZ-1;P>=f;--P){const R=S.scaledTo(P);if(d[R.key])break;if(d[R.key]=!0,E=this.getTile(R),!E&&C&&(E=this._addTile(R)),E){const $=E.hasData();if((C||$)&&(u[R.key]=R),C=E.wasRequested(),$)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}a.push(d.key);const f=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;d=f}for(const f of a)this._loadedParentTiles[f]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=a;return a||(a=new es(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,u||this._source.fire(new l.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,u){const d=[],f=this.transform;if(!f)return d;const v=u?f.getCameraQueryGeometry(t):t,x=t.map(U=>f.pointCoordinate(U,this.terrain)),S=v.map(U=>f.pointCoordinate(U,this.terrain)),E=this.getIds();let C=1/0,P=1/0,R=-1/0,$=-1/0;for(const U of S)C=Math.min(C,U.x),P=Math.min(P,U.y),R=Math.max(R,U.x),$=Math.max($,U.y);for(let U=0;U<E.length;U++){const q=this._tiles[E[U]];if(q.holdingForFade())continue;const V=q.tileID,re=Math.pow(2,f.zoom-q.tileID.overscaledZ),he=a*q.queryPadding*l.N/q.tileSize/re,K=[V.getTilePoint(new l.U(C,P)),V.getTilePoint(new l.U(R,$))];if(K[0].x-he<l.N&&K[0].y-he<l.N&&K[1].x+he>=0&&K[1].y+he>=0){const ne=x.map(fe=>V.getTilePoint(fe)),pe=S.map(fe=>V.getTilePoint(fe));d.push({tile:q,tileID:V,queryGeometry:ne,cameraQueryGeometry:pe,scale:re})}}return d}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of a)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const t=l.h.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const d=this._tiles[t];d&&d.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}}function Vi(p,t){const a=Math.abs(2*p.wrap)-+(p.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||u-a||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function jt(p){return p==="raster"||p==="image"||p==="video"}hi.maxOverzooming=10,hi.maxUnderzooming=3;const Ct="mapboxgl_preloaded_worker_pool";class fn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<fn.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}const Ws=Math.floor(l.h.hardwareConcurrency/2);let An;function wo(){return An||(An=new fn),An}fn.workerCount=l.ac(globalThis)?Math.max(Math.min(Ws,3),1):1;class Xs{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ad(t,0,1);let a=1,u=this._distances[a];const d=t*this.paddedLength+this.padding;for(;u<d&&a<this._distances.length;)u=this._distances[++a];const f=a-1,v=this._distances[f],x=u-v,S=x>0?(d-v)/x:0;return this.points[f].mult(1-S).add(this.points[a].mult(S))}}function ts(p,t){let a=!0;return p==="always"||p!=="never"&&t!=="never"||(a=!1),a}class vs{constructor(t,a,u){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,d,f){this._forEachCell(a,u,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(t,a,u,d){this._forEachCell(a-d,u-d,a+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(d)}_insertBoxCell(t,a,u,d,f,v){this.boxCells[f].push(v)}_insertCircleCell(t,a,u,d,f,v){this.circleCells[f].push(v)}_query(t,a,u,d,f,v,x){if(u<0||t>this.width||d<0||a>this.height)return[];const S=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=d){if(f)return[{key:null,x1:t,y1:a,x2:u,y2:d}];for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const C=this.circles[3*E],P=this.circles[3*E+1],R=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:C-R,y1:P-R,x2:C+R,y2:P+R})}}else this._forEachCell(t,a,u,d,this._queryCell,S,{hitTest:f,overlapMode:v,seenUids:{box:{},circle:{}}},x);return S}query(t,a,u,d){return this._query(t,a,u,d,!1,null)}hitTest(t,a,u,d,f,v){return this._query(t,a,u,d,!0,f,v).length>0}hitTestCircle(t,a,u,d,f){const v=t-u,x=t+u,S=a-u,E=a+u;if(x<0||v>this.width||E<0||S>this.height)return!1;const C=[];return this._forEachCell(v,S,x,E,this._queryCellCircle,C,{hitTest:!0,overlapMode:d,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},f),C.length>0}_queryCell(t,a,u,d,f,v,x,S){const{seenUids:E,hitTest:C,overlapMode:P}=x,R=this.boxCells[f];if(R!==null){const U=this.bboxes;for(const q of R)if(!E.box[q]){E.box[q]=!0;const V=4*q,re=this.boxKeys[q];if(t<=U[V+2]&&a<=U[V+3]&&u>=U[V+0]&&d>=U[V+1]&&(!S||S(re))&&(!C||!ts(P,re.overlapMode))&&(v.push({key:re,x1:U[V],y1:U[V+1],x2:U[V+2],y2:U[V+3]}),C))return!0}}const $=this.circleCells[f];if($!==null){const U=this.circles;for(const q of $)if(!E.circle[q]){E.circle[q]=!0;const V=3*q,re=this.circleKeys[q];if(this._circleAndRectCollide(U[V],U[V+1],U[V+2],t,a,u,d)&&(!S||S(re))&&(!C||!ts(P,re.overlapMode))){const he=U[V],K=U[V+1],ne=U[V+2];if(v.push({key:re,x1:he-ne,y1:K-ne,x2:he+ne,y2:K+ne}),C)return!0}}}return!1}_queryCellCircle(t,a,u,d,f,v,x,S){const{circle:E,seenUids:C,overlapMode:P}=x,R=this.boxCells[f];if(R!==null){const U=this.bboxes;for(const q of R)if(!C.box[q]){C.box[q]=!0;const V=4*q,re=this.boxKeys[q];if(this._circleAndRectCollide(E.x,E.y,E.radius,U[V+0],U[V+1],U[V+2],U[V+3])&&(!S||S(re))&&!ts(P,re.overlapMode))return v.push(!0),!0}}const $=this.circleCells[f];if($!==null){const U=this.circles;for(const q of $)if(!C.circle[q]){C.circle[q]=!0;const V=3*q,re=this.circleKeys[q];if(this._circlesCollide(U[V],U[V+1],U[V+2],E.x,E.y,E.radius)&&(!S||S(re))&&!ts(P,re.overlapMode))return v.push(!0),!0}}}_forEachCell(t,a,u,d,f,v,x,S){const E=this._convertToXCellCoord(t),C=this._convertToYCellCoord(a),P=this._convertToXCellCoord(u),R=this._convertToYCellCoord(d);for(let $=E;$<=P;$++)for(let U=C;U<=R;U++)if(f.call(this,t,a,u,d,this.xCellCount*U+$,v,x,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,d,f,v){const x=d-t,S=f-a,E=u+v;return E*E>x*x+S*S}_circleAndRectCollide(t,a,u,d,f,v,x){const S=(v-d)/2,E=Math.abs(t-(d+S));if(E>S+u)return!1;const C=(x-f)/2,P=Math.abs(a-(f+C));if(P>C+u)return!1;if(E<=S||P<=C)return!0;const R=E-S,$=P-C;return R*R+$*$<=u*u}}function Ae(p,t,a,u,d){const f=l.Z();return t?(l.a0(f,f,[1/d,1/d,1]),a||l.ae(f,f,u.angle)):l.a1(f,u.labelPlaneMatrix,p),f}function mn(p,t,a,u,d){if(t){const f=l.af(p);return l.a0(f,f,[d,d,1]),a||l.ae(f,f,-u.angle),f}return u.glCoordMatrix}function rr(p,t,a){let u;a?(u=[p.x,p.y,a(p.x,p.y),1],l.ag(u,u,t)):(u=[p.x,p.y,0,1],H(u,u,t));const d=u[3];return{point:new l.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function xs(p,t){return .5+p/t*.5}function Dn(p,t){const a=p[0]/p[3],u=p[1]/p[3];return a>=-t[0]&&a<=t[0]&&u>=-t[1]&&u<=t[1]}function Re(p,t,a,u,d,f,v,x,S,E){const C=u?p.textSizeData:p.iconSizeData,P=l.ah(C,a.transform.zoom),R=[256/a.width*2+1,256/a.height*2+1],$=u?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;$.clear();const U=p.lineVertexArray,q=u?p.text.placedSymbolArray:p.icon.placedSymbolArray,V=a.transform.width/a.transform.height;let re=!1;for(let he=0;he<q.length;he++){const K=q.get(he);if(K.hidden||K.writingMode===l.ai.vertical&&!re){N(K.numGlyphs,$);continue}let ne;if(re=!1,E?(ne=[K.anchorX,K.anchorY,E(K.anchorX,K.anchorY),1],l.ag(ne,ne,t)):(ne=[K.anchorX,K.anchorY,0,1],H(ne,ne,t)),!Dn(ne,R)){N(K.numGlyphs,$);continue}const pe=xs(a.transform.cameraToCenterDistance,ne[3]),fe=l.aj(C,P,K),we=v?fe/pe:fe*pe,ke=new l.P(K.anchorX,K.anchorY),Te=rr(ke,d,E).point,Pe={projections:{},offsets:{}},Ke=Jr(K,we,!1,x,t,d,f,p.glyphOffsetArray,U,$,Te,ke,Pe,V,S,E);re=Ke.useVertical,(Ke.notEnoughRoom||re||Ke.needsFlipping&&Jr(K,we,!0,x,t,d,f,p.glyphOffsetArray,U,$,Te,ke,Pe,V,S,E).notEnoughRoom)&&N(K.numGlyphs,$)}u?p.text.dynamicLayoutVertexBuffer.updateData($):p.icon.dynamicLayoutVertexBuffer.updateData($)}function mt(p,t,a,u,d,f,v,x,S,E,C,P,R){const $=x.glyphStartIndex+x.numGlyphs,U=x.lineStartIndex,q=x.lineStartIndex+x.lineLength,V=t.getoffsetX(x.glyphStartIndex),re=t.getoffsetX($-1),he=A(p*V,a,u,d,f,v,x.segment,U,q,S,E,C,P,R);if(!he)return null;const K=A(p*re,a,u,d,f,v,x.segment,U,q,S,E,C,P,R);return K?{first:he,last:K}:null}function ct(p,t,a,u){return p===l.ai.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*u?{useVertical:!0}:(p===l.ai.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Jr(p,t,a,u,d,f,v,x,S,E,C,P,R,$,U,q){const V=t/24,re=p.lineOffsetX*V,he=p.lineOffsetY*V;let K;if(p.numGlyphs>1){const ne=p.glyphStartIndex+p.numGlyphs,pe=p.lineStartIndex,fe=p.lineStartIndex+p.lineLength,we=mt(V,x,re,he,a,C,P,p,S,f,R,U,q);if(!we)return{notEnoughRoom:!0};const ke=rr(we.first.point,v,q).point,Te=rr(we.last.point,v,q).point;if(u&&!a){const Pe=ct(p.writingMode,ke,Te,$);if(Pe)return Pe}K=[we.first];for(let Pe=p.glyphStartIndex+1;Pe<ne-1;Pe++)K.push(A(V*x.getoffsetX(Pe),re,he,a,C,P,p.segment,pe,fe,S,f,R,U,q));K.push(we.last)}else{if(u&&!a){const pe=rr(P,d,q).point,fe=p.lineStartIndex+p.segment+1,we=new l.P(S.getx(fe),S.gety(fe)),ke=rr(we,d,q),Te=ke.signedDistanceFromCamera>0?ke.point:gn(P,we,pe,1,d,q),Pe=ct(p.writingMode,pe,Te,$);if(Pe)return Pe}const ne=A(V*x.getoffsetX(p.glyphStartIndex),re,he,a,C,P,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,S,f,R,U,q);if(!ne)return{notEnoughRoom:!0};K=[ne]}for(const ne of K)l.ak(E,ne.point,ne.angle);return{}}function gn(p,t,a,u,d,f){const v=rr(p.add(p.sub(t)._unit()),d,f).point,x=a.sub(v);return a.add(x._mult(u/x.mag()))}function pt(p,t){const{projectionCache:a,lineVertexArray:u,labelPlaneMatrix:d,tileAnchorPoint:f,distanceFromAnchor:v,getElevation:x,previousVertex:S,direction:E,absOffsetX:C}=t;if(a.projections[p])return a.projections[p];const P=new l.P(u.getx(p),u.gety(p)),R=rr(P,d,x);if(R.signedDistanceFromCamera>0)return a.projections[p]=R.point,R.point;const $=p-E;return gn(v===0?f:new l.P(u.getx($),u.gety($)),P,S,C-v+1,d,x)}function Ln(p,t,a){return p._unit()._perp()._mult(t*a)}function Z(p,t,a,u,d,f,v,x){const{projectionCache:S,direction:E}=x;if(S.offsets[p])return S.offsets[p];const C=a.add(t);if(p+E<u||p+E>=d)return S.offsets[p]=C,C;const P=pt(p+E,x),R=Ln(P.sub(a),v,E),$=a.add(R),U=P.add(R);return S.offsets[p]=l.al(f,C,$,U)||C,S.offsets[p]}function A(p,t,a,u,d,f,v,x,S,E,C,P,R,$){const U=u?p-t:p+t;let q=U>0?1:-1,V=0;u&&(q*=-1,V=Math.PI),q<0&&(V+=Math.PI);let re,he,K=q>0?x+v:x+v+1,ne=d,pe=d,fe=0,we=0;const ke=Math.abs(U),Te=[];let Pe;for(;fe+we<=ke;){if(K+=q,K<x||K>=S)return null;fe+=we,pe=ne,he=re;const Be={projectionCache:P,lineVertexArray:E,labelPlaneMatrix:C,tileAnchorPoint:f,distanceFromAnchor:fe,getElevation:$,previousVertex:pe,direction:q,absOffsetX:ke};if(ne=pt(K,Be),a===0)Te.push(pe),Pe=ne.sub(pe);else{let ot;const Qe=ne.sub(pe);ot=Qe.mag()===0?Ln(pt(K+q,Be).sub(ne),a,q):Ln(Qe,a,q),he||(he=pe.add(ot)),re=Z(K,ot,ne,x,S,he,a,Be),Te.push(he),Pe=re.sub(he)}we=Pe.mag()}const Ke=Pe._mult((ke-fe)/we)._add(he||pe),xt=V+Math.atan2(ne.y-pe.y,ne.x-pe.x);return Te.push(Ke),{point:Ke,angle:R?xt:0,path:Te}}const L=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function N(p,t){for(let a=0;a<p;a++){const u=t.length;t.resize(u+4),t.float32.set(L,3*u)}}function H(p,t,a){const u=t[0],d=t[1];return p[0]=a[0]*u+a[4]*d+a[12],p[1]=a[1]*u+a[5]*d+a[13],p[3]=a[3]*u+a[7]*d+a[15],p}const X=100;class le{constructor(t,a=new vs(t.width+200,t.height+200,25),u=new vs(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+X,this.screenBottomBoundary=t.height+X,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,u,d,f,v){const x=this.projectAndGetPerspectiveRatio(d,t.anchorPointX,t.anchorPointY,v),S=u*x.perspectiveRatio,E=t.x1*S+x.point.x,C=t.y1*S+x.point.y,P=t.x2*S+x.point.x,R=t.y2*S+x.point.y;return!this.isInsideGrid(E,C,P,R)||a!=="always"&&this.grid.hitTest(E,C,P,R,a,f)||x.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[E,C,P,R],offscreen:this.isOffscreen(E,C,P,R)}}placeCollisionCircles(t,a,u,d,f,v,x,S,E,C,P,R,$,U){const q=[],V=new l.P(a.anchorX,a.anchorY),re=rr(V,v,U),he=xs(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),K=(C?f/he:f*he)/l.ap,ne=rr(V,x,U).point,pe=mt(K,d,a.lineOffsetX*K,a.lineOffsetY*K,!1,ne,V,a,u,x,{projections:{},offsets:{}},!1,U);let fe=!1,we=!1,ke=!0;if(pe){const Te=.5*R*he+$,Pe=new l.P(-100,-100),Ke=new l.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Xs,Be=pe.first,ot=pe.last;let Qe=[];for(let ft=Be.path.length-1;ft>=1;ft--)Qe.push(Be.path[ft]);for(let ft=1;ft<ot.path.length;ft++)Qe.push(ot.path[ft]);const Ft=2.5*Te;if(S){const ft=Qe.map(wt=>rr(wt,S,U));Qe=ft.some(wt=>wt.signedDistanceFromCamera<=0)?[]:ft.map(wt=>wt.point)}let vt=[];if(Qe.length>0){const ft=Qe[0].clone(),wt=Qe[0].clone();for(let ur=1;ur<Qe.length;ur++)ft.x=Math.min(ft.x,Qe[ur].x),ft.y=Math.min(ft.y,Qe[ur].y),wt.x=Math.max(wt.x,Qe[ur].x),wt.y=Math.max(wt.y,Qe[ur].y);vt=ft.x>=Pe.x&&wt.x<=Ke.x&&ft.y>=Pe.y&&wt.y<=Ke.y?[Qe]:wt.x<Pe.x||ft.x>Ke.x||wt.y<Pe.y||ft.y>Ke.y?[]:l.am([Qe],Pe.x,Pe.y,Ke.x,Ke.y)}for(const ft of vt){xt.reset(ft,.25*Te);let wt=0;wt=xt.length<=.5*Te?1:Math.ceil(xt.paddedLength/Ft)+1;for(let ur=0;ur<wt;ur++){const Zt=ur/Math.max(wt-1,1),Or=xt.lerp(Zt),Sr=Or.x+X,fr=Or.y+X;q.push(Sr,fr,Te,0);const zi=Sr-Te,Ht=fr-Te,_n=Sr+Te,vn=fr+Te;if(ke=ke&&this.isOffscreen(zi,Ht,_n,vn),we=we||this.isInsideGrid(zi,Ht,_n,vn),t!=="always"&&this.grid.hitTestCircle(Sr,fr,Te,t,P)&&(fe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:fe}}}}return{circles:!E&&fe||!we||he<this.perspectiveRatioCutoff?[]:q,offscreen:ke,collisionDetected:fe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,d=1/0,f=-1/0,v=-1/0;for(const C of t){const P=new l.P(C.x+X,C.y+X);u=Math.min(u,P.x),d=Math.min(d,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y),a.push(P)}const x=this.grid.query(u,d,f,v).concat(this.ignoredGrid.query(u,d,f,v)),S={},E={};for(const C of x){const P=C.key;if(S[P.bucketInstanceId]===void 0&&(S[P.bucketInstanceId]={}),S[P.bucketInstanceId][P.featureIndex])continue;const R=[new l.P(C.x1,C.y1),new l.P(C.x2,C.y1),new l.P(C.x2,C.y2),new l.P(C.x1,C.y2)];l.an(a,R)&&(S[P.bucketInstanceId][P.featureIndex]=!0,E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]=[]),E[P.bucketInstanceId].push(P.featureIndex))}return E}insertCollisionBox(t,a,u,d,f,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:f,collisionGroupID:v,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,d,f,v){const x=u?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:f,collisionGroupID:v,overlapMode:a};for(let E=0;E<t.length;E+=4)x.insertCircle(S,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,a,u,d){let f;return d?(f=[a,u,d(a,u),1],l.ag(f,f,t)):(f=[a,u,0,1],H(f,f,t)),{point:new l.P((f[0]/f[3]+1)/2*this.transform.width+X,(-f[1]/f[3]+1)/2*this.transform.height+X),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,a,u,d){return u<X||t>=this.screenRightBoundary||d<X||a>this.screenBottomBoundary}isInsideGrid(t,a,u,d){return u>=0&&t<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ao([]);return l.$(t,t,[-100,-100,0]),t}}function ee(p,t,a){return t*(l.N/(p.tileSize*Math.pow(2,a-p.tileID.overscaledZ)))}class Q{constructor(t,a,u,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class se{constructor(t,a,u,d,f){this.text=new Q(t?t.text:null,a,u,f),this.icon=new Q(t?t.icon:null,a,d,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _e{constructor(t,a,u){this.text=t,this.icon=a,this.skipFade=u}}class xe{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Se{constructor(t,a,u,d,f){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=f}}class it{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function ut(p,t,a,u,d){const{horizontalAlign:f,verticalAlign:v}=l.au(p);return new l.P(-(f-.5)*t+u[0]*d,-(v-.5)*a+u[1]*d)}function Xe(p,t,a,u,d,f){const{x1:v,x2:x,y1:S,y2:E,anchorPointX:C,anchorPointY:P}=p,R=new l.P(t,a);return u&&R._rotate(d?f:-f),{x1:v+R.x,y1:S+R.y,x2:x+R.x,y2:E+R.y,anchorPointX:C,anchorPointY:P}}class st{constructor(t,a,u,d,f){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new it(d),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,u,d){const f=u.getBucket(a),v=u.latestFeatureIndex;if(!f||!v||a.id!==f.layerIds[0])return;const x=u.collisionBoxArray,S=f.layers[0].layout,E=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),C=u.tileSize/l.N,P=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),R=S.get("text-pitch-alignment")==="map",$=S.get("text-rotation-alignment")==="map",U=ee(u,1,this.transform.zoom),q=Ae(P,R,$,this.transform,U);let V=null;if(R){const he=mn(P,R,$,this.transform,U);V=l.a1([],this.transform.labelPlaneMatrix,he)}this.retainedQueryData[f.bucketInstanceId]=new Se(f.bucketInstanceId,v,f.sourceLayerIndex,f.index,u.tileID);const re={bucket:f,layout:S,posMatrix:P,textLabelPlaneMatrix:q,labelToScreenMatrix:V,scale:E,textPixelRatio:C,holdingForFade:u.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:l.ah(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const he of f.sortKeyRanges){const{sortKey:K,symbolInstanceStart:ne,symbolInstanceEnd:pe}=he;t.push({sortKey:K,symbolInstanceStart:ne,symbolInstanceEnd:pe,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,a,u,d,f,v,x,S,E,C,P,R,$,U,q,V){const re=l.aq[t.textAnchor],he=[t.textOffset0,t.textOffset1],K=ut(re,u,d,he,f),ne=this.collisionIndex.placeCollisionBox(Xe(a,K.x,K.y,v,x,this.transform.angle),P,S,E,C.predicate,V);if((!q||this.collisionIndex.placeCollisionBox(Xe(q,K.x,K.y,v,x,this.transform.angle),P,S,E,C.predicate,V).box.length!==0)&&ne.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:he,width:u,height:d,anchor:re,textBoxScale:f,prevAnchor:pe},this.markUsedJustification($,re,R,U),$.allowVerticalPlacement&&(this.markUsedOrientation($,U,R),this.placedOrientations[R.crossTileID]=U),{shift:K,placedGlyphBoxes:ne}}}placeLayerBucketPart(t,a,u){const{bucket:d,layout:f,posMatrix:v,textLabelPlaneMatrix:x,labelToScreenMatrix:S,textPixelRatio:E,holdingForFade:C,collisionBoxArray:P,partiallyEvaluatedTextSize:R,collisionGroup:$}=t.parameters,U=f.get("text-optional"),q=f.get("icon-optional"),V=l.ar(f,"text-overlap","text-allow-overlap"),re=V==="always",he=l.ar(f,"icon-overlap","icon-allow-overlap"),K=he==="always",ne=f.get("text-rotation-alignment")==="map",pe=f.get("text-pitch-alignment")==="map",fe=f.get("icon-text-fit")!=="none",we=f.get("symbol-z-order")==="viewport-y",ke=re&&(K||!d.hasIconData()||q),Te=K&&(re||!d.hasTextData()||U);!d.collisionArrays&&P&&d.deserializeCollisionBoxes(P);const Pe=this.retainedQueryData[d.bucketInstanceId].tileID,Ke=this.terrain?(Be,ot)=>this.terrain.getElevation(Pe,Be,ot):null,xt=(Be,ot)=>{var Qe,Ft;if(a[Be.crossTileID])return;if(C)return void(this.placements[Be.crossTileID]=new _e(!1,!1,!1));let vt=!1,ft=!1,wt=!0,ur=null,Zt={box:null,offscreen:null},Or={box:null},Sr=null,fr=null,zi=null,Ht=0,_n=0,vn=0;ot.textFeatureIndex?Ht=ot.textFeatureIndex:Be.useRuntimeCollisionCircles&&(Ht=Be.featureIndex),ot.verticalTextFeatureIndex&&(_n=ot.verticalTextFeatureIndex);const us=ot.textBox;if(us){const Gr=cr=>{let Tr=l.ai.horizontal;if(d.allowVerticalPlacement&&!cr&&this.prevPlacement){const fi=this.prevPlacement.placedOrientations[Be.crossTileID];fi&&(this.placedOrientations[Be.crossTileID]=fi,Tr=fi,this.markUsedOrientation(d,Tr,Be))}return Tr},Nr=(cr,Tr)=>{if(d.allowVerticalPlacement&&Be.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const fi of d.writingModes)if(fi===l.ai.vertical?(Zt=Tr(),Or=Zt):Zt=cr(),Zt&&Zt.box&&Zt.box.length)break}else Zt=cr()},ti=Be.textAnchorOffsetStartIndex,zs=Be.textAnchorOffsetEndIndex;if(zs===ti){const cr=(Tr,fi)=>{const hr=this.collisionIndex.placeCollisionBox(Tr,V,E,v,$.predicate,Ke);return hr&&hr.box&&hr.box.length&&(this.markUsedOrientation(d,fi,Be),this.placedOrientations[Be.crossTileID]=fi),hr};Nr(()=>cr(us,l.ai.horizontal),()=>{const Tr=ot.verticalTextBox;return d.allowVerticalPlacement&&Be.numVerticalGlyphVertices>0&&Tr?cr(Tr,l.ai.vertical):{box:null,offscreen:null}}),Gr(Zt&&Zt.box&&Zt.box.length)}else{let cr=l.aq[(Ft=(Qe=this.prevPlacement)===null||Qe===void 0?void 0:Qe.variableOffsets[Be.crossTileID])===null||Ft===void 0?void 0:Ft.anchor];const Tr=(hr,Ms,Ko)=>{const gh=hr.x2-hr.x1,yh=hr.y2-hr.y1,_p=Be.textBoxScale,Su=fe&&he==="never"?Ms:null;let xn={box:[],offscreen:!1},As=V==="never"?1:2,wn="never";cr&&As++;for(let Hi=0;Hi<As;Hi++){for(let bn=ti;bn<zs;bn++){const Tu=d.textAnchorOffsets.get(bn);if(cr&&Tu.textAnchor!==cr)continue;const Nn=this.attemptAnchorPlacement(Tu,hr,gh,yh,_p,ne,pe,E,v,$,wn,Be,d,Ko,Su,Ke);if(Nn&&(xn=Nn.placedGlyphBoxes,xn&&xn.box&&xn.box.length))return vt=!0,ur=Nn.shift,xn}cr?cr=null:wn=V}return xn};Nr(()=>Tr(us,ot.iconBox,l.ai.horizontal),()=>{const hr=ot.verticalTextBox;return d.allowVerticalPlacement&&!(Zt&&Zt.box&&Zt.box.length)&&Be.numVerticalGlyphVertices>0&&hr?Tr(hr,ot.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),Zt&&(vt=Zt.box,wt=Zt.offscreen);const fi=Gr(Zt&&Zt.box);if(!vt&&this.prevPlacement){const hr=this.prevPlacement.variableOffsets[Be.crossTileID];hr&&(this.variableOffsets[Be.crossTileID]=hr,this.markUsedJustification(d,hr.anchor,Be,fi))}}}if(Sr=Zt,vt=Sr&&Sr.box&&Sr.box.length>0,wt=Sr&&Sr.offscreen,Be.useRuntimeCollisionCircles){const Gr=d.text.placedSymbolArray.get(Be.centerJustifiedTextSymbolIndex),Nr=l.aj(d.textSizeData,R,Gr),ti=f.get("text-padding");fr=this.collisionIndex.placeCollisionCircles(V,Gr,d.lineVertexArray,d.glyphOffsetArray,Nr,v,x,S,u,pe,$.predicate,Be.collisionCircleDiameter,ti,Ke),fr.circles.length&&fr.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),vt=re||fr.circles.length>0&&!fr.collisionDetected,wt=wt&&fr.offscreen}if(ot.iconFeatureIndex&&(vn=ot.iconFeatureIndex),ot.iconBox){const Gr=Nr=>{const ti=fe&&ur?Xe(Nr,ur.x,ur.y,ne,pe,this.transform.angle):Nr;return this.collisionIndex.placeCollisionBox(ti,he,E,v,$.predicate,Ke)};Or&&Or.box&&Or.box.length&&ot.verticalIconBox?(zi=Gr(ot.verticalIconBox),ft=zi.box.length>0):(zi=Gr(ot.iconBox),ft=zi.box.length>0),wt=wt&&zi.offscreen}const Ps=U||Be.numHorizontalGlyphVertices===0&&Be.numVerticalGlyphVertices===0,ua=q||Be.numIconVertices===0;if(Ps||ua?ua?Ps||(ft=ft&&vt):vt=ft&&vt:ft=vt=ft&&vt,vt&&Sr&&Sr.box&&this.collisionIndex.insertCollisionBox(Sr.box,V,f.get("text-ignore-placement"),d.bucketInstanceId,Or&&Or.box&&_n?_n:Ht,$.ID),ft&&zi&&this.collisionIndex.insertCollisionBox(zi.box,he,f.get("icon-ignore-placement"),d.bucketInstanceId,vn,$.ID),fr&&(vt&&this.collisionIndex.insertCollisionCircles(fr.circles,V,f.get("text-ignore-placement"),d.bucketInstanceId,Ht,$.ID),u)){const Gr=d.bucketInstanceId;let Nr=this.collisionCircleArrays[Gr];Nr===void 0&&(Nr=this.collisionCircleArrays[Gr]=new xe);for(let ti=0;ti<fr.circles.length;ti+=4)Nr.circles.push(fr.circles[ti+0]),Nr.circles.push(fr.circles[ti+1]),Nr.circles.push(fr.circles[ti+2]),Nr.circles.push(fr.collisionDetected?1:0)}if(Be.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Be.crossTileID]=new _e(vt||ke,ft||Te,wt||d.justReloaded),a[Be.crossTileID]=!0};if(we){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Be=d.getSortedSymbolIndexes(this.transform.angle);for(let ot=Be.length-1;ot>=0;--ot){const Qe=Be[ot];xt(d.symbolInstances.get(Qe),d.collisionArrays[Qe])}}else for(let Be=t.symbolInstanceStart;Be<t.symbolInstanceEnd;Be++)xt(d.symbolInstances.get(Be),d.collisionArrays[Be]);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[d.bucketInstanceId];l.as(Be.invProjMatrix,v),Be.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(t,a,u,d){let f;f=d===l.ai.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.at(a)];const v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const x of v)x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=f>=0&&x!==f?0:u.crossTileID)}markUsedOrientation(t,a,u){const d=a===l.ai.horizontal||a===l.ai.horizontalOnly?a:0,f=a===l.ai.vertical?a:0,v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const x of v)t.text.placedSymbolArray.get(x).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(t):1,f=a?a.opacities:{},v=a?a.variableOffsets:{},x=a?a.placedOrientations:{};for(const S in this.placements){const E=this.placements[S],C=f[S];C?(this.opacities[S]=new se(C,d,E.text,E.icon),u=u||E.text!==C.text.placed||E.icon!==C.icon.placed):(this.opacities[S]=new se(null,d,E.text,E.icon,E.skipFade),u=u||E.text||E.icon)}for(const S in f){const E=f[S];if(!this.opacities[S]){const C=new se(E,d,!1,!1);C.isHidden()||(this.opacities[S]=C,u=u||E.text.placed||E.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in x)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=x[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const u={};for(const d of a){const f=d.getBucket(t);f&&d.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,u,d.collisionBoxArray)}}updateBucketOpacities(t,a,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const d=t.layers[0],f=d.layout,v=new se(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),S=f.get("icon-allow-overlap"),E=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",R=f.get("icon-text-fit")!=="none",$=new se(null,0,x&&(S||!t.hasIconData()||f.get("icon-optional")),S&&(x||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const U=(q,V,re)=>{for(let he=0;he<V/4;he++)q.opacityVertexArray.emplaceBack(re);q.hasVisibleVertices=q.hasVisibleVertices||re!==ji};for(let q=0;q<t.symbolInstances.length;q++){const V=t.symbolInstances.get(q),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:he,crossTileID:K}=V;let ne=this.opacities[K];a[K]?ne=v:ne||(ne=$,this.opacities[K]=ne),a[K]=!0;const pe=V.numIconVertices>0,fe=this.placedOrientations[V.crossTileID],we=fe===l.ai.vertical,ke=fe===l.ai.horizontal||fe===l.ai.horizontalOnly;if(re>0||he>0){const Te=Fr(ne.text);U(t.text,re,we?ji:Te),U(t.text,he,ke?ji:Te);const Pe=ne.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(Be=>{Be>=0&&(t.text.placedSymbolArray.get(Be).hidden=Pe||we?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=Pe||ke?1:0);const Ke=this.variableOffsets[V.crossTileID];Ke&&this.markUsedJustification(t,Ke.anchor,V,fe);const xt=this.placedOrientations[V.crossTileID];xt&&(this.markUsedJustification(t,"left",V,xt),this.markUsedOrientation(t,xt,V))}if(pe){const Te=Fr(ne.icon),Pe=!(R&&V.verticalPlacedIconSymbolIndex&&we);V.placedIconSymbolIndex>=0&&(U(t.icon,V.numIconVertices,Pe?Te:ji),t.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=ne.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(U(t.icon,V.numVerticalIconVertices,Pe?ji:Te),t.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[q];if(Te){let Pe=new l.P(0,0);if(Te.textBox||Te.verticalTextBox){let xt=!0;if(E){const Be=this.variableOffsets[K];Be?(Pe=ut(Be.anchor,Be.width,Be.height,Be.textOffset,Be.textBoxScale),C&&Pe._rotate(P?this.transform.angle:-this.transform.angle)):xt=!1}Te.textBox&&ht(t.textCollisionBox.collisionVertexArray,ne.text.placed,!xt||we,Pe.x,Pe.y),Te.verticalTextBox&&ht(t.textCollisionBox.collisionVertexArray,ne.text.placed,!xt||ke,Pe.x,Pe.y)}const Ke=!!(!ke&&Te.verticalIconBox);Te.iconBox&&ht(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,Ke,R?Pe.x:0,R?Pe.y:0),Te.verticalIconBox&&ht(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,!Ke,R?Pe.x:0,R?Pe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=q.invProjMatrix,t.placementViewportMatrix=q.viewportMatrix,t.collisionCircleArray=q.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function ht(p,t,a,u,d){p.emplaceBack(t?1:0,a?1:0,u||0,d||0),p.emplaceBack(t?1:0,a?1:0,u||0,d||0),p.emplaceBack(t?1:0,a?1:0,u||0,d||0),p.emplaceBack(t?1:0,a?1:0,u||0,d||0)}const At=Math.pow(2,25),Ot=Math.pow(2,24),Et=Math.pow(2,17),kt=Math.pow(2,16),Zr=Math.pow(2,9),$t=Math.pow(2,8),vr=Math.pow(2,1);function Fr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,a=Math.floor(127*p.opacity);return a*At+t*Ot+a*Et+t*kt+a*Zr+t*$t+a*vr+t}const ji=0;class Ac{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,u,d,f){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(v,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((x,S)=>x.sortKey-S.sortKey));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class Ks{constructor(t,a,u,d,f,v,x,S){this.placement=new st(t,a,v,x,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u){const d=l.h.now(),f=()=>!this._forceFullPlacement&&l.h.now()-d>2;for(;this._currentPlacementIndex>=0;){const v=a[t[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=x)&&(!v.maxzoom||v.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Ac(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ys=512/l.N/2;class tp{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let f=0;f<a.length;f++){const v=a.get(f),x=v.key,S=d.get(x);S?S.push(v):d.set(x,[v])}for(const[f,v]of d){const x={positions:v.map(S=>({x:Math.floor(S.anchorX*Ys),y:Math.floor(S.anchorY*Ys)})),crossTileIDs:v.map(S=>S.crossTileID)};if(x.positions.length>128){const S=new l.av(x.positions.length,16,Uint16Array);for(const{x:E,y:C}of x.positions)S.add(E,C);S.finish(),delete x.positions,x.index=S}this._symbolsByKey[f]=x}}getScaledCoordinates(t,a){const{x:u,y:d,z:f}=this.tileID.canonical,{x:v,y:x,z:S}=a.canonical,E=Ys/Math.pow(2,S-f),C=(x*l.N+t.anchorY)*E,P=d*l.N*Ys;return{x:Math.floor((v*l.N+t.anchorX)*E-u*l.N*Ys),y:Math.floor(C-P)}}findMatches(t,a,u){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let f=0;f<t.length;f++){const v=t.get(f);if(v.crossTileID)continue;const x=this._symbolsByKey[v.key];if(!x)continue;const S=this.getScaledCoordinates(v,a);if(x.index){const E=x.index.range(S.x-d,S.y-d,S.x+d,S.y+d).sort();for(const C of E){const P=x.crossTileIDs[C];if(!u[P]){u[P]=!0,v.crossTileID=P;break}}}else if(x.positions)for(let E=0;E<x.positions.length;E++){const C=x.positions[E],P=x.crossTileIDs[E];if(Math.abs(C.x-S.x)<=d&&Math.abs(C.y-S.y)<=d&&!u[P]){u[P]=!0,v.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const d=this.indexes[u],f={};for(const v in d){const x=d[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+a),f[x.tileID.key]=x}this.indexes[u]=f}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<a.symbolInstances.length;f++)a.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const v=this.indexes[f];if(Number(f)>t.overscaledZ)for(const x in v){const S=v[x];S.tileID.isChildOf(t)&&S.findMatches(a.symbolInstances,t,d)}else{const x=v[t.scaledTo(Number(f)).key];x&&x.findMatches(a.symbolInstances,t,d)}}for(let f=0;f<a.symbolInstances.length;f++){const v=a.symbolInstances.get(f);v.crossTileID||(v.crossTileID=u.generate(),d[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new tp(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const d=this.indexes[u];for(const f in d)t[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[f]),delete d[f],a=!0)}return a}}class bo{constructor(){this.layerIndexes={},this.crossTileIDs=new Rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new Fl);let f=!1;const v={};d.handleWrapJump(u);for(const x of a){const S=x.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(x.tileID,S,this.crossTileIDs)&&(f=!0),v[S.bucketInstanceId]=!0)}return d.removeStaleBuckets(v)&&(f=!0),f}pruneUnusedLayers(t){const a={};t.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}const qr=(p,t)=>l.x(p,t&&t.filter(a=>a.identifier!=="source.canvas")),ki=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),rp=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),Ui=l.aw();class Br extends l.E{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Ut(wo(),this,t._getMapId()),this.imageManager=new Rr,this.imageManager.setEventedParent(this),this.glyphManager=new Ti(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new gt(256,512),this.crossTileSymbolIndex=new bo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const u=this;this._rtlTextPluginCallback=Br.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,v)=>{if(l.aA(f),v&&v.every(x=>x))for(const x in u.sourceCaches){const S=u.sourceCaches[x].getSource().type;S!=="vector"&&S!=="geojson"||u.sourceCaches[x].reload()}})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const f=this.sourceCaches[d.sourceId];if(!f)return;const v=f.getSource();if(v&&v.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===v.id&&this._validateLayer(S)}})}loadURL(t,a={},u){this.fire(new l.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const d=this.map._requestManager.transformRequest(t,ie.Style);this._request=l.f(d,(f,v)=>{this._request=null,f?this.fire(new l.j(f)):v&&this._load(v,a,u)})}loadJSON(t,a={},u){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(t,a,u)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Ui,{validate:!1})}_load(t,a,u){var d;const f=a.transformStyle?a.transformStyle(u,t):t;if(!a.validate||!qr(this,l.y(f))){this._loaded=!0,this.stylesheet=f;for(const v in f.sources)this.addSource(v,f.sources[v],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new dt(this.stylesheet.light),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const u=l.aC(a);u.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=u}}_loadSprite(t,a=!1,u=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(d,f,v,x){const S=Ze(d),E=S.length,C=v>1?"@2x":"",P={},R={},$={};for(const{id:U,url:q}of S){const V=f.transformRequest(f.normalizeSpriteURL(q,C,".json"),ie.SpriteJSON),re=`${U}_${V.url}`;P[re]=l.f(V,(ne,pe)=>{delete P[re],R[U]=pe,Vt(x,R,$,ne,E)});const he=f.transformRequest(f.normalizeSpriteURL(q,C,".png"),ie.SpriteImage),K=`${U}_${he.url}`;P[K]=lt.getImage(he,(ne,pe)=>{delete P[K],$[U]=pe,Vt(x,R,$,ne,E)})}return{cancel(){for(const U of Object.values(P))U.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(d,f)=>{if(this._spriteRequest=null,d)this.fire(new l.j(d));else if(f)for(const v in f){this._spritesImagesIds[v]=[];const x=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(S=>!(S in f)):[];for(const S of x)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in f[v]){const E=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,f[v][S],!1):this.imageManager.addImage(E,f[v][S]),a&&(this._changedImages[E]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const u=t.sourceLayer;if(!u)return;const d=a.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const u=[];for(const d of t)a[d]&&u.push(a[d]);return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const d=this._layers[u];d.type!=="custom"&&(t[u]=d.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const v in this._updatedSources){const x=this._updatedSources[v];if(x==="reload")this._reloadSource(v);else{if(x!=="clear")throw new Error(`Invalid action ${x}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const f=this.sourceCaches[d];u[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const d in u){const f=this.sourceCaches[d];u[d]!==f.used&&f.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){this._checkLoaded();const u=this.serialize();if(t=a.transformStyle?a.transformStyle(u,t):t,qr(this,l.y(t)))return!1;(t=l.aD(t)).layers=l.aB(t.layers);const d=l.aE(u,t).filter(v=>!(v.command in rp));if(d.length===0)return!1;const f=d.filter(v=>!(v.command in ki));if(f.length>0)throw new Error(`Unimplemented: ${f.map(v=>v.command).join(", ")}.`);for(const v of d)v.command!=="setTransition"&&this[v.command].apply(this,v.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,a){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.y.source,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=this.sourceCaches[t]=new hi(t,a,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t})),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,u={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new l.j(new Error(`Layer "${d}" already exists on this map.`)));let f;if(t.type==="custom"){if(qr(this,l.aF(t)))return;f=l.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(d,t.source),t=l.aD(t),t=l.e(t,{source:d})),this._validate(l.y.layer,`layers.${d}`,t,{arrayIndex:-1},u))return;f=l.aC(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new l.j(new Error(`Cannot add layer "${d}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,d),this._layerOrderChanged=!0,this._layers[d]=f,this._removedLayers[d]&&f.source&&f.type!=="custom"){const x=this._removedLayers[d];delete this._removedLayers[d],x.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const u=this._order.indexOf(t);this._order.splice(u,1);const d=a?this._order.indexOf(a):this._order.length;a&&d===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,u){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===a&&d.maxzoom===u||(a!=null&&(d.minzoom=a),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,u={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!l.aG(d.filter,a))return a==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.y.filter,`layers.${d.id}.filter`,a,null,u)||(d.filter=l.aD(a),this._updateLayer(d)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aD(this.getLayer(t).filter)}setLayoutProperty(t,a,u,d={}){this._checkLoaded();const f=this.getLayer(t);f?l.aG(f.getLayoutProperty(a),u)||(f.setLayoutProperty(a,u,d),this._updateLayer(f)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const u=this.getLayer(t);if(u)return u.getLayoutProperty(a);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,u,d={}){this._checkLoaded();const f=this.getLayer(t);f?l.aG(f.getPaintProperty(a),u)||(f.setPaintProperty(a,u,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const u=t.source,d=t.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const v=f.getSource().type;v==="geojson"&&d?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||d?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(d,t.id,a)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const u=t.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=d.getSource().type,v=f==="vector"?t.sourceLayer:void 0;f!=="vector"||v?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(v,t.id,a):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,u=t.sourceLayer,d=this.sourceCaches[a];if(d!==void 0)return d.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aH(this.sourceCaches,f=>f.serialize()),a=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.aI({version:d.version,name:d.name,metadata:d.metadata,light:d.light,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:t,layers:a,terrain:u},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=v=>this._layers[v].type==="fill-extrusion",u={},d=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(a(x)){u[x]=v;for(const S of t){const E=S[x];if(E)for(const C of E)d.push(C)}}}d.sort((v,x)=>x.intersectionZ-v.intersectionZ);const f=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(a(x))for(let S=d.length-1;S>=0;S--){const E=d[S].feature;if(u[E.layer.id]<v)break;f.push(E),d.pop()}else for(const S of t){const E=S[x];if(E)for(const C of E)f.push(C.feature)}}return f}queryRenderedFeatures(t,a,u){a&&a.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const x of a.layers){const S=this._layers[x];if(!S)return this.fire(new l.j(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];d[S.source]=!0}}const f=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const x in this.sourceCaches)a.layers&&!d[x]||f.push(ys(this.sourceCaches[x],this._layers,v,t,a,u));return this.placement&&f.push(function(x,S,E,C,P,R,$){const U={},q=R.queryRenderedSymbols(C),V=[];for(const re of Object.keys(q).map(Number))V.push($[re]);V.sort(Jn);for(const re of V){const he=re.featureIndex.lookupSymbolFeatures(q[re.bucketInstanceId],S,re.bucketIndex,re.sourceLayerIndex,P.filter,P.layers,P.availableImages,x);for(const K in he){const ne=U[K]=U[K]||[],pe=he[K];pe.sort((fe,we)=>{const ke=re.featureSortOrder;if(ke){const Te=ke.indexOf(fe.featureIndex);return ke.indexOf(we.featureIndex)-Te}return we.featureIndex-fe.featureIndex});for(const fe of pe)ne.push(fe)}}for(const re in U)U[re].forEach(he=>{const K=he.feature,ne=E[x[re].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=ne});return U}(this._layers,v,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,a){a&&a.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.sourceCaches[t];return u?function(d,f){const v=d.getRenderableIds().map(E=>d.getTileByID(E)),x=[],S={};for(let E=0;E<v.length;E++){const C=v[E],P=C.tileID.canonical.key;S[P]||(S[P]=!0,C.querySourceFeatures(x,f))}return x}(u,a):[]}addSourceType(t,a,u){return Mn(t)?u(new Error(`A source type called "${t}" already exists.`)):(((d,f)=>{Ba[d]=f})(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const v in t)if(!l.aG(t[v],u[v])){d=!0;break}if(!d)return;const f={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(f)}_validate(t,a,u,d,f={}){return(!f||f.validate!==!1)&&qr(this,t.call(l.y,l.e({key:a,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const u=this.sourceCaches[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,u,d,f=!1){let v=!1,x=!1;const S={};for(const E of this._order){const C=this._layers[E];if(C.type!=="symbol")continue;if(!S[C.source]){const R=this.sourceCaches[C.source];S[C.source]=R.getRenderableIds(!0).map($=>R.getTileByID($)).sort(($,U)=>U.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(U.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(C,S[C.source],t.center.lng);v=v||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),t.zoom))&&(this.pauseablePlacement=new Ks(t,this.map.terrain,this._order,f,a,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),x=!0),v&&this.pauseablePlacement.placement.setStale()),x||v)for(const E of this._order){const C=this._layers[E];C.type==="symbol"&&this.placement.updateLayerOpacities(C,S[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,u){this.imageManager.getImages(a.icons,u),this._updateTilesForChangedImages();const d=this.sourceCaches[a.source];d&&d.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,u){this.glyphManager.getGlyphs(a.stacks,u);const d=this.sourceCaches[a.source];d&&d.setDependencies(a.tileID.key,a.type,[""])}getResource(t,a,u){return l.m(a,u)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.y.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,u={},d){this._checkLoaded();const f=[{id:t,url:a}],v=[...Ze(this.stylesheet.sprite),...f];this._validate(l.y.sprite,"sprite",v,null,u)||(this.stylesheet.sprite=v,this._loadSprite(f,!0,d))}removeSprite(t){this._checkLoaded();const a=Ze(this.stylesheet.sprite);if(a.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex(u=>u.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ze(this.stylesheet.sprite)}setSprite(t,a={},u){this._checkLoaded(),t&&this._validate(l.y.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}}Br.registerForPluginStateChange=l.aK;var So=l.Q([{name:"a_pos",type:"Int16",components:2}]),Qs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Yt={prelude:Pt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Pt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Pt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Pt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Pt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Pt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Pt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Pt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Pt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Pt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Pt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Qs),terrainDepth:Pt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Qs),terrainCoords:Pt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Qs)};function Pt(p,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),d=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=f?f.concat(d):d,x={};return{fragmentSource:p=p.replace(a,(S,E,C,P,R)=>(x[R]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${C} ${P} ${R};
#else
uniform ${C} ${P} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${C} ${P} ${R} = u_${R};
#endif
`)),vertexSource:t=t.replace(a,(S,E,C,P,R)=>{const $=P==="float"?"vec2":"vec4",U=R.match(/color/)?"color":$;return x[R]?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${C} ${$} a_${R};
varying ${C} ${P} ${R};
#else
uniform ${C} ${P} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${C} ${P} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${C} ${P} ${R} = u_${R};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${C} ${$} a_${R};
#else
uniform ${C} ${P} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${P} ${R} = a_${R};
#else
    ${C} ${P} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${P} ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${C} ${P} ${R} = u_${R};
#endif
`}),staticAttributes:u,staticUniforms:v}}class ws{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,u,d,f,v,x,S,E){this.context=t;let C=this.boundPaintVertexBuffers.length!==d.length;for(let P=0;!C&&P<d.length;P++)this.boundPaintVertexBuffers[P]!==d[P]&&(C=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||C||this.boundIndexBuffer!==f||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==x||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==E?this.freshBind(a,u,d,f,v,x,S,E):(t.bindVertexArray.set(this.vao),x&&x.bind(),f&&f.dynamicDraw&&f.bind(),S&&S.bind(),E&&E.bind())}freshBind(t,a,u,d,f,v,x,S){const E=t.numAttributes,C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=x,this.boundDynamicVertexBuffer3=S,a.enableAttributes(P,t);for(const R of u)R.enableAttributes(P,t);v&&v.enableAttributes(P,t),x&&x.enableAttributes(P,t),S&&S.enableAttributes(P,t),a.bind(),a.setVertexAttribPointers(P,t,f);for(const R of u)R.bind(),R.setVertexAttribPointers(P,t,f);v&&(v.bind(),v.setVertexAttribPointers(P,t,f)),d&&d.bind(),x&&(x.bind(),x.setVertexAttribPointers(P,t,f)),S&&(S.bind(),S.setVertexAttribPointers(P,t,f)),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ir(p){const t=[];for(let a=0;a<p.length;a++){if(p[a]===null)continue;const u=p[a].split(" ");t.push(u.pop())}return t}class To{constructor(t,a,u,d,f,v){const x=t.gl;this.program=x.createProgram();const S=ir(a.staticAttributes),E=u?u.getBinderAttributes():[],C=S.concat(E),P=Yt.prelude.staticUniforms?ir(Yt.prelude.staticUniforms):[],R=a.staticUniforms?ir(a.staticUniforms):[],$=u?u.getBinderUniforms():[],U=P.concat(R).concat($),q=[];for(const fe of U)q.indexOf(fe)<0&&q.push(fe);const V=u?u.defines():[];f&&V.push("#define OVERDRAW_INSPECTOR;"),v&&V.push("#define TERRAIN3D;");const re=V.concat(Yt.prelude.fragmentSource,a.fragmentSource).join(`
`),he=V.concat(Yt.prelude.vertexSource,a.vertexSource).join(`
`),K=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(K,re),x.compileShader(K),!x.getShaderParameter(K,x.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${x.getShaderInfoLog(K)}`);x.attachShader(this.program,K);const ne=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(ne,he),x.compileShader(ne),!x.getShaderParameter(ne,x.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${x.getShaderInfoLog(ne)}`);x.attachShader(this.program,ne),this.attributes={};const pe={};this.numAttributes=C.length;for(let fe=0;fe<this.numAttributes;fe++)C[fe]&&(x.bindAttribLocation(this.program,fe,C[fe]),this.attributes[C[fe]]=fe);if(x.linkProgram(this.program),!x.getProgramParameter(this.program,x.LINK_STATUS))throw new Error(`Program failed to link: ${x.getProgramInfoLog(this.program)}`);x.deleteShader(ne),x.deleteShader(K);for(let fe=0;fe<q.length;fe++){const we=q[fe];if(we&&!pe[we]){const ke=x.getUniformLocation(this.program,we);ke&&(pe[we]=ke)}}this.fixedUniforms=d(t,pe),this.terrainUniforms=((fe,we)=>({u_depth:new l.aL(fe,we.u_depth),u_terrain:new l.aL(fe,we.u_terrain),u_terrain_dim:new l.aM(fe,we.u_terrain_dim),u_terrain_matrix:new l.aN(fe,we.u_terrain_matrix),u_terrain_unpack:new l.aO(fe,we.u_terrain_unpack),u_terrain_exaggeration:new l.aM(fe,we.u_terrain_exaggeration)}))(t,pe),this.binderUniforms=u?u.getUniforms(t,pe):[]}draw(t,a,u,d,f,v,x,S,E,C,P,R,$,U,q,V,re,he){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(d),t.setColorMode(f),t.setCullFace(v),S){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(S[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(x[pe]);q&&q.setUniforms(t,this.binderUniforms,$,{zoom:U});let ne=0;switch(a){case K.LINES:ne=2;break;case K.TRIANGLES:ne=3;break;case K.LINE_STRIP:ne=1}for(const pe of R.get()){const fe=pe.vaos||(pe.vaos={});(fe[E]||(fe[E]=new ws)).bind(t,this,C,q?q.getPaintVertexBuffers():[],P,pe.vertexOffset,V,re,he),K.drawElements(a,pe.primitiveLength*ne,K.UNSIGNED_SHORT,pe.primitiveOffset*ne*2)}}}function $i(p,t,a){const u=1/ee(a,1,t.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),f=a.tileSize*Math.pow(2,t.transform.tileZoom)/d,v=f*(a.tileID.canonical.x+a.tileID.wrap*d),x=f*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}const Bl=(p,t,a,u)=>{const d=t.style.light,f=d.properties.get("position"),v=[f.x,f.y,f.z],x=function(){var E=new l.A(9);return l.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();d.properties.get("anchor")==="viewport"&&function(E,C){var P=Math.sin(C),R=Math.cos(C);E[0]=R,E[1]=P,E[2]=0,E[3]=-P,E[4]=R,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(x,-t.transform.angle),function(E,C,P){var R=C[0],$=C[1],U=C[2];E[0]=R*P[0]+$*P[3]+U*P[6],E[1]=R*P[1]+$*P[4]+U*P[7],E[2]=R*P[2]+$*P[5]+U*P[8]}(v,v,x);const S=d.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+a,u_opacity:u}},rs=(p,t,a,u,d,f,v)=>l.e(Bl(p,t,a,u),$i(f,t,v),{u_height_factor:-Math.pow(2,d.overscaledZ)/v.tileSize/8}),Dc=p=>({u_matrix:p}),Ol=(p,t,a,u)=>l.e(Dc(p),$i(a,t,u)),ko=(p,t)=>({u_matrix:p,u_world:t}),Eo=(p,t,a,u,d)=>l.e(Ol(p,t,a,u),{u_world:d}),is=(p,t,a,u)=>{const d=p.transform;let f,v;if(u.paint.get("circle-pitch-alignment")==="map"){const x=ee(a,1,d.zoom);f=!0,v=[x,x]}else f=!1,v=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,a,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},Nl=(p,t,a)=>{const u=ee(a,1,t.zoom),d=Math.pow(2,t.zoom-a.tileID.overscaledZ),f=a.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*d),t.pixelsToGLUnits[1]/(u*d)],u_overscale_factor:f}},Oa=(p,t,a=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:a}),Lc=p=>({u_matrix:p}),ip=(p,t,a,u)=>({u_matrix:p,u_extrude_scale:ee(t,1,a),u_intensity:u});function Vl(p,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new l.U(0,u/a).toLngLat().lat,new l.U(0,(u+1)/a).toLngLat().lat]}const jl=(p,t,a,u)=>{const d=p.transform;return{u_matrix:Io(p,t,a,u),u_ratio:1/ee(t,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Rc=(p,t,a,u,d)=>l.e(jl(p,t,a,d),{u_image:0,u_image_height:u}),np=(p,t,a,u,d)=>{const f=p.transform,v=Bc(t,f);return{u_matrix:Io(p,t,a,d),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ee(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Fc=(p,t,a,u,d,f)=>{const v=p.lineAtlas,x=Bc(t,p.transform),S=a.layout.get("line-cap")==="round",E=v.getDash(u.from,S),C=v.getDash(u.to,S),P=E.width*d.fromScale,R=C.width*d.toScale;return l.e(jl(p,t,a,f),{u_patternscale_a:[x/P,-E.height/2],u_patternscale_b:[x/R,-C.height/2],u_sdfgamma:v.width/(256*Math.min(P,R)*p.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:C.y,u_mix:d.t})};function Bc(p,t){return 1/ee(p,1,t.tileZoom)}function Io(p,t,a,u){return p.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Oc=(p,t,a,u,d)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(v=d.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Nc(d.paint.get("raster-hue-rotate"))};var f,v};function Nc(p){p*=Math.PI/180;const t=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Ul=(p,t,a,u,d,f,v,x,S,E)=>{const C=d.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:C.width/C.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:v,u_coord_matrix:x,u_is_text:+S,u_pitch_with_map:+u,u_texsize:E,u_texture:0}},$l=(p,t,a,u,d,f,v,x,S,E,C)=>{const P=d.transform;return l.e(Ul(p,t,a,u,d,f,v,x,S,E),{u_gamma_scale:u?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:1})},bs=(p,t,a,u,d,f,v,x,S,E)=>l.e($l(p,t,a,u,d,f,v,x,!0,S),{u_texsize_icon:E,u_texture_icon:1}),Co=(p,t,a)=>({u_matrix:p,u_opacity:t,u_color:a}),Zi=(p,t,a,u,d,f)=>l.e(function(v,x,S,E){const C=S.imageManager.getPattern(v.from.toString()),P=S.imageManager.getPattern(v.to.toString()),{width:R,height:$}=S.imageManager.getPixelSize(),U=Math.pow(2,E.tileID.overscaledZ),q=E.tileSize*Math.pow(2,S.transform.tileZoom)/U,V=q*(E.tileID.canonical.x+E.tileID.wrap*U),re=q*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[R,$],u_mix:x.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/ee(E,1,S.transform.tileZoom),u_pixel_coord_upper:[V>>16,re>>16],u_pixel_coord_lower:[65535&V,65535&re]}}(u,f,a,d),{u_matrix:p,u_opacity:t}),Po={fillExtrusion:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_lightpos:new l.aP(p,t.u_lightpos),u_lightintensity:new l.aM(p,t.u_lightintensity),u_lightcolor:new l.aP(p,t.u_lightcolor),u_vertical_gradient:new l.aM(p,t.u_vertical_gradient),u_opacity:new l.aM(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_lightpos:new l.aP(p,t.u_lightpos),u_lightintensity:new l.aM(p,t.u_lightintensity),u_lightcolor:new l.aP(p,t.u_lightcolor),u_vertical_gradient:new l.aM(p,t.u_vertical_gradient),u_height_factor:new l.aM(p,t.u_height_factor),u_image:new l.aL(p,t.u_image),u_texsize:new l.aQ(p,t.u_texsize),u_pixel_coord_upper:new l.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(p,t.u_pixel_coord_lower),u_scale:new l.aP(p,t.u_scale),u_fade:new l.aM(p,t.u_fade),u_opacity:new l.aM(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_image:new l.aL(p,t.u_image),u_texsize:new l.aQ(p,t.u_texsize),u_pixel_coord_upper:new l.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(p,t.u_pixel_coord_lower),u_scale:new l.aP(p,t.u_scale),u_fade:new l.aM(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_world:new l.aQ(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_world:new l.aQ(p,t.u_world),u_image:new l.aL(p,t.u_image),u_texsize:new l.aQ(p,t.u_texsize),u_pixel_coord_upper:new l.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(p,t.u_pixel_coord_lower),u_scale:new l.aP(p,t.u_scale),u_fade:new l.aM(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_scale_with_map:new l.aL(p,t.u_scale_with_map),u_pitch_with_map:new l.aL(p,t.u_pitch_with_map),u_extrude_scale:new l.aQ(p,t.u_extrude_scale),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_matrix:new l.aN(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(p,t.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(p,t.u_extrude_scale),u_overscale_factor:new l.aM(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_inv_matrix:new l.aN(p,t.u_inv_matrix),u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_viewport_size:new l.aQ(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new l.aR(p,t.u_color),u_matrix:new l.aN(p,t.u_matrix),u_overlay:new l.aL(p,t.u_overlay),u_overlay_scale:new l.aM(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new l.aM(p,t.u_extrude_scale),u_intensity:new l.aM(p,t.u_intensity),u_matrix:new l.aN(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_world:new l.aQ(p,t.u_world),u_image:new l.aL(p,t.u_image),u_color_ramp:new l.aL(p,t.u_color_ramp),u_opacity:new l.aM(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_image:new l.aL(p,t.u_image),u_latrange:new l.aQ(p,t.u_latrange),u_light:new l.aQ(p,t.u_light),u_shadow:new l.aR(p,t.u_shadow),u_highlight:new l.aR(p,t.u_highlight),u_accent:new l.aR(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_image:new l.aL(p,t.u_image),u_dimension:new l.aQ(p,t.u_dimension),u_zoom:new l.aM(p,t.u_zoom),u_unpack:new l.aO(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_ratio:new l.aM(p,t.u_ratio),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_ratio:new l.aM(p,t.u_ratio),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(p,t.u_units_to_pixels),u_image:new l.aL(p,t.u_image),u_image_height:new l.aM(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_texsize:new l.aQ(p,t.u_texsize),u_ratio:new l.aM(p,t.u_ratio),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_image:new l.aL(p,t.u_image),u_units_to_pixels:new l.aQ(p,t.u_units_to_pixels),u_scale:new l.aP(p,t.u_scale),u_fade:new l.aM(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_ratio:new l.aM(p,t.u_ratio),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(p,t.u_units_to_pixels),u_patternscale_a:new l.aQ(p,t.u_patternscale_a),u_patternscale_b:new l.aQ(p,t.u_patternscale_b),u_sdfgamma:new l.aM(p,t.u_sdfgamma),u_image:new l.aL(p,t.u_image),u_tex_y_a:new l.aM(p,t.u_tex_y_a),u_tex_y_b:new l.aM(p,t.u_tex_y_b),u_mix:new l.aM(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_tl_parent:new l.aQ(p,t.u_tl_parent),u_scale_parent:new l.aM(p,t.u_scale_parent),u_buffer_scale:new l.aM(p,t.u_buffer_scale),u_fade_t:new l.aM(p,t.u_fade_t),u_opacity:new l.aM(p,t.u_opacity),u_image0:new l.aL(p,t.u_image0),u_image1:new l.aL(p,t.u_image1),u_brightness_low:new l.aM(p,t.u_brightness_low),u_brightness_high:new l.aM(p,t.u_brightness_high),u_saturation_factor:new l.aM(p,t.u_saturation_factor),u_contrast_factor:new l.aM(p,t.u_contrast_factor),u_spin_weights:new l.aP(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new l.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(p,t.u_is_size_feature_constant),u_size_t:new l.aM(p,t.u_size_t),u_size:new l.aM(p,t.u_size),u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_pitch:new l.aM(p,t.u_pitch),u_rotate_symbol:new l.aL(p,t.u_rotate_symbol),u_aspect_ratio:new l.aM(p,t.u_aspect_ratio),u_fade_change:new l.aM(p,t.u_fade_change),u_matrix:new l.aN(p,t.u_matrix),u_label_plane_matrix:new l.aN(p,t.u_label_plane_matrix),u_coord_matrix:new l.aN(p,t.u_coord_matrix),u_is_text:new l.aL(p,t.u_is_text),u_pitch_with_map:new l.aL(p,t.u_pitch_with_map),u_texsize:new l.aQ(p,t.u_texsize),u_texture:new l.aL(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new l.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(p,t.u_is_size_feature_constant),u_size_t:new l.aM(p,t.u_size_t),u_size:new l.aM(p,t.u_size),u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_pitch:new l.aM(p,t.u_pitch),u_rotate_symbol:new l.aL(p,t.u_rotate_symbol),u_aspect_ratio:new l.aM(p,t.u_aspect_ratio),u_fade_change:new l.aM(p,t.u_fade_change),u_matrix:new l.aN(p,t.u_matrix),u_label_plane_matrix:new l.aN(p,t.u_label_plane_matrix),u_coord_matrix:new l.aN(p,t.u_coord_matrix),u_is_text:new l.aL(p,t.u_is_text),u_pitch_with_map:new l.aL(p,t.u_pitch_with_map),u_texsize:new l.aQ(p,t.u_texsize),u_texture:new l.aL(p,t.u_texture),u_gamma_scale:new l.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_is_halo:new l.aL(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new l.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(p,t.u_is_size_feature_constant),u_size_t:new l.aM(p,t.u_size_t),u_size:new l.aM(p,t.u_size),u_camera_to_center_distance:new l.aM(p,t.u_camera_to_center_distance),u_pitch:new l.aM(p,t.u_pitch),u_rotate_symbol:new l.aL(p,t.u_rotate_symbol),u_aspect_ratio:new l.aM(p,t.u_aspect_ratio),u_fade_change:new l.aM(p,t.u_fade_change),u_matrix:new l.aN(p,t.u_matrix),u_label_plane_matrix:new l.aN(p,t.u_label_plane_matrix),u_coord_matrix:new l.aN(p,t.u_coord_matrix),u_is_text:new l.aL(p,t.u_is_text),u_pitch_with_map:new l.aL(p,t.u_pitch_with_map),u_texsize:new l.aQ(p,t.u_texsize),u_texsize_icon:new l.aQ(p,t.u_texsize_icon),u_texture:new l.aL(p,t.u_texture),u_texture_icon:new l.aL(p,t.u_texture_icon),u_gamma_scale:new l.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new l.aM(p,t.u_device_pixel_ratio),u_is_halo:new l.aL(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_opacity:new l.aM(p,t.u_opacity),u_color:new l.aR(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_opacity:new l.aM(p,t.u_opacity),u_image:new l.aL(p,t.u_image),u_pattern_tl_a:new l.aQ(p,t.u_pattern_tl_a),u_pattern_br_a:new l.aQ(p,t.u_pattern_br_a),u_pattern_tl_b:new l.aQ(p,t.u_pattern_tl_b),u_pattern_br_b:new l.aQ(p,t.u_pattern_br_b),u_texsize:new l.aQ(p,t.u_texsize),u_mix:new l.aM(p,t.u_mix),u_pattern_size_a:new l.aQ(p,t.u_pattern_size_a),u_pattern_size_b:new l.aQ(p,t.u_pattern_size_b),u_scale_a:new l.aM(p,t.u_scale_a),u_scale_b:new l.aM(p,t.u_scale_b),u_pixel_coord_upper:new l.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_texture:new l.aL(p,t.u_texture),u_ele_delta:new l.aM(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_ele_delta:new l.aM(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new l.aN(p,t.u_matrix),u_texture:new l.aL(p,t.u_texture),u_terrain_coords_id:new l.aM(p,t.u_terrain_coords_id),u_ele_delta:new l.aM(p,t.u_ele_delta)})};class zo{constructor(t,a,u){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Na={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mo{constructor(t,a,u,d){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const d=a.attributes[this.attributes[u].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,a,u){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],v=a.attributes[f.name];v!==void 0&&t.vertexAttribPointer(v,f.components,t[Na[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Js=new WeakMap;function ns(p){var t;if(Js.has(p))return Js.get(p);{const a=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Js.set(p,a),a}}class St{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ao extends St{getDefault(){return l.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ei extends St{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ii extends St{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Zl extends St{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Do extends St{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Lo extends St{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ql extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Gl extends St{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ro extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Hl extends St{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Wl extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Fo extends St{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Vc extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class jc extends St{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ea extends St{getDefault(){return l.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sp extends St{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ap extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class op extends St{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class lp extends St{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class up extends St{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class cp extends St{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xl extends St{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Bo extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Kl extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yl extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ta extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Uc extends St{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $c extends St{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const u=this.gl;ns(u)?u.bindVertexArray(t):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ql extends St{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ss extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Zc extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ss extends St{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class ra extends ss{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class qc extends ss{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jl extends ss{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zt{constructor(t,a,u,d,f){this.context=t,this.width=a,this.height=u;const v=t.gl,x=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new ra(t,x),d)this.depthAttachment=f?new Jl(t,x):new qc(t,x);else if(f)throw new Error("Stencil cannot be setted without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Qt{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}Qt.Replace=[1,0],Qt.disabled=new Qt(Qt.Replace,l.aT.transparent,[!1,!1,!1,!1]),Qt.unblended=new Qt(Qt.Replace,l.aT.transparent,[!0,!0,!0,!0]),Qt.alphaBlended=new Qt([1,771],l.aT.transparent,[!0,!0,!0,!0]);class hp{constructor(t){var a,u;if(this.gl=t,this.clearColor=new Ao(this),this.clearDepth=new Ei(this),this.clearStencil=new Ii(this),this.colorMask=new Zl(this),this.depthMask=new Do(this),this.stencilMask=new Lo(this),this.stencilFunc=new ql(this),this.stencilOp=new Gl(this),this.stencilTest=new Ro(this),this.depthRange=new Hl(this),this.depthTest=new Wl(this),this.depthFunc=new Fo(this),this.blend=new Vc(this),this.blendFunc=new jc(this),this.blendColor=new ea(this),this.blendEquation=new sp(this),this.cullFace=new ap(this),this.cullFaceSide=new op(this),this.frontFace=new lp(this),this.program=new up(this),this.activeTexture=new cp(this),this.viewport=new Xl(this),this.bindFramebuffer=new Bo(this),this.bindRenderbuffer=new Kl(this),this.bindTexture=new Yl(this),this.bindVertexBuffer=new ta(this),this.bindElementBuffer=new Uc(this),this.bindVertexArray=new $c(this),this.pixelStoreUnpack=new Ql(this),this.pixelStoreUnpackPremultiplyAlpha=new Ss(this),this.pixelStoreUnpackFlipY=new Zc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ns(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:d==null?void 0:d.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new zo(this,t,a)}createVertexBuffer(t,a,u){return new Mo(this,t,a,u)}createRenderbuffer(t,a,u){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),f}createFramebuffer(t,a,u,d){return new zt(this,t,a,u,d)}clear({color:t,depth:a,stencil:u}){const d=this.gl;let f=0;t&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aG(t.blendFunction,Qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ns(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return ns(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Tt{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);const Ts=7680;class Jt{constructor(t,a,u,d,f,v){this.test=t,this.ref=a,this.mask=u,this.fail=d,this.depthFail=f,this.pass=v}}Jt.disabled=new Jt({func:519,mask:0},0,0,Ts,Ts,Ts);class Xt{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}let Va;function Gc(p,t,a,u,d,f,v){const x=p.context,S=x.gl,E=p.useProgram("collisionBox"),C=[];let P=0,R=0;for(let K=0;K<u.length;K++){const ne=u[K],pe=t.getTile(ne),fe=pe.getBucket(a);if(!fe)continue;let we=ne.posMatrix;d[0]===0&&d[1]===0||(we=p.translatePosMatrix(ne.posMatrix,pe,d,f));const ke=v?fe.textCollisionBox:fe.iconCollisionBox,Te=fe.collisionCircleArray;if(Te.length>0){const Pe=l.Z(),Ke=we;l.aU(Pe,fe.placementInvProjMatrix,p.transform.glCoordMatrix),l.aU(Pe,Pe,fe.placementViewportMatrix),C.push({circleArray:Te,circleOffset:R,transform:Ke,invTransform:Pe,coord:ne}),P+=Te.length/4,R=P}ke&&E.draw(x,S.LINES,Tt.disabled,Jt.disabled,p.colorModeForRenderPass(),Xt.disabled,Nl(we,p.transform,pe),p.style.map.terrain&&p.style.map.terrain.getTerrainData(ne),a.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,p.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!v||!C.length)return;const $=p.useProgram("collisionCircle"),U=new l.aV;U.resize(4*P),U._trim();let q=0;for(const K of C)for(let ne=0;ne<K.circleArray.length/4;ne++){const pe=4*ne,fe=K.circleArray[pe+0],we=K.circleArray[pe+1],ke=K.circleArray[pe+2],Te=K.circleArray[pe+3];U.emplace(q++,fe,we,ke,Te,0),U.emplace(q++,fe,we,ke,Te,1),U.emplace(q++,fe,we,ke,Te,2),U.emplace(q++,fe,we,ke,Te,3)}(!Va||Va.length<2*P)&&(Va=function(K){const ne=2*K,pe=new l.aX;pe.resize(ne),pe._trim();for(let fe=0;fe<ne;fe++){const we=6*fe;pe.uint16[we+0]=4*fe+0,pe.uint16[we+1]=4*fe+1,pe.uint16[we+2]=4*fe+2,pe.uint16[we+3]=4*fe+2,pe.uint16[we+4]=4*fe+3,pe.uint16[we+5]=4*fe+0}return pe}(P));const V=x.createIndexBuffer(Va,!0),re=x.createVertexBuffer(U,l.aW.members,!0);for(const K of C){const ne={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(he=p.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};$.draw(x,S.TRIANGLES,Tt.disabled,Jt.disabled,p.colorModeForRenderPass(),Xt.disabled,ne,p.style.map.terrain&&p.style.map.terrain.getTerrainData(K.coord),a.id,re,V,l.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,p.transform.zoom,null,null,null)}var he;re.destroy(),V.destroy()}Xt.disabled=new Xt(!1,1029,2305),Xt.backCCW=new Xt(!0,1029,2305);const eu=l.ao(new Float32Array(16));function Oo(p,t,a,u,d,f){const{horizontalAlign:v,verticalAlign:x}=l.au(p);return new l.P((-(v-.5)*t/d+u[0])*f,(-(x-.5)*a/d+u[1])*f)}function No(p,t,a,u,d,f,v,x,S,E,C){const P=p.text.placedSymbolArray,R=p.text.dynamicLayoutVertexArray,$=p.icon.dynamicLayoutVertexArray,U={};R.clear();for(let q=0;q<P.length;q++){const V=P.get(q),re=V.hidden||!V.crossTileID||p.allowVerticalPlacement&&!V.placedOrientation?null:u[V.crossTileID];if(re){const he=new l.P(V.anchorX,V.anchorY),K=rr(he,a?v:f,C),ne=xs(d.cameraToCenterDistance,K.signedDistanceFromCamera);let pe=l.aj(p.textSizeData,S,V)*ne/l.ap;a&&(pe*=p.tilePixelRatio/x);const{width:fe,height:we,anchor:ke,textOffset:Te,textBoxScale:Pe}=re,Ke=Oo(ke,fe,we,Te,Pe,pe),xt=a?rr(he.add(Ke),f,C).point:K.point.add(t?Ke.rotate(-d.angle):Ke),Be=p.allowVerticalPlacement&&V.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let ot=0;ot<V.numGlyphs;ot++)l.ak(R,xt,Be);E&&V.associatedIconIndex>=0&&(U[V.associatedIconIndex]={shiftedAnchor:xt,angle:Be})}else N(V.numGlyphs,R)}if(E){$.clear();const q=p.icon.placedSymbolArray;for(let V=0;V<q.length;V++){const re=q.get(V);if(re.hidden)N(re.numGlyphs,$);else{const he=U[V];if(he)for(let K=0;K<re.numGlyphs;K++)l.ak($,he.shiftedAnchor,he.angle);else N(re.numGlyphs,$)}}p.icon.dynamicLayoutVertexBuffer.updateData($)}p.text.dynamicLayoutVertexBuffer.updateData(R)}function tu(p,t,a){return a.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Vo(p,t,a,u,d,f,v,x,S,E,C,P){const R=p.context,$=R.gl,U=p.transform,q=x==="map",V=S==="map",re=x!=="viewport"&&a.layout.get("symbol-placement")!=="point",he=q&&!V&&!re,K=!a.layout.get("symbol-sort-key").isConstant();let ne=!1;const pe=p.depthModeForSublayer(0,Tt.ReadOnly),fe=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),we=[];for(const ke of u){const Te=t.getTile(ke),Pe=Te.getBucket(a);if(!Pe)continue;const Ke=d?Pe.text:Pe.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const xt=Ke.programConfigurations.get(a.id),Be=d||Pe.sdfIcons,ot=d?Pe.textSizeData:Pe.iconSizeData,Qe=V||U.pitch!==0,Ft=p.useProgram(tu(Be,d,Pe),xt),vt=l.ah(ot,U.zoom),ft=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ke);let wt,ur,Zt,Or,Sr=[0,0],fr=null;if(d)ur=Te.glyphAtlasTexture,Zt=$.LINEAR,wt=Te.glyphAtlasTexture.size,Pe.iconsInText&&(Sr=Te.imageAtlasTexture.size,fr=Te.imageAtlasTexture,Or=Qe||p.options.rotating||p.options.zooming||ot.kind==="composite"||ot.kind==="camera"?$.LINEAR:$.NEAREST);else{const cr=a.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;ur=Te.imageAtlasTexture,Zt=Be||p.options.rotating||p.options.zooming||cr||Qe?$.LINEAR:$.NEAREST,wt=Te.imageAtlasTexture.size}const zi=ee(Te,1,p.transform.zoom),Ht=Ae(ke.posMatrix,V,q,p.transform,zi),_n=mn(ke.posMatrix,V,q,p.transform,zi),vn=fe&&Pe.hasTextData(),us=a.layout.get("icon-text-fit")!=="none"&&vn&&Pe.hasIconData();if(re){const cr=p.style.map.terrain?(fi,hr)=>p.style.map.terrain.getElevation(ke,fi,hr):null,Tr=a.layout.get("text-rotation-alignment")==="map";Re(Pe,ke.posMatrix,p,d,Ht,_n,V,E,Tr,cr)}const Ps=p.translatePosMatrix(ke.posMatrix,Te,f,v),ua=re||d&&fe||us?eu:Ht,Gr=p.translatePosMatrix(_n,Te,f,v,!0),Nr=Be&&a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ti;ti=Be?Pe.iconsInText?bs(ot.kind,vt,he,V,p,Ps,ua,Gr,wt,Sr):$l(ot.kind,vt,he,V,p,Ps,ua,Gr,d,wt):Ul(ot.kind,vt,he,V,p,Ps,ua,Gr,d,wt);const zs={program:Ft,buffers:Ke,uniformValues:ti,atlasTexture:ur,atlasTextureIcon:fr,atlasInterpolation:Zt,atlasInterpolationIcon:Or,isSDF:Be,hasHalo:Nr};if(K&&Pe.canOverlap){ne=!0;const cr=Ke.segments.get();for(const Tr of cr)we.push({segments:new l.S([Tr]),sortKey:Tr.sortKey,state:zs,terrainData:ft})}else we.push({segments:Ke.segments,sortKey:0,state:zs,terrainData:ft})}ne&&we.sort((ke,Te)=>ke.sortKey-Te.sortKey);for(const ke of we){const Te=ke.state;if(R.activeTexture.set($.TEXTURE0),Te.atlasTexture.bind(Te.atlasInterpolation,$.CLAMP_TO_EDGE),Te.atlasTextureIcon&&(R.activeTexture.set($.TEXTURE1),Te.atlasTextureIcon&&Te.atlasTextureIcon.bind(Te.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Te.isSDF){const Pe=Te.uniformValues;Te.hasHalo&&(Pe.u_is_halo=1,ru(Te.buffers,ke.segments,a,p,Te.program,pe,C,P,Pe,ke.terrainData)),Pe.u_is_halo=0}ru(Te.buffers,ke.segments,a,p,Te.program,pe,C,P,Te.uniformValues,ke.terrainData)}}function ru(p,t,a,u,d,f,v,x,S,E){const C=u.context;d.draw(C,C.gl.TRIANGLES,f,v,x,Xt.disabled,S,E,a.id,p.layoutVertexBuffer,p.indexBuffer,t,a.paint,u.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function ja(p,t,a,u,d){if(!a||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let v=f[a.to.toString()],x=f[a.from.toString()];if(!v&&x&&(v=x),!x&&v&&(x=v),!v||!x){const S=d.getPaintProperty(t);v=f[S],x=f[S]}v&&x&&p.setConstantPatternPositions(v,x)}function Ua(p,t,a,u,d,f,v){const x=p.context.gl,S="fill-pattern",E=a.paint.get(S),C=E&&E.constantOr(1),P=a.getCrossfadeParameters();let R,$,U,q,V;v?($=C&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=x.LINES):($=C?"fillPattern":"fill",R=x.TRIANGLES);const re=E.constantOr(null);for(const he of u){const K=t.getTile(he);if(C&&!K.patternsLoaded())continue;const ne=K.getBucket(a);if(!ne)continue;const pe=ne.programConfigurations.get(a.id),fe=p.useProgram($,pe),we=p.style.map.terrain&&p.style.map.terrain.getTerrainData(he);C&&(p.context.activeTexture.set(x.TEXTURE0),K.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),pe.updatePaintBuffers(P)),ja(pe,S,re,K,a);const ke=we?he:null,Te=p.translatePosMatrix(ke?ke.posMatrix:he.posMatrix,K,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(v){q=ne.indexBuffer2,V=ne.segments2;const Pe=[x.drawingBufferWidth,x.drawingBufferHeight];U=$==="fillOutlinePattern"&&C?Eo(Te,p,P,K,Pe):ko(Te,Pe)}else q=ne.indexBuffer,V=ne.segments,U=C?Ol(Te,p,P,K):Dc(Te);fe.draw(p.context,R,d,p.stencilModeForClipping(he),f,Xt.disabled,U,we,a.id,ne.layoutVertexBuffer,q,V,a.paint,p.transform.zoom,pe)}}function $a(p,t,a,u,d,f,v){const x=p.context,S=x.gl,E="fill-extrusion-pattern",C=a.paint.get(E),P=C.constantOr(1),R=a.getCrossfadeParameters(),$=a.paint.get("fill-extrusion-opacity"),U=C.constantOr(null);for(const q of u){const V=t.getTile(q),re=V.getBucket(a);if(!re)continue;const he=p.style.map.terrain&&p.style.map.terrain.getTerrainData(q),K=re.programConfigurations.get(a.id),ne=p.useProgram(P?"fillExtrusionPattern":"fillExtrusion",K);P&&(p.context.activeTexture.set(S.TEXTURE0),V.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers(R)),ja(K,E,U,V,a);const pe=p.translatePosMatrix(q.posMatrix,V,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),fe=a.paint.get("fill-extrusion-vertical-gradient"),we=P?rs(pe,p,fe,$,q,R,V):Bl(pe,p,fe,$);ne.draw(x,x.gl.TRIANGLES,d,f,v,Xt.backCCW,we,he,a.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,a.paint,p.transform.zoom,K,p.style.map.terrain&&re.centroidVertexBuffer)}}function dp(p,t,a,u,d,f,v){const x=p.context,S=x.gl,E=a.fbo;if(!E)return;const C=p.useProgram("hillshade"),P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),C.draw(x,S.TRIANGLES,d,f,v,Xt.disabled,((R,$,U,q)=>{const V=U.paint.get("hillshade-shadow-color"),re=U.paint.get("hillshade-highlight-color"),he=U.paint.get("hillshade-accent-color");let K=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=R.transform.angle);const ne=!R.options.moving;return{u_matrix:q?q.posMatrix:R.transform.calculatePosMatrix($.tileID.toUnwrapped(),ne),u_image:0,u_latrange:Vl(0,$.tileID),u_light:[U.paint.get("hillshade-exaggeration"),K],u_shadow:V,u_highlight:re,u_accent:he}})(p,a,u,P?t:null),P,u.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function iu(p,t,a,u,d,f){const v=p.context,x=v.gl,S=t.dem;if(S&&S.data){const E=S.dim,C=S.stride,P=S.getPixels();if(v.activeTexture.set(x.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(C),t.demTexture){const $=t.demTexture;$.update(P,{premultiply:!1}),$.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else t.demTexture=new Ue(v,P,x.RGBA,{premultiply:!1}),t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);v.activeTexture.set(x.TEXTURE0);let R=t.fbo;if(!R){const $=new Ue(v,{width:E,height:E,data:null},x.RGBA);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),R=t.fbo=v.createFramebuffer(E,E,!0,!1),R.colorAttachment.set($.texture)}v.bindFramebuffer.set(R.framebuffer),v.viewport.set([0,0,E,E]),p.useProgram("hillshadePrepare").draw(v,x.TRIANGLES,u,d,f,Xt.disabled,(($,U)=>{const q=U.stride,V=l.Z();return l.aS(V,0,l.N,-l.N,0,0,1),l.$(V,V,[0,-l.N,0]),{u_matrix:V,u_image:1,u_dimension:[q,q],u_zoom:$.overscaledZ,u_unpack:U.getUnpackVector()}})(t.tileID,S),null,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function pp(p,t,a,u,d,f){const v=u.paint.get("raster-fade-duration");if(!f&&v>0){const x=l.h.now(),S=(x-p.timeAdded)/v,E=t?(x-t.timeAdded)/v:-1,C=a.getSource(),P=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),$=R&&p.refreshedUponExpiration?1:l.ad(R?S:1-E,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const Hc=new l.aT(1,0,0,1),jo=new l.aT(0,1,0,1),nu=new l.aT(0,0,1,1),Wc=new l.aT(1,0,1,1),Xc=new l.aT(0,1,1,1);function Za(p,t,a,u){$o(p,0,t+a/2,p.transform.width,a,u)}function Uo(p,t,a,u){$o(p,t-a/2,0,a,p.transform.height,u)}function $o(p,t,a,u,d,f){const v=p.context,x=v.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*p.pixelRatio,a*p.pixelRatio,u*p.pixelRatio,d*p.pixelRatio),v.clear({color:f}),x.disable(x.SCISSOR_TEST)}function Kc(p,t,a){const u=p.context,d=u.gl,f=a.posMatrix,v=p.useProgram("debug"),x=Tt.disabled,S=Jt.disabled,E=p.colorModeForRenderPass(),C="$debug",P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(a);u.activeTexture.set(d.TEXTURE0);const R=t.getTileByID(a.key).latestRawTileData,$=Math.floor((R&&R.byteLength||0)/1024),U=t.getTile(a).tileSize,q=512/Math.min(U,512)*(a.overscaledZ/p.transform.zoom)*.5;let V=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(V+=` => ${a.overscaledZ}`),function(re,he){re.initDebugOverlayCanvas();const K=re.debugOverlayCanvas,ne=re.context.gl,pe=re.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,K.width,K.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(he,5,5),pe.strokeText(he,5,5),re.debugOverlayTexture.update(K),re.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(p,`${V} ${$}kB`),v.draw(u,d.TRIANGLES,x,S,Qt.alphaBlended,Xt.disabled,Oa(f,l.aT.transparent,q),null,C,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(u,d.LINE_STRIP,x,S,E,Xt.disabled,Oa(f,l.aT.red),P,C,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function nr(p,t,a){const u=p.context,d=u.gl,f=p.colorModeForRenderPass(),v=new Tt(d.LEQUAL,Tt.ReadWrite,p.depthRangeFor3D),x=p.useProgram("terrain"),S=t.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,p.width,p.height]);for(const E of a){const C=p.renderToTexture.getTexture(E),P=t.getTerrainData(E.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,C.texture);const R={u_matrix:p.transform.calculatePosMatrix(E.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};x.draw(u,d.TRIANGLES,v,Jt.disabled,f,Xt.backCCW,R,P,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class ks{constructor(t,a){this.context=new hp(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=hi.maxUnderzooming+hi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bo}resize(t,a,u){if(this.width=Math.floor(t*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,a=new l.a_;a.emplaceBack(0,0),a.emplaceBack(l.N,0),a.emplaceBack(0,l.N),a.emplaceBack(l.N,l.N),this.tileExtentBuffer=t.createVertexBuffer(a,So.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const u=new l.a_;u.emplaceBack(0,0),u.emplaceBack(l.N,0),u.emplaceBack(0,l.N),u.emplaceBack(l.N,l.N),this.debugBuffer=t.createVertexBuffer(u,So.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const d=new l.V;d.emplaceBack(0,0,0,0),d.emplaceBack(l.N,0,l.N,0),d.emplaceBack(0,l.N,0,l.N),d.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=t.createVertexBuffer(d,rn.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const f=new l.a_;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,So.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const v=new l.a$;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const x=new l.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const S=this.context.gl;this.stencilClearMode=new Jt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.Z();l.aS(u,0,this.width,this.height,0,0,1),l.a0(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,Tt.disabled,this.stencilClearMode,Qt.disabled,Xt.disabled,Lc(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const u=this.context,d=u.gl;this.nextStencilID+a.length>256&&this.clearStencil(),u.setColorMode(Qt.disabled),u.setDepthMode(Tt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of a){const x=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);f.draw(u,d.TRIANGLES,Tt.disabled,new Jt({func:d.ALWAYS,mask:0},x,255,d.KEEP,d.KEEP,d.REPLACE),Qt.disabled,Xt.disabled,Lc(v.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Jt({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Jt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,u=t.sort((v,x)=>x.overscaledZ-v.overscaledZ),d=u[u.length-1].overscaledZ,f=u[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const v={};for(let x=0;x<f;x++)v[x+d]=new Jt({func:a.GEQUAL,mask:255},x+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=f,[v,u]}return[{[d]:Jt.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Qt([t.CONSTANT_COLOR,t.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qt.unblended:Qt.alphaBlended}depthModeForSublayer(t,a,u){if(!this.opaquePassEnabledForLayer())return Tt.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(u||this.context.gl.LEQUAL,a,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,f={},v={},x={};for(const S in d){const E=d[S];E.used&&E.prepare(this.context),f[S]=E.getVisibleCoordinates(),v[S]=f[S].slice().reverse(),x[S]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<u.length;S++)if(this.style._layers[u[S]].is3D()){this.opaquePassCutoff=S;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,C){const P=E.context,R=P.gl,$=Qt.unblended,U=new Tt(R.LEQUAL,Tt.ReadWrite,[0,1]),q=C.getTerrainMesh(),V=C.sourceCache.getRenderableTiles(),re=E.useProgram("terrainDepth");P.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),P.clear({color:l.aT.transparent,depth:1});for(const he of V){const K=C.getTerrainData(he.tileID),ne={u_matrix:E.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(E.transform.zoom)};re.draw(P,R.TRIANGLES,U,Jt.disabled,$,Xt.backCCW,ne,K,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,C){const P=E.context,R=P.gl,$=Qt.unblended,U=new Tt(R.LEQUAL,Tt.ReadWrite,[0,1]),q=C.getTerrainMesh(),V=C.getCoordsTexture(),re=C.sourceCache.getRenderableTiles(),he=E.useProgram("terrainCoords");P.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),P.clear({color:l.aT.transparent,depth:1}),C.coordsIndex=[];for(const K of re){const ne=C.getTerrainData(K.tileID);P.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,V.texture);const pe={u_matrix:E.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(E.transform.zoom)};he.draw(P,R.TRIANGLES,U,Jt.disabled,$,Xt.backCCW,pe,ne,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),C.coordsIndex.push(K.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const S of u){const E=this.style._layers[S];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const C=v[E.source];(E.type==="custom"||C.length)&&this.renderLayer(this,d[E.source],E,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[u[this.currentLayer]],E=d[S.source],C=f[S.source];this._renderTileClippingMasks(S,C),this.renderLayer(this,E,S,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const S=this.style._layers[u[this.currentLayer]],E=d[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const C=(S.type==="symbol"?x:v)[S.source];this._renderTileClippingMasks(S,f[S.source]),this.renderLayer(this,E,S,C)}if(this.options.showTileBoundaries){const S=function(E,C){let P=null;const R=Object.values(E._layers).flatMap(V=>V.source&&!V.isHidden(C)?[E.sourceCaches[V.source]]:[]),$=R.filter(V=>V.getSource().type==="vector"),U=R.filter(V=>V.getSource().type!=="vector"),q=V=>{(!P||P.getSource().maxzoom<V.getSource().maxzoom)&&(P=V)};return $.forEach(V=>q(V)),P||U.forEach(V=>q(V)),P}(this.style,this.transform.zoom);S&&function(E,C,P){for(let R=0;R<P.length;R++)Kc(E,C,P[R])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const E=S.transform.padding;Za(S,S.transform.height-(E.top||0),3,Hc),Za(S,E.bottom||0,3,jo),Uo(S,E.left||0,3,nu),Uo(S,S.transform.width-(E.right||0),3,Wc);const C=S.transform.centerPoint;(function(P,R,$,U){$o(P,R-1,$-10,2,20,U),$o(P,R-10,$-1,20,2,U)})(S,C.x,S.transform.height-C.y,Xc)}(this),this.context.setDefault()}renderLayer(t,a,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,v,x,S,E){if(f.renderPass!=="translucent")return;const C=Jt.disabled,P=f.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(R,$,U,q,V,re,he){const K=$.transform,ne=V==="map",pe=re==="map";for(const fe of R){const we=q.getTile(fe),ke=we.getBucket(U);if(!ke||!ke.text||!ke.text.segments.get().length)continue;const Te=l.ah(ke.textSizeData,K.zoom),Pe=ee(we,1,$.transform.zoom),Ke=Ae(fe.posMatrix,pe,ne,$.transform,Pe),xt=U.layout.get("icon-text-fit")!=="none"&&ke.hasIconData();if(Te){const Be=Math.pow(2,K.zoom-we.tileID.overscaledZ);No(ke,ne,pe,he,K,Ke,fe.posMatrix,Be,Te,xt,$.style.map.terrain?(ot,Qe)=>$.style.map.terrain.getElevation(fe,ot,Qe):null)}}}(S,f,x,v,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),E),x.paint.get("icon-opacity").constantOr(1)!==0&&Vo(f,v,x,S,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),C,P),x.paint.get("text-opacity").constantOr(1)!==0&&Vo(f,v,x,S,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),C,P),v.map.showCollisionBoxes&&(Gc(f,v,x,S,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),!0),Gc(f,v,x,S,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),!1))})(t,a,u,d,this.style.placement.variableOffsets);break;case"circle":(function(f,v,x,S){if(f.renderPass!=="translucent")return;const E=x.paint.get("circle-opacity"),C=x.paint.get("circle-stroke-width"),P=x.paint.get("circle-stroke-opacity"),R=!x.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(C.constantOr(1)===0||P.constantOr(1)===0))return;const $=f.context,U=$.gl,q=f.depthModeForSublayer(0,Tt.ReadOnly),V=Jt.disabled,re=f.colorModeForRenderPass(),he=[];for(let K=0;K<S.length;K++){const ne=S[K],pe=v.getTile(ne),fe=pe.getBucket(x);if(!fe)continue;const we=fe.programConfigurations.get(x.id),ke=f.useProgram("circle",we),Te=fe.layoutVertexBuffer,Pe=fe.indexBuffer,Ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne),xt={programConfiguration:we,program:ke,layoutVertexBuffer:Te,indexBuffer:Pe,uniformValues:is(f,ne,pe,x),terrainData:Ke};if(R){const Be=fe.segments.get();for(const ot of Be)he.push({segments:new l.S([ot]),sortKey:ot.sortKey,state:xt})}else he.push({segments:fe.segments,sortKey:0,state:xt})}R&&he.sort((K,ne)=>K.sortKey-ne.sortKey);for(const K of he){const{programConfiguration:ne,program:pe,layoutVertexBuffer:fe,indexBuffer:we,uniformValues:ke,terrainData:Te}=K.state;pe.draw($,U.TRIANGLES,q,V,re,Xt.disabled,ke,Te,x.id,fe,we,K.segments,x.paint,f.transform.zoom,ne)}})(t,a,u,d);break;case"heatmap":(function(f,v,x,S){if(x.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const E=f.context,C=E.gl,P=Jt.disabled,R=new Qt([C.ONE,C.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function($,U,q){const V=$.gl;$.activeTexture.set(V.TEXTURE1),$.viewport.set([0,0,U.width/4,U.height/4]);let re=q.heatmapFbo;if(re)V.bindTexture(V.TEXTURE_2D,re.colorAttachment.get()),$.bindFramebuffer.set(re.framebuffer);else{const he=V.createTexture();V.bindTexture(V.TEXTURE_2D,he),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),re=q.heatmapFbo=$.createFramebuffer(U.width/4,U.height/4,!1,!1),function(K,ne,pe,fe){var we,ke;const Te=K.gl,Pe=(we=K.HALF_FLOAT)!==null&&we!==void 0?we:Te.UNSIGNED_BYTE,Ke=(ke=K.RGBA16F)!==null&&ke!==void 0?ke:Te.RGBA;Te.texImage2D(Te.TEXTURE_2D,0,Ke,ne.width/4,ne.height/4,0,Te.RGBA,Pe,null),fe.colorAttachment.set(pe)}($,U,he,re)}})(E,f,x),E.clear({color:l.aT.transparent});for(let $=0;$<S.length;$++){const U=S[$];if(v.hasRenderableParent(U))continue;const q=v.getTile(U),V=q.getBucket(x);if(!V)continue;const re=V.programConfigurations.get(x.id),he=f.useProgram("heatmap",re),{zoom:K}=f.transform;he.draw(E,C.TRIANGLES,Tt.disabled,P,R,Xt.disabled,ip(U.posMatrix,q,K,x.paint.get("heatmap-intensity")),null,x.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,x.paint,f.transform.zoom,re)}E.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(E,C){const P=E.context,R=P.gl,$=C.heatmapFbo;if(!$)return;P.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,$.colorAttachment.get()),P.activeTexture.set(R.TEXTURE1);let U=C.colorRampTexture;U||(U=C.colorRampTexture=new Ue(P,C.colorRamp,R.RGBA)),U.bind(R.LINEAR,R.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(P,R.TRIANGLES,Tt.disabled,Jt.disabled,E.colorModeForRenderPass(),Xt.disabled,((q,V,re,he)=>{const K=l.Z();l.aS(K,0,q.width,q.height,0,0,1);const ne=q.context.gl;return{u_matrix:K,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}})(E,C),null,C.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,C.paint,E.transform.zoom)}(f,x))})(t,a,u,d);break;case"line":(function(f,v,x,S){if(f.renderPass!=="translucent")return;const E=x.paint.get("line-opacity"),C=x.paint.get("line-width");if(E.constantOr(1)===0||C.constantOr(1)===0)return;const P=f.depthModeForSublayer(0,Tt.ReadOnly),R=f.colorModeForRenderPass(),$=x.paint.get("line-dasharray"),U=x.paint.get("line-pattern"),q=U.constantOr(1),V=x.paint.get("line-gradient"),re=x.getCrossfadeParameters(),he=q?"linePattern":$?"lineSDF":V?"lineGradient":"line",K=f.context,ne=K.gl;let pe=!0;for(const fe of S){const we=v.getTile(fe);if(q&&!we.patternsLoaded())continue;const ke=we.getBucket(x);if(!ke)continue;const Te=ke.programConfigurations.get(x.id),Pe=f.context.program.get(),Ke=f.useProgram(he,Te),xt=pe||Ke.program!==Pe,Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(fe),ot=U.constantOr(null);if(ot&&we.imageAtlas){const vt=we.imageAtlas,ft=vt.patternPositions[ot.to.toString()],wt=vt.patternPositions[ot.from.toString()];ft&&wt&&Te.setConstantPatternPositions(ft,wt)}const Qe=Be?fe:null,Ft=q?np(f,we,x,re,Qe):$?Fc(f,we,x,$,re,Qe):V?Rc(f,we,x,ke.lineClipsArray.length,Qe):jl(f,we,x,Qe);if(q)K.activeTexture.set(ne.TEXTURE0),we.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Te.updatePaintBuffers(re);else if($&&(xt||f.lineAtlas.dirty))K.activeTexture.set(ne.TEXTURE0),f.lineAtlas.bind(K);else if(V){const vt=ke.gradients[x.id];let ft=vt.texture;if(x.gradientVersion!==vt.version){let wt=256;if(x.stepInterpolant){const ur=v.getSource().maxzoom,Zt=fe.canonical.z===ur?Math.ceil(1<<f.transform.maxZoom-fe.canonical.z):1;wt=l.ad(l.aY(ke.maxLineLength/l.N*1024*Zt),256,K.maxTextureSize)}vt.gradient=l.aZ({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:vt.gradient||void 0,clips:ke.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new Ue(K,vt.gradient,ne.RGBA),vt.version=x.gradientVersion,ft=vt.texture}K.activeTexture.set(ne.TEXTURE0),ft.bind(x.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Ke.draw(K,ne.TRIANGLES,P,f.stencilModeForClipping(fe),R,Xt.disabled,Ft,Be,x.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,x.paint,f.transform.zoom,Te,ke.layoutVertexBuffer2),pe=!1}})(t,a,u,d);break;case"fill":(function(f,v,x,S){const E=x.paint.get("fill-color"),C=x.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const P=f.colorModeForRenderPass(),R=x.paint.get("fill-pattern"),$=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&E.constantOr(l.aT.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===$){const U=f.depthModeForSublayer(1,f.renderPass==="opaque"?Tt.ReadWrite:Tt.ReadOnly);Ua(f,v,x,S,U,P,!1)}if(f.renderPass==="translucent"&&x.paint.get("fill-antialias")){const U=f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);Ua(f,v,x,S,U,P,!0)}})(t,a,u,d);break;case"fill-extrusion":(function(f,v,x,S){const E=x.paint.get("fill-extrusion-opacity");if(E!==0&&f.renderPass==="translucent"){const C=new Tt(f.context.gl.LEQUAL,Tt.ReadWrite,f.depthRangeFor3D);if(E!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))$a(f,v,x,S,C,Jt.disabled,Qt.disabled),$a(f,v,x,S,C,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const P=f.colorModeForRenderPass();$a(f,v,x,S,C,Jt.disabled,P)}}})(t,a,u,d);break;case"hillshade":(function(f,v,x,S){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const E=f.context,C=f.depthModeForSublayer(0,Tt.ReadOnly),P=f.colorModeForRenderPass(),[R,$]=f.renderPass==="translucent"?f.stencilConfigForOverlap(S):[{},S];for(const U of $){const q=v.getTile(U);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&f.renderPass==="offscreen"?iu(f,q,x,C,Jt.disabled,P):f.renderPass==="translucent"&&dp(f,U,q,x,C,R[U.overscaledZ],P)}E.viewport.set([0,0,f.width,f.height])})(t,a,u,d);break;case"raster":(function(f,v,x,S){if(f.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!S.length)return;const E=f.context,C=E.gl,P=v.getSource(),R=f.useProgram("raster"),$=f.colorModeForRenderPass(),[U,q]=P instanceof Ni?[{},S]:f.stencilConfigForOverlap(S),V=q[q.length-1].overscaledZ,re=!f.options.moving;for(const he of q){const K=f.depthModeForSublayer(he.overscaledZ-V,x.paint.get("raster-opacity")===1?Tt.ReadWrite:Tt.ReadOnly,C.LESS),ne=v.getTile(he);ne.registerFadeDuration(x.paint.get("raster-fade-duration"));const pe=v.findLoadedParent(he,0),fe=pp(ne,pe,v,x,f.transform,f.style.map.terrain);let we,ke;const Te=x.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),ne.texture.bind(Te,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(C.TEXTURE1),pe?(pe.texture.bind(Te,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),we=Math.pow(2,pe.tileID.overscaledZ-ne.tileID.overscaledZ),ke=[ne.tileID.canonical.x*we%1,ne.tileID.canonical.y*we%1]):ne.texture.bind(Te,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const Pe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(he),Ke=Pe?he:null,xt=Ke?Ke.posMatrix:f.transform.calculatePosMatrix(he.toUnwrapped(),re),Be=Oc(xt,ke||[0,0],we||1,fe,x);P instanceof Ni?R.draw(E,C.TRIANGLES,K,Jt.disabled,$,Xt.disabled,Be,Pe,x.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments):R.draw(E,C.TRIANGLES,K,U[he.overscaledZ],$,Xt.disabled,Be,Pe,x.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,a,u,d);break;case"background":(function(f,v,x,S){const E=x.paint.get("background-color"),C=x.paint.get("background-opacity");if(C===0)return;const P=f.context,R=P.gl,$=f.transform,U=$.tileSize,q=x.paint.get("background-pattern");if(f.isPatternMissing(q))return;const V=!q&&E.a===1&&C===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==V)return;const re=Jt.disabled,he=f.depthModeForSublayer(0,V==="opaque"?Tt.ReadWrite:Tt.ReadOnly),K=f.colorModeForRenderPass(),ne=f.useProgram(q?"backgroundPattern":"background"),pe=S||$.coveringTiles({tileSize:U,terrain:f.style.map.terrain});q&&(P.activeTexture.set(R.TEXTURE0),f.imageManager.bind(f.context));const fe=x.getCrossfadeParameters();for(const we of pe){const ke=S?we.posMatrix:f.transform.calculatePosMatrix(we.toUnwrapped()),Te=q?Zi(ke,C,f,q,{tileID:we,tileSize:U},fe):Co(ke,C,E),Pe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(we);ne.draw(P,R.TRIANGLES,he,re,K,Xt.disabled,Te,Pe,x.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,u,d);break;case"custom":(function(f,v,x){const S=f.context,E=x.implementation;if(f.renderPass==="offscreen"){const C=E.prerender;C&&(f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),C.call(E,S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),S.setStencilMode(Jt.disabled);const C=E.renderingMode==="3d"?new Tt(f.context.gl.LEQUAL,Tt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Tt.ReadOnly);S.setDepthMode(C),E.render(S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState(),S.bindFramebuffer.set(null)}})(t,0,u)}}translatePosMatrix(t,a,u,d,f){if(!u[0]&&!u[1])return t;const v=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(v){const E=Math.sin(v),C=Math.cos(v);u=[u[0]*C-u[1]*E,u[0]*E+u[1]*C]}const x=[f?u[0]:ee(a,u[0],this.transform.zoom),f?u[1]:ee(a,u[1],this.transform.zoom),0],S=new Float32Array(16);return l.$(S,t,x),S}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!a||!u}useProgram(t,a){this.cache=this.cache||{};const u=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new To(this.context,Yt[t],a,Po[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ue(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class di{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,u){const d=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const S=1/(x=l.ag([],x,t))[3]/a*d;return l.b3(x,x,[S,S,1/x[3],S])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const S=function(R,$){var U=$[0],q=$[1],V=$[2],re=U*U+q*q+V*V;return re>0&&(re=1/Math.sqrt(re)),R[0]=$[0]*re,R[1]=$[1]*re,R[2]=$[2]*re,R}([],function(R,$,U){var q=$[0],V=$[1],re=$[2],he=U[0],K=U[1],ne=U[2];return R[0]=V*ne-re*K,R[1]=re*he-q*ne,R[2]=q*K-V*he,R}([],We([],f[x[0]],f[x[1]]),We([],f[x[2]],f[x[1]]))),E=-((C=S)[0]*(P=f[x[1]])[0]+C[1]*P[1]+C[2]*P[2]);var C,P;return S.concat(E)});return new di(f,v)}}class ia{constructor(t,a){this.min=t,this.max=a,this.center=function(u,d,f){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,f){return u[0]=d[0]+f[0],u[1]=d[1]+f[1],u[2]=d[2]+f[2],u}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],u=Ee(this.min),d=Ee(this.max);for(let f=0;f<a.length;f++)u[f]=a[f]?this.min[f]:this.center[f],d[f]=a[f]?this.center[f]:this.max[f];return d[2]=this.max[2],new ia(u,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<t.planes.length;d++){const f=t.planes[d];let v=0;for(let x=0;x<a.length;x++)l.b4(f,a[x])>=0&&v++;if(v===0)return 0;v!==a.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let f=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const S=t.points[x][d]-this.min[d];f=Math.min(f,S),v=Math.max(v,S)}if(v<0||f>this.max[d]-this.min[d])return 0}return 1}}class qa{constructor(t=0,a=0,u=0,d=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=d}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=l.B.number(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.B.number(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=l.B.number(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=l.B.number(t.right,a.right,u)),this}getCenter(t,a){const u=l.ad((this.left+t-this.right)/2,0,t),d=l.ad((this.top+a-this.bottom)/2,0,a);return new l.P(u,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Zo{constructor(t,a,u,d,f){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Zo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-l.b5(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var u=new l.A(4);return l.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,f){var v=d[0],x=d[1],S=d[2],E=d[3],C=Math.sin(f),P=Math.cos(f);u[0]=v*P+S*C,u[1]=x*P+E*C,u[2]=v*-C+S*P,u[3]=x*-C+E*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=l.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new l.b6(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new l.P(0,0)),d=this.pointCoordinate(new l.P(this.width,0)),f=this.pointCoordinate(new l.P(this.width,this.height)),v=this.pointCoordinate(new l.P(0,this.height)),x=Math.floor(Math.min(u.x,d.x,f.x,v.x)),S=Math.floor(Math.max(u.x,d.x,f.x,v.x)),E=1;for(let C=x-E;C<=S+E;C++)C!==0&&a.push(new l.b6(C,t))}return a}coveringTiles(t){var a,u;let d=this.coveringZoomLevel(t);const f=d;if(t.minzoom!==void 0&&d<t.minzoom)return[];t.maxzoom!==void 0&&d>t.maxzoom&&(d=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),x=l.U.fromLngLat(this.center),S=Math.pow(2,d),E=[S*v.x,S*v.y,0],C=[S*x.x,S*x.y,0],P=di.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let R=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(R=d);const $=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,U=K=>({aabb:new ia([K*S,0,0],[(K+1)*S,S,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),q=[],V=[],re=d,he=t.reparseOverscaled?f:d;if(this._renderWorldCopies)for(let K=1;K<=3;K++)q.push(U(-K)),q.push(U(K));for(q.push(U(0));q.length>0;){const K=q.pop(),ne=K.x,pe=K.y;let fe=K.fullyVisible;if(!fe){const Ke=K.aabb.intersects(P);if(Ke===0)continue;fe=Ke===2}const we=t.terrain?E:C,ke=K.aabb.distanceX(we),Te=K.aabb.distanceY(we),Pe=Math.max(Math.abs(ke),Math.abs(Te));if(K.zoom===re||Pe>$+(1<<re-K.zoom)-2&&K.zoom>=R){const Ke=re-K.zoom,xt=E[0]-.5-(ne<<Ke),Be=E[1]-.5-(pe<<Ke);V.push({tileID:new l.O(K.zoom===re?he:K.zoom,K.wrap,K.zoom,ne,pe),distanceSq:Je([C[0]-.5-ne,C[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(xt*xt+Be*Be)})}else for(let Ke=0;Ke<4;Ke++){const xt=(ne<<1)+Ke%2,Be=(pe<<1)+(Ke>>1),ot=K.zoom+1;let Qe=K.aabb.quadrant(Ke);if(t.terrain){const Ft=new l.O(ot,K.wrap,ot,xt,Be),vt=t.terrain.getMinMaxElevation(Ft),ft=(a=vt.minElevation)!==null&&a!==void 0?a:this.elevation,wt=(u=vt.maxElevation)!==null&&u!==void 0?u:this.elevation;Qe=new ia([Qe.min[0],Qe.min[1],ft],[Qe.max[0],Qe.max[1],wt])}q.push({aabb:Qe,zoom:ot,x:xt,y:Be,wrap:K.wrap,fullyVisible:fe})}}return V.sort((K,ne)=>K.distanceSq-ne.distanceSq).map(K=>K.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=l.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(t.lng)*this.worldSize,l.H(a)*this.worldSize)}unproject(t){return new l.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),u=t.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-u))return;const d=this.getCameraPosition(),f=l.U.fromLngLat(d.lngLat,d.altitude),v=l.U.fromLngLat(a,u),x=f.x-v.x,S=f.y-v.y,E=f.z-v.z,C=Math.sqrt(x*x+S*S+E*E),P=this.scaleZoom(this.cameraToCenterDistance/C/this.tileSize);this._elevation=u,this._center=a,this.zoom=P}setLocationAtPoint(t,a){const u=this.pointCoordinate(a),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),v=new l.U(f.x-(u.x-d.x),f.y-(u.y-d.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return l.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const R=a.pointCoordinate(t);if(R!=null)return R}const u=[t.x,t.y,0,1],d=[t.x,t.y,1,1];l.ag(u,u,this.pixelMatrixInverse),l.ag(d,d,this.pixelMatrixInverse);const f=u[3],v=d[3],x=u[1]/f,S=d[1]/v,E=u[2]/f,C=d[2]/v,P=E===C?0:(0-E)/(C-E);return new l.U(l.B.number(u[0]/f,d[0]/v,P)/this.worldSize,l.B.number(x,S,P)/this.worldSize)}coordinatePoint(t,a=0,u=this.pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.ag(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Dt().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Dt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const u=t.key,d=a?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const f=t.canonical,v=this.worldSize/this.zoomScale(f.z),x=f.x+Math.pow(2,f.z)*t.wrap,S=l.ao(new Float64Array(16));return l.$(S,S,[x*v,f.y*v,0]),l.a0(S,S,[v/l.N,v/l.N,1]),l.a1(S,a?this.alignedProjMatrix:this.projMatrix,S),d[u]=new Float32Array(S),d[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,u,d,f=-90,v=90,x=-180,S=180;const E=this.size,C=this._unmodified;if(this.latRange){const $=this.latRange;f=l.H($[1])*this.worldSize,v=l.H($[0])*this.worldSize,t=v-f<E.y?E.y/(v-f):0}if(this.lngRange){const $=this.lngRange;x=l.b5(l.G($[0])*this.worldSize,0,this.worldSize),S=l.b5(l.G($[1])*this.worldSize,0,this.worldSize),S<x&&(S+=this.worldSize),a=S-x<E.x?E.x/(S-x):0}const P=this.point,R=Math.max(a||0,t||0);if(R)return this.center=this.unproject(new l.P(a?(S+x)/2:P.x,t?(v+f)/2:P.y)),this.zoom+=this.scaleZoom(R),this._unmodified=C,void(this._constraining=!1);if(this.latRange){const $=P.y,U=E.y/2;$-U<f&&(d=f+U),$+U>v&&(d=v-U)}if(this.lngRange){const $=(x+S)/2,U=l.b5(P.x,$-this.worldSize/2,$+this.worldSize/2),q=E.x/2;U-q<x&&(u=x+q),U+q>S&&(u=S-q)}u===void 0&&d===void 0||(this.center=this.unproject(new l.P(u!==void 0?u:P.x,d!==void 0?d:P.y)).wrap()),this._unmodified=C,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let d=l.ao(new Float64Array(16));l.a0(d,d,[this.width/2,-this.height/2,1]),l.$(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=l.ao(new Float64Array(16)),l.a0(d,d,[1,-1,1]),l.$(d,d,[-1,-1,0]),l.a0(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this._minEleveationForCurrentTile),x=f-v*this._pixelPerMeter/Math.cos(this._pitch),S=v<0?x:f,E=Math.PI/2+this._pitch,C=this._fov*(.5+t.y/this.height),P=Math.sin(C)*S/Math.sin(l.ad(Math.PI-E-C,.01,Math.PI-.01)),R=this.getHorizon(),$=2*Math.atan(R/this.cameraToCenterDistance)*(.5+t.y/(2*R)),U=Math.sin($)*S/Math.sin(l.ad(Math.PI-E-$,.01,Math.PI-.01)),q=Math.min(P,U),V=1.01*(Math.cos(Math.PI/2-this._pitch)*q+S),re=this.height/50;d=new Float64Array(16),l.b8(d,this._fov,this.width/this.height,re,V),d[8]=2*-t.x/this.width,d[9]=2*t.y/this.height,l.a0(d,d,[1,-1,1]),l.$(d,d,[0,0,-this.cameraToCenterDistance]),l.b9(d,d,this._pitch),l.ae(d,d,this.angle),l.$(d,d,[-a,-u,0]),this.mercatorMatrix=l.a0([],d,[this.worldSize,this.worldSize,this.worldSize]),l.a0(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,d),l.$(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=l.as([],d),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,d);const he=this.width%2/2,K=this.height%2/2,ne=Math.cos(this.angle),pe=Math.sin(this.angle),fe=a-Math.round(a)+ne*he+pe*K,we=u-Math.round(u)+ne*K+pe*he,ke=new Float64Array(d);if(l.$(ke,ke,[fe>.5?fe-1:fe,we>.5?we-1:we,0]),this.alignedProjMatrix=ke,d=l.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.ag(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let u=a.x,d=a.y,f=a.x,v=a.y;for(const x of t)u=Math.min(u,x.x),d=Math.min(d,x.y),f=Math.max(f,x.x),v=Math.max(v,x.y);return[new l.P(u,d),new l.P(f,d),new l.P(f,v),new l.P(u,v),new l.P(u,d)]}}}function Es(p,t){let a,u=!1,d=null,f=null;const v=()=>{d=null,u&&(p.apply(f,a),d=setTimeout(v,t),u=!1)};return(...x)=>(u=!0,f=this,a=x,d||v(),d)}class Ga{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=Es(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),v=Math.round(a.lng*f)/f,x=Math.round(a.lat*f)/f,S=this._map.getBearing(),E=this._map.getPitch();let C="";if(C+=t?`/${v}/${x}/${u}`:`${u}/${x}/${v}`,(S||E)&&(C+="/"+Math.round(10*S)/10),E&&(C+=`/${Math.round(E)}`),this._hashName){const P=this._hashName;let R=!1;const $=window.location.hash.slice(1).split("&").map(U=>{const q=U.split("=")[0];return q===P?(R=!0,`${q}=${C}`):U}).filter(U=>U);return R||$.push(`${P}=${C}`),`#${$.join("&")}`}return`#${C}`}}const na={linearity:.3,easing:l.ba(0,0,.3,1)},Yc=l.e({deceleration:2500,maxSpeed:1400},na),Qc=l.e({deceleration:20,maxSpeed:1400},na),Jc=l.e({deceleration:1e3,maxSpeed:360},na),eh=l.e({deceleration:1e3,maxSpeed:90},na);class th{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=l.h.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)a.zoom+=f.zoomDelta||0,a.bearing+=f.bearingDelta||0,a.pitch+=f.pitchDelta||0,f.panDelta&&a.pan._add(f.panDelta),f.around&&(a.around=f.around),f.pinchAround&&(a.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const f=Ha(a.pan.mag(),u,l.e({},Yc,t||{}));d.offset=a.pan.mult(f.amount/a.pan.mag()),d.center=this._map.transform.center,yn(d,f)}if(a.zoom){const f=Ha(a.zoom,u,Qc);d.zoom=this._map.transform.zoom+f.amount,yn(d,f)}if(a.bearing){const f=Ha(a.bearing,u,Jc);d.bearing=this._map.transform.bearing+l.ad(f.amount,-179,179),yn(d,f)}if(a.pitch){const f=Ha(a.pitch,u,eh);d.pitch=this._map.transform.pitch+f.amount,yn(d,f)}if(d.zoom||d.bearing){const f=a.pinchAround===void 0?a.around:a.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function yn(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Ha(p,t,a){const{maxSpeed:u,linearity:d,deceleration:f}=a,v=l.ad(p*d/(t/1e3),-u,u),x=Math.abs(v)/(f*d);return{easing:a.easing,duration:1e3*x,amount:v*(x/2)}}class Ci extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,d={}){const f=O.mousePos(a.getCanvasContainer(),u),v=a.unproject(f);super(t,l.e({point:f,lngLat:v,originalEvent:u},d)),this._defaultPrevented=!1,this.target=a}}class Wa extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const d=t==="touchend"?u.changedTouches:u.touches,f=O.touchPos(a.getCanvasContainer(),d),v=f.map(S=>a.unproject(S)),x=f.reduce((S,E,C,P)=>S.add(E.div(P.length)),new l.P(0,0));super(t,{points:f,point:x,lngLats:v,lngLat:a.unproject(x),originalEvent:u}),this._defaultPrevented=!1}}class rh extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class ih{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new rh(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Ci(t.type,this._map,t))}mouseup(t){this._map.fire(new Ci(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Ci(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ci(t.type,this._map,t))}mouseover(t){this._map.fire(new Ci(t.type,this._map,t))}mouseout(t){this._map.fire(new Ci(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Wa(t.type,this._map,t))}touchmove(t){this._map.fire(new Wa(t.type,this._map,t))}touchend(t){this._map.fire(new Wa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Wa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ci(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ci("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ci(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class as{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class sh{constructor(t,a){this._map=t,this._tr=new as(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(O.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=O.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(d.x,u.x),v=Math.max(d.x,u.x),x=Math.min(d.y,u.y),S=Math.max(d.y,u.y);O.setTransform(this._box,`translate(${f}px,${x}px)`),this._box.style.width=v-f+"px",this._box.style.height=S-x+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const u=this._startPos,d=a;if(this.reset(),O.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(O.remove(this._box),this._box=null),O.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.k(t,{originalEvent:a}))}}function qi(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const a={};for(let u=0;u<p.length;u++)a[p[u].identifier]=t[u];return a}class Rn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const f=new l.P(0,0);for(const v of d)f._add(v);return f.div(d.length)}(a),this.touches=qi(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const d=qi(u,a);for(const f in this.touches){const v=d[f];(!v||v.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class qo{constructor(t){this.singleTap=new Rn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const d=this.singleTap.touchend(t,a,u);if(d){const f=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(d)<30;if(f&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Fn{constructor(t){this._tr=new as(t),this._zoomIn=new qo({numTouches:1,numTaps:2}),this._zoomOut=new qo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const d=this._zoomIn.touchend(t,a,u),f=this._zoomOut.touchend(t,a,u),v=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(d)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=a.length?a[0]:a;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&O.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fp={0:1,2:2};class su{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=O.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,u){const d=fp[u];return a.buttons===void 0||(a.buttons&d)!==d}(t,this._eventButton)}isValidEndEvent(t){return O.mouseButton(t)===this._eventButton}}class ah{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Go=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},sa=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const u=new su({checkCorrectEvent:d=>O.mouseButton(d)===0&&d.ctrlKey||O.mouseButton(d)===2});return new Bn({clickTolerance:t,move:(d,f)=>({bearingDelta:(f.x-d.x)*a}),moveStateManager:u,enable:p,assignEvents:Go})},On=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const u=new su({checkCorrectEvent:d=>O.mouseButton(d)===0&&d.ctrlKey||O.mouseButton(d)===2});return new Bn({clickTolerance:t,move:(d,f)=>({pitchDelta:(f.y-d.y)*a}),moveStateManager:u,enable:p,assignEvents:Go})};class $e{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._map._cooperativeGestures&&(this._minTouches===2&&u.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,u.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(u.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,u)}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const d=qi(u,a),f=new l.P(0,0),v=new l.P(0,0);let x=0;for(const E in d){const C=d[E],P=this._touches[E];P&&(f._add(C),v._add(C.sub(P)),x++,d[E]=C)}if(this._touches=d,x<this._minTouches||!v.mag())return;const S=v.div(x);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(x),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ho{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){if(!this._firstTwoTouches)return;t.preventDefault();const[d,f]=this._firstTwoTouches,v=os(u,a,d),x=os(u,a,f);if(!v||!x)return;const S=this._aroundCenter?null:v.add(x).div(2);return this._move([v,x],S,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,v=os(u,a,d),x=os(u,a,f);v&&x||(this._active&&O.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function os(p,t,a){for(let u=0;u<p.length;u++)if(p[u].identifier===a)return t[u]}function aa(p,t){return Math.log(p/t)/Math.LN2}class oh extends Ho{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(aa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:aa(this._distance,u),pinchAround:a}}}function Ve(p,t){return 180*p.angleWith(t)/Math.PI}class au extends Ho{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ve(this._vector,u),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=Ve(t,this._startVector);return Math.abs(u)<a}}function ou(p){return Math.abs(p.y)>Math.abs(p.x)}class mp extends Ho{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,u){super.touchstart(t,a,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,ou(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,f,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,f=a.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return ou(t)&&ou(a)&&v}}const lu={panStep:100,bearingStep:15,pitchStep:10};class lh{constructor(t){this._tr=new as(t);const a=lu;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,d=0,f=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:x=>{const S=this._tr;x.easeTo({duration:300,easeId:"keyboardHandler",easing:uh,zoom:a?Math.round(S.zoom)+a*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+u*this._bearingStep,pitch:S.pitch+d*this._pitchStep,offset:[-f*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uh(p){return p*(2-p)}const ch=4.000244140625;class gp{constructor(t,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new as(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=l.h.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%ch==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=O.mousePos(this._el,t),u=this._tr;this._around=l.L.convert(this._aroundCenter?u.center:u.unproject(a)),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>ch?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&S!==0&&(S=1/S);const E=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(E*S))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,d=this._easing;let f,v=!1;if(this._type==="wheel"&&u&&d){const x=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),S=d(x);f=l.B.number(u,a,S),x<1?this._frameId||(this._frameId=!0):v=!0}else f=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.bb;if(this._prevEase){const u=this._prevEase,d=(l.h.now()-u.start)/u.duration,f=u.easing(d+.01)-u.easing(d),v=.27/Math.sqrt(f*f+1e-4)*.01,x=Math.sqrt(.0729-v*v);a=l.ba(v,x,.25,1)}return this._prevEase={start:l.h.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class uu{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cu{constructor(t){this._tr=new as(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hu{constructor(){this._tap=new qo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,u){if(!this._swipePoint)if(this._tapTime){const d=a[0],f=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(d)<30;f&&v?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,a,u)}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=a[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(t,a,u);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class du{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pi{constructor(t,a,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ls{constructor(t,a,u,d){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xa=p=>p.zoom||p.drag||p.pitch||p.rotate;class pu extends l.k{}function Ka(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class fu{constructor(t,a){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,f)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=d.type==="renderFrame"?void 0:d,x={needsRenderFrame:!1},S={},E={},C=d.touches,P=C?this._getMapTouches(C):void 0,R=P?O.touchPos(this._el,P):O.mousePos(this._el,d);for(const{handlerName:q,handler:V,allowed:re}of this._handlers){if(!V.isEnabled())continue;let he;this._blockedByActive(E,re,q)?V.reset():V[f||d.type]&&(he=V[f||d.type](d,R,P),this.mergeHandlerResult(x,S,he,q,v),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||V.isActive())&&(E[q]=V)}const $={};for(const q in this._previousActiveHandlers)E[q]||($[q]=v);this._previousActiveHandlers=E,(Object.keys($).length||Ka(x))&&(this._changes.push([x,S,$]),this._triggerRenderFrame()),(Object.keys(E).length||Ka(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new th(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,f,v]of this._listeners)O.addEventListener(d,f,d===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,a,u]of this._listeners)O.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new ih(a,t));const d=a.boxZoom=new sh(a,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const f=new Fn(a),v=new cu(a);a.doubleClickZoom=new uu(v,f),this._add("tapZoom",f),this._add("clickZoom",v),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const x=new hu;this._add("tapDragZoom",x);const S=a.touchPitch=new mp(a);this._add("touchPitch",S),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const E=sa(t),C=On(t);a.dragRotate=new pi(t,E,C),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const P=(({enable:re,clickTolerance:he})=>{const K=new su({checkCorrectEvent:ne=>O.mouseButton(ne)===0&&!ne.ctrlKey});return new Bn({clickTolerance:he,move:(ne,pe)=>({around:pe,panDelta:pe.sub(ne)}),activateOnStart:!0,moveStateManager:K,enable:re,assignEvents:Go})})(t),R=new $e(t,a);a.dragPan=new du(u,P,R),this._add("mousePan",P),this._add("touchPan",R,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const $=new au,U=new oh;a.touchZoomRotate=new ls(u,U,$,x),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const q=a.scrollZoom=new gp(a,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const V=a.keyboard=new lh(a);this._add("keyboard",V),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new nh(a))}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xa(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,u){for(const d in t)if(d!==u&&(!a||a.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(t,a,u,d,f){if(!u)return;l.e(t,u);const v={handlerName:d,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(a.zoom=v),u.panDelta!==void 0&&(a.drag=v),u.pitchDelta!==void 0&&(a.pitch=v),u.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},u={};for(const[d,f,v]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),l.e(a,f),l.e(u,v);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const d=this._map,f=d._getTransformForUpdate(),v=d.terrain;if(!(Ka(t)||v&&this._terrainMovement))return this._fireEvents(a,u,!0);let{panDelta:x,zoomDelta:S,bearingDelta:E,pitchDelta:C,around:P,pinchAround:R}=t;R!==void 0&&(P=R),d._stop(!0),P=P||d.transform.centerPoint;const $=f.pointLocation(x?P.sub(x):P);E&&(f.bearing+=E),C&&(f.pitch+=C),S&&(f.zoom+=S),v?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(x)):f.setLocationAtPoint($,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint($,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(d.terrain)})):f.setLocationAtPoint($,P),d._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_fireEvents(t,a,u){const d=Xa(this._eventsInProgress),f=Xa(t),v={};for(const C in t){const{originalEvent:P}=t[C];this._eventsInProgress[C]||(v[`${C}start`]=P),this._eventsInProgress[C]=t[C]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const C in v)this._fireEvent(C,v[C]);f&&this._fireEvent("move",f.originalEvent);for(const C in t){const{originalEvent:P}=t[C];this._fireEvent(C,P)}const x={};let S;for(const C in this._eventsInProgress){const{handlerName:P,originalEvent:R}=this._eventsInProgress[C];this._handlersById[P].isActive()||(delete this._eventsInProgress[C],S=a[P]||R,x[`${C}end`]=S)}for(const C in x)this._fireEvent(C,x[C]);const E=Xa(this._eventsInProgress);if(u&&(d||f)&&!E){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;!C||!C.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:S})),P(this._map.getBearing())&&this._map.resetNorth()):(P(C.bearing||this._map.getBearing())&&(C.bearing=0),C.freezeElevation=!0,this._map.easeTo(C,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.k(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new pu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class hh extends l.E{constructor(t,a){super(),this._renderFrameCallback=()=>{const u=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,u){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),u)}panTo(t,a,u){return this.easeTo(l.e({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(l.e({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(l.e({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=Dt.convert(t);const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,a)}_cameraForBoxAndBearing(t,a,u,d){const f={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const pe=d.padding;d.padding={top:pe,bottom:pe,right:pe,left:pe}}d.padding=l.e(f,d.padding);const v=this.transform,x=v.padding,S=v.project(l.L.convert(t)),E=v.project(l.L.convert(a)),C=S.rotate(-u*Math.PI/180),P=E.rotate(-u*Math.PI/180),R=new l.P(Math.max(C.x,P.x),Math.max(C.y,P.y)),$=new l.P(Math.min(C.x,P.x),Math.min(C.y,P.y)),U=R.sub($),q=(v.width-(x.left+x.right+d.padding.left+d.padding.right))/U.x,V=(v.height-(x.top+x.bottom+d.padding.top+d.padding.bottom))/U.y;if(V<0||q<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(v.scaleZoom(v.scale*Math.min(q,V)),d.maxZoom),he=l.P.convert(d.offset),K=new l.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(u*Math.PI/180),ne=he.add(K).mult(v.scale/v.zoomScale(re));return{center:v.unproject(S.add(E).div(2).sub(ne)),zoom:re,bearing:u}}fitBounds(t,a,u){return this._fitInternal(this.cameraForBounds(t,a),a,u)}fitScreenCoordinates(t,a,u,d,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(a)),u,d),d,f)}_fitInternal(t,a,u){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(t,a){this.stop();const u=this._getTransformForUpdate();let d=!1,f=!1,v=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(d=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=l.L.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(f=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(v=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this._applyUpdatedTransform(u),this.fire(new l.k("movestart",a)).fire(new l.k("move",a)),d&&this.fire(new l.k("zoomstart",a)).fire(new l.k("zoom",a)).fire(new l.k("zoomend",a)),f&&this.fire(new l.k("rotatestart",a)).fire(new l.k("rotate",a)).fire(new l.k("rotateend",a)),v&&this.fire(new l.k("pitchstart",a)).fire(new l.k("pitch",a)).fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}calculateCameraOptionsFromTo(t,a,u,d=0){const f=l.U.fromLngLat(t,a),v=l.U.fromLngLat(u,d),x=v.x-f.x,S=v.y-f.y,E=v.z-f.z,C=Math.hypot(x,S,E);if(C===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(x,S),R=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),$=180*Math.atan2(x,-S)/Math.PI;let U=180*Math.acos(P/C)/Math.PI;return U=E<0?90-U:90+U,{center:v.toLngLat(),zoom:R,pitch:U,bearing:$}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.bb},t)).animate===!1||!t.essential&&l.h.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),d=this.getZoom(),f=this.getBearing(),v=this.getPitch(),x=this.getPadding(),S="zoom"in t?+t.zoom:d,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,C="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:u.padding,R=l.P.convert(t.offset);let $=u.centerPoint.add(R);const U=u.pointLocation($),q=l.L.convert(t.center||U);this._normalizeCenter(q);const V=u.project(U),re=u.project(q).sub(V),he=u.zoomScale(S-d);let K,ne;t.around&&(K=l.L.convert(t.around),ne=u.locationPoint(K));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==d,this._rotating=this._rotating||f!==E,this._pitching=this._pitching||C!==v,this._padding=!u.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,pe),this.terrain&&this._prepareElevation(q),this._ease(fe=>{if(this._zooming&&(u.zoom=l.B.number(d,S,fe)),this._rotating&&(u.bearing=l.B.number(f,E,fe)),this._pitching&&(u.pitch=l.B.number(v,C,fe)),this._padding&&(u.interpolatePadding(x,P,fe),$=u.centerPoint.add(R)),this.terrain&&!t.freezeElevation&&this._updateElevation(fe),K)u.setLocationAtPoint(K,ne);else{const we=u.zoomScale(u.zoom-d),ke=S>d?Math.min(2,he):Math.max(.5,he),Te=Math.pow(ke,1-fe),Pe=u.unproject(V.add(re.mult(fe*Te)).mult(we));u.setLocationAtPoint(u.renderWorldCopies?Pe.wrap():Pe,$)}this._applyUpdatedTransform(u),this._fireMoveEvents(a)},fe=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,fe)},t),this}_prepareEase(t,a,u={}){this._moving=!0,a||u.moving||this.fire(new l.k("movestart",t)),this._zooming&&!u.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(a-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:u,zoom:d,pitch:f,bearing:v,elevation:x}=this.transformCameraUpdate(a);u&&(a.center=u),d!==void 0&&(a.zoom=d),f!==void 0&&(a.pitch=f),v!==void 0&&(a.bearing=v),x!==void 0&&(a.elevation=x),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new l.k("zoomend",t)),d&&this.fire(new l.k("rotateend",t)),f&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,a){if(!t.essential&&l.h.prefersReducedMotion){const Qe=l.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},t);const u=this._getTransformForUpdate(),d=this.getZoom(),f=this.getBearing(),v=this.getPitch(),x=this.getPadding(),S="zoom"in t?l.ad(+t.zoom,u.minZoom,u.maxZoom):d,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,C="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:u.padding,R=u.zoomScale(S-d),$=l.P.convert(t.offset);let U=u.centerPoint.add($);const q=u.pointLocation(U),V=l.L.convert(t.center||q);this._normalizeCenter(V);const re=u.project(q),he=u.project(V).sub(re);let K=t.curve;const ne=Math.max(u.width,u.height),pe=ne/R,fe=he.mag();if("minZoom"in t){const Qe=l.ad(Math.min(t.minZoom,d,S),u.minZoom,u.maxZoom),Ft=ne/u.zoomScale(Qe-d);K=Math.sqrt(Ft/fe*2)}const we=K*K;function ke(Qe){const Ft=(pe*pe-ne*ne+(Qe?-1:1)*we*we*fe*fe)/(2*(Qe?pe:ne)*we*fe);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function Te(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Pe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Ke=ke(!1);let xt=function(Qe){return Pe(Ke)/Pe(Ke+K*Qe)},Be=function(Qe){return ne*((Pe(Ke)*(Te(Ft=Ke+K*Qe)/Pe(Ft))-Te(Ke))/we)/fe;var Ft},ot=(ke(!0)-Ke)/K;if(Math.abs(fe)<1e-6||!isFinite(ot)){if(Math.abs(ne-pe)<1e-6)return this.easeTo(t,a);const Qe=pe<ne?-1:1;ot=Math.abs(Math.log(pe/ne))/K,Be=function(){return 0},xt=function(Ft){return Math.exp(Qe*K*Ft)}}return t.duration="duration"in t?+t.duration:1e3*ot/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==E,this._pitching=C!==v,this._padding=!u.isPaddingEqual(P),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(V),this._ease(Qe=>{const Ft=Qe*ot,vt=1/xt(Ft);u.zoom=Qe===1?S:d+u.scaleZoom(vt),this._rotating&&(u.bearing=l.B.number(f,E,Qe)),this._pitching&&(u.pitch=l.B.number(v,C,Qe)),this._padding&&(u.interpolatePadding(x,P,Qe),U=u.centerPoint.add($)),this.terrain&&!t.freezeElevation&&this._updateElevation(Qe);const ft=Qe===1?V:u.unproject(re.add(he.mult(Be(Ft))).mult(vt));u.setLocationAtPoint(u.renderWorldCopies?ft.wrap():ft,U),this._applyUpdatedTransform(u),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,a)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=l.h.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.b5(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const u=t.lng-a.center.lng;t.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Pi{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=O.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=O.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const u=this._map._getUIString(`AttributionControl.${a}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style.sourceCaches;for(const d in a){const f=a[d];if(f.used||f.usedForTerrain){const v=f.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(d=>String(d).trim()),t.sort((d,f)=>d.length-f.length),t=t.filter((d,f)=>{for(let v=f+1;v<t.length;v++)if(t[v].indexOf(d)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gt{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=O.create("div","maplibregl-ctrl");const a=O.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){O.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Wo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const d of u)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const mu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var dh=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ph extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const u={};for(const d of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),l.aS(d.posMatrix,0,l.N,0,l.N,0,1),this._tiles[d.key]=new es(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(t){for(const a in this._tiles){const u=this._tiles[a];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),l.aS(f.posMatrix,0,l.N,0,l.N,0,1),a[u]=f}else if(d.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=d.canonical.z-t.canonical.z,x=d.canonical.x-(d.canonical.x>>v<<v),S=d.canonical.y-(d.canonical.y>>v<<v),E=l.N>>v;l.aS(f.posMatrix,0,E,0,E,0,1),l.$(f.posMatrix,f.posMatrix,[-x*E,-S*E,0]),a[u]=f}else if(t.canonical.isChildOf(d.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=t.canonical.z-d.canonical.z,x=t.canonical.x-(t.canonical.x>>v<<v),S=t.canonical.y-(t.canonical.y>>v<<v),E=l.N>>v;l.aS(f.posMatrix,0,l.N,0,l.N,0,1),l.$(f.posMatrix,f.posMatrix,[x*E,S*E,0]),l.a0(f.posMatrix,f.posMatrix,[1/2**v,1/2**v,0]),a[u]=f}}return a}getSourceTile(t,a){const u=this.sourceCache._source;let d=t.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&a)for(;d>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(d--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class fh{constructor(t,a,u){this.painter=t,this.sourceCache=new ph(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,u,d=l.N){var f;if(!(a>=0&&a<d&&u>=0&&u<d))return 0;const v=this.getTerrainData(t),x=(f=v.tile)===null||f===void 0?void 0:f.dem;if(!x)return 0;const S=function(U,q,V){var re=q[0],he=q[1];return U[0]=V[0]*re+V[4]*he+V[12],U[1]=V[1]*re+V[5]*he+V[13],U}([],[a/d*l.N,u/d*l.N],v.u_terrain_matrix),E=[S[0]*x.dim,S[1]*x.dim],C=Math.floor(E[0]),P=Math.floor(E[1]),R=E[0]-C,$=E[1]-P;return x.get(C,P)*(1-R)*(1-$)+x.get(C+1,P)*R*(1-$)+x.get(C,P+1)*(1-R)*$+x.get(C+1,P+1)*R*$}getElevationForLngLatZoom(t,a){const{tileID:u,mercatorX:d,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(u,d%l.N,f%l.N,l.N)}getElevation(t,a,u,d=l.N){return this.getDEMElevation(t,a,u,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,f=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ue(d,f,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ue(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const d=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Ue(d,a.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),a.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?f=t.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>f<<f),x=t.canonical.y-(t.canonical.y>>f<<f),S=l.bc(new Float64Array(16),[1/(l.N<<f),1/(l.N<<f),0]);l.$(S,S,[v*l.N,x*l.N,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,u=a.width/devicePixelRatio,d=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ue(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ue(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,v=0;f<this._coordsTextureSize;f++)for(let x=0;x<this._coordsTextureSize;x++,v+=4)a[v+0]=255&x,a[v+1]=255&f,a[v+2]=x>>8<<4|f>>8,a[v+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),d=new Ue(t,u,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){const a=new Uint8Array(4),u=this.painter.context,d=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const f=a[0]+(a[2]>>4<<8),v=a[1]+((15&a[2])<<8),x=this.coordsIndex[255-a[3]],S=x&&this.sourceCache.getTileByID(x);if(!S)return null;const E=this._coordsTextureSize,C=(1<<S.tileID.canonical.z)*E;return new l.U(this._allowMercatorOverflow(t,(S.tileID.canonical.x*E+f)/C),(S.tileID.canonical.y*E+v)/C,this.getElevation(S.tileID,f,v,E))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new l.bd,u=new l.b0,d=this.meshSize,f=l.N/d,v=d*d;for(let P=0;P<=d;P++)for(let R=0;R<=d;R++)a.emplaceBack(R*f,P*f,0);for(let P=0;P<v;P+=d+1)for(let R=0;R<d;R++)u.emplaceBack(R+P,d+R+P+1,d+R+P+2),u.emplaceBack(R+P,d+R+P+2,R+P+1);const x=a.length,S=x+2*(d+1);for(const P of[0,1])for(let R=0;R<=d;R++)for(const $ of[0,1])a.emplaceBack(R*f,P*l.N,$);for(let P=0;P<2*d;P+=2)u.emplaceBack(S+P,S+P+1,S+P+3),u.emplaceBack(S+P,S+P+3,S+P+2),u.emplaceBack(x+P,x+P+3,x+P+1),u.emplaceBack(x+P,x+P+2,x+P+3);const E=a.length,C=E+2*(d+1);for(const P of[0,1])for(let R=0;R<=d;R++)for(const $ of[0,1])a.emplaceBack(P*l.N,R*f,$);for(let P=0;P<2*d;P+=2)u.emplaceBack(E+P,E+P+1,E+P+3),u.emplaceBack(E+P,E+P+3,E+P+2),u.emplaceBack(C+P,C+P+3,C+P+1),u.emplaceBack(C+P,C+P+2,C+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(a,dh.members),segments:l.S.simpleSegment(0,0,a.length,u.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,a){const u=l.U.fromLngLat(t.wrap()),d=(1<<a)*l.N,f=u.x*d,v=u.y*d,x=Math.floor(f/l.N),S=Math.floor(v/l.N);return{tileID:new l.O(a,0,a,x,S),mercatorX:f,mercatorY:v}}_allowMercatorOverflow(t,a){const u=t.x<this.painter.width/2;let d=l.bf(a);const f=this.painter.transform.center.lng;return u&&Math.sign(d)>0&&Math.sign(f)<0||!u&&Math.sign(d)<0&&Math.sign(f)>0?(d=360*Math.sign(f)+d,l.G(d)):a}}class yp{constructor(t,a,u){this._context=t,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:t,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ei={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Xo{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new yp(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(a)),this._coordsDescendingInv={};for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const d=t.sourceCaches[u].getVisibleCoordinates();for(const f of d){const v=this.terrain.sourceCache.getTerrainCoords(f);for(const x in v)this._coordsDescendingInv[u][x]||(this._coordsDescendingInv[u][x]=[]),this._coordsDescendingInv[u][x].push(v[x])}}this._coordsDescendingInvStr={};for(const u of t._order){const d=t._layers[u],f=d.source;if(ei[d.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const v in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][v]=this._coordsDescendingInv[f][v].map(x=>x.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[d][u.tileID.key];f&&f!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ei[a]&&(this._prevType&&ei[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!d))return!0;if(ei[this._prevType]||ei[a]&&d){this._prevType=a;const f=this._stacks.length-1,v=this._stacks[f]||[];for(const x of this._renderableTiles){if(this.pool.isFull()&&(nr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(x),x.rtt[f]){const E=this.pool.getObjectForId(x.rtt[f].id);if(E.stamp===x.rtt[f].stamp){this.pool.useObject(E);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),x.rtt[f]={id:S.id,stamp:S.stamp},u.context.bindFramebuffer.set(S.fbo.framebuffer),u.context.clear({color:l.aT.transparent,stencil:0}),u.currentStencilSource=void 0;for(let E=0;E<v.length;E++){const C=u.style._layers[v[E]],P=C.source?this._coordsDescendingInv[C.source][x.tileID.key]:[x.tileID];u.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),u._renderTileClippingMasks(C,P),u.renderLayer(u,u.style.sourceCaches[C.source],C,P),C.source&&(x.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][x.tileID.key])}}return nr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ei[a]}return!1}}const tt=G,at={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ya=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},gu={showCompass:!0,showZoom:!0,visualizePitch:!1};class yu{constructor(t,a,u=!1){this.mousedown=v=>{this.startMouse(l.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),O.mousePos(this.element,v)),O.addEventListener(window,"mousemove",this.mousemove),O.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,O.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=O.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),O.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=O.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=sa({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:x,bearingDegreesPerPixelMoved:S=.8})=>{const E=new ah;return new Bn({clickTolerance:x,move:(C,P)=>({bearingDelta:(P.x-C.x)*S}),moveStateManager:E,enable:v,assignEvents:Ya})})({clickTolerance:d,enable:!0}),this.map=t,u&&(this.mousePitch=On({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:x,pitchDegreesPerPixelMoved:S=-.5})=>{const E=new ah;return new Bn({clickTolerance:x,move:(C,P)=>({pitchDelta:(P.y-C.y)*S}),moveStateManager:E,enable:v,assignEvents:Ya})})({clickTolerance:f,enable:!0})),O.addEventListener(a,"mousedown",this.mousedown),O.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),O.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),O.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),O.disableDrag()}moveMouse(t,a){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(t,a)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,a)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(t,a){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(t,a)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,a)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const t=this.element;O.removeEventListener(t,"mousedown",this.mousedown),O.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend),O.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){O.enableDrag(),O.removeEventListener(window,"mousemove",this.mousemove),O.removeEventListener(window,"mouseup",this.mouseup),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend)}}let pr;function _u(p,t,a){if(p=new l.L(p.lng,p.lat),t){const u=new l.L(p.lng-360,p.lat),d=new l.L(p.lng+360,p.lat),f=a.locationPoint(p).distSqr(t);a.locationPoint(u).distSqr(t)<f?p=u:a.locationPoint(d).distSqr(t)<f&&(p=d)}for(;Math.abs(p.lng-a.center.lng)>180;){const u=a.locationPoint(p);if(u.x>=0&&u.y>=0&&u.x<=a.width&&u.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p}const Gi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mh(p,t,a){const u=p.classList;for(const d in Gi)u.remove(`maplibregl-${a}-anchor-${d}`);u.add(`maplibregl-${a}-anchor-${t}`)}class Is extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const u=a.code,d=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!u)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=_u(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),O.setTransform(this._element,`${Gi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${d}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const v=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=v.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=O.create("div"),this._element.setAttribute("aria-label","Map marker");const a=O.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const f=O.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const v=O.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const x=O.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(3.0, 29.0)"),x.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of S){const he=O.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",re.rx),he.setAttributeNS(null,"ry",re.ry),x.appendChild(he)}const E=O.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const C=O.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(C);const P=O.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const R=O.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(R);const $=O.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const U=O.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const q=O.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");const V=O.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#FFFFFF"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962"),U.appendChild(q),U.appendChild(V),v.appendChild(x),v.appendChild(E),v.appendChild(P),v.appendChild($),v.appendChild(U),a.appendChild(v),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),mh(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),O.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const sr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let er=0,oa=!1;const Qa={maxWidth:100,unit:"metric"};function Ja(p,t,a){const u=a&&a.maxWidth||100,d=p._container.clientHeight/2,f=p.unproject([0,d]),v=p.unproject([u,d]),x=f.distanceTo(v);if(a&&a.unit==="imperial"){const S=3.2808*x;S>5280?Cs(t,u,S/5280,p._getUIString("ScaleControl.Miles")):Cs(t,u,S,p._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Cs(t,u,x/1852,p._getUIString("ScaleControl.NauticalMiles")):x>=1e3?Cs(t,u,x/1e3,p._getUIString("ScaleControl.Kilometers")):Cs(t,u,x,p._getUIString("ScaleControl.Meters"))}function Cs(p,t,a,u){const d=function(f){const v=Math.pow(10,`${Math.floor(f)}`.length-1);let x=f/v;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(S){const E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E}(x),v*x}(a);p.style.width=t*(d/a)+"px",p.innerHTML=`${d}&nbsp;${u}`}const vu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function la(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,p),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-p),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(p,0),right:new l.P(-p,0)}}if(p instanceof l.P||Array.isArray(p)){const t=l.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(p.center||[0,0]),top:l.P.convert(p.top||[0,0]),"top-left":l.P.convert(p["top-left"]||[0,0]),"top-right":l.P.convert(p["top-right"]||[0,0]),bottom:l.P.convert(p.bottom||[0,0]),"bottom-left":l.P.convert(p["bottom-left"]||[0,0]),"bottom-right":l.P.convert(p["bottom-right"]||[0,0]),left:l.P.convert(p.left||[0,0]),right:l.P.convert(p.right||[0,0])}}return la(new l.P(0,0))}const wu={extend:(p,...t)=>l.e(p,...t),run(p){p()},logToElement(p,t=!1,a="log"){const u=window.document.getElementById(a);u&&(t&&(u.innerHTML=""),u.innerHTML+=`<br>${p}`)}},bu=G;class Mt{static get version(){return bu}static get workerCount(){return fn.workerCount}static set workerCount(t){fn.workerCount=t}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){l.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(t){l.c.WORKER_URL=t}static addProtocol(t,a){l.c.REGISTERED_PROTOCOLS[t]=a}static removeProtocol(t){delete l.c.REGISTERED_PROTOCOLS[t]}}return Mt.Map=class extends hh{constructor(p){if(l.bg.mark(l.bh.create),(p=l.e({},at,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Zo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Wo,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},mu,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=lt.addThrottleControl(()=>this.isMoving()),this._requestManager=new te(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const a=Es(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{t?a(u):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new fu(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new Ga(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,l.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Pi({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new Gt,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new l.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new l.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,a,u)}resize(p){var t;const a=this._containerDimensions(),u=a[0],d=a[1],f=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,f),this.painter.resize(u,d,f),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,S),this.painter.resize(u,d,S)}this.transform.resize(u,d),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,d);const v=!this._moving;return v&&(this.stop(),this.fire(new l.k("movestart",p)).fire(new l.k("move",p))),this.fire(new l.k("resize",p)),v&&this.fire(new l.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:a,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),f=p*d,v=t*d;return Math.min(f>a?a/f:1,v>u?u/v:1)*d}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Dt.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(p){return this.transform.locationPoint(l.L.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(l.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,a){if(p==="mouseenter"||p==="mouseover"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:f=>{const v=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];v.length?u||(u=!0,a.call(this,new Ci(p,this,f.originalEvent,{features:v}))):u=!1},mouseout:()=>{u=!1}}}}if(p==="mouseleave"||p==="mouseout"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,a.call(this,new Ci(p,this,v.originalEvent)))},mouseout:v=>{u&&(u=!1,a.call(this,new Ci(p,this,v.originalEvent)))}}}}{const u=d=>{const f=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];f.length&&(d.features=f,a.call(this,d),delete d.features)};return{layer:t,listener:a,delegates:{[p]:u}}}}on(p,t,a){if(a===void 0)return super.on(p,t);const u=this._createDelegatedListener(p,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(p,t,a){if(a===void 0)return super.once(p,t);const u=this._createDelegatedListener(p,t,a);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(p,t,a){return a===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(u=>{const d=this._delegatedListeners[p];for(let f=0;f<d.length;f++){const v=d[f];if(v.layer===t&&v.listener===a){for(const x in v.delegates)this.off(x,v.delegates[x]);return d.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let a;const u=p instanceof l.P||Array.isArray(p),d=u?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:p)||{},d instanceof l.P||typeof d[0]=="number")a=[l.P.convert(d)];else{const f=l.P.convert(d[0]),v=l.P.convert(d[1]);a=[f,new l.P(v.x,f.y),v,new l.P(f.x,v.y),f]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Br(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,a):this.style.loadJSON(p,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const a=this._requestManager.transformRequest(p,ie.Style);l.f(a,(u,d)=>{u?this.fire(new l.j(u)):d&&this._updateDiff(d,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===p.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fh(this.painter,t,p),this.painter.renderToTexture=new Xo(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==p.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const a=p[t]._tiles;for(const u in a){const d=a[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}addSourceType(p,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,a)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,a={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:f,stretchY:v,content:x}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:E,data:C}=t,P=t;return this.style.addImage(p,{data:new l.R({width:S,height:E},new Uint8Array(C)),pixelRatio:u,stretchX:f,stretchY:v,content:x,sdf:d,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p),this}}{const{width:S,height:E,data:C}=l.h.getImageData(t);this.style.addImage(p,{data:new l.R({width:S,height:E},C),pixelRatio:u,stretchX:f,stretchY:v,content:x,sdf:d,version:0})}}updateImage(p,t){const a=this.style.getImage(p);if(!a)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||l.a(t)?l.h.getImageData(t):t,{width:d,height:f,data:v}=u;if(d===void 0||f===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==a.data.width||f!==a.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(t instanceof HTMLImageElement||l.a(t));return a.data.replace(v,x),this.style.updateImage(p,a),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){lt.getImage(this._requestManager.transformRequest(p,ie.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,a){return this.style.setLayerZoomRange(p,t,a),this._update(!0)}setFilter(p,t,a={}){return this.style.setFilter(p,t,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,a,u={}){return this.style.setPaintProperty(p,t,a,u),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,a,u={}){return this.style.setLayoutProperty(p,t,a,u),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,a,u=>{u||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,a=>{a||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=O.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=O.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const d=this._controlContainer=O.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{f[v]=O.create("div",`maplibregl-ctrl-${v} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=O.create("div","maplibregl-cooperative-gesture-screen",this._container);let p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){O.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(p,t,a){this._canvas.width=Math.floor(a*p),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:p},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});const a=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!a){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new ks(a,this.transform),ve.testSupport(a)}_onCooperativeGesture(p,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,f=l.h.now();this.style.zoomHistory.update(d,f);const v=new l.a8(d,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),x=v.crossFadingFactor();x===1&&x===this._crossFadingFactor||(a=!0,this._crossFadingFactor=x),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),lt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),O.remove(this._canvasContainer),O.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(p=>{l.bg.frame(p),this._frame=null,this._render(p)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return tt}getCameraTargetElevation(){return this.transform.elevation}},Mt.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);t.title=u,t.setAttribute("aria-label",u)},this.options=l.e({},gu,p),this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),O.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),O.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=O.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){O.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const a=O.create("button",p,this._container);return a.type="button",a.addEventListener("click",t),a}},Mt.GeolocateControl=class extends l.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.L(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,d=this._map.getBearing(),f=l.e({bearing:d},this.options.fitBoundsOptions),v=Dt.fromLngLat(a,u);this._map.fitBounds(v,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&oa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=O.create("button","maplibregl-ctrl-geolocate",this._container),O.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Is({element:this._dotElement}),this._circleElement=O.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Is({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},sr,p)}onAdd(p){return this._map=p,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,a=!1){pr===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(u=>{pr=u.state!=="denied",t(pr)}).catch(()=>{pr=!!window.navigator.geolocation,t(pr)}):(pr=!!window.navigator.geolocation,t(pr)):t(pr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),O.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,er=0,oa=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),a=p.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),a=p.getNorthEast(),u=t.distanceTo(a),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":er--,oa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),er++,er>1?(p={maximumAge:6e5,timeout:0},oa=!0):(p=this.options.positionOptions,oa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Mt.AttributionControl=Pi,Mt.LogoControl=Gt,Mt.ScaleControl=class{constructor(p){this._onMove=()=>{Ja(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ja(this._map,this._container,this.options)},this.options=l.e({},Qa,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){O.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Mt.FullscreenControl=class extends l.E{constructor(p={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){O.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=O.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);O.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Mt.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=p}onAdd(p){return this._map=p,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=O.create("button","maplibregl-ctrl-terrain",this._container),O.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){O.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Mt.Popup=class extends l.E{constructor(p){super(),this.remove=()=>(this._content&&O.remove(this._content),this._container&&(O.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=O.create("div","maplibregl-popup",this._map.getContainer()),this._tip=O.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_u(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const a=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let u=this.options.anchor;const d=la(this.options.offset);if(!u){const v=this._container.offsetWidth,x=this._container.offsetHeight;let S;S=a.y+d.bottom.y<x?["top"]:a.y>this._map.transform.height-x?["bottom"]:[],a.x<v/2?S.push("left"):a.x>this._map.transform.width-v/2&&S.push("right"),u=S.length===0?"bottom":S.join("-")}const f=a.add(d[u]).round();O.setTransform(this._container,`${Gi[u]} translate(${f.x}px,${f.y}px)`),mh(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(vu),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=l.L.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=p;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=O.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=O.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(xu);p&&p.focus()}},Mt.Marker=Is,Mt.Style=Br,Mt.LngLat=l.L,Mt.LngLatBounds=Dt,Mt.Point=l.P,Mt.MercatorCoordinate=l.U,Mt.Evented=l.E,Mt.AJAXError=l.bi,Mt.config=l.c,Mt.CanvasSource=Qn,Mt.GeoJSONSource=Yn,Mt.ImageSource=Ni,Mt.RasterDEMTileSource=tn,Mt.RasterTileSource=ci,Mt.VectorTileSource=en,Mt.VideoSource=Fa,Mt.setRTLTextPlugin=l.bj,Mt.getRTLTextPluginStatus=l.bk,Mt.prewarm=function(){wo().acquire(Ct)},Mt.clearPrewarmedResources=function(){const p=An;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Ct),An=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},wu.extend(Mt,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Mt});var M=w;return M})})(P0);var Pm=P0.exports;const Rf="/bear-map-web-sapporo/icon/",mv="bear.svg",tS=i=>{var y;const s=i.properties.icon;if(typeof s!="string")return`${Rf}${mv}`;const h=(y=s.replace(/\\/g,"/").split("/").pop())==null?void 0:y.trim();return h?`${Rf}${h}`:`${Rf}${mv}`},rS=({map:i,feature:s,onSelect:h})=>{const y=yt.useRef(null);return yt.useEffect(()=>{if(!i)return;y.current&&(y.current.remove(),y.current=null);const w=document.createElement("img");w.src=tS(s),w.alt="",w.style.width="32px",w.style.height="32px",w.style.cursor="pointer";const T=()=>h(s),M=G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),h(s))};w.addEventListener("click",T),w.addEventListener("keydown",M),w.tabIndex=0,w.setAttribute("role","button"),w.setAttribute("aria-label","");const l=new Pm.Marker({element:w}).setLngLat(s.geometry.coordinates).addTo(i);return y.current=l,()=>{w.removeEventListener("click",T),w.removeEventListener("keydown",M),l.remove()}},[s,i,h]),null},iS="/bear-map-web-sapporo/icon/filter.svg",nS=({onClick:i})=>me.jsx("button",{type:"button",className:"filter-button",onClick:i,"aria-label":"",children:me.jsx("img",{src:iS,alt:""})}),sS=Array.from({length:9},(i,s)=>2017+s),aS=Array.from({length:12},(i,s)=>s+1),oS=[{label:"",filename:"bear.svg"},{label:"",filename:"like-bear.svg"},{label:"",filename:"excrement.svg"},{label:"",filename:"footprint.svg"},{label:"",filename:"camera.svg"},{label:"",filename:"voice.svg"},{label:"",filename:"other.svg"}],lS=({isOpen:i,defaultFilter:s,onApply:h,onClose:y,onReset:w})=>{const[T,M]=yt.useState(s.year??""),[l,G]=yt.useState(s.month??""),[O,ve]=yt.useState(s.icon??""),ge=yt.useRef(null),oe=yt.useRef(null);yt.useEffect(()=>{i&&(M(s.year??""),G(s.month??""),ve(s.icon??""))},[s,i]),yt.useEffect(()=>{var lt;if(!i)return;(lt=oe.current)==null||lt.focus();const Ce=ie=>{if(ie.key==="Escape"){ie.preventDefault(),y();return}if(ie.key==="Tab"&&ge.current){const te=ge.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(te.length===0)return;const ce=te[0],Ee=te[te.length-1];!ie.shiftKey&&document.activeElement===Ee?(ie.preventDefault(),ce.focus()):ie.shiftKey&&document.activeElement===ce&&(ie.preventDefault(),Ee.focus())}};return document.addEventListener("keydown",Ce),()=>{document.removeEventListener("keydown",Ce)}},[i,y]);const ze=Ce=>{Ce.preventDefault(),h({year:typeof T=="number"?T:void 0,month:typeof l=="number"?l:void 0,icon:O||void 0}),y()},Fe=()=>{M(""),G(""),ve(""),w()};return i?me.jsx("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:me.jsxs("div",{className:"modal-content",ref:ge,children:[me.jsxs("header",{className:"modal-header",children:[me.jsx("h2",{children:""}),me.jsx("button",{type:"button",className:"modal-close",onClick:y,"aria-label":"",children:""})]}),me.jsxs("form",{className:"modal-form",onSubmit:ze,children:[me.jsxs("label",{children:["",me.jsxs("select",{ref:oe,value:T,onChange:Ce=>M(Ce.target.value?Number(Ce.target.value):""),children:[me.jsx("option",{value:"",children:""}),sS.map(Ce=>me.jsx("option",{value:Ce,children:Ce},`year-${Ce}`))]})]}),me.jsxs("label",{children:["",me.jsxs("select",{value:l,onChange:Ce=>G(Ce.target.value?Number(Ce.target.value):""),children:[me.jsx("option",{value:"",children:""}),aS.map(Ce=>me.jsx("option",{value:Ce,children:Ce},`month-${Ce}`))]})]}),me.jsxs("label",{children:["",me.jsxs("select",{value:O,onChange:Ce=>{const lt=Ce.target.value;ve(lt===""?"":lt)},children:[me.jsx("option",{value:"",children:""}),oS.map(({label:Ce,filename:lt})=>me.jsx("option",{value:lt,children:Ce},`icon-${lt}`))]})]}),me.jsxs("div",{className:"modal-actions",children:[me.jsx("button",{type:"button",onClick:Fe,className:"secondary-button",children:""}),me.jsx("button",{type:"submit",className:"primary-button",children:""})]})]})]})}):null},uS=({feature:i,onClose:s})=>{const h=yt.useRef(null);if(yt.useEffect(()=>{var T;if(!i)return;(T=h.current)==null||T.focus();const w=M=>{M.key==="Escape"&&(M.preventDefault(),s())};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[i,s]),!i)return null;const y="/bear-map-web-sapporo/icon/"+String(i.properties.icon);return me.jsx("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:me.jsxs("div",{className:"modal-content details-modal",children:[me.jsxs("header",{className:"modal-header",children:[me.jsx("h2",{children:""}),me.jsx("button",{type:"button",className:"modal-close",onClick:s,"aria-label":"",ref:h,children:""})]}),me.jsx("img",{src:y,width:"64px",height:"64px"}),me.jsx("div",{className:"modal-body",children:me.jsx("table",{children:me.jsxs("tbody",{children:[me.jsxs("tr",{children:[me.jsx("th",{children:""}),me.jsx("td",{children:String(i.properties.datetime)})]}),me.jsxs("tr",{children:[me.jsx("th",{children:""}),me.jsx("td",{children:String(i.properties.location)})]}),me.jsxs("tr",{children:[me.jsx("th",{children:""}),me.jsx("td",{children:String(i.properties.status)})]})]})})})]})})},cS="/bear-map-web-sapporo/icon/menu.svg",hS=({isOpen:i,onToggle:s,onNavigateToAbout:h})=>{const y=()=>{h==null||h()};return me.jsxs("div",{className:"header-menu",children:[me.jsx("button",{type:"button",className:"header-menu-button","aria-label":"","aria-haspopup":"true","aria-expanded":i,onClick:s,children:me.jsx("img",{src:cS,alt:""})}),i&&me.jsx("div",{className:"header-menu-panel",role:"menu",children:me.jsx("ul",{className:"header-menu-list","aria-label":"",children:me.jsx("li",{children:me.jsx("button",{type:"button",className:"header-menu-link",onClick:y,children:""})})})})]})},dS=["bear.svg","like-bear.svg","excrement.svg","footprint.svg","camera.svg","voice.svg","other.svg"],pS=i=>{if(!(!i||typeof i!="string"))return dS.includes(i)?i:void 0},fS=i=>typeof i=="number"&&Number.isInteger(i)&&i>=2017&&i<=2025,mS=i=>typeof i=="number"&&Number.isInteger(i)&&i>=1&&i<=12,gS=i=>{if(!i)return;i.date;const s=i.icon,y=[i.year].filter(M=>typeof M=="number"||M instanceof Number).find(M=>fS(Number(M))),T=[i.month].filter(M=>typeof M=="number"||M instanceof Number).find(M=>mS(Number(M)));if(!(!y||!T))return{...i,year:y,month:T,icon:pS(s)}},yS=i=>{if(!i||typeof i!="object"||i.type!=="FeatureCollection")throw new Error("FeatureCollection  GeoJSON ");const s=Array.isArray(i.features)?i.features:[],h=[];for(const y of s){if(!y||typeof y!="object")continue;const w=y.geometry,T=y.properties;if(!w||w.type!=="Point"||!Array.isArray(w.coordinates))continue;const M=gS(T);if(!M)continue;const[l,G]=w.coordinates;typeof G!="number"||typeof l!="number"||h.push({type:"Feature",geometry:{type:"Point",coordinates:[l,G]},properties:M})}return{type:"FeatureCollection",features:h}},_S=(i,s)=>i.filter(h=>{const{year:y,month:w,icon:T}=h.properties;return!(s.year&&y!==s.year||s.month&&w!==s.month||s.icon&&T!==s.icon)}),vS="/bear-map-web-sapporo/data/bears.geojson",xS=()=>{const[i,s]=yt.useState([]),[h,y]=yt.useState({}),[w,T]=yt.useState(!0),[M,l]=yt.useState(null);yt.useEffect(()=>{let ge=!1;return T(!0),l(null),fetch(vS).then(async oe=>{if(!oe.ok)throw new Error(`HTTP ${oe.status}`);const ze=await oe.json(),Fe=yS(ze);ge||s(Fe.features)}).catch(oe=>{ge||(l(oe instanceof Error?oe.message:""),s([]))}).finally(()=>{ge||T(!1)}),()=>{ge=!0}},[]);const G=yt.useCallback(ge=>{y(oe=>{const ze={...oe,...ge};return Object.entries(ze).forEach(([Fe,Ce])=>{(Ce==null||Ce==="")&&delete ze[Fe]}),ze})},[]),O=yt.useCallback(()=>{y({})},[]),ve=yt.useMemo(()=>_S(i,h),[i,h]);return{features:i,filteredFeatures:ve,filter:h,setFilter:G,resetFilter:O,isLoading:w,error:M}},wS=[141.3545,43.0621],bS=({onNavigateAbout:i})=>{const s=yt.useRef(null),h=yt.useRef(null),[y,w]=yt.useState(!1),[T,M]=yt.useState(!1),[l,G]=yt.useState(null),{filteredFeatures:O,filter:ve,setFilter:ge,resetFilter:oe,isLoading:ze,error:Fe}=xS();yt.useEffect(()=>{if(h.current||!s.current)return;const Ue=new Pm.Map({container:s.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:' <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:wS,zoom:11});return Ue.addControl(new Pm.NavigationControl,"top-right"),h.current=Ue,()=>{Ue.remove(),h.current=null}},[]),yt.useEffect(()=>{var Ue;(Ue=h.current)==null||Ue.resize()},[O.length]);const Ce=yt.useCallback(()=>{w(!0)},[]),lt=yt.useCallback(()=>{w(!1)},[]),ie=yt.useCallback(Ue=>{G(Ue)},[]),te=yt.useCallback(()=>{G(null)},[]),ce=yt.useCallback(Ue=>{ge(Ue)},[ge]),Ee=yt.useCallback(()=>{oe()},[oe]),Ge=yt.useCallback(()=>{M(Ue=>!Ue)},[]),We=yt.useCallback(()=>{i&&(i(),M(!1))},[i]),Je=h.current,Ze=yt.useMemo(()=>JSON.stringify({year:ve.year??"all",month:ve.month??"all",icon:ve.icon??"all"}),[ve]),Vt=yt.useMemo(()=>Je?me.jsx(yt.Fragment,{children:O.map(Ue=>me.jsx(rS,{map:Je,feature:Ue,onSelect:ie},Ue.properties.id??`${Ue.geometry.coordinates.join(",")}-${Ue.properties.year}-${Ue.properties.month}`))},Ze):null,[O,ie,Je,Ze]);return me.jsxs("div",{className:"map-container",children:[me.jsxs("div",{className:"map-header",children:[me.jsxs("div",{className:"map-header-left",children:[me.jsx(hS,{isOpen:T,onToggle:Ge,onNavigateToAbout:We}),me.jsx("h1",{children:"  20172025"})]}),me.jsx("button",{type:"button",className:"secondary-button",onClick:Ee,children:""})]}),me.jsx("div",{className:"map-wrapper",ref:s,"aria-label":""}),me.jsx(nS,{onClick:Ce}),ze&&me.jsx("div",{className:"status-badge",children:"..."}),Fe&&me.jsxs("div",{className:"status-badge error",children:[": ",Fe]}),Vt,me.jsx(lS,{isOpen:y,defaultFilter:ve,onApply:ce,onClose:lt,onReset:Ee}),me.jsx(uS,{feature:l,onClose:te})]})},so="/bear-map-web-sapporo/icon/",rd="/bear-map-web-sapporo/qr/",SS=({onNavigateHome:i})=>{const s=h=>me.jsx("li",{children:h});return me.jsxs("section",{className:"about-page","aria-labelledby":"about-page-title",children:[me.jsxs("div",{className:"about-page-header",children:[me.jsxs("div",{children:[me.jsx("p",{className:"about-page-subtitle",children:"/about"}),me.jsx("h1",{id:"about-page-title",children:""}),me.jsx("p",{className:"about-page-lead",children:""})]}),me.jsx("button",{type:"button",className:"primary-button",onClick:i,children:""})]}),me.jsxs("div",{className:"about-card",children:[me.jsx("h2",{children:""}),me.jsxs("ul",{className:"about-list",children:[s("OpenStreetMap  MapLibre "),s(""),s(""),s(""),s("GeoJSON  data/bears.geojson ")]})]}),me.jsxs("div",{className:"about-card",children:[me.jsx("h2",{children:""}),me.jsx("div",{children:me.jsxs("ul",{className:"about-icon-list",children:[me.jsxs("li",{children:[me.jsx("img",{src:so+"bear.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"like-bear.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"excrement.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"footprint.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"camera.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"voice.svg",width:"32px",height:"32px"})," "]}),me.jsxs("li",{children:[me.jsx("img",{src:so+"other.svg",width:"32px",height:"32px"})," "]})]})}),me.jsx("p",{children:""}),me.jsxs("p",{children:["",me.jsx("br",{}),""]})]}),me.jsxs("div",{className:"about-card",children:[me.jsx("h2",{children:""}),me.jsxs("p",{children:[" GeoJSON ",me.jsx("br",{})," CC BY 4.0 "]})]}),me.jsxs("div",{className:"about-card",children:[me.jsx("h2",{children:""}),me.jsxs("ol",{className:"about-steps",children:[me.jsx("li",{children:""}),me.jsx("li",{children:" "}),me.jsx("li",{children:""}),me.jsx("li",{children:""})]})]}),me.jsxs("div",{className:"about-card",children:[me.jsx("h2",{children:""}),me.jsx("p",{children:""}),me.jsxs("div",{className:"contact-links",children:[me.jsxs("div",{className:"contact-item",children:[me.jsx("h3",{children:""}),me.jsx("a",{href:"mailto:murakami77@nifty.com",children:"murakami77@nifty.com"}),me.jsx("div",{className:"contact-qr",children:me.jsx("img",{src:rd+"qr_sqare_mail_nifty.png",alt:"QR",width:"128",height:"128"})})]}),me.jsxs("div",{className:"contact-item",children:[me.jsx("h3",{children:"X"}),me.jsx("a",{href:"https://x.com/murakami77mm",target:"_blank",rel:"noreferrer",children:"@murakami77mm"}),me.jsx("div",{className:"contact-qr",children:me.jsx("img",{src:rd+"qr_sqare_x_murakami77mm.png",alt:"X QR",width:"128",height:"128"})})]}),me.jsxs("div",{className:"contact-item",children:[me.jsx("h3",{children:"Facebook"}),me.jsx("a",{href:"https://www.facebook.com/masashi0923",target:"_blank",rel:"noreferrer",children:"masashi0923"}),me.jsx("div",{className:"contact-qr",children:me.jsx("img",{src:rd+"qr_sqare_facebook_masashi0923.png",alt:"Facebook QR",width:"128",height:"128"})})]}),me.jsxs("div",{className:"contact-item",children:[me.jsx("h3",{children:"GitHub"}),me.jsx("a",{href:"https://github.com/murakami0923",target:"_blank",rel:"noreferrer",children:"murakami0923"}),me.jsx("div",{className:"contact-qr",children:me.jsx("img",{src:rd+"qr_sqare_github_murakami0923.png",alt:"GitHub QR",width:"128",height:"128"})})]})]})]})]})},Tg=i=>i.length>1&&i.endsWith("/")?i.slice(0,-1):i,kg=i=>i.startsWith("/")?i:`/${i}`,M0="/bear-map-web-sapporo/",uc=Tg(M0),gv=()=>{const i=Tg(window.location.pathname)||"/";if(uc!=="/"&&i.startsWith(uc)){const s=i.slice(uc.length);return s===""?"/":kg(s)}return i===""?"/":i},TS=i=>{const s=kg(i===""?"/":i);return uc==="/"?s:s==="/"?M0:`${Tg(uc)}${s}`},kS=()=>{const[i,s]=yt.useState(()=>gv());yt.useEffect(()=>{const M=()=>{s(gv())};return window.addEventListener("popstate",M),()=>{window.removeEventListener("popstate",M)}},[]);const h=yt.useCallback(M=>{const l=kg(M===""?"/":M);if(l===i)return;const G=TS(l);window.history.pushState({},"",G),s(l)},[i]),y=yt.useCallback(()=>{h("/")},[h]),w=yt.useCallback(()=>{h("/about")},[h]),T=i==="/about";return me.jsxs("div",{className:"app-root",children:[me.jsx("main",{children:T?me.jsx(SS,{onNavigateHome:y}):me.jsx(bS,{onNavigateAbout:w})}),me.jsxs("footer",{className:"app-footer",children:[me.jsxs("p",{children:["",me.jsx("a",{href:"https://www.openstreetmap.org/",target:"_blank",rel:"noopener noreferrer",children:"OpenStreetMap"})," ",""," ",me.jsx("a",{href:"https://www.openstreetmap.org/copyright",target:"_blank",rel:"noopener noreferrer",children:"OpenStreetMap contributors"})," ","",me.jsx("a",{href:"https://opendatacommons.org/licenses/odbl/",target:"_blank",rel:"noopener noreferrer",children:"ODbL"})," ",""]}),me.jsxs("p",{children:["",me.jsx("a",{href:"https://ckan.pf-sapporo.jp/dataset/sapporo_bear_appearance",target:"_blank",rel:"noopener noreferrer",children:""}),me.jsx("br",{}),"CSVGeoJSON",me.jsx("br",{}),""," ",me.jsx("a",{href:"https://creativecommons.org/licenses/by/4.0/deed.ja",target:"_blank",rel:"noopener noreferrer",children:"  4.0 CC BY 4.0"})," ","",me.jsx("br",{})," , CC BY 4.0"]})]})]})},ES=()=>{const i=document.getElementById("root");if(!i)throw new Error("root ");Ff.createRoot(i).render(me.jsx($w.StrictMode,{children:me.jsx(kS,{})}))};ES();
